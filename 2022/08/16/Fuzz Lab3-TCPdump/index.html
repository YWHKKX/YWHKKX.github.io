<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Fuzz-Lab3：TCPdump在本练习中，我们将 fuzz TCPdump 数据包分析器（截取网络分组，并输出分组内容的工具），目标是在 TCPdump 4.9.2 中找到 [CVE-2017-13028] 的 crash&#x2F;PoC  CVE-2017-13028 是一个越界读取漏洞，可以通过 BOOTP 数据包（引导协议）触发 越界读取是当程序读取超出预期缓冲区末尾或开头之前的数据时发生的漏洞">
<meta property="og:type" content="article">
<meta property="og:title" content="Fuzz Lab3-TCPdump">
<meta property="og:url" content="http://example.com/2022/08/16/Fuzz%20Lab3-TCPdump/index.html">
<meta property="og:site_name" content="Pwn进你的心">
<meta property="og:description" content="Fuzz-Lab3：TCPdump在本练习中，我们将 fuzz TCPdump 数据包分析器（截取网络分组，并输出分组内容的工具），目标是在 TCPdump 4.9.2 中找到 [CVE-2017-13028] 的 crash&#x2F;PoC  CVE-2017-13028 是一个越界读取漏洞，可以通过 BOOTP 数据包（引导协议）触发 越界读取是当程序读取超出预期缓冲区末尾或开头之前的数据时发生的漏洞">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2022/08/16/Fuzz%20Lab3-TCPdump/1660639958590.png">
<meta property="og:image" content="http://example.com/2022/08/16/Fuzz%20Lab3-TCPdump/1660657166128.png">
<meta property="article:published_time" content="2022-08-16T14:38:36.000Z">
<meta property="article:modified_time" content="2022-10-09T16:09:21.779Z">
<meta property="article:author" content="yhellow">
<meta property="article:tag" content="labs">
<meta property="article:tag" content="fuzz">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/08/16/Fuzz%20Lab3-TCPdump/1660639958590.png">

<link rel="canonical" href="http://example.com/2022/08/16/Fuzz%20Lab3-TCPdump/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Fuzz Lab3-TCPdump | Pwn进你的心</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Pwn进你的心</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/08/16/Fuzz%20Lab3-TCPdump/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yhellow">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pwn进你的心">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Fuzz Lab3-TCPdump
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-08-16 22:38:36" itemprop="dateCreated datePublished" datetime="2022-08-16T22:38:36+08:00">2022-08-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-10-10 00:09:21" itemprop="dateModified" datetime="2022-10-10T00:09:21+08:00">2022-10-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Knowledge/" itemprop="url" rel="index"><span itemprop="name">Knowledge</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>16k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>15 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Fuzz-Lab3：TCPdump"><a href="#Fuzz-Lab3：TCPdump" class="headerlink" title="Fuzz-Lab3：TCPdump"></a>Fuzz-Lab3：TCPdump</h2><p>在本练习中，我们将 fuzz <strong>TCPdump</strong> 数据包分析器（截取网络分组，并输出分组内容的工具），目标是在 TCPdump 4.9.2 中找到 [<strong>CVE-2017-13028</strong>] 的 crash/PoC</p>
<ul>
<li><strong>CVE-2017-13028</strong> 是一个越界读取漏洞，可以通过 BOOTP 数据包（引导协议）触发<ul>
<li>越界读取是当程序读取超出预期缓冲区末尾或开头之前的数据时发生的漏洞</li>
<li>结果，它允许远程攻击者导致拒绝服务或可能从进程内存中获取潜在的敏感信息</li>
</ul>
</li>
</ul>
<p>学习的目标：</p>
<ul>
<li>什么是 <strong>ASan (Address Sanitizer)</strong>，一个运行时内存错误检测工具</li>
<li>如何使用 ASAN 对目标进行模糊测试</li>
<li>使用 ASan 对崩溃进行分类有多容易</li>
</ul>
<h2 id="Do-it-yourself"><a href="#Do-it-yourself" class="headerlink" title="Do it yourself!"></a>Do it yourself!</h2><p>为了完成这个练习，你需要：</p>
<ul>
<li>找到一种对 TCPdump 进行模糊测试的有效方法</li>
<li>尝试弄清楚如何启用 ASan 进行模糊测试</li>
<li>Fuzz TCPdump，直到你有一些独特的崩溃</li>
<li>对崩溃进行分类以找到漏洞的 PoC</li>
<li>修复问题</li>
</ul>
<h2 id="Download-and-build-your-target"><a href="#Download-and-build-your-target" class="headerlink" title="Download and build your target"></a>Download and build your target</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cd $HOME</span><br><span class="line">mkdir fuzzing_tcpdump &amp;&amp; cd fuzzing_tcpdump/</span><br><span class="line"></span><br><span class="line">cd ..</span><br><span class="line">wget https://github.com/the-tcpdump-group/tcpdump/archive/refs/tags/tcpdump-4.9.2.tar.gz # 下载tcpdump-4.9.2.tar.gz</span><br><span class="line">tar -xzvf tcpdump-4.9.2.tar.gz</span><br><span class="line"></span><br><span class="line">wget https://github.com/the-tcpdump-group/libpcap/archive/refs/tags/libpcap-1.8.0.tar.gz # 下载TCPdump需要的跨平台库libpcap</span><br><span class="line">tar -xzvf libpcap-1.8.0.tar.gz</span><br><span class="line"></span><br><span class="line">mv libpcap-libpcap-1.8.0/ libpcap-1.8.0 # 将libpcap-libpcap-1.8.0重命名为libpcap-1.8.0(否则tcpdump找不到libpcap.a本地路径)</span><br><span class="line"></span><br><span class="line">cd $HOME/libpcap-1.8.0/ # 构建和安装libpcap</span><br><span class="line">./configure --enable-shared=no</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">cd $HOME/tcpdump-tcpdump-4.9.2/ # 构建和安装tcpdump</span><br><span class="line">./configure --prefix=&quot;$HOME/fuzzing_tcpdump/install2/&quot;</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>要测试一切是否正常，只需键入：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">HOME/fuzzing_tcpdump/install2/sbin/tcpdump -h</span></span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">tcpdump version <span class="number">4.9</span><span class="number">.2</span></span><br><span class="line">libpcap version <span class="number">1.8</span><span class="number">.0</span></span><br><span class="line">OpenSSL <span class="number">1.1</span><span class="number">.1f</span>  <span class="number">31</span> Mar <span class="number">2020</span></span><br><span class="line">Usage: tcpdump [-aAbdDefhHIJKlLnNOpqStuUvxX#] [ -B size ] [ -c count ]</span><br><span class="line">		[ -C file_size ] [ -E algo:secret ] [ -F file ] [ -G seconds ]</span><br><span class="line">		[ -i interface ] [ -j tstamptype ] [ -M secret ] [ --number ]</span><br><span class="line">		[ -Q in|out|inout ]</span><br><span class="line">		[ -r file ] [ -s snaplen ] [ --time-stamp-precision precision ]</span><br><span class="line">		[ --immediate-mode ] [ -T type ] [ --version ] [ -V file ]</span><br><span class="line">		[ -w file ] [ -W filecount ] [ -y datalinktype ] [ -z postrotate-command ]</span><br><span class="line">		[ -Z user ] [ expression ]</span><br></pre></td></tr></table></figure>
<h2 id="Seed-corpus-creation"><a href="#Seed-corpus-creation" class="headerlink" title="Seed corpus creation"></a>Seed corpus creation</h2><p>您可以在 tests 文件夹中找到很多 .pcap 示例。 您可以使用以下命令行运行这些 .pcap 文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">HOME/fuzzing_tcpdump/install/sbin/tcpdump -vvvvXX -ee -nn -r ./tests/geneve.pcap</span></span><br></pre></td></tr></table></figure>
<ul>
<li>pcap 文件是常用的数据报存储格式（拖入 wireshark 就可以直接查看），可以理解为就是一种文件格式，只不过里面的数据是按照特定格式存储的</li>
<li>所以我们想要解析里面的数据，也必须按照一定的格式，比如使用 wireshark 或者 tcpdump</li>
</ul>
<p>结果：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">reading from file ./tests/geneve.pcap, link-<span class="function">type <span class="title">EN10MB</span> <span class="params">(Ethernet)</span></span></span><br><span class="line"><span class="function">06:04:33.817203 00:1b:21:3c:ab:64 &gt; 00:1b:21:3c:ac:30, ethertype <span class="title">IPv4</span> <span class="params">(<span class="number">0x0800</span>)</span>, length 156: <span class="params">(tos <span class="number">0x0</span>, ttl <span class="number">64</span>, id <span class="number">57261</span>, offset <span class="number">0</span>, flags [DF], proto UDP (<span class="number">17</span>), length <span class="number">142</span>)</span></span></span><br><span class="line"><span class="function">    20.0.0.1.12618 &gt; 20.0.0.2.6081: [no cksum] Geneve, Flags [C], vni 0xa, proto <span class="title">TEB</span> <span class="params">(<span class="number">0x6558</span>)</span>, options [class <span class="title">Standard</span> <span class="params">(<span class="number">0x0</span>)</span> type 0<span class="title">x80</span><span class="params">(C)</span> len 8 data 0000000c]</span></span><br><span class="line"><span class="function">	b6:9e:d2:49:51:48 &gt; fe:71:d8:83:72:4f, ethertype <span class="title">IPv4</span> <span class="params">(<span class="number">0x0800</span>)</span>, length 98: <span class="params">(tos <span class="number">0x0</span>, ttl <span class="number">64</span>, id <span class="number">48546</span>, offset <span class="number">0</span>, flags [DF], proto ICMP (<span class="number">1</span>), length <span class="number">84</span>)</span></span></span><br><span class="line"><span class="function">    30.0.0.1 &gt; 30.0.0.2: ICMP echo request, id 10578, seq 23, length 64</span></span><br><span class="line"><span class="function">	0x0000:  001b 213c ac30 001b 213c ab64 0800 4500  ..!&lt;.0..!&lt;.d..E.</span></span><br><span class="line"><span class="function">	0x0010:  008e dfad 4000 4011 32af 1400 0001 1400  ....@.@.2.......</span></span><br><span class="line"><span class="function">	0x0020:  0002 314a 17c1 007a 0000 0240 6558 0000  ..1J...z...@eX..</span></span><br><span class="line"><span class="function">	0x0030:  0a00 0000 8001 0000 000c fe71 d883 724f  ...........q..rO</span></span><br><span class="line"><span class="function">	0x0040:  b69e d249 5148 0800 4500 0054 bda2 4000  ...IQH..E..T..@.</span></span><br><span class="line"><span class="function">	0x0050:  4001 4104 1e00 0001 1e00 0002 0800 2c54  @.A...........,T</span></span><br><span class="line"><span class="function">	0x0060:  2952 0017 f1a2 ce54 0000 0000 1778 0c00  )R.....T.....x..</span></span><br><span class="line"><span class="function">	0x0070:  0000 0000 1011 1213 1415 1617 1819 1a1b  ................</span></span><br><span class="line"><span class="function">	0x0080:  1c1d 1e1f 2021 2223 2425 2627 2829 2a2b  .....!&quot;#$%&amp;&#x27;<span class="params">()</span>*+</span></span><br><span class="line"><span class="function">	0x0090:  2c2d 2e2f 3031 3233 3435 3637            ,-./01234567</span></span><br><span class="line"><span class="function">06:04:33.817454 00:1b:21:3c:ac:30 &gt; 00:1b:21:3c:ab:64, ethertype <span class="title">IPv4</span> <span class="params">(<span class="number">0x0800</span>)</span>, length 148: <span class="params">(tos <span class="number">0x0</span>, ttl <span class="number">64</span>, id <span class="number">34821</span>, offset <span class="number">0</span>, flags [DF], proto UDP (<span class="number">17</span>), length <span class="number">134</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">......</span></span><br></pre></td></tr></table></figure>
<ul>
<li>和 wireshark 显示的结果大同小异</li>
</ul>
<h2 id="AddressSanitizer"><a href="#AddressSanitizer" class="headerlink" title="AddressSanitizer"></a>AddressSanitizer</h2><p><strong>AddressSanitizer (ASan)</strong> 是用于 C 和 C++ 的快速内存错误检测器</p>
<ul>
<li>它最初由 Google（Konstantin Serebryany、Derek Bruening、Alexander Potapenko、Dmitry Vyukov）开发，并于 2011 年 5 月首次发布</li>
<li>它由一个编译器检测模块和一个运行时库组成，该工具能够发现对堆、堆栈和全局对象的越界访问，以及释放后使用、双重释放和内存泄漏错误</li>
<li>AddressSanitizer 是开源的，从 3.1 版开始与 LLVM 编译器工具链集成，虽然它最初是作为 LLVM 项目开发的，但它已被移植到 GCC 并包含在 &gt;= 4.8 的 GCC 版本中</li>
</ul>
<p>现在我们将构建启用 ASAN 的 tcpdump（和 libpcap），首先，我们要清理所有以前编译的目标文件和可执行文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd $HOME/libpcap-1.8.0/</span><br><span class="line">make clean</span><br><span class="line"></span><br><span class="line">cd $HOME/tcpdump-tcpdump-4.9.2/</span><br><span class="line">make clean</span><br></pre></td></tr></table></figure>
<p>现在，我们在调用“configure”和“make”之前设置“AFL_USE_ASAN=1”：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cd $HOME/libpcap-1.8.0/</span><br><span class="line">export LLVM_CONFIG=&quot;llvm-config-11&quot;</span><br><span class="line">CC=afl-clang-lto ./configure --enable-shared=no --prefix=&quot;$HOME/fuzzing_tcpdump/install/&quot;</span><br><span class="line">AFL_USE_ASAN=1 make</span><br><span class="line">AFL_USE_ASAN=1 make install</span><br><span class="line"></span><br><span class="line">cd $HOME/tcpdump-tcpdump-4.9.2/</span><br><span class="line">AFL_USE_ASAN=1 CC=afl-clang-lto ./configure --prefix=&quot;$HOME/fuzzing_tcpdump/install/&quot;</span><br><span class="line">AFL_USE_ASAN=1 make</span><br><span class="line">AFL_USE_ASAN=1 make install</span><br></pre></td></tr></table></figure>
<h2 id="Fuzz-TCPdump"><a href="#Fuzz-TCPdump" class="headerlink" title="Fuzz TCPdump"></a>Fuzz TCPdump</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afl-fuzz -m none -i $HOME/tcpdump-tcpdump-4.9.2/tests/ -o $HOME/fuzzing_tcpdump/out/ -s 123 -- $HOME/fuzzing_tcpdump/install/sbin/tcpdump -vvvvXX -ee -nn -r @@</span><br></pre></td></tr></table></figure>
<ul>
<li>注意：64 位系统上的 ASAN 需要大量虚拟内存，需要设置了标志 “-m none” 来禁用 AFL 中的内存限制</li>
</ul>
<img src="/2022/08/16/Fuzz%20Lab3-TCPdump/1660639958590.png" class width="1660639958590"> 
<ul>
<li>PS：4小时，太慢了~~</li>
</ul>
<h2 id="Triage"><a href="#Triage" class="headerlink" title="Triage"></a>Triage</h2><p>调试使用 ASan 构建的程序比前面的练习要容易得多，您需要做的就是向程序提供崩溃文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">HOME/fuzzing_tcpdump/install/sbin/tcpdump -vvvvXX -ee -nn -r ./id:000000,sig:06,src:005014,time:6037115,execs:4952858,op:havoc,rep:16</span></span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">Warning: AFL++ tools might need to <span class="built_in">set</span> AFL_MAP_SIZE to <span class="number">84065</span> to be able to run <span class="keyword">this</span> instrumented program <span class="keyword">if</span> <span class="keyword">this</span> crashes!</span><br><span class="line">reading from file ./id:<span class="number">000000</span>,sig:<span class="number">06</span>,src:<span class="number">005014</span>,time:<span class="number">6037115</span>,execs:<span class="number">4952858</span>,op:havoc,rep:<span class="number">16</span>, link-<span class="function">type <span class="title">EN10MB</span> <span class="params">(Ethernet)</span></span></span><br><span class="line"><span class="function">04:27:12.000006 01:01:01:0d:01:01 &gt; ed:e9:ff:ff:ff:ff, ethertype <span class="title">IPv4</span> <span class="params">(<span class="number">0x0800</span>)</span>, length 67: truncated-ip - 2607 bytes missing! <span class="params">(tos <span class="number">0xe5</span>,ECT(<span class="number">1</span>), ttl <span class="number">252</span>, id <span class="number">8264</span>, offset <span class="number">0</span>, flags [none], proto UDP (<span class="number">17</span>), length <span class="number">2660</span>, bad cksum <span class="number">121</span> (-&gt;d6d1)!)</span></span></span><br><span class="line"><span class="function">    222.241.104.198.53 &gt; 131.63.241.146.67: 212 op8 ServFail|$ [41218q] q: <span class="title">Type212</span> <span class="params">(Class <span class="number">50098</span>)</span>? ., q:[|domain]</span></span><br><span class="line"><span class="function">	0x0000:  ede9 ffff ffff 0101 010d 0101 0800 45e5  ..............E.</span></span><br><span class="line"><span class="function">	0x0010:  0a64 2048 0000 fc11 0121 def1 68c6 833f  .d.H.....!..h..?</span></span><br><span class="line"><span class="function">	0x0020:  f192 0035 0043 1800 5002 00d4 c3b2 a102  ...5.C..P.......</span></span><br><span class="line"><span class="function">	0x0030:  0004 0000 0000 0000 d4c3 b2a1 0200 0400  ................</span></span><br><span class="line"><span class="function">	0x0040:  0000 0001 0000 0000 5d00 0000            ........]...</span></span><br><span class="line"><span class="function">08:01:59.1399853056 59:59:d4:c3:b2:a1 &gt; 00:00:00:00:00:71, 802.3, length 512: LLC, dsap <span class="title">SNA</span> <span class="params">(<span class="number">0x04</span>)</span> Individual, ssap <span class="title">Null</span> <span class="params">(<span class="number">0x00</span>)</span> Command, ctrl 0x0000: Information, send seq 0, rcv seq 0, Flags [Command], length 587271413</span></span><br><span class="line"><span class="function">	0x0000:  0000 0000 0071 5959 d4c3 b2a1 0200 0400  .....qYY........</span></span><br><span class="line"><span class="function">	0x0010:  0000 0000 0000 0000 ffff 0000 0100 0000  ................</span></span><br><span class="line"><span class="function">23:17:28.958610 00:04:23:57:a5:7a &gt; ff:ff:ff:ff:ef:ff, ethertype <span class="title">IPv4</span> <span class="params">(<span class="number">0x0800</span>)</span>, length 221: <span class="params">(tos <span class="number">0x0</span>, ttl <span class="number">128</span>, id <span class="number">14471</span>, offset <span class="number">0</span>, flags [none], proto UDP (<span class="number">17</span>), length <span class="number">207</span>)</span></span></span><br><span class="line"><span class="function">    192.168.1.249.138 &gt; 192.168.1.255.138: </span></span><br><span class="line"><span class="function">&gt;&gt;&gt; NBT UDP <span class="title">PACKET</span><span class="params">(<span class="number">138</span>)</span> Res</span>=<span class="number">0x110E</span> ID=<span class="number">0x891D</span> IP=<span class="number">192</span> (<span class="number">0xc0</span>)<span class="number">.168</span> (<span class="number">0xa8</span>)<span class="number">.1</span> (<span class="number">0x1</span>)<span class="number">.249</span> (<span class="number">0xf9</span>) Port=<span class="number">650</span> (<span class="number">0x28a</span>) Length=<span class="number">165</span> (<span class="number">0xa5</span>) Res2=<span class="number">0x0</span></span><br><span class="line">SourceName=DJP95S0J        NameType=<span class="number">0x00</span> (Workstation)</span><br><span class="line">DestName=ARBEITSGRUPPE   NameType=<span class="number">0x00</span> (Workstation)</span><br><span class="line"></span><br><span class="line">SMB PACKET: SMBtrans (REQUEST)</span><br><span class="line">SMB Command   =  <span class="number">0x25</span></span><br><span class="line">Error class   =  <span class="number">0x0</span></span><br><span class="line">Error code    =  <span class="number">0</span> (<span class="number">0x0</span>)</span><br><span class="line">Flags1        =  <span class="number">0x0</span></span><br><span class="line">Flags2        =  <span class="number">0x0</span></span><br><span class="line">Tree ID       =  <span class="number">0</span> (<span class="number">0x0</span>)</span><br><span class="line">Proc ID       =  <span class="number">0</span> (<span class="number">0x0</span>)</span><br><span class="line">UID           =  <span class="number">0</span> (<span class="number">0x0</span>)</span><br><span class="line">MID           =  <span class="number">0</span> (<span class="number">0x0</span>)</span><br><span class="line">Word Count    =  <span class="number">17</span> (<span class="number">0x11</span>)</span><br><span class="line">TotParamCnt=<span class="number">0</span> (<span class="number">0x0</span>) </span><br><span class="line">TotDataCnt=<span class="number">11</span> (<span class="number">0xb</span>) </span><br><span class="line">MaxParmCnt=<span class="number">0</span> (<span class="number">0x0</span>) </span><br><span class="line">MaxDataCnt=<span class="number">0</span> (<span class="number">0x0</span>)</span><br><span class="line">MaxSCnt=<span class="number">0</span> (<span class="number">0x0</span>) </span><br><span class="line">TransFlags=<span class="number">0x0</span> </span><br><span class="line">Res1=<span class="number">0x3E9</span> </span><br><span class="line">Res2=<span class="number">0x0</span> </span><br><span class="line">Res3=<span class="number">0x0</span></span><br><span class="line">ParamCnt=<span class="number">0</span> (<span class="number">0x0</span>) </span><br><span class="line">ParamOff=<span class="number">0</span> (<span class="number">0x0</span>) </span><br><span class="line">DataCnt=<span class="number">11</span> (<span class="number">0xb</span>) </span><br><span class="line">DataOff=<span class="number">86</span> (<span class="number">0x56</span>) </span><br><span class="line">SUCnt=<span class="number">3</span> (<span class="number">0x3</span>)</span><br><span class="line">Data: (<span class="number">6</span> bytes)</span><br><span class="line">[<span class="number">000</span>] <span class="number">01</span> <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">02</span> <span class="number">00</span>                                 \<span class="number">0x01</span>\<span class="number">0x00</span>\<span class="number">0x01</span>\<span class="number">0x00</span>\<span class="number">0x02</span>\<span class="number">0x00</span> </span><br><span class="line">smb_bcc=<span class="number">28</span></span><br><span class="line">=================================================================</span><br><span class="line">==<span class="number">2727</span>==ERROR: AddressSanitizer: heap-buffer-overflow on address <span class="number">0x611000000107</span> at pc <span class="number">0x0000003d0235</span> bp <span class="number">0x7ffc22dc8210</span> sp <span class="number">0x7ffc22dc79b8</span> <span class="comment">/* 对应代码的位置 */</span></span><br><span class="line">READ of size <span class="number">7</span> at <span class="number">0x611000000107</span> thread T0 <span class="comment">/* heap中的溢出点 */</span></span><br><span class="line">    #<span class="number">0</span> <span class="number">0x3d0234</span> in <span class="built_in">strcmp</span> (/home/yhellow/fuzzing_tcpdump/install/sbin/tcpdump+<span class="number">0x3d0234</span>)</span><br><span class="line">    #<span class="number">1</span> <span class="number">0x712469</span> in print_trans /home/yhellow/tcpdump-tcpdump<span class="number">-4.9</span><span class="number">.2</span>/./print-smb.c:<span class="number">375</span>:<span class="number">6</span></span><br><span class="line">    #<span class="number">2</span> <span class="number">0x713f6a</span> in print_smb /home/yhellow/tcpdump-tcpdump<span class="number">-4.9</span><span class="number">.2</span>/./print-smb.c:<span class="number">863</span>:<span class="number">6</span></span><br><span class="line">    #<span class="number">3</span> <span class="number">0x6ec5e1</span> in nbt_udp138_print /home/yhellow/tcpdump-tcpdump<span class="number">-4.9</span><span class="number">.2</span>/./print-smb.c:<span class="number">1307</span>:<span class="number">6</span></span><br><span class="line">    #<span class="number">4</span> <span class="number">0x6ec5e1</span> in udp_print /home/yhellow/tcpdump-tcpdump<span class="number">-4.9</span><span class="number">.2</span>/./print-udp.c:<span class="number">608</span>:<span class="number">4</span></span><br><span class="line">    #<span class="number">5</span> <span class="number">0x55dfe8</span> in ip_print_demux /home/yhellow/tcpdump-tcpdump<span class="number">-4.9</span><span class="number">.2</span>/./print-ip.c:<span class="number">402</span>:<span class="number">3</span></span><br><span class="line">    #<span class="number">6</span> <span class="number">0x5616e5</span> in ip_print /home/yhellow/tcpdump-tcpdump<span class="number">-4.9</span><span class="number">.2</span>/./print-ip.c:<span class="number">673</span>:<span class="number">3</span></span><br><span class="line">    #<span class="number">7</span> <span class="number">0x51ac27</span> in ethertype_print /home/yhellow/tcpdump-tcpdump<span class="number">-4.9</span><span class="number">.2</span>/./print-ether.c:<span class="number">333</span>:<span class="number">10</span></span><br><span class="line">    #<span class="number">8</span> <span class="number">0x51996a</span> in ether_print /home/yhellow/tcpdump-tcpdump<span class="number">-4.9</span><span class="number">.2</span>/./print-ether.c:<span class="number">236</span>:<span class="number">7</span></span><br><span class="line">    #<span class="number">9</span> <span class="number">0x4791ab</span> in pretty_print_packet /home/yhellow/tcpdump-tcpdump<span class="number">-4.9</span><span class="number">.2</span>/./print.c:<span class="number">332</span>:<span class="number">18</span></span><br><span class="line">    #<span class="number">10</span> <span class="number">0x4791ab</span> in print_packet /home/yhellow/tcpdump-tcpdump<span class="number">-4.9</span><span class="number">.2</span>/./tcpdump.c:<span class="number">2497</span>:<span class="number">2</span></span><br><span class="line">    #<span class="number">11</span> <span class="number">0x83da5d</span> in pcap_offline_read /home/yhellow/libpcap<span class="number">-1.8</span><span class="number">.0</span>/./savefile.c:<span class="number">507</span>:<span class="number">4</span></span><br><span class="line">    #<span class="number">12</span> <span class="number">0x470c0c</span> in pcap_loop /home/yhellow/libpcap<span class="number">-1.8</span><span class="number">.0</span>/./pcap.c:<span class="number">875</span>:<span class="number">8</span></span><br><span class="line">    #<span class="number">13</span> <span class="number">0x470c0c</span> in main /home/yhellow/tcpdump-tcpdump<span class="number">-4.9</span><span class="number">.2</span>/./tcpdump.c:<span class="number">2000</span>:<span class="number">12</span></span><br><span class="line">    #<span class="number">14</span> <span class="number">0x7fa3263bb082</span> in __libc_start_main /build/glibc-SzIz7B/glibc<span class="number">-2.31</span>/csu/../csu/libc-start.c:<span class="number">308</span>:<span class="number">16</span></span><br><span class="line">    #<span class="number">15</span> <span class="number">0x3bcedd</span> in _start (/home/yhellow/fuzzing_tcpdump/install/sbin/tcpdump+<span class="number">0x3bcedd</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">0x611000000107</span> is located <span class="number">0</span> bytes to the right of <span class="number">199</span>-byte region [<span class="number">0x611000000040</span>,<span class="number">0x611000000107</span>)</span><br><span class="line">allocated by thread T0 here:</span><br><span class="line">    #<span class="number">0</span> <span class="number">0x436f4d</span> in <span class="built_in">malloc</span> (/home/yhellow/fuzzing_tcpdump/install/sbin/tcpdump+<span class="number">0x436f4d</span>)</span><br><span class="line">    #<span class="number">1</span> <span class="number">0x83efd8</span> in pcap_check_header /home/yhellow/libpcap<span class="number">-1.8</span><span class="number">.0</span>/./sf-pcap.c:<span class="number">401</span>:<span class="number">14</span></span><br><span class="line">    #<span class="number">2</span> <span class="number">0x83ce1d</span> in pcap_fopen_offline_with_tstamp_precision /home/yhellow/libpcap<span class="number">-1.8</span><span class="number">.0</span>/./savefile.c:<span class="number">380</span>:<span class="number">7</span></span><br><span class="line">    #<span class="number">3</span> <span class="number">0x83cb48</span> in pcap_open_offline_with_tstamp_precision /home/yhellow/libpcap<span class="number">-1.8</span><span class="number">.0</span>/./savefile.c:<span class="number">287</span>:<span class="number">6</span></span><br><span class="line"></span><br><span class="line">SUMMARY: AddressSanitizer: heap-buffer-overflow (/home/yhellow/fuzzing_tcpdump/install/sbin/tcpdump+<span class="number">0x3d0234</span>) in <span class="built_in">strcmp</span></span><br><span class="line">Shadow bytes around the buggy address:</span><br><span class="line">  <span class="number">0x0c227fff7fd0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0c227fff7fe0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0c227fff7ff0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0c227fff8000</span>: fa fa fa fa fa fa fa fa <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0c227fff8010</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">=&gt;<span class="number">0x0c227fff8020</span>:[<span class="number">07</span>]fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">  <span class="number">0x0c227fff8030</span>: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">  <span class="number">0x0c227fff8040</span>: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">  <span class="number">0x0c227fff8050</span>: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">  <span class="number">0x0c227fff8060</span>: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">  <span class="number">0x0c227fff8070</span>: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">Shadow byte legend (one shadow byte represents <span class="number">8</span> application bytes):</span><br><span class="line">  Addressable:           <span class="number">00</span></span><br><span class="line">  Partially addressable: <span class="number">01</span> <span class="number">02</span> <span class="number">03</span> <span class="number">04</span> <span class="number">05</span> <span class="number">06</span> <span class="number">07</span> </span><br><span class="line">  Heap left redzone:       fa</span><br><span class="line">  Freed heap region:       fd</span><br><span class="line">  Stack left redzone:      f1</span><br><span class="line">  Stack mid redzone:       f2</span><br><span class="line">  Stack right redzone:     f3</span><br><span class="line">  Stack after <span class="keyword">return</span>:      f5</span><br><span class="line">  Stack use after scope:   f8</span><br><span class="line">  Global redzone:          f9</span><br><span class="line">  Global init order:       f6</span><br><span class="line">  Poisoned by user:        f7</span><br><span class="line">  Container overflow:      fc</span><br><span class="line">  Array cookie:            ac</span><br><span class="line">  Intra object redzone:    bb</span><br><span class="line">  ASan internal:           fe</span><br><span class="line">  Left alloca redzone:     ca</span><br><span class="line">  Right alloca redzone:    cb</span><br><span class="line">  Shadow gap:              cc</span><br><span class="line">==<span class="number">2727</span>==ABORTING</span><br></pre></td></tr></table></figure>
<ul>
<li>程序 crash 的原因为 heap-buffer-overflow（堆溢出）</li>
</ul>
<p>[<strong>CVE-2017-13028</strong>] 的漏洞点是 <code>bootp_print()</code> ，而这里的漏洞点是 <code>print_trans()</code></p>
<p>后来发现这个是 <strong>[CVE-2018-16451]</strong> 的漏洞点，因为没有 fuzz 出 [<strong>CVE-2017-13028</strong>] 的漏洞，而我又不想继续 fuzz 了，干脆就复现 <strong>[CVE-2018-16451]</strong> 算了</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://avd.aliyun.com/detail?id=AVD-2018-16451">阿里云漏洞库 (aliyun.com)</a> </li>
</ul>
<h2 id="Reproduce-the-crash"><a href="#Reproduce-the-crash" class="headerlink" title="Reproduce the crash"></a>Reproduce the crash</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb --args ./tcpdump -vvvvXX -ee -nn -r ./test</span><br></pre></td></tr></table></figure>
<ul>
<li>在 <code>print_trans</code> 打上断点，单步到执行 <code>strcmp</code> 的位置：</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">► <span class="number">0x712465</span> &lt;print_trans+<span class="number">1509</span>&gt;    call   <span class="built_in">strcmp</span>                      &lt;<span class="built_in">strcmp</span>&gt;</span><br><span class="line">       s1: <span class="number">0x611000000101</span> ◂— <span class="number">0x534c49414d5c</span> <span class="comment">/* &#x27;\\MAILS&#x27; */</span></span><br><span class="line">       s2: <span class="number">0x34e960</span> (str<span class="number">.275</span>) ◂— <span class="string">&#x27;\\MAILSLOT\\BROWSE&#x27;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>再次单步过后，ASan 检测到内存错误，并中断程序：</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; ni</span><br><span class="line">=================================================================</span><br><span class="line">==<span class="number">5418</span>==ERROR: AddressSanitizer: heap-buffer-overflow on address <span class="number">0x611000000107</span> at pc <span class="number">0x0000003d0235</span> bp <span class="number">0x7fffffffbb30</span> sp <span class="number">0x7fffffffb2d8</span></span><br><span class="line">READ of size <span class="number">7</span> at <span class="number">0x611000000107</span> thread T0</span><br><span class="line">[Attaching after Thread <span class="number">0x7ffff7947800</span> (LWP <span class="number">5418</span>) fork to child process <span class="number">5422</span>]</span><br><span class="line">[New inferior <span class="number">2</span> (process <span class="number">5422</span>)]</span><br><span class="line">[Detaching after fork from parent process <span class="number">5418</span>]</span><br><span class="line">[Inferior <span class="number">1</span> (process <span class="number">5418</span>) detached]</span><br><span class="line">[Thread debugging <span class="keyword">using</span> libthread_db enabled]</span><br><span class="line">Using host libthread_db library <span class="string">&quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;</span>.</span><br><span class="line">process <span class="number">5422</span> is executing <span class="keyword">new</span> program: /usr/lib/llvm<span class="number">-11</span>/bin/llvm-symbolizer</span><br><span class="line">Warning:</span><br><span class="line">Cannot insert breakpoint <span class="number">1.</span></span><br><span class="line">Cannot access memory at address <span class="number">0x712465</span></span><br></pre></td></tr></table></figure>
<ul>
<li>我第一时间不清楚 ASan 给出的报错信息和程序漏洞之间的关系，所以跟进 <code>strcmp</code> 继续调试</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">► <span class="number">0x3d0252</span> &lt;<span class="built_in">strcmp</span>+<span class="number">482</span>&gt;    call   <span class="number">0x43c5c0</span>                      &lt;<span class="number">0x43c5c0</span>&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>一直跟进到 ASan 记录的地址：<code>0x3d0235</code>（我发现这个 <code>strcmp</code> 的地址有点怪，好像不在 libc 里面）</li>
<li>对比该汇编指令执行前后 [rdx] 寄存器的变化：（讲真，这里我没有看出溢出点）</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">*RDX  <span class="number">0x14</span></span><br><span class="line"> RBP  <span class="number">0x7fffffffbb30</span> —▸ <span class="number">0x611000000101</span> ◂— <span class="number">0x534c49414d5c</span> <span class="comment">/* &#x27;\\MAILS&#x27; */</span></span><br><span class="line">*RIP  <span class="number">0x3d0235</span> (<span class="built_in">strcmp</span>+<span class="number">453</span>) ◂— lea    rdx, [rbp - <span class="number">0x858</span>]</span><br><span class="line">──────────────────────────────────────────────────────────────────────────────────</span><br><span class="line"> ► <span class="number">0x3d0235</span> &lt;<span class="built_in">strcmp</span>+<span class="number">453</span>&gt;    lea    rdx, [rbp - <span class="number">0x858</span>]</span><br><span class="line">   <span class="number">0x3d023c</span> &lt;<span class="built_in">strcmp</span>+<span class="number">460</span>&gt;    mov    rdi, rax</span><br><span class="line">   <span class="number">0x3d023f</span> &lt;<span class="built_in">strcmp</span>+<span class="number">463</span>&gt;    mov    rsi, qword ptr [rbp - <span class="number">0x40</span>]</span><br><span class="line">   <span class="number">0x3d0243</span> &lt;<span class="built_in">strcmp</span>+<span class="number">467</span>&gt;    mov    rcx, qword ptr [rbp - <span class="number">0x38</span>]</span><br><span class="line">   <span class="number">0x3d0247</span> &lt;<span class="built_in">strcmp</span>+<span class="number">471</span>&gt;    <span class="keyword">xor</span>    r8d, r8d</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">*RDX  <span class="number">0x7fffffffb2d8</span> —▸ <span class="number">0x7ffff7b376a0</span> (_IO_2_1_stdout_) —▸ <span class="number">0xfbad2a84</span> ◂— <span class="number">0x0</span></span><br><span class="line"> RBP  <span class="number">0x7fffffffbb30</span> —▸ <span class="number">0x611000000101</span> ◂— <span class="number">0x534c49414d5c</span> <span class="comment">/* &#x27;\\MAILS&#x27; */</span></span><br><span class="line">*RIP  <span class="number">0x3d023c</span> (<span class="built_in">strcmp</span>+<span class="number">460</span>) ◂— mov    rdi, rax</span><br><span class="line">──────────────────────────────────────────────────────────────────────────────────</span><br><span class="line">   <span class="number">0x3d0235</span> &lt;<span class="built_in">strcmp</span>+<span class="number">453</span>&gt;    lea    rdx, [rbp - <span class="number">0x858</span>]</span><br><span class="line"> ► <span class="number">0x3d023c</span> &lt;<span class="built_in">strcmp</span>+<span class="number">460</span>&gt;    mov    rdi, rax</span><br><span class="line">   <span class="number">0x3d023f</span> &lt;<span class="built_in">strcmp</span>+<span class="number">463</span>&gt;    mov    rsi, qword ptr [rbp - <span class="number">0x40</span>]</span><br><span class="line">   <span class="number">0x3d0243</span> &lt;<span class="built_in">strcmp</span>+<span class="number">467</span>&gt;    mov    rcx, qword ptr [rbp - <span class="number">0x38</span>]</span><br><span class="line">   <span class="number">0x3d0247</span> &lt;<span class="built_in">strcmp</span>+<span class="number">471</span>&gt;    <span class="keyword">xor</span>    r8d, r8d</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; telescope <span class="number">0x7fffffffbb30</span><span class="number">-0x858</span></span><br><span class="line"><span class="number">00</span>:<span class="number">0000</span>│ rdx <span class="number">0x7fffffffb2d8</span> —▸ <span class="number">0x7ffff7b376a0</span> (_IO_2_1_stdout_) —▸ <span class="number">0xfbad2a84</span> ◂— <span class="number">0x0</span></span><br></pre></td></tr></table></figure>
<ul>
<li>最后执行 ASan 中的函数（ASan 已经劫持程序流了）</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">► <span class="number">0x43ca69</span>    call   __asan::ScopedInErrorReport::~ScopedInErrorReport()                      &lt;__asan::ScopedInErrorReport::~ScopedInErrorReport()&gt;</span><br><span class="line">       rdi: <span class="number">0x7fffffffb280</span> —▸ <span class="number">0x611000000107</span> ◂— <span class="number">0x0</span></span><br><span class="line">       rsi: <span class="number">0x7fffffffabe0</span> ◂— <span class="number">0x7fff00000016</span></span><br><span class="line">       rdx: <span class="number">0x690</span></span><br><span class="line">       rcx: <span class="number">0x0</span></span><br></pre></td></tr></table></figure>
<p>想要理解 ASan 的报错信息，可以参考以下博客：（这里就记录一下我的学习笔记）</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43708622/article/details/117966519">理解ASAN的shadow memory和读懂报错信息</a> </li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/21cnbao/article/details/107096665">ASAN和HWASAN原理解析</a> </li>
</ul>
<p><strong>shadow memory</strong></p>
<p>shadow memory 也是内存中的一块区域，但与 main memory 又不同，shadow memory 有中元数据的思想，其中的数据放映的是 main memory 的状态信息，因此，可以将 shadow memory 看做是 main memory 的元数据，而 main memory 中存储的才是程序真正的数据</p>
<p>Malloc 函数返回的地址通常是8字节对齐的，因此可以用9种状态，来表示8字节对齐的内存可访问(可寻址)状态：</p>
<img src="/2022/08/16/Fuzz%20Lab3-TCPdump/1660657166128.png" class width="1660657166128"> 
<ul>
<li>所有的8个字节都可寻址，shadow memory 值为0</li>
<li>所有的8个字节都不可寻址，shadow memory 值为负数</li>
<li>前 k(0≤k≤7) 个字节可寻址，剩下的 7-k 个字节不可寻址，shadow memory 的值为k</li>
</ul>
<p>我们知道 malloc 函数返回的地址通常是8字节对齐的，因此任意一个由（对齐的）8字节所组成的内存区域必然落在以上9种状态之中，这9种状态便可以用 shadow memory 中的一个字节来进行编码</p>
<p>所有的8个字节都不可寻址其实可以继续分为多种情况，譬如： </p>
<ul>
<li>Heap left redzone:       fa</li>
<li>Freed heap region:       fd</li>
<li>Stack left redzone:      f1</li>
<li>Stack mid redzone:       f2</li>
<li>Stack right redzone:     f3</li>
<li>Stack after return:      f5</li>
<li>Stack use after scope:   f8</li>
<li>Global redzone:          f9</li>
<li>Global init order:       f6</li>
<li>Poisoned by user:        f7</li>
<li>Container overflow:      fc</li>
<li>Array cookie:            ac</li>
<li>Intra object redzone:    bb</li>
<li>ASan internal:           fe</li>
<li>Left alloca redzone:     ca</li>
<li>Right alloca redzone:    cb</li>
<li>Shadow gap:              cc</li>
</ul>
<p>案例：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2021 junfu0903@aliyun.com.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unpublished copyright. All rights reserved. This material contains</span></span><br><span class="line"><span class="comment"> * proprietary information that should be used or copied only within</span></span><br><span class="line"><span class="comment"> * junfu0903@aliyun.com, except with written permission of junfu0903@aliyun.com.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @file heap_buffer_overflow.c</span></span><br><span class="line"><span class="comment"> * @brief</span></span><br><span class="line"><span class="comment"> * @author junfu0903@aliyun.com</span></span><br><span class="line"><span class="comment"> * @version 1.0.0</span></span><br><span class="line"><span class="comment"> * @date 2021-06-15 10:18:45</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *p = <span class="literal">NULL</span>;</span><br><span class="line">    p = (<span class="keyword">char</span>*)<span class="built_in">malloc</span>(<span class="number">16</span>);</span><br><span class="line">    p[<span class="number">17</span>] = <span class="number">12</span>;</span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc test.c -o test -fsanitize=address -fsanitize-recover=all -fsanitize=leak -no-pie -fno-omit-frame-pointer -g </span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">==<span class="number">6154</span>==ERROR: AddressSanitizer: heap-buffer-overflow on address <span class="number">0x602000000021</span> at pc <span class="number">0x00000040121b</span> bp <span class="number">0x7fff11080090</span> sp <span class="number">0x7fff11080080</span> <span class="comment">/* 对应代码的位置 */</span></span><br><span class="line">WRITE of size <span class="number">1</span> at <span class="number">0x602000000021</span> thread T0 <span class="comment">/* heap中的溢出点 */</span></span><br><span class="line">    #<span class="number">0</span> <span class="number">0x40121a</span> in main /home/yhellow/桌面/<span class="built_in">exp</span>/shadow test/test.c:<span class="number">22</span></span><br><span class="line">    #<span class="number">1</span> <span class="number">0x7f9992b66082</span> in __libc_start_main ../csu/libc-start.c:<span class="number">308</span></span><br><span class="line">    #<span class="number">2</span> <span class="number">0x4010fd</span> in _start (/home/yhellow/桌面/<span class="built_in">exp</span>/shadow test/test+<span class="number">0x4010fd</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">0x602000000021</span> is located <span class="number">1</span> bytes to the right of <span class="number">16</span>-byte region [<span class="number">0x602000000010</span>,<span class="number">0x602000000020</span>)</span><br><span class="line">allocated by thread T0 here:</span><br><span class="line">    #<span class="number">0</span> <span class="number">0x7f9992e41808</span> in __interceptor_malloc ../../../../src/libsanitizer/asan/asan_malloc_linux.cc:<span class="number">144</span></span><br><span class="line">    #<span class="number">1</span> <span class="number">0x4011db</span> in main /home/yhellow/桌面/<span class="built_in">exp</span>/shadow test/test.c:<span class="number">21</span></span><br><span class="line">    #<span class="number">2</span> <span class="number">0x7f9992b66082</span> in __libc_start_main ../csu/libc-start.c:<span class="number">308</span></span><br><span class="line"></span><br><span class="line">SUMMARY: AddressSanitizer: heap-buffer-overflow /home/yhellow/桌面/<span class="built_in">exp</span>/shadow test/test.c:<span class="number">22</span> in main</span><br><span class="line">Shadow bytes around the buggy address:</span><br><span class="line">  <span class="number">0x0c047fff7fb0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0c047fff7fc0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0c047fff7fd0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0c047fff7fe0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0c047fff7ff0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">=&gt;<span class="number">0x0c047fff8000</span>: fa fa <span class="number">00</span> <span class="number">00</span>[fa]fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">  <span class="number">0x0c047fff8010</span>: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">  <span class="number">0x0c047fff8020</span>: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">  <span class="number">0x0c047fff8030</span>: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">  <span class="number">0x0c047fff8040</span>: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">  <span class="number">0x0c047fff8050</span>: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">Shadow byte legend (one shadow byte represents <span class="number">8</span> application bytes):</span><br><span class="line">  Addressable:           <span class="number">00</span></span><br><span class="line">  Partially addressable: <span class="number">01</span> <span class="number">02</span> <span class="number">03</span> <span class="number">04</span> <span class="number">05</span> <span class="number">06</span> <span class="number">07</span> </span><br><span class="line">  Heap left redzone:       fa</span><br><span class="line">  Freed heap region:       fd</span><br><span class="line">  Stack left redzone:      f1</span><br><span class="line">  Stack mid redzone:       f2</span><br><span class="line">  Stack right redzone:     f3</span><br><span class="line">  Stack after <span class="keyword">return</span>:      f5</span><br><span class="line">  Stack use after scope:   f8</span><br><span class="line">  Global redzone:          f9</span><br><span class="line">  Global init order:       f6</span><br><span class="line">  Poisoned by user:        f7</span><br><span class="line">  Container overflow:      fc</span><br><span class="line">  Array cookie:            ac</span><br><span class="line">  Intra object redzone:    bb</span><br><span class="line">  ASan internal:           fe</span><br><span class="line">  Left alloca redzone:     ca</span><br><span class="line">  Right alloca redzone:    cb</span><br><span class="line">  Shadow gap:              cc</span><br><span class="line">==<span class="number">6154</span>==ABORTING</span><br></pre></td></tr></table></figure>
<ul>
<li>单步到 <code>0x40121b</code> 处：（程序提示的 <code>0x40121b</code> 就是发生溢出的地方）</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">► <span class="number">0x401216</span> &lt;main+<span class="number">96</span>&gt;     call   __asan_report_store1_noabort@plt                      &lt;__asan_report_store1_noabort@plt&gt;</span><br><span class="line">       rdi: <span class="number">0x602000000021</span> ◂— <span class="number">0x0</span></span><br><span class="line">       rsi: <span class="number">0x1</span></span><br><span class="line">       rdx: <span class="number">0x1</span></span><br><span class="line">       rcx: <span class="number">0x7ffff7718d01</span> (__asan::instance+<span class="number">57089</span>) ◂— <span class="number">0x0</span></span><br><span class="line"></span><br><span class="line">  <span class="number">0x40121b</span> &lt;main+<span class="number">101</span>&gt;    mov    byte ptr [rbx], <span class="number">0xc</span> <span class="comment">/* 溢出点 */</span></span><br></pre></td></tr></table></figure>
<p>根据计算公式 <strong>Shadow = (Mem &gt;&gt; 3) + 0x7fff8000</strong>（64位）：</p>
<ul>
<li>mem 的地址 0x602000000021</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">3</span>]: hex((<span class="number">0x602000000021</span>&gt;&gt;<span class="number">3</span>)+<span class="number">0x7fff8000</span>)</span><br><span class="line">Out[<span class="number">3</span>]: <span class="string">&#x27;0xc047fff8004&#x27;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>得到 shadow memory 的地址是 0xC047FFF8004，刚好就是上图中由中括号括起来的 [fa]（发生溢出的 heap 地址空间）</li>
<li>而 0xC047FFF8002 和 0xC047FFF8003 两个 shadow memory 对应的值都为 0，说明这两个 shadow memory 对应的 main memory 是可寻址的（刚好就是 <code>malloc(16)</code> 申请的 0x10 字节的空间）</li>
</ul>
<p>从这里也可以窥探到 <strong>[CVE-2018-16451]</strong> 的漏洞点，但是我把 crash 放入没有 ASan 的程序却复现不出漏洞（很头痛）</p>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/labs/" rel="tag"><i class="fa fa-tag"></i> labs</a>
              <a href="/tags/fuzz/" rel="tag"><i class="fa fa-tag"></i> fuzz</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/08/15/Fuzz%20Lab2-libexif/" rel="prev" title="Fuzz Lab2-libexif">
      <i class="fa fa-chevron-left"></i> Fuzz Lab2-libexif
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/08/17/Fuzz%20Lab4-tiff-4.0.4/" rel="next" title="Fuzz Lab4-tiff-4.0.4">
      Fuzz Lab4-tiff-4.0.4 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Fuzz-Lab3%EF%BC%9ATCPdump"><span class="nav-number">1.</span> <span class="nav-text">Fuzz-Lab3：TCPdump</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Do-it-yourself"><span class="nav-number">2.</span> <span class="nav-text">Do it yourself!</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Download-and-build-your-target"><span class="nav-number">3.</span> <span class="nav-text">Download and build your target</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Seed-corpus-creation"><span class="nav-number">4.</span> <span class="nav-text">Seed corpus creation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AddressSanitizer"><span class="nav-number">5.</span> <span class="nav-text">AddressSanitizer</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Fuzz-TCPdump"><span class="nav-number">6.</span> <span class="nav-text">Fuzz TCPdump</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Triage"><span class="nav-number">7.</span> <span class="nav-text">Triage</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reproduce-the-crash"><span class="nav-number">8.</span> <span class="nav-text">Reproduce the crash</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="yhellow"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">yhellow</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">192</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">116</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yhellow</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">2.5m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">37:46</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

</body>
</html>
