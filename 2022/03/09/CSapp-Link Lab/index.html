<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Link LabCMU无此实验，HIT增加 每个实验阶段考察 ELF 文件组成与程序链接过程的不同方面知识  阶段1：全局变量 &lt;&#x3D;&gt; 数据节 阶段2：指令 &lt;&#x3D;&gt; 代码节 阶段3：符号解析 阶段4：switch语句与重定位 阶段5：重定位  实验文件 main.o：主程序的可重定位目标模块（实验中无需修改） phase1.o …….. phase5.o：各阶段实验所针对的">
<meta property="og:type" content="article">
<meta property="og:title" content="CSapp-Link Lab">
<meta property="og:url" content="http://example.com/2022/03/09/CSapp-Link%20Lab/index.html">
<meta property="og:site_name" content="Pwn进你的心">
<meta property="og:description" content="Link LabCMU无此实验，HIT增加 每个实验阶段考察 ELF 文件组成与程序链接过程的不同方面知识  阶段1：全局变量 &lt;&#x3D;&gt; 数据节 阶段2：指令 &lt;&#x3D;&gt; 代码节 阶段3：符号解析 阶段4：switch语句与重定位 阶段5：重定位  实验文件 main.o：主程序的可重定位目标模块（实验中无需修改） phase1.o …….. phase5.o：各阶段实验所针对的">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2022/03/09/CSapp-Link%20Lab/1646800862254.png">
<meta property="og:image" content="http://example.com/2022/03/09/CSapp-Link%20Lab/1646800924153.png">
<meta property="og:image" content="http://example.com/2022/03/09/CSapp-Link%20Lab/1646632648612.png">
<meta property="og:image" content="http://example.com/2022/03/09/CSapp-Link%20Lab/1641118618666-1646286364492.png">
<meta property="og:image" content="http://example.com/2022/03/09/CSapp-Link%20Lab/1646665002297.png">
<meta property="article:published_time" content="2022-03-09T06:54:54.000Z">
<meta property="article:modified_time" content="2022-10-09T16:08:48.000Z">
<meta property="article:author" content="yhellow">
<meta property="article:tag" content="labs">
<meta property="article:tag" content="CSapp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/03/09/CSapp-Link%20Lab/1646800862254.png">

<link rel="canonical" href="http://example.com/2022/03/09/CSapp-Link%20Lab/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>CSapp-Link Lab | Pwn进你的心</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Pwn进你的心</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/09/CSapp-Link%20Lab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yhellow">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pwn进你的心">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          CSapp-Link Lab
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-03-09 14:54:54" itemprop="dateCreated datePublished" datetime="2022-03-09T14:54:54+08:00">2022-03-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-10-10 00:08:48" itemprop="dateModified" datetime="2022-10-10T00:08:48+08:00">2022-10-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Knowledge/" itemprop="url" rel="index"><span itemprop="name">Knowledge</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>39k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>35 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Link-Lab"><a href="#Link-Lab" class="headerlink" title="Link Lab"></a>Link Lab</h2><p>CMU无此实验，HIT增加</p>
<p>每个实验阶段考察 ELF 文件组成与程序链接过程的不同方面知识</p>
<ul>
<li>阶段1：全局变量 &lt;=&gt; 数据节</li>
<li>阶段2：指令 &lt;=&gt; 代码节</li>
<li>阶段3：符号解析</li>
<li>阶段4：switch语句与重定位</li>
<li>阶段5：重定位</li>
</ul>
<h2 id="实验文件"><a href="#实验文件" class="headerlink" title="实验文件"></a>实验文件</h2><ul>
<li>main.o：主程序的可重定位目标模块（实验中无需修改）</li>
<li>phase1.o …….. phase5.o：各阶段实验所针对的二进制可重定位目标模块，需在相应实验阶段中予以修改或补充</li>
<li>linkbombn：验证文件</li>
</ul>
<p>在实验中的每一阶段，按照阶段的目标要求修改相应可重定位二进制目标模块 phasen.o 后，使用如下命令生成可执行程序 linkbomb：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">linux &gt; gcc -m32 -o linkbomb main.o phase[n].o </span><br><span class="line">./linkbomb</span><br></pre></td></tr></table></figure>
<h2 id="使用工具"><a href="#使用工具" class="headerlink" title="使用工具"></a>使用工具</h2><p><strong>hexedit</strong></p>
<p>hexedit 不仅仅是十六进制编辑器，它提供了获取文件差异的信息，可用于比较二进制文件，它的用户界面基于 ncurses</p>
<p>我们可以像下面这样安装它：（可能需要 root 权限）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linux &gt; apt install hexedit</span><br></pre></td></tr></table></figure>
<p>打开终端输入以下指令即可运行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linux &gt; hexedit filename</span><br></pre></td></tr></table></figure>
<p>用方向键移动，ctrl+w保存，ctrl+x退出，man hexedit </p>
<p><strong>readelf</strong>  </p>
<ul>
<li>-a —all        等同于同时使用：-h -l -S -s -r -d -V -A -l</li>
<li>-h —file-header    显示ELF文件头</li>
<li>-l —program-headers    显示程序头</li>
<li>-S —section-headers    显示节头</li>
<li>-t —section-details    显示节详细信息</li>
<li>-s —syms        显示符号表（symbol table）</li>
<li>-r —relocs        显示重定位信息</li>
<li>-d —dynamic    显示动态节（dynamic section）</li>
<li>-x —hex-dump=<number|name>    以字节形式显示输出<number|name>指定节的内容</number|name></number|name></li>
<li>-p —string-dump=<number|name>     以字符串形式显示输出<number|name>指定节的内容</number|name></number|name></li>
<li>-R —relocated-dump=<number|name>     以重定位后的字节形式显示输出<number|name>指定节内容</number|name></number|name></li>
</ul>
<h2 id="符号相关知识"><a href="#符号相关知识" class="headerlink" title="符号相关知识"></a>符号相关知识</h2><p><strong>符号表</strong></p>
<p>在计算机科学中，符号表是一种用于语言翻译器（例如：编译器和解释器）中的数据结构，在符号表中，程序源代码中的每个标识符都和它的声明或使用信息绑定在一起，比如其数据类型、作用域以及内存地址</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">        Elf32_Word    st_name;      <span class="comment">/* 符号对应字符串在strtab节中的偏移量 */</span> </span><br><span class="line">        Elf32_Word    st_value;     <span class="comment">/* 在对应节中的偏移量，可执行文件中是虚拟地址 */</span></span><br><span class="line">        Elf32_Word    st_size;      <span class="comment">/* 符号对应目标所占字节数 */</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span>   type: <span class="number">4</span>,    <span class="comment">/* 符号对应目标的类型：数据、函数、源文件、节 */</span></span><br><span class="line">              		 binding: <span class="number">4</span>;    <span class="comment">/* 符号类别：全局符号、局部符号、弱符号 */</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span>   st_other;</span><br><span class="line">        Elf32_Section   st_shndx;    <span class="comment">/* 符号对应目标所在的节，或其他情况 */</span></span><br><span class="line">&#125;Elf32_Sym;</span><br></pre></td></tr></table></figure>
<p><strong>散列表</strong></p>
<p>散列表是用来实现符号表的一种常用技术，编译器可能会使用一个很大的符号表来包含所有的符号，或是针对不同的作用域使用层次结构的多个独立的符号表</p>
<p><strong>符号</strong></p>
<ul>
<li>Global symbols（模块内部定义的全局符号）<ul>
<li>由模块m定义并能被其他模块引用的符号（非static函数，非static全局变量）</li>
</ul>
</li>
<li>External symbols（外部定义的全局符号）<ul>
<li>由其他模块定义并被模块m引用的全局符号</li>
</ul>
</li>
<li>Local symbols（本模块的局部符号）<ul>
<li>仅由模块m定义和引用的本地符号（带有static的函数和全局变量）</li>
<li>注意：局部变量不会在过程外被引用（分配在栈中），因此不是符号定义</li>
</ul>
</li>
</ul>
<p><strong>符号变量</strong></p>
<p>自动变量（动态局部变量）：auto </p>
<ul>
<li>离开函数，值就消失</li>
<li>不写 static 就默认是 auto</li>
</ul>
<p>静态局部变量：static </p>
<ul>
<li>离开函数，值任然保留</li>
<li>变量的值只在函数内部生效</li>
<li>带有 static 的变量只会初始化一次（数据存储在 data 段）</li>
<li>当上一级函数多次调用本函数时，带有 static 的变量数值不变（并且不会进行初始化）</li>
</ul>
<p>寄存器变量：register</p>
<ul>
<li>离开函数，值就消失</li>
<li>变量的值只在函数内部生效</li>
</ul>
<p>全局变量：在 main 之外</p>
<ul>
<li>允许 main 中所有函数访问</li>
<li>允许外部其他文件访问</li>
</ul>
<p>静态全局变量：在 main 之外，static</p>
<ul>
<li>允许 main 中所有函数访问</li>
<li>变量的值只在文件内部生效</li>
</ul>
<h2 id="节简析"><a href="#节简析" class="headerlink" title="节简析"></a>节简析</h2><p>使用目标文件的节头表，可以定位文件的所有节，节头表是 <code>Elf32_Shdr</code> 或 <code>Elf64_Shdr</code> 结构的数组</p>
<p><strong>节头</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">        elf32_Word      sh_name; <span class="comment">/* 节的名称，此成员值是节头字符串表节的索引，用于指定以空字符结尾的字符串的位置 */</span></span><br><span class="line">        Elf32_Word      sh_type; <span class="comment">/* 用于将节的内容和语义分类 */</span></span><br><span class="line">        Elf32_Word      sh_flags; <span class="comment">/* 节可支持用于说明杂项属性的1位标志 */</span></span><br><span class="line">        Elf32_Addr      sh_addr; <span class="comment">/* 如果节显示在进程的内存映像中，则此成员会指定节的第一个字节所在的地址 */</span></span><br><span class="line">        Elf32_Off       sh_offset; <span class="comment">/* 从文件的起始位置到节中第一个字节的字节偏移 */</span></span><br><span class="line">        Elf32_Word      sh_size; <span class="comment">/* 节的大小 */</span></span><br><span class="line">        Elf32_Word      sh_link; <span class="comment">/* 节头表索引链接，其解释依赖于节类型 */</span></span><br><span class="line">        Elf32_Word      sh_info; <span class="comment">/* 额外信息，其解释依赖于节类型 */</span></span><br><span class="line">        Elf32_Word      sh_addralign; <span class="comment">/* 一些节具有地址对齐约束 */</span></span><br><span class="line">        Elf32_Word      sh_entsize; <span class="comment">/* 指定每一项的大小(一些节包含固定大小的项的表) */</span></span><br><span class="line">&#125; Elf32_Shdr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">        Elf64_Word      sh_name;</span><br><span class="line">        Elf64_Word      sh_type;</span><br><span class="line">        Elf64_Xword     sh_flags;</span><br><span class="line">        Elf64_Addr      sh_addr;</span><br><span class="line">        Elf64_Off       sh_offset;</span><br><span class="line">        Elf64_Xword     sh_size;</span><br><span class="line">        Elf64_Word      sh_link;</span><br><span class="line">        Elf64_Word      sh_info;</span><br><span class="line">        Elf64_Xword     sh_addralign;</span><br><span class="line">        Elf64_Xword     sh_entsize;</span><br><span class="line">&#125; Elf64_Shdr;</span><br></pre></td></tr></table></figure>
<p>参考：<a target="_blank" rel="noopener" href="https://docs.oracle.com/cd/E26926_01/html/E25910/chapter6-94076.html">节 - 链接程序和库指南</a> </p>
<p><strong>节分配</strong></p>
<img src="/2022/03/09/CSapp-Link%20Lab/1646800862254.png" class width="1646800862254"> 
<p><strong>节简述</strong></p>
 <img src="/2022/03/09/CSapp-Link%20Lab/1646800924153.png" class width="1646800924153"> 
<ul>
<li>ELF头：包括16字节的标识信息，文件类型（.o，exec，.so），机器类型（如Intel 80386），节头表的偏移，节头表的表项大小及表项个数 </li>
<li>.text节：编译后的代码部分 </li>
<li>.rodata节：只读数据，如 printf 用到的格式串，switch 跳转表等</li>
<li>.data节：已初始化的全局变量和静态变量</li>
<li>.bss节：未初始化全局变量和静态变量，仅是占位符，不占据任何磁盘空间，区分初始化和非初始化是为了空间效率</li>
<li>.symtab节：存放函数和全局变量（符号表）的信息，它不包括局部变量</li>
<li>.rel.text节：.text节的重定位信息，用于重新修改代码段的指令中的地址信息</li>
<li>.debug节：调试用的符号表（gcc -g） </li>
<li>.strtab节：包含 .symtab节和 .debug节 中的符号及节名 </li>
</ul>
<p><strong>示例</strong>（可能会有不同，比如：在我的电脑上 .data 为第4节）</p>
<img src="/2022/03/09/CSapp-Link%20Lab/1646632648612.png" class width="1646632648612"> 
<ul>
<li>ABS：表示不该被重定位 </li>
<li>UND：表示未定义 </li>
<li>COM：表示未初始化数据（.bss） </li>
<li>value：表示对齐要求，size：给出最小大小 </li>
</ul>
<h2 id="编译器驱动程序"><a href="#编译器驱动程序" class="headerlink" title="编译器驱动程序"></a>编译器驱动程序</h2><p>编译器驱动程序的工作：调用语言预处理器，编译器，汇编器，链接器</p>
<img src="/2022/03/09/CSapp-Link%20Lab/1641118618666-1646286364492.png" class width="1641118618666"> 
<img src="/2022/03/09/CSapp-Link%20Lab/1646665002297.png" class width="1646665002297"> 
<p>详细过程：</p>
<ul>
<li><strong>预处理阶段</strong>：预处理器（cpp）根据以字符 “#” 开头的命令，修改原始的 C 程序（比如 hello.c 中第 1 行的<code>#include</code>命令告诉预处理器读取系统头文件 stdio.h 的内容）并把它直接插入程序文本中，结果就得到了另一个 C 程序<ul>
<li>通常是以 .i 作为文件扩展名</li>
<li>所谓的头文件，里面装的其实就是函数声明（libc库中的函数：scanf，printf 等）</li>
</ul>
</li>
<li><strong>编译阶段</strong>：编译器（ccl）将文本文件 hello.i 翻译成文本文件 hello.s，它包含一个汇编语言程序<ul>
<li>.s 文件其实就是装有汇编语言的文件</li>
</ul>
</li>
<li><strong>汇编阶段</strong>：汇编器（as）将 hello.s 翻译成机器语言指令，把这些指令打包成一种叫做可重定位目标程序（relocatable object program）的格式，并将结果保存在目标文件 hello.o 中<ul>
<li>hello.o 文件是一个二进制文件，它包含的 17 个字节是函数 main 的指令编码</li>
<li>如果我们在文本编辑器中打开 hello.o文件，将看到一堆乱码（二进制）</li>
</ul>
</li>
<li><strong>链接阶段</strong>：链接器（ld）就负责处理合并各个 hello.o 文件，结果就得到 hello 文件，它是一个可执行目标文件（或者简称为可执行文件），可以被加载到内存中，由系统执行<ul>
<li>请注意，hello 程序调用了 printf 函数，它是每个 C 编译器都提供的标准 C 库中的一个函数</li>
<li>printf 函数存在于一个名为 printf.o 的单独的预编译好了的目标文件中，而这个文件必须以某种方式合并到我们的 hello.o 程序中</li>
<li>通过修改 hello.o 可以影响最终文件 hello 的效果</li>
</ul>
</li>
</ul>
<h2 id="强符号与弱符号"><a href="#强符号与弱符号" class="headerlink" title="强符号与弱符号"></a>强符号与弱符号</h2><p>在C语言中：</p>
<ul>
<li>函数和初始化的全局变量（包括显示初始化为0）是强符号</li>
<li>未初始化的全局变量是弱符号 </li>
</ul>
<p>对于它们，下列三条规则使用：</p>
<ul>
<li>同名的强符号只能有一个，否则编译器报”重复定义”错误</li>
<li>允许一个强符号和多个弱符号，但定义会选择强符号的</li>
<li>当有多个弱符号相同时，链接器选择最先出现那个，也就是与链接顺序有关</li>
</ul>
<h2 id="实验一"><a href="#实验一" class="headerlink" title="实验一"></a>实验一</h2><p>步骤一：使用 readelf 和 bjdump 工具，首先确定 printf（具体为 puts ）输出函数的第2个调用参数对应的字符串地址（在 .data 节中）</p>
<p>步骤二：使用readelf 或 objdump 工具，查看 .data 节中的字符串内容并与未修改的 phase1.o 链接后程序输出的字符串比较，确定该字符串为修改的目标</p>
<p>步骤三：使用 hexedit 或自己写程序该字符串前若干字符替换为目标学号中的字符</p>
<p>实验一的程序框架：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;config.h&quot;</span> </span></span><br><span class="line"><span class="keyword">void</span> (*phase)();   <span class="comment">/*初始化为0*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span>* argv[] )</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ( phase )</span><br><span class="line">               (*phase)();</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">               <span class="built_in">printf</span>(<span class="string">&quot;To run lab, please link the relevant object module with the main module.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>直接运行输出这个结果：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l1] ./linkbomb1 </span><br><span class="line"><span class="number">173000209U</span>Vv00d3vyFALuMYjxuPCr5m38uiiwLQwlzRxr80BxYnv7r6zz9aChMvWou2DL9e4tc6EidF1olhqrhH3gxYChAckMo7uMXJHwSDfiEmlYH	hhJElIl RzCWKPcuNvdHAIt	h7487zkd39QJEm4Rqwyer	L <span class="number">0</span>gauz1N2w9g PyaHAl</span><br></pre></td></tr></table></figure>
<p>现在先收集信息：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l1] readelf -s phase1.o</span><br><span class="line"></span><br><span class="line">Symbol table <span class="string">&#x27;.symtab&#x27;</span> contains <span class="number">17</span> entries:</span><br><span class="line">   Num:    Value  Size Type    Bind   Vis      Ndx Name</span><br><span class="line">     <span class="number">0</span>: <span class="number">00000000</span>     <span class="number">0</span> NOTYPE  LOCAL  DEFAULT  UND </span><br><span class="line">     <span class="number">1</span>: <span class="number">00000000</span>     <span class="number">0</span> FILE    LOCAL  DEFAULT  ABS phase1.c</span><br><span class="line">     <span class="number">2</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT    <span class="number">2</span> </span><br><span class="line">     <span class="number">3</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT    <span class="number">4</span> </span><br><span class="line">     <span class="number">4</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT    <span class="number">5</span> </span><br><span class="line">     <span class="number">5</span>: <span class="number">00000000</span>   <span class="number">200</span> OBJECT  LOCAL  DEFAULT    <span class="number">4</span> ALJsLxmF <span class="comment">// target</span></span><br><span class="line">     <span class="number">6</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT    <span class="number">6</span> </span><br><span class="line">     <span class="number">7</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT    <span class="number">8</span> </span><br><span class="line">     <span class="number">8</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT   <span class="number">10</span> </span><br><span class="line">     <span class="number">9</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT   <span class="number">11</span> </span><br><span class="line">    <span class="number">10</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT    <span class="number">9</span> </span><br><span class="line">    <span class="number">11</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT    <span class="number">1</span> </span><br><span class="line">    <span class="number">12</span>: <span class="number">00000000</span>    <span class="number">43</span> FUNC    GLOBAL DEFAULT    <span class="number">2</span> do_phase</span><br><span class="line">    <span class="number">13</span>: <span class="number">00000000</span>     <span class="number">0</span> FUNC    GLOBAL HIDDEN     <span class="number">8</span> __x86.get_pc_thunk.ax</span><br><span class="line">    <span class="number">14</span>: <span class="number">00000000</span>     <span class="number">0</span> NOTYPE  GLOBAL DEFAULT  UND _GLOBAL_OFFSET_TABLE_ <span class="comment">// GOT表</span></span><br><span class="line">    <span class="number">15</span>: <span class="number">00000000</span>     <span class="number">0</span> NOTYPE  GLOBAL DEFAULT  UND <span class="built_in">puts</span></span><br><span class="line">    <span class="number">16</span>: <span class="number">00000000</span>     <span class="number">4</span> OBJECT  GLOBAL DEFAULT    <span class="number">6</span> phase</span><br></pre></td></tr></table></figure>
<p>发现可疑目标：ALJsLxmF</p>
<ul>
<li>Bind：LOCAL（局部符号）</li>
<li>Ndx：4（第4节 .data）</li>
<li>Value：0（节内偏移为0）</li>
<li>Type：OBJECT（全局变量）</li>
</ul>
<p>局部全局变量，大小为 200，位于 .data 节，节内偏移为 0</p>
<p>接下来只需要查看 data 节在 .o 文件中的偏移是多少应该就可了：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l1] readelf -S phase1.o</span><br><span class="line">There are <span class="number">16</span> section headers, starting at offset <span class="number">0x3f0</span>:</span><br><span class="line"></span><br><span class="line">节头：</span><br><span class="line">  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al</span><br><span class="line">  [ <span class="number">0</span>]                   <span class="literal">NULL</span>            <span class="number">00000000</span> <span class="number">000000</span> <span class="number">000000</span> <span class="number">00</span>      <span class="number">0</span>   <span class="number">0</span>  <span class="number">0</span></span><br><span class="line">  [ <span class="number">1</span>] .group            GROUP           <span class="number">00000000</span> <span class="number">000034</span> <span class="number">000008</span> <span class="number">04</span>     <span class="number">13</span>  <span class="number">13</span>  <span class="number">4</span></span><br><span class="line">  [ <span class="number">2</span>] .text             PROGBITS        <span class="number">00000000</span> <span class="number">00003</span>c <span class="number">00002b</span> <span class="number">00</span>  AX  <span class="number">0</span>   <span class="number">0</span>  <span class="number">1</span></span><br><span class="line">  [ <span class="number">3</span>] .rel.text         REL             <span class="number">00000000</span> <span class="number">000328</span> <span class="number">000020</span> <span class="number">08</span>   I <span class="number">13</span>   <span class="number">2</span>  <span class="number">4</span></span><br><span class="line">  [ <span class="number">4</span>] .data             PROGBITS        <span class="number">00000000</span> <span class="number">000080</span> <span class="number">0000</span>c8 <span class="number">00</span>  WA  <span class="number">0</span>   <span class="number">0</span> <span class="number">32</span></span><br><span class="line">  [ <span class="number">5</span>] .bss              NOBITS          <span class="number">00000000</span> <span class="number">000148</span> <span class="number">000000</span> <span class="number">00</span>  WA  <span class="number">0</span>   <span class="number">0</span>  <span class="number">1</span></span><br><span class="line">  [ <span class="number">6</span>] .data.rel.local   PROGBITS        <span class="number">00000000</span> <span class="number">000148</span> <span class="number">000004</span> <span class="number">00</span>  WA  <span class="number">0</span>   <span class="number">0</span>  <span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>.data节 偏移为“0x80”，在 HexEdit 中定为偏移为“0x80+0x0”（节偏移+节内偏移）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00000000</span>   <span class="number">7F</span> <span class="number">45</span> <span class="number">4</span>C <span class="number">46</span>  <span class="number">01</span> <span class="number">01</span> <span class="number">01</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  .ELF............</span><br><span class="line"><span class="number">00000010</span>   <span class="number">01</span> <span class="number">00</span> <span class="number">03</span> <span class="number">00</span>  <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  ................</span><br><span class="line"><span class="number">00000020</span>   F0 <span class="number">03</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">34</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">28</span> <span class="number">00</span>  .......<span class="number">.4</span>.....(.</span><br><span class="line"><span class="number">00000030</span>   <span class="number">10</span> <span class="number">00</span> <span class="number">0F</span> <span class="number">00</span>  <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">08</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">55</span> <span class="number">89</span> E5 <span class="number">53</span>  ............U..S</span><br><span class="line"><span class="number">00000040</span>   <span class="number">83</span> EC <span class="number">04</span> E8  FC FF FF FF  <span class="number">05</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">8</span>D <span class="number">90</span> <span class="number">11</span>  ................</span><br><span class="line"><span class="number">00000050</span>   <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">83</span>  EC <span class="number">0</span>C <span class="number">52</span> <span class="number">89</span>  C3 E8 FC FF  FF FF <span class="number">83</span> C4  ......R.........</span><br><span class="line"><span class="number">00000060</span>   <span class="number">10</span> <span class="number">90</span> <span class="number">8B</span> <span class="number">5</span>D  FC C9 C3 <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  ...]............</span><br><span class="line"><span class="number">00000070</span>   <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  ................</span><br><span class="line"><span class="number">00000080</span>   <span class="number">37</span> <span class="number">30</span> <span class="number">6</span>C <span class="number">4</span>C  <span class="number">39</span> <span class="number">46</span> <span class="number">39</span> <span class="number">09</span>  <span class="number">39</span> <span class="number">68</span> <span class="number">6B</span> <span class="number">52</span>  <span class="number">58</span> <span class="number">55</span> <span class="number">38</span> <span class="number">41</span>  <span class="number">70l</span>L9F9<span class="number">.9</span>hkRXU8A</span><br><span class="line"><span class="number">00000090</span>   <span class="number">31</span> <span class="number">31</span> <span class="number">37</span> <span class="number">33</span>  <span class="number">30</span> <span class="number">30</span> <span class="number">30</span> <span class="number">32</span>  <span class="number">30</span> <span class="number">39</span> <span class="number">55</span> <span class="number">56</span>  <span class="number">76</span> <span class="number">30</span> <span class="number">30</span> <span class="number">64</span>  <span class="number">1173000209U</span>Vv00d</span><br><span class="line"><span class="number">000000</span>A0   <span class="number">33</span> <span class="number">76</span> <span class="number">79</span> <span class="number">46</span>  <span class="number">41</span> <span class="number">4</span>C <span class="number">75</span> <span class="number">4</span>D  <span class="number">59</span> <span class="number">6</span>A <span class="number">78</span> <span class="number">75</span>  <span class="number">50</span> <span class="number">43</span> <span class="number">72</span> <span class="number">35</span>  <span class="number">3</span>vyFALuMYjxuPCr5</span><br><span class="line"><span class="number">000000B</span>0   <span class="number">6</span>D <span class="number">33</span> <span class="number">38</span> <span class="number">75</span>  <span class="number">69</span> <span class="number">69</span> <span class="number">77</span> <span class="number">4</span>C  <span class="number">51</span> <span class="number">77</span> <span class="number">6</span>C <span class="number">7</span>A  <span class="number">52</span> <span class="number">78</span> <span class="number">72</span> <span class="number">38</span>  m38uiiwLQwlzRxr8</span><br><span class="line"><span class="number">000000</span>C0   <span class="number">30</span> <span class="number">42</span> <span class="number">78</span> <span class="number">59</span>  <span class="number">6</span>E <span class="number">76</span> <span class="number">37</span> <span class="number">72</span>  <span class="number">36</span> <span class="number">7</span>A <span class="number">7</span>A <span class="number">39</span>  <span class="number">61</span> <span class="number">43</span> <span class="number">68</span> <span class="number">4</span>D  <span class="number">0B</span>xYnv7r6zz9aChM</span><br><span class="line"><span class="number">000000</span>D0   <span class="number">76</span> <span class="number">57</span> <span class="number">6F</span> <span class="number">75</span>  <span class="number">32</span> <span class="number">44</span> <span class="number">4</span>C <span class="number">39</span>  <span class="number">65</span> <span class="number">34</span> <span class="number">74</span> <span class="number">63</span>  <span class="number">36</span> <span class="number">45</span> <span class="number">69</span> <span class="number">64</span>  vWou2DL9e4tc6Eid</span><br><span class="line"><span class="number">000000E0</span>   <span class="number">46</span> <span class="number">31</span> <span class="number">6F</span> <span class="number">6</span>C  <span class="number">68</span> <span class="number">71</span> <span class="number">72</span> <span class="number">68</span>  <span class="number">48</span> <span class="number">33</span> <span class="number">67</span> <span class="number">78</span>  <span class="number">59</span> <span class="number">43</span> <span class="number">68</span> <span class="number">41</span>  F1olhqrhH3gxYChA</span><br><span class="line"><span class="number">000000F</span>0   <span class="number">63</span> <span class="number">6B</span> <span class="number">4</span>D <span class="number">6F</span>  <span class="number">37</span> <span class="number">75</span> <span class="number">4</span>D <span class="number">58</span>  <span class="number">4</span>A <span class="number">48</span> <span class="number">77</span> <span class="number">53</span>  <span class="number">44</span> <span class="number">66</span> <span class="number">69</span> <span class="number">45</span>  ckMo7uMXJHwSDfiE</span><br><span class="line"><span class="number">00000100</span>   <span class="number">6</span>D <span class="number">6</span>C <span class="number">59</span> <span class="number">48</span>  <span class="number">09</span> <span class="number">68</span> <span class="number">68</span> <span class="number">4</span>A  <span class="number">45</span> <span class="number">6</span>C <span class="number">49</span> <span class="number">6</span>C  <span class="number">20</span> <span class="number">52</span> <span class="number">7</span>A <span class="number">43</span>  mlYH.hhJElIl RzC</span><br><span class="line"><span class="number">00000110</span>   <span class="number">57</span> <span class="number">4B</span> <span class="number">50</span> <span class="number">63</span>  <span class="number">75</span> <span class="number">4</span>E <span class="number">76</span> <span class="number">64</span>  <span class="number">48</span> <span class="number">41</span> <span class="number">49</span> <span class="number">74</span>  <span class="number">09</span> <span class="number">68</span> <span class="number">37</span> <span class="number">34</span>  WKPcuNvdHAIt.h74</span><br><span class="line"><span class="number">00000120</span>   <span class="number">38</span> <span class="number">37</span> <span class="number">7</span>A <span class="number">6B</span>  <span class="number">64</span> <span class="number">33</span> <span class="number">39</span> <span class="number">51</span>  <span class="number">4</span>A <span class="number">45</span> <span class="number">6</span>D <span class="number">34</span>  <span class="number">52</span> <span class="number">71</span> <span class="number">77</span> <span class="number">79</span>  <span class="number">87</span>zkd39QJEm4Rqwy</span><br><span class="line"><span class="number">00000130</span>   <span class="number">65</span> <span class="number">72</span> <span class="number">09</span> <span class="number">4</span>C  <span class="number">20</span> <span class="number">30</span> <span class="number">67</span> <span class="number">61</span>  <span class="number">75</span> <span class="number">7</span>A <span class="number">31</span> <span class="number">4</span>E  <span class="number">32</span> <span class="number">77</span> <span class="number">39</span> <span class="number">67</span>  er.L <span class="number">0</span>gauz1N2w9g</span><br><span class="line"><span class="number">00000140</span>   <span class="number">20</span> <span class="number">50</span> <span class="number">79</span> <span class="number">61</span>  <span class="number">48</span> <span class="number">41</span> <span class="number">6</span>C <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">8B</span> <span class="number">04</span> <span class="number">24</span> C3   PyaHAl.......$.</span><br><span class="line"><span class="number">00000150</span>   <span class="number">00</span> <span class="number">47</span> <span class="number">43</span> <span class="number">43</span>  <span class="number">3</span>A <span class="number">20</span> <span class="number">28</span> <span class="number">55</span>  <span class="number">62</span> <span class="number">75</span> <span class="number">6</span>E <span class="number">74</span>  <span class="number">75</span> <span class="number">20</span> <span class="number">37</span> <span class="number">2</span>E  .GCC: (Ubuntu <span class="number">7.</span></span><br><span class="line"><span class="number">00000160</span>   <span class="number">33</span> <span class="number">2</span>E <span class="number">30</span> <span class="number">2</span>D  <span class="number">31</span> <span class="number">36</span> <span class="number">75</span> <span class="number">62</span>  <span class="number">75</span> <span class="number">6</span>E <span class="number">74</span> <span class="number">75</span>  <span class="number">33</span> <span class="number">29</span> <span class="number">20</span> <span class="number">37</span>  <span class="number">3.0</span><span class="number">-16u</span>buntu3) <span class="number">7</span></span><br><span class="line"><span class="number">00000170</span>   <span class="number">2</span>E <span class="number">33</span> <span class="number">2</span>E <span class="number">30</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">14</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">.3</span><span class="number">.0</span>............</span><br><span class="line">---  phase1.o       -<span class="number">-0x0</span>/<span class="number">0x670</span>------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>可以发现 printf 并没有从变量 ALJsLxmF 的头部开始打印，对原字符串进行搜索，发现偏移多了“0x11”，利用 objdump 反汇编进行检查：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l1] objdump -d phase1.o</span><br><span class="line"></span><br><span class="line">phase1.o：     文件格式 elf32-i386</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line"><span class="number">00000000</span> &lt;do_phase&gt;:</span><br><span class="line">   <span class="number">0</span>:	<span class="number">55</span>                   	push   %ebp</span><br><span class="line">   <span class="number">1</span>:	<span class="number">89</span> e5                	mov    %esp,%ebp</span><br><span class="line">   <span class="number">3</span>:	<span class="number">53</span>                   	push   %ebx</span><br><span class="line">   <span class="number">4</span>:	<span class="number">83</span> ec <span class="number">04</span>             	sub    $<span class="number">0x4</span>,%esp</span><br><span class="line">   <span class="number">7</span>:	e8 fc ff ff ff       	call   <span class="number">8</span> &lt;do_phase+<span class="number">0x8</span>&gt;</span><br><span class="line">   c:	<span class="number">05</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       	add    $<span class="number">0x1</span>,%eax</span><br><span class="line">  <span class="number">11</span>:	<span class="number">8</span>d <span class="number">90</span> <span class="number">11</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    	lea    <span class="number">0x11</span>(%eax),%edx </span><br><span class="line">      <span class="comment">// lea 取源操作数地址的偏移量，并把它传送到目的操作数所在的单元</span></span><br><span class="line">  <span class="number">17</span>:	<span class="number">83</span> ec <span class="number">0</span>c             	sub    $<span class="number">0xc</span>,%esp </span><br><span class="line">  <span class="number">1</span>a:	<span class="number">52</span>                   	push   %edx</span><br><span class="line">  <span class="number">1b</span>:	<span class="number">89</span> c3                	mov    %eax,%ebx</span><br><span class="line">  <span class="number">1</span>d:	e8 fc ff ff ff       	call   <span class="number">1</span>e &lt;do_phase+<span class="number">0x1e</span>&gt;</span><br><span class="line">  <span class="number">22</span>:	<span class="number">83</span> c4 <span class="number">10</span>             	add    $<span class="number">0x10</span>,%esp</span><br><span class="line">  <span class="number">25</span>:	<span class="number">90</span>                   	nop</span><br><span class="line">  <span class="number">26</span>:	<span class="number">8b</span> <span class="number">5</span>d fc             	mov    <span class="number">-0x4</span>(%ebp),%ebx</span><br><span class="line">  <span class="number">29</span>:	c9                   	leave  </span><br><span class="line">  <span class="number">2</span>a:	c3                   	ret    </span><br><span class="line"></span><br><span class="line">Disassembly of section .text.__x86.get_pc_thunk.ax:</span><br><span class="line"></span><br><span class="line"><span class="number">00000000</span> &lt;__x86.get_pc_thunk.ax&gt;:</span><br><span class="line">   <span class="number">0</span>:	<span class="number">8b</span> <span class="number">04</span> <span class="number">24</span>             	mov    (%esp),%eax</span><br><span class="line">   <span class="number">3</span>:	c3                   	ret   </span><br></pre></td></tr></table></figure>
<p>现在可以用 HexEdit 修改二进制数据了，我将把它改为 “YHellow”</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l1] gcc -m32 -o linkbomb main.o phase1.o </span><br><span class="line">➜  [/home/ywhkkx/ex1.linklab/l1] ./linkbomb</span><br><span class="line">YHellow</span><br></pre></td></tr></table></figure>
<h2 id="实验二"><a href="#实验二" class="headerlink" title="实验二"></a>实验二</h2><p>修改二进制可重定位目标文件 phase2.o 的代码节内容，使其与 main.o 链接后能够运行输出（且仅输出）自己的学号</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;config.h&quot;</span> </span></span><br><span class="line"><span class="keyword">void</span> (*phase)();   <span class="comment">/*初始化为0*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span>* argv[] )</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ( phase )</span><br><span class="line">               (*phase)();</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">               <span class="built_in">printf</span>(<span class="string">&quot;To run lab, please link the relevant object module with the main module.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OUTPUT_FUNC_NAME</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *id)</span>     <span class="comment">// 该函数名对每名学生均不同</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">strcmp</span>(id,MYID) != <span class="number">0</span> ) <span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, id);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_phase</span><span class="params">()</span>  </span>&#123;</span><br><span class="line">        <span class="comment">// 在代码节中预留存储位置供学生插入完成功能的必要指令</span></span><br><span class="line">        <span class="keyword">asm</span>( “nop\n\tnop\n\tnop\n\tnop\n\tnop\n\tnop\n\tnop\n\tnop\n\t…” );     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​        // 这个实验要求我们在 do_phase 中执行 OUTPUT_FUNC_NAME，打印 ID</p>
<p>步骤一：使用 objdump 工具，定位 phase2.o 代码节中包含对 printf（会被优化为 puts）输出函数调用的函数的偏移量地址</p>
<p>步骤二：使用 objdump 工具，分析 do_phase 函数的反汇编指令，确定加入对前述输出函数的调用指令的 .text 节中的偏移量位置</p>
<p>步骤三：构造调用输出函数（通过相对PC的偏移量）的机器指令，并替换 do_phase 函数中预留的 nop 指令偏移量</p>
<p>注：目标输出函数为 static 类型，可通过偏移量直接调用跳转（无需重定位）</p>
<p>直接执行程序：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l2] ./linkbomb2 <span class="comment">// 啥也没有(本来也不该有)</span></span><br></pre></td></tr></table></figure>
<p>信息收集：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l2] file linkbomb2 </span><br><span class="line">linkbomb2: ELF <span class="number">32</span>-bit LSB shared object, Intel <span class="number">80386</span>, version <span class="number">1</span> (SYSV), dynamically linked, interpreter /lib/ld-linux.so<span class="number">.2</span>, <span class="keyword">for</span> GNU/Linux <span class="number">3.2</span><span class="number">.0</span>, BuildID[sha1]=<span class="number">32f</span>a54a562f55fda7e482d48180dc3e162fcea98, <span class="keyword">not</span> stripped</span><br></pre></td></tr></table></figure>
<p>发现 linkbomb2 是 dynamically，函数采用懒加载（利用PLT/GOT进行加载）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l2] readelf -s phase2.o  </span><br><span class="line"></span><br><span class="line">Symbol table <span class="string">&#x27;.symtab&#x27;</span> contains <span class="number">22</span> entries:</span><br><span class="line">   Num:    Value  Size Type    Bind   Vis      Ndx Name</span><br><span class="line">     <span class="number">0</span>: <span class="number">00000000</span>     <span class="number">0</span> NOTYPE  LOCAL  DEFAULT  UND </span><br><span class="line">     <span class="number">1</span>: <span class="number">00000000</span>     <span class="number">0</span> FILE    LOCAL  DEFAULT  ABS phase2.c</span><br><span class="line">     <span class="number">2</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT    <span class="number">3</span> </span><br><span class="line">     <span class="number">3</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT    <span class="number">5</span> </span><br><span class="line">     <span class="number">4</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT    <span class="number">6</span> </span><br><span class="line">     <span class="number">5</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT    <span class="number">7</span> </span><br><span class="line">     <span class="number">6</span>: <span class="number">00000000</span>    <span class="number">65</span> FUNC    LOCAL  DEFAULT    <span class="number">3</span> yeDfwUkv</span><br><span class="line">     <span class="number">7</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT    <span class="number">8</span> </span><br><span class="line">     <span class="number">8</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT   <span class="number">10</span> </span><br><span class="line">     <span class="number">9</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT   <span class="number">11</span> </span><br><span class="line">    <span class="number">10</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT   <span class="number">13</span> </span><br><span class="line">    <span class="number">11</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT   <span class="number">14</span> </span><br><span class="line">    <span class="number">12</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT   <span class="number">12</span> </span><br><span class="line">    <span class="number">13</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT    <span class="number">1</span> </span><br><span class="line">    <span class="number">14</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT    <span class="number">2</span> </span><br><span class="line">    <span class="number">15</span>: <span class="number">00000000</span>     <span class="number">0</span> FUNC    GLOBAL HIDDEN    <span class="number">11</span> __x86.get_pc_thunk.bx</span><br><span class="line">    <span class="number">16</span>: <span class="number">00000000</span>     <span class="number">0</span> NOTYPE  GLOBAL DEFAULT  UND _GLOBAL_OFFSET_TABLE_</span><br><span class="line">    <span class="number">17</span>: <span class="number">00000000</span>     <span class="number">0</span> NOTYPE  GLOBAL DEFAULT  UND <span class="built_in">strcmp</span></span><br><span class="line">    <span class="number">18</span>: <span class="number">00000000</span>     <span class="number">0</span> NOTYPE  GLOBAL DEFAULT  UND <span class="built_in">puts</span></span><br><span class="line">    <span class="number">19</span>: <span class="number">00000041</span>    <span class="number">48</span> FUNC    GLOBAL DEFAULT    <span class="number">3</span> do_phase <span class="comment">// target</span></span><br><span class="line">    <span class="number">20</span>: <span class="number">00000000</span>     <span class="number">0</span> FUNC    GLOBAL HIDDEN    <span class="number">10</span> __x86.get_pc_thunk.ax</span><br><span class="line">    <span class="number">21</span>: <span class="number">00000000</span>     <span class="number">4</span> OBJECT  GLOBAL DEFAULT    <span class="number">8</span> phase</span><br></pre></td></tr></table></figure>
<p>目标在：第3节，节内偏移为“0x41”的地方</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l2] readelf -S phase2.o</span><br><span class="line">There are <span class="number">19</span> section headers, starting at offset <span class="number">0x458</span>:</span><br><span class="line"></span><br><span class="line">节头：</span><br><span class="line">  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al</span><br><span class="line">  [ <span class="number">0</span>]                   <span class="literal">NULL</span>            <span class="number">00000000</span> <span class="number">000000</span> <span class="number">000000</span> <span class="number">00</span>      <span class="number">0</span>   <span class="number">0</span>  <span class="number">0</span></span><br><span class="line">  [ <span class="number">1</span>] .group            GROUP           <span class="number">00000000</span> <span class="number">000034</span> <span class="number">000008</span> <span class="number">04</span>     <span class="number">16</span>  <span class="number">20</span>  <span class="number">4</span></span><br><span class="line">  [ <span class="number">2</span>] .group            GROUP           <span class="number">00000000</span> <span class="number">00003</span>c <span class="number">000008</span> <span class="number">04</span>     <span class="number">16</span>  <span class="number">15</span>  <span class="number">4</span></span><br><span class="line">  [ <span class="number">3</span>] .text             PROGBITS        <span class="number">00000000</span> <span class="number">000044</span> <span class="number">000071</span> <span class="number">00</span>  AX  <span class="number">0</span>   <span class="number">0</span>  <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>在 .text 节中找到指定的 do_phase 位置（需要修改的函数），偏移为“0x44+0x41”（注意，puts，strcmp等函数是要在链接重定向完成之后才能确定地址，在反汇编代码中显示出来）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00000000</span>   <span class="number">7F</span> <span class="number">45</span> <span class="number">4</span>C <span class="number">46</span>  <span class="number">01</span> <span class="number">01</span> <span class="number">01</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  .ELF............</span><br><span class="line"><span class="number">00000010</span>   <span class="number">01</span> <span class="number">00</span> <span class="number">03</span> <span class="number">00</span>  <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  ................</span><br><span class="line"><span class="number">00000020</span>   <span class="number">58</span> <span class="number">04</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">34</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">28</span> <span class="number">00</span>  X......<span class="number">.4</span>.....(.</span><br><span class="line"><span class="number">00000030</span>   <span class="number">13</span> <span class="number">00</span> <span class="number">12</span> <span class="number">00</span>  <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">0</span>A <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  ................</span><br><span class="line"><span class="number">00000040</span>   <span class="number">0B</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">55</span> <span class="number">89</span> E5 <span class="number">53</span>  <span class="number">83</span> EC <span class="number">04</span> E8  FC FF FF FF  ....U..S........</span><br><span class="line"><span class="number">00000050</span>   <span class="number">81</span> C3 <span class="number">02</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">83</span> EC  <span class="number">08</span> <span class="number">8</span>D <span class="number">83</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">50</span>  ...............P</span><br><span class="line"><span class="number">00000060</span>   FF <span class="number">75</span> <span class="number">08</span> E8  FC FF FF FF  <span class="number">83</span> C4 <span class="number">10</span> <span class="number">85</span>  C0 <span class="number">75</span> <span class="number">10</span> <span class="number">83</span>  .u...........u..</span><br><span class="line"><span class="number">00000070</span>   EC <span class="number">0</span>C FF <span class="number">75</span>  <span class="number">08</span> E8 FC FF  FF FF <span class="number">83</span> C4  <span class="number">10</span> EB <span class="number">01</span> <span class="number">90</span>  ...u............</span><br><span class="line"><span class="number">00000080</span>   <span class="number">8B</span> <span class="number">5</span>D FC C9  C3 <span class="number">55</span> <span class="number">89</span> E5  E8 FC FF FF  FF <span class="number">05</span> <span class="number">01</span> <span class="number">00</span>  .]...U..........</span><br><span class="line"><span class="number">00000090</span>   <span class="number">00</span> <span class="number">00</span> <span class="number">90</span> <span class="number">90</span>  <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span>  <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span>  <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span>  ................</span><br><span class="line"><span class="number">000000</span>A0   <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span>  <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span>  <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span>  <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span>  ................</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00000041</span> &lt;do_phase&gt;:</span><br><span class="line">  <span class="number">41</span>:	<span class="number">55</span>                   	push   %ebp</span><br><span class="line">  <span class="number">42</span>:	<span class="number">89</span> e5                	mov    %esp,%ebp</span><br><span class="line">  <span class="number">44</span>:	e8 fc ff ff ff       	call   <span class="number">45</span> &lt;do_phase+<span class="number">0x4</span>&gt;</span><br><span class="line">  <span class="number">49</span>:	<span class="number">05</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       	add    $<span class="number">0x1</span>,%eax</span><br><span class="line">  <span class="number">4</span>a:	<span class="number">90</span>					   nop</span><br><span class="line">  <span class="number">4b</span>:	<span class="number">90</span>					   nop</span><br><span class="line">  <span class="number">4</span>c:	<span class="number">90</span>					   nop</span><br><span class="line">  <span class="number">4</span>d:	<span class="number">90</span>					   nop</span><br></pre></td></tr></table></figure>
<p>在“0x86”处发现 do_phase （55 89 e5 e8 …….. ）</p>
<p>先输入：gcc -m32 -o linkbomb2 main.o phase2.o 进行链接重定向（phase2.o 没有变）</p>
<p>然后用 objdump 进行打印：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l2] objdump -d linkbomb2 </span><br><span class="line"></span><br><span class="line">....................</span><br><span class="line"></span><br><span class="line"><span class="number">00001215</span> &lt;yeDfwUkv&gt;:</span><br><span class="line">    <span class="number">1215</span>:	<span class="number">55</span>                   	push   %ebp</span><br><span class="line">    <span class="number">1216</span>:	<span class="number">89</span> e5                	mov    %esp,%ebp</span><br><span class="line">    <span class="number">1218</span>:	<span class="number">53</span>                   	push   %ebx</span><br><span class="line">    <span class="number">1219</span>:	<span class="number">83</span> ec <span class="number">04</span>             	sub    $<span class="number">0x4</span>,%esp</span><br><span class="line">    <span class="number">121</span>c:	e8 <span class="number">9f</span> fe ff ff       	call   <span class="number">10</span>c0 &lt;__x86.get_pc_thunk.bx&gt;</span><br><span class="line">    <span class="number">1221</span>:	<span class="number">81</span> c3 b3 <span class="number">2</span>d <span class="number">00</span> <span class="number">00</span>    	add    $<span class="number">0x2db3</span>,%ebx</span><br><span class="line">    <span class="number">1227</span>:	<span class="number">83</span> ec <span class="number">08</span>             	sub    $<span class="number">0x8</span>,%esp</span><br><span class="line">    <span class="number">122</span>a:	<span class="number">8</span>d <span class="number">83</span> a8 e0 ff ff    	lea    <span class="number">-0x1f58</span>(%ebx),%eax</span><br><span class="line">    <span class="number">1230</span>:	<span class="number">50</span>                   	push   %eax</span><br><span class="line">    <span class="number">1231</span>:	ff <span class="number">75</span> <span class="number">08</span>             	pushl  <span class="number">0x8</span>(%ebp)</span><br><span class="line">    <span class="number">1234</span>:	e8 <span class="number">07</span> fe ff ff       	call   <span class="number">1040</span> &lt;<span class="built_in">strcmp</span>@plt&gt; <span class="comment">// strcmp</span></span><br><span class="line">    <span class="number">1239</span>:	<span class="number">83</span> c4 <span class="number">10</span>             	add    $<span class="number">0x10</span>,%esp</span><br><span class="line">    <span class="number">123</span>c:	<span class="number">85</span> c0                	test   %eax,%eax</span><br><span class="line">    <span class="number">123</span>e:	<span class="number">75</span> <span class="number">10</span>                	jne    <span class="number">1250</span> &lt;yeDfwUkv+<span class="number">0x3b</span>&gt; <span class="comment">// do_phase</span></span><br><span class="line">    <span class="number">1240</span>:	<span class="number">83</span> ec <span class="number">0</span>c             	sub    $<span class="number">0xc</span>,%esp</span><br><span class="line">    <span class="number">1243</span>:	ff <span class="number">75</span> <span class="number">08</span>             	pushl  <span class="number">0x8</span>(%ebp)</span><br><span class="line">    <span class="number">1246</span>:	e8 <span class="number">05</span> fe ff ff       	call   <span class="number">1050</span> &lt;<span class="built_in">puts</span>@plt&gt; <span class="comment">// printf的优化</span></span><br><span class="line">    <span class="number">124b</span>:	<span class="number">83</span> c4 <span class="number">10</span>             	add    $<span class="number">0x10</span>,%esp</span><br><span class="line">    <span class="number">124</span>e:	eb <span class="number">01</span>                	jmp    <span class="number">1251</span> &lt;yeDfwUkv+<span class="number">0x3c</span>&gt;</span><br><span class="line">    <span class="number">1250</span>:	<span class="number">90</span>                   	nop</span><br><span class="line">    <span class="number">1251</span>:	<span class="number">8b</span> <span class="number">5</span>d fc             	mov    <span class="number">-0x4</span>(%ebp),%ebx</span><br><span class="line">    <span class="number">1254</span>:	c9                   	leave  </span><br><span class="line">    <span class="number">1255</span>:	c3                   	ret    </span><br></pre></td></tr></table></figure>
<p>想要在 do_phase 中执行 OUTPUT_FUNC_NAME，打印 ID，必须先传入参数 ID，因为“strcmp(id,MYID)”，参数 ID 在 MYID 中，所以改为传入 MYID 的地址</p>
<p>但是 MYID 的地址是变化的（PIE保护），不能直接获取其地址</p>
<p>但是在动态链接中，地址可以通过GOT表来获取，确定MYID在GOT中的偏移</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">121</span>c:	e8 <span class="number">9f</span> fe ff ff       	call   <span class="number">10</span>c0 &lt;__x86.get_pc_thunk.bx&gt; </span><br><span class="line"><span class="number">1221</span>:	<span class="number">81</span> c3 b3 <span class="number">2</span>d <span class="number">00</span> <span class="number">00</span>    	add    $<span class="number">0x2db3</span>,%ebx </span><br><span class="line">    ............</span><br><span class="line"><span class="number">122</span>a:	<span class="number">8</span>d <span class="number">83</span> a8 e0 ff ff    	lea    <span class="number">-0x1f58</span>(%ebx),%eax </span><br><span class="line"><span class="number">1230</span>:	<span class="number">50</span>                   	push   %eax </span><br><span class="line"><span class="number">1231</span>:	ff <span class="number">75</span> <span class="number">08</span>             	pushl  <span class="number">0x8</span>(%ebp)</span><br><span class="line"><span class="number">1234</span>:	e8 <span class="number">07</span> fe ff ff       	call   <span class="number">1040</span> &lt;<span class="built_in">strcmp</span>@plt&gt; <span class="comment">// strcmp          </span></span><br></pre></td></tr></table></figure>
<p>“121c”和“1221”这两步就是为了获取GOT表，装入ebx</p>
<p>“122a”这一步取出了位于偏移为“-0x1f58”的数组，装入eax</p>
<p>“1230”和“1231”这两步显然是把“strcmp”的参数压栈（MYID 和 id，从右往左依次入栈）</p>
<p>而“strcmp”的参数就是 MYID ，反推得“-0x1f58”为MYID在GOT表中的偏移，MYID的地址有了</p>
<p>可以在构思注入 do_phase 的汇编了：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.code32 <span class="comment">// 不添加就会报错</span></span><br><span class="line">lea <span class="number">-0x1f58</span>(%eax), %eax</span><br><span class="line">push %eax</span><br><span class="line">call <span class="number">-86</span></span><br><span class="line">pop %eax</span><br></pre></td></tr></table></figure>
<p>查看二进制代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l2] gcc -c <span class="number">2.</span>s -o <span class="number">2.</span>o  </span><br><span class="line">➜  [/home/ywhkkx/ex1.linklab/l2] objdump -d <span class="number">2.</span>o   </span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>o：     文件格式 elf64-x86<span class="number">-64</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line"><span class="number">0000000000000000</span> &lt;.text&gt;:</span><br><span class="line">   <span class="number">0</span>:	<span class="number">8</span>d <span class="number">80</span> a8 e0 ff ff    	lea    <span class="number">-0x1f58</span>(%rax),%eax</span><br><span class="line">   <span class="number">6</span>:	<span class="number">50</span>                   	push   %rax</span><br><span class="line">   <span class="number">7</span>:	e8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       	callq  <span class="number">0xc</span></span><br><span class="line">   c:	<span class="number">58</span>                   	pop    %rax</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l2] gcc -m32 -o linkbomb2 main.o phase2.o </span><br><span class="line">➜  [/home/ywhkkx/ex1.linklab/l2] ./linkbomb2 </span><br><span class="line"><span class="number">1180300330</span></span><br></pre></td></tr></table></figure>
<p>成功了，最后再看一眼链接后的 linkbomb2 </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00001256</span> &lt;do_phase&gt;:</span><br><span class="line">    <span class="number">1256</span>:	<span class="number">55</span>                   	push   %ebp</span><br><span class="line">    <span class="number">1257</span>:	<span class="number">89</span> e5                	mov    %esp,%ebp</span><br><span class="line">    <span class="number">1259</span>:	e8 b3 ff ff ff       	call   <span class="number">1211</span> &lt;__x86.get_pc_thunk.ax&gt;</span><br><span class="line">    <span class="number">125</span>e:	<span class="number">05</span> <span class="number">76</span> <span class="number">2</span>d <span class="number">00</span> <span class="number">00</span>       	add    $<span class="number">0x2d76</span>,%eax <span class="comment">/* 因为链接,变具体了 */</span></span><br><span class="line">        <span class="comment">/* 新添 */</span></span><br><span class="line">    <span class="number">1263</span>:	<span class="number">8</span>d <span class="number">80</span> a8 e0 ff ff    	lea    <span class="number">-0x1f58</span>(%eax),%eax </span><br><span class="line">    <span class="number">1269</span>:	<span class="number">50</span>                   	push   %eax</span><br><span class="line">    <span class="number">126</span>a:	e8 a6 ff ff ff       	call   <span class="number">1215</span> &lt;yeDfwUkv&gt;</span><br><span class="line">    <span class="number">126f</span>:	<span class="number">58</span>                   	pop    %eax</span><br></pre></td></tr></table></figure>
<h2 id="实验三"><a href="#实验三" class="headerlink" title="实验三"></a>实验三</h2><p>创建生成一个名为 “phase3_patch.o” 的二进制可重定位目标文件，使其与 main.o phase3.o 链接后能够运行和输出（且仅输出）自己的学号</p>
<p>模块入口函数 do_phase() 依次遍历一个 COOKIE 字符串（由一组互不相同的英文字母组成，且总长度与学号字符串相同）中的每一字符，并通过一个映射数组将该字符的不同可能 ASCII 编码取值映射为输出字符</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> PHASE3_CODEBOOK[<span class="number">256</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_phase</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span> <span class="keyword">char</span> cookie[] = PHASE3_COOKIE;</span><br><span class="line">        <span class="keyword">for</span>( <span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="keyword">sizeof</span>(cookie)<span class="number">-1</span>; i++ )</span><br><span class="line">                <span class="built_in">printf</span>( <span class="string">&quot;%c&quot;</span>, PHASE3_CODEBOOK[ (<span class="keyword">unsigned</span> <span class="keyword">char</span>)(cookie[i]) ] );</span><br><span class="line">        <span class="built_in">printf</span>( <span class="string">&quot;\n&quot;</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>分析 do_phase 函数反汇编指令，获知 COOKIE 字符串（保存于栈帧中的局部字符数组中）的组成内容和起始地址</li>
<li>定位循环结构，根据 cookie 中字符的使用，定位映射数组的引用位置，结合重定位记录，确定映射数组的变量名</li>
<li>通过符号表，发现该数组为一未初始化变量（类型为COM，长度为256字节）</li>
<li>要改变程序输出（为学号），必须改变该映射数组的内容，因此，可利用强弱全局符号的解析规则，在 patch 模块中定义同名且按输出要求正确初始化映射关系的数组变量——从而在链接时替换对原数组的引用 </li>
</ul>
<p>先执行文件：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l3] ./linkbomb3 <span class="comment">// 打印了个寂寞</span></span><br></pre></td></tr></table></figure>
<p>PHASE3_CODEBOOK 未知，没有进行初始化，如果我们想要让 do_phase 打印我们需要的数据，就需要另写一个重定位文件对 PHASE3_CODEBOOK 进行初始化</p>
<p>反汇编 linkbomb3 寻找 COOKIE ：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00001225</span> &lt;do_phase&gt;:</span><br><span class="line">    <span class="number">1225</span>:	<span class="number">55</span>                   	push   %ebp</span><br><span class="line">    <span class="number">1226</span>:	<span class="number">89</span> e5                	mov    %esp,%ebp</span><br><span class="line">    <span class="number">1228</span>:	<span class="number">53</span>                   	push   %ebx</span><br><span class="line">    <span class="number">1229</span>:	<span class="number">83</span> ec <span class="number">24</span>             	sub    $<span class="number">0x24</span>,%esp</span><br><span class="line">    <span class="number">122</span>c:	e8 <span class="number">9f</span> fe ff ff       	call   <span class="number">10</span>d0 &lt;__x86.get_pc_thunk.bx&gt;</span><br><span class="line">    <span class="number">1231</span>:	<span class="number">81</span> c3 <span class="number">9f</span> <span class="number">2</span>d <span class="number">00</span> <span class="number">00</span>    	add    $<span class="number">0x2d9f</span>,%ebx</span><br><span class="line">    <span class="number">1237</span>:	<span class="number">65</span> a1 <span class="number">14</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    	mov    %gs:<span class="number">0x14</span>,%eax</span><br><span class="line">    <span class="number">123</span>d:	<span class="number">89</span> <span class="number">45</span> f4             	mov    %eax,<span class="number">-0xc</span>(%ebp)</span><br><span class="line">    <span class="number">1240</span>:	<span class="number">31</span> c0                	<span class="keyword">xor</span>    %eax,%eax</span><br><span class="line">    <span class="number">1242</span>:	c7 <span class="number">45</span> e9 <span class="number">61</span> <span class="number">73</span> <span class="number">74</span> <span class="number">70</span> 	movl   $<span class="number">0x70747361</span>,<span class="number">-0x17</span>(%ebp) <span class="comment">// target</span></span><br><span class="line">    <span class="number">1249</span>:	c7 <span class="number">45</span> ed <span class="number">71</span> <span class="number">72</span> <span class="number">77</span> <span class="number">68</span> 	movl   $<span class="number">0x68777271</span>,<span class="number">-0x13</span>(%ebp) <span class="comment">// target</span></span><br><span class="line">    <span class="number">1250</span>:	<span class="number">66</span> c7 <span class="number">45</span> f1 <span class="number">62</span> <span class="number">66</span>    	movw   $<span class="number">0x6662</span>,<span class="number">-0xf</span>(%ebp) <span class="comment">// target</span></span><br><span class="line">    <span class="number">1256</span>:	c6 <span class="number">45</span> f3 <span class="number">00</span>          	movb   $<span class="number">0x0</span>,<span class="number">-0xd</span>(%ebp)</span><br><span class="line">    <span class="number">125</span>a:	c7 <span class="number">45</span> e4 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 	movl   $<span class="number">0x0</span>,<span class="number">-0x1c</span>(%ebp)</span><br><span class="line">    <span class="number">1261</span>:	eb <span class="number">2b</span>                	jmp    <span class="number">128</span>e &lt;do_phase+<span class="number">0x69</span>&gt;</span><br><span class="line">    <span class="number">1263</span>:	<span class="number">8</span>d <span class="number">55</span> e9             	lea    <span class="number">-0x17</span>(%ebp),%edx</span><br><span class="line">    <span class="number">1266</span>:	<span class="number">8b</span> <span class="number">45</span> e4             	mov    <span class="number">-0x1c</span>(%ebp),%eax</span><br><span class="line">    <span class="number">1269</span>:	<span class="number">01</span> d0                	add    %edx,%eax</span><br><span class="line">    <span class="number">126b</span>:	<span class="number">0f</span> b6 <span class="number">00</span>             	movzbl (%eax),%eax</span><br><span class="line">    <span class="number">126</span>e:	<span class="number">0f</span> b6 c0             	movzbl %al,%eax</span><br><span class="line">    <span class="number">1271</span>:	<span class="number">8</span>d <span class="number">93</span> <span class="number">70</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    	lea    <span class="number">0x70</span>(%ebx),%edx</span><br><span class="line">    <span class="number">1277</span>:	<span class="number">0f</span> b6 <span class="number">04</span> <span class="number">02</span>          	movzbl (%edx,%eax,<span class="number">1</span>),%eax</span><br><span class="line">    <span class="number">127b</span>:	<span class="number">0f</span> be c0             	movsbl %al,%eax</span><br><span class="line">    <span class="number">127</span>e:	<span class="number">83</span> ec <span class="number">0</span>c             	sub    $<span class="number">0xc</span>,%esp</span><br><span class="line">    <span class="number">1281</span>:	<span class="number">50</span>                   	push   %eax</span><br><span class="line">    <span class="number">1282</span>:	e8 e9 fd ff ff       	call   <span class="number">1070</span> &lt;<span class="built_in">putchar</span>@plt&gt;</span><br><span class="line">    <span class="number">1287</span>:	<span class="number">83</span> c4 <span class="number">10</span>             	add    $<span class="number">0x10</span>,%esp</span><br><span class="line">    <span class="number">128</span>a:	<span class="number">83</span> <span class="number">45</span> e4 <span class="number">01</span>          	addl   $<span class="number">0x1</span>,<span class="number">-0x1c</span>(%ebp)</span><br><span class="line">    <span class="number">128</span>e:	<span class="number">8b</span> <span class="number">45</span> e4             	mov    <span class="number">-0x1c</span>(%ebp),%eax</span><br><span class="line">    <span class="number">1291</span>:	<span class="number">83</span> f8 <span class="number">09</span>             	cmp    $<span class="number">0x9</span>,%eax</span><br><span class="line">    <span class="number">1294</span>:	<span class="number">76</span> cd                	jbe    <span class="number">1263</span> &lt;do_phase+<span class="number">0x3e</span>&gt;</span><br><span class="line">    <span class="number">1296</span>:	<span class="number">83</span> ec <span class="number">0</span>c             	sub    $<span class="number">0xc</span>,%esp</span><br><span class="line">    <span class="number">1299</span>:	<span class="number">6</span>a <span class="number">0</span>a                	push   $<span class="number">0xa</span></span><br><span class="line">    <span class="number">129b</span>:	e8 d0 fd ff ff       	call   <span class="number">1070</span> &lt;<span class="built_in">putchar</span>@plt&gt;</span><br><span class="line">    <span class="number">12</span>a0:	<span class="number">83</span> c4 <span class="number">10</span>             	add    $<span class="number">0x10</span>,%esp</span><br><span class="line">    <span class="number">12</span>a3:	<span class="number">90</span>                   	nop</span><br><span class="line">    <span class="number">12</span>a4:	<span class="number">8b</span> <span class="number">45</span> f4             	mov    <span class="number">-0xc</span>(%ebp),%eax</span><br><span class="line">    <span class="number">12</span>a7:	<span class="number">65</span> <span class="number">33</span> <span class="number">05</span> <span class="number">14</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 	<span class="keyword">xor</span>    %gs:<span class="number">0x14</span>,%eax</span><br><span class="line">    <span class="number">12</span>ae:	<span class="number">74</span> <span class="number">05</span>                	je     <span class="number">12b</span>5 &lt;do_phase+<span class="number">0x90</span>&gt;</span><br><span class="line">    <span class="number">12b</span>0:	e8 <span class="number">8b</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       	call   <span class="number">1340</span> &lt;__stack_chk_fail_local&gt;</span><br><span class="line">    <span class="number">12b</span>5:	<span class="number">8b</span> <span class="number">5</span>d fc             	mov    <span class="number">-0x4</span>(%ebp),%ebx</span><br><span class="line">    <span class="number">12b</span>8:	c9                   	leave  </span><br><span class="line">    <span class="number">12b</span>9:	c3                   	ret    </span><br><span class="line">    <span class="number">12b</span>a:	<span class="number">66</span> <span class="number">90</span>                	xchg   %ax,%ax</span><br><span class="line">    <span class="number">12b</span>c:	<span class="number">66</span> <span class="number">90</span>                	xchg   %ax,%ax</span><br><span class="line">    <span class="number">12b</span>e:	<span class="number">66</span> <span class="number">90</span>                	xchg   %ax,%ax</span><br></pre></td></tr></table></figure>
<p>COOKIE 在栈中分配（看到与ebp有关的操作，和密之数字，基本猜到了）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1242</span>:	c7 <span class="number">45</span> e9 <span class="number">61</span> <span class="number">73</span> <span class="number">74</span> <span class="number">70</span> 	movl   $<span class="number">0x70747361</span>,<span class="number">-0x17</span>(%ebp) <span class="comment">// target</span></span><br><span class="line"><span class="number">1249</span>:	c7 <span class="number">45</span> ed <span class="number">71</span> <span class="number">72</span> <span class="number">77</span> <span class="number">68</span> 	movl   $<span class="number">0x68777271</span>,<span class="number">-0x13</span>(%ebp) <span class="comment">// target</span></span><br><span class="line"><span class="number">1250</span>:	<span class="number">66</span> c7 <span class="number">45</span> f1 <span class="number">62</span> <span class="number">66</span>    	movw   $<span class="number">0x6662</span>,<span class="number">-0xf</span>(%ebp) <span class="comment">// target</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">5</span>]: a=[<span class="number">0x61</span>,<span class="number">0x73</span>,<span class="number">0x74</span>,<span class="number">0x70</span>,<span class="number">0x71</span>,<span class="number">0x72</span>,<span class="number">0x77</span>,<span class="number">0x68</span>,<span class="number">0x62</span>,<span class="number">0x66</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: data=<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">   ...:     data+=<span class="built_in">chr</span>(a[i])</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">9</span>]: data</span><br><span class="line">Out[<span class="number">9</span>]: <span class="string">&#x27;astpqrwhbf&#x27;</span></span><br></pre></td></tr></table></figure>
<p>再在 GDB 中看看：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">04</span>:<span class="number">0010</span>│     <span class="number">0xffffcf00</span> ◂— <span class="number">0x747361fc</span> <span class="comment">/* &#x27;astp&#x27; &gt;&gt; 由于GDB被0xfc干扰,没有打印出来 */</span></span><br><span class="line"><span class="number">05</span>:<span class="number">0014</span>│     <span class="number">0xffffcf04</span> ◂— <span class="string">&#x27;pqrwhbf&#x27;</span></span><br><span class="line"><span class="number">06</span>:<span class="number">0018</span>│     <span class="number">0xffffcf08</span> ◂— <span class="number">0x666268</span> <span class="comment">/* &#x27;hbf&#x27; */</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/s <span class="number">0xffffcf00</span>+<span class="number">1</span></span><br><span class="line"><span class="number">0xffffcf01</span>:	<span class="string">&quot;astpqrwhbf&quot;</span></span><br></pre></td></tr></table></figure>
<p>文本中的 PHASE3_CODEBOOK 是弱符号（未初始化的全局变量），我们就在 phase3_patch.o 中定义一个强符号来替换它（强符号会优先被定义）</p>
<p>假设我们想让程序输出：YHelow</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l3] readelf -s phase3.o </span><br><span class="line"></span><br><span class="line">Symbol table <span class="string">&#x27;.symtab&#x27;</span> contains <span class="number">18</span> entries:</span><br><span class="line">   Num:    Value  Size Type    Bind   Vis      Ndx Name</span><br><span class="line">     <span class="number">0</span>: <span class="number">00000000</span>     <span class="number">0</span> NOTYPE  LOCAL  DEFAULT  UND </span><br><span class="line">     <span class="number">1</span>: <span class="number">00000000</span>     <span class="number">0</span> FILE    LOCAL  DEFAULT  ABS phase3.c</span><br><span class="line">     <span class="number">2</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT    <span class="number">2</span> </span><br><span class="line">     <span class="number">3</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT    <span class="number">4</span> </span><br><span class="line">     <span class="number">4</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT    <span class="number">5</span> </span><br><span class="line">     <span class="number">5</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT    <span class="number">6</span> </span><br><span class="line">     <span class="number">6</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT    <span class="number">8</span> </span><br><span class="line">     <span class="number">7</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT   <span class="number">10</span> </span><br><span class="line">     <span class="number">8</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT   <span class="number">11</span> </span><br><span class="line">     <span class="number">9</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT    <span class="number">9</span> </span><br><span class="line">    <span class="number">10</span>: <span class="number">00000000</span>     <span class="number">0</span> SECTION LOCAL  DEFAULT    <span class="number">1</span> </span><br><span class="line">    <span class="number">11</span>: <span class="number">00000020</span>   <span class="number">256</span> OBJECT  GLOBAL DEFAULT  COM cDBDohBAOo <span class="comment">// 获取字符串名称</span></span><br><span class="line">    <span class="number">12</span>: <span class="number">00000000</span>   <span class="number">149</span> FUNC    GLOBAL DEFAULT    <span class="number">2</span> do_phase</span><br><span class="line">    <span class="number">13</span>: <span class="number">00000000</span>     <span class="number">0</span> FUNC    GLOBAL HIDDEN     <span class="number">8</span> __x86.get_pc_thunk.bx</span><br><span class="line">    <span class="number">14</span>: <span class="number">00000000</span>     <span class="number">0</span> NOTYPE  GLOBAL DEFAULT  UND _GLOBAL_OFFSET_TABLE_</span><br><span class="line">    <span class="number">15</span>: <span class="number">00000000</span>     <span class="number">0</span> NOTYPE  GLOBAL DEFAULT  UND <span class="built_in">putchar</span></span><br><span class="line">    <span class="number">16</span>: <span class="number">00000000</span>     <span class="number">0</span> NOTYPE  GLOBAL HIDDEN   UND __stack_chk_fail_local</span><br><span class="line">    <span class="number">17</span>: <span class="number">00000000</span>     <span class="number">4</span> OBJECT  GLOBAL DEFAULT    <span class="number">6</span> phase</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span>  cDBDohBAOo[<span class="number">256</span>] =   <span class="string">&quot;1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111Y01119121111111lloHe11w&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l3] gcc -m32 -c phase3_patch.c -o phase3_patch.o</span><br><span class="line">➜  [/home/ywhkkx/ex1.linklab/l3] gcc -m32 -o linkbomb3 main.o phase3.o phase3_patch.o</span><br><span class="line">➜  [/home/ywhkkx/ex1.linklab/l3] ./linkbomb3 </span><br><span class="line">YHellow209</span><br></pre></td></tr></table></figure>
<h2 id="实验四"><a href="#实验四" class="headerlink" title="实验四"></a>实验四</h2><p>修改二进制可重定位目标文件 “phase4.o” 中相应节中的数据内容（注意不允许修改 .text 节的内容），使其与 main.o 链接后能够运行输出（且仅输出）自己的学号</p>
<p>本阶段学生所拿到的.o文件中的“重定位位置”信息已经被抹除，学生需要根据实际情况确认冲重定位的发生位置，并根据重定位类型对位置信息进行恢复 </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_phase</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span> cookie[] = PHASE4_COOKIE; </span><br><span class="line">        <span class="keyword">char</span> c;</span><br><span class="line">        <span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(cookie)<span class="number">-1</span>; i++ ) </span><br><span class="line">       &#123;</span><br><span class="line">                c = cookie[i];</span><br><span class="line">                <span class="keyword">switch</span> (c) </span><br><span class="line">                &#123;</span><br><span class="line">                      <span class="comment">// 每个学生的映射关系和case顺序建议不一样</span></span><br><span class="line">                      <span class="keyword">case</span> ‘A’: &#123; c = <span class="number">48</span>; <span class="keyword">break</span>; &#125; </span><br><span class="line">                      <span class="keyword">case</span> ‘B’: &#123; c = <span class="number">121</span>; <span class="keyword">break</span>; &#125;</span><br><span class="line">                        …</span><br><span class="line">                      <span class="keyword">case</span> ‘Z’: &#123; c = <span class="number">93</span>; <span class="keyword">break</span>; &#125;</span><br><span class="line">                &#125;</span><br><span class="line">               <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, c);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>通过分析 do_phase 函数的反汇编程序获知 COOKIE 字符串（保存于栈帧中的局部字符数组中）的组成内容</li>
<li>确定 switch 跳转表在 .rodata 节中的偏移量（“A”，“B”，“C” …… 这些字符都在 .rodata 节中）</li>
<li>定位 COOKIE 中每一字符’c’在switch跳转表中的对应表项（索引为’c’-0x41），将其值设为输出目标学号中对应字符的 case 首指令的偏移量</li>
</ul>
<p>直接运行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l4] ./linkbomb4                          </span><br><span class="line">wl0_TZb3vJ</span><br></pre></td></tr></table></figure>
<p>和 <strong>实验三</strong> 一样的套路，只不过这个在外面包装了 switch-case </p>
<p>故技重施，先反汇编 linkbomb4 寻找 COOKIE ：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00001225</span> &lt;do_phase&gt;:</span><br><span class="line">    <span class="number">1225</span>:	<span class="number">55</span>                   	push   %ebp</span><br><span class="line">    <span class="number">1226</span>:	<span class="number">89</span> e5                	mov    %esp,%ebp</span><br><span class="line">    <span class="number">1228</span>:	<span class="number">53</span>                   	push   %ebx</span><br><span class="line">    <span class="number">1229</span>:	<span class="number">83</span> ec <span class="number">24</span>             	sub    $<span class="number">0x24</span>,%esp</span><br><span class="line">    <span class="number">122</span>c:	e8 <span class="number">9f</span> fe ff ff       	call   <span class="number">10</span>d0 &lt;__x86.get_pc_thunk.bx&gt;</span><br><span class="line">    <span class="number">1231</span>:	<span class="number">81</span> c3 <span class="number">9f</span> <span class="number">2</span>d <span class="number">00</span> <span class="number">00</span>    	add    $<span class="number">0x2d9f</span>,%ebx</span><br><span class="line">    <span class="number">1237</span>:	<span class="number">65</span> a1 <span class="number">14</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    	mov    %gs:<span class="number">0x14</span>,%eax</span><br><span class="line">    <span class="number">123</span>d:	<span class="number">89</span> <span class="number">45</span> f4             	mov    %eax,<span class="number">-0xc</span>(%ebp)</span><br><span class="line">    <span class="number">1240</span>:	<span class="number">31</span> c0                	<span class="keyword">xor</span>    %eax,%eax</span><br><span class="line">    <span class="number">1242</span>:	c7 <span class="number">45</span> e9 <span class="number">42</span> <span class="number">47</span> <span class="number">4f</span> <span class="number">4</span>d 	movl   $<span class="number">0x4d4f4742</span>,<span class="number">-0x17</span>(%ebp) <span class="comment">// target</span></span><br><span class="line">    <span class="number">1249</span>:	c7 <span class="number">45</span> ed <span class="number">45</span> <span class="number">49</span> <span class="number">55</span> <span class="number">46</span> 	movl   $<span class="number">0x46554945</span>,<span class="number">-0x13</span>(%ebp) <span class="comment">// target</span></span><br><span class="line">    <span class="number">1250</span>:	<span class="number">66</span> c7 <span class="number">45</span> f1 <span class="number">51</span> <span class="number">4</span>a    	movw   $<span class="number">0x4a51</span>,<span class="number">-0xf</span>(%ebp) <span class="comment">// target</span></span><br><span class="line">    <span class="number">1256</span>:	c6 <span class="number">45</span> f3 <span class="number">00</span>          	movb   $<span class="number">0x0</span>,<span class="number">-0xd</span>(%ebp)</span><br><span class="line">    <span class="number">125</span>a:	c7 <span class="number">45</span> e4 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 	movl   $<span class="number">0x0</span>,<span class="number">-0x1c</span>(%ebp)</span><br><span class="line">    <span class="number">1261</span>:	e9 e7 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       	jmp    <span class="number">134</span>d &lt;.L30+<span class="number">0x19</span>&gt;</span><br><span class="line">    <span class="number">1266</span>:	<span class="number">8</span>d <span class="number">55</span> e9             	lea    <span class="number">-0x17</span>(%ebp),%edx</span><br><span class="line">    <span class="number">1269</span>:	<span class="number">8b</span> <span class="number">45</span> e4             	mov    <span class="number">-0x1c</span>(%ebp),%eax</span><br><span class="line">    <span class="number">126</span>c:	<span class="number">01</span> d0                	add    %edx,%eax</span><br><span class="line">    <span class="number">126</span>e:	<span class="number">0f</span> b6 <span class="number">00</span>             	movzbl (%eax),%eax</span><br><span class="line">    <span class="number">1271</span>:	<span class="number">88</span> <span class="number">45</span> e3             	mov    %al,<span class="number">-0x1d</span>(%ebp)</span><br><span class="line">    <span class="number">1274</span>:	<span class="number">0f</span> be <span class="number">45</span> e3          	movsbl <span class="number">-0x1d</span>(%ebp),%eax</span><br><span class="line">    <span class="number">1278</span>:	<span class="number">83</span> e8 <span class="number">41</span>             	sub    $<span class="number">0x41</span>,%eax</span><br><span class="line">    <span class="number">127b</span>:	<span class="number">83</span> f8 <span class="number">19</span>             	cmp    $<span class="number">0x19</span>,%eax</span><br><span class="line">    <span class="number">127</span>e:	<span class="number">0f</span> <span class="number">87</span> b5 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    	ja     <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line">    <span class="number">1284</span>:	c1 e0 <span class="number">02</span>             	shl    $<span class="number">0x2</span>,%eax</span><br><span class="line">    <span class="number">1287</span>:	<span class="number">8b</span> <span class="number">84</span> <span class="number">18</span> ac e0 ff ff 	mov    <span class="number">-0x1f54</span>(%eax,%ebx,<span class="number">1</span>),%eax</span><br><span class="line">    <span class="number">128</span>e:	<span class="number">01</span> d8                	add    %ebx,%eax</span><br><span class="line">    <span class="number">1290</span>:	ff e0                	jmp    *%eax</span><br></pre></td></tr></table></figure>
<p>这次直接在GDB中获取 COOKIE 了：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/xs <span class="number">0xffffcf00</span>+<span class="number">1</span></span><br><span class="line"><span class="number">0xffffcf01</span>:	<span class="string">&quot;BGOMEIUFQJ&quot;</span></span><br></pre></td></tr></table></figure>
<p>在 Switch-Case 中：“BGOMEIUFQJ” 对应“跳转表”表项的顺序为：2 7 15 13 5 9 21 6 17 10 </p>
<p>先看下汇编：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00001225</span> &lt;do_phase&gt;:</span><br><span class="line">    <span class="number">1225</span>:	<span class="number">55</span>                   	push   %ebp</span><br><span class="line">    <span class="number">1226</span>:	<span class="number">89</span> e5                	mov    %esp,%ebp</span><br><span class="line">    <span class="number">1228</span>:	<span class="number">53</span>                   	push   %ebx</span><br><span class="line">    <span class="number">1229</span>:	<span class="number">83</span> ec <span class="number">24</span>             	sub    $<span class="number">0x24</span>,%esp</span><br><span class="line">    <span class="number">122</span>c:	e8 <span class="number">9f</span> fe ff ff       	call   <span class="number">10</span>d0 &lt;__x86.get_pc_thunk.bx&gt;</span><br><span class="line">    <span class="number">1231</span>:	<span class="number">81</span> c3 <span class="number">9f</span> <span class="number">2</span>d <span class="number">00</span> <span class="number">00</span>    	add    $<span class="number">0x2d9f</span>,%ebx</span><br><span class="line">    <span class="number">1237</span>:	<span class="number">65</span> a1 <span class="number">14</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    	mov    %gs:<span class="number">0x14</span>,%eax</span><br><span class="line">    <span class="number">123</span>d:	<span class="number">89</span> <span class="number">45</span> f4             	mov    %eax,<span class="number">-0xc</span>(%ebp)</span><br><span class="line">    <span class="number">1240</span>:	<span class="number">31</span> c0                	<span class="keyword">xor</span>    %eax,%eax</span><br><span class="line">    <span class="number">1242</span>:	c7 <span class="number">45</span> e9 <span class="number">42</span> <span class="number">47</span> <span class="number">4f</span> <span class="number">4</span>d 	movl   $<span class="number">0x4d4f4742</span>,<span class="number">-0x17</span>(%ebp)</span><br><span class="line">    <span class="number">1249</span>:	c7 <span class="number">45</span> ed <span class="number">45</span> <span class="number">49</span> <span class="number">55</span> <span class="number">46</span> 	movl   $<span class="number">0x46554945</span>,<span class="number">-0x13</span>(%ebp)</span><br><span class="line">    <span class="number">1250</span>:	<span class="number">66</span> c7 <span class="number">45</span> f1 <span class="number">51</span> <span class="number">4</span>a    	movw   $<span class="number">0x4a51</span>,<span class="number">-0xf</span>(%ebp)</span><br><span class="line">    <span class="number">1256</span>:	c6 <span class="number">45</span> f3 <span class="number">00</span>          	movb   $<span class="number">0x0</span>,<span class="number">-0xd</span>(%ebp)</span><br><span class="line">    <span class="number">125</span>a:	c7 <span class="number">45</span> e4 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 	movl   $<span class="number">0x0</span>,<span class="number">-0x1c</span>(%ebp)</span><br><span class="line">    <span class="number">1261</span>:	e9 e7 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       	jmp    <span class="number">134</span>d &lt;.L30+<span class="number">0x19</span>&gt;</span><br><span class="line">    <span class="number">1266</span>:	<span class="number">8</span>d <span class="number">55</span> e9             	lea    <span class="number">-0x17</span>(%ebp),%edx</span><br><span class="line">    <span class="number">1269</span>:	<span class="number">8b</span> <span class="number">45</span> e4             	mov    <span class="number">-0x1c</span>(%ebp),%eax</span><br><span class="line">    <span class="number">126</span>c:	<span class="number">01</span> d0                	add    %edx,%eax</span><br><span class="line">    <span class="number">126</span>e:	<span class="number">0f</span> b6 <span class="number">00</span>             	movzbl (%eax),%eax</span><br><span class="line">    <span class="number">1271</span>:	<span class="number">88</span> <span class="number">45</span> e3             	mov    %al,<span class="number">-0x1d</span>(%ebp)</span><br><span class="line">    <span class="number">1274</span>:	<span class="number">0f</span> be <span class="number">45</span> e3          	movsbl <span class="number">-0x1d</span>(%ebp),%eax</span><br><span class="line">    <span class="number">1278</span>:	<span class="number">83</span> e8 <span class="number">41</span>             	sub    $<span class="number">0x41</span>,%eax</span><br><span class="line">    <span class="number">127b</span>:	<span class="number">83</span> f8 <span class="number">19</span>             	cmp    $<span class="number">0x19</span>,%eax</span><br><span class="line">    <span class="number">127</span>e:	<span class="number">0f</span> <span class="number">87</span> b5 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    	ja     <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line">    <span class="number">1284</span>:	c1 e0 <span class="number">02</span>             	shl    $<span class="number">0x2</span>,%eax</span><br><span class="line">    <span class="number">1287</span>:	<span class="number">8b</span> <span class="number">84</span> <span class="number">18</span> ac e0 ff ff 	mov    <span class="number">-0x1f54</span>(%eax,%ebx,<span class="number">1</span>),%eax</span><br><span class="line">    <span class="number">128</span>e:	<span class="number">01</span> d8                	add    %ebx,%eax</span><br><span class="line">    <span class="number">1290</span>:	ff e0                	jmp    *%eax</span><br><span class="line"></span><br><span class="line"><span class="number">00001292</span> &lt;.L4&gt;: </span><br><span class="line">    <span class="number">1292</span>:	c6 <span class="number">45</span> e3 <span class="number">54</span>          	movb   $<span class="number">0x54</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// A &gt;&gt; T</span></span><br><span class="line">    <span class="number">1296</span>:	e9 <span class="number">9</span>e <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">0000129b</span> &lt;.L6&gt;:</span><br><span class="line">    <span class="number">129b</span>:	c6 <span class="number">45</span> e3 <span class="number">77</span>          	movb   $<span class="number">0x77</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// B &gt;&gt; w</span></span><br><span class="line">    <span class="number">129f</span>:	e9 <span class="number">95</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">000012</span>a4 &lt;.L7&gt;:</span><br><span class="line">    <span class="number">12</span>a4:	c6 <span class="number">45</span> e3 <span class="number">70</span>          	movb   $<span class="number">0x70</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// C &gt;&gt; p</span></span><br><span class="line">    <span class="number">12</span>a8:	e9 <span class="number">8</span>c <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">000012</span>ad &lt;.L8&gt;:</span><br><span class="line">    <span class="number">12</span>ad:	c6 <span class="number">45</span> e3 <span class="number">36</span>          	movb   $<span class="number">0x36</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// D &gt;&gt; 6</span></span><br><span class="line">    <span class="number">12b</span>1:	e9 <span class="number">83</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">000012b</span>6 &lt;.L9&gt;:</span><br><span class="line">    <span class="number">12b</span>6:	c6 <span class="number">45</span> e3 <span class="number">54</span>          	movb   $<span class="number">0x54</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// E &gt;&gt; T</span></span><br><span class="line">    <span class="number">12b</span>a:	eb <span class="number">7</span>d                	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">000012b</span>c &lt;.L10&gt;:</span><br><span class="line">    <span class="number">12b</span>c:	c6 <span class="number">45</span> e3 <span class="number">33</span>          	movb   $<span class="number">0x33</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// F &gt;&gt; 3</span></span><br><span class="line">    <span class="number">12</span>c0:	eb <span class="number">77</span>                	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">000012</span>c2 &lt;.L11&gt;:</span><br><span class="line">    <span class="number">12</span>c2:	c6 <span class="number">45</span> e3 <span class="number">6</span>c          	movb   $<span class="number">0x6c</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// G &gt;&gt; l</span></span><br><span class="line">    <span class="number">12</span>c6:	eb <span class="number">71</span>                	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">000012</span>c8 &lt;.L12&gt;:</span><br><span class="line">    <span class="number">12</span>c8:	c6 <span class="number">45</span> e3 <span class="number">34</span>          	movb   $<span class="number">0x34</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// H &gt;&gt; 4</span></span><br><span class="line">    <span class="number">12</span>cc:	eb <span class="number">6b</span>                	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">000012</span>ce &lt;.L13&gt;:</span><br><span class="line">    <span class="number">12</span>ce:	c6 <span class="number">45</span> e3 <span class="number">5</span>a          	movb   $<span class="number">0x5a</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// I &gt;&gt; Z </span></span><br><span class="line">    <span class="number">12</span>d2:	eb <span class="number">65</span>                	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">000012</span>d4 &lt;.L14&gt;:</span><br><span class="line">    <span class="number">12</span>d4:	c6 <span class="number">45</span> e3 <span class="number">4</span>a          	movb   $<span class="number">0x4a</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// J &gt;&gt; J </span></span><br><span class="line">    <span class="number">12</span>d8:	eb <span class="number">5f</span>                	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">000012</span>da &lt;.L15&gt;:</span><br><span class="line">    <span class="number">12</span>da:	c6 <span class="number">45</span> e3 <span class="number">51</span>          	movb   $<span class="number">0x51</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// K &gt;&gt; Q</span></span><br><span class="line">    <span class="number">12</span>de:	eb <span class="number">59</span>                	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">000012e0</span> &lt;.L16&gt;:</span><br><span class="line">    <span class="number">12e0</span>:	c6 <span class="number">45</span> e3 <span class="number">4</span>d          	movb   $<span class="number">0x4d</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// L &gt;&gt; M</span></span><br><span class="line">    <span class="number">12e4</span>:	eb <span class="number">53</span>                	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">000012e6</span> &lt;.L17&gt;:</span><br><span class="line">    <span class="number">12e6</span>:	c6 <span class="number">45</span> e3 <span class="number">5f</span>          	movb   $<span class="number">0x5f</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// M &gt;&gt; -</span></span><br><span class="line">    <span class="number">12</span>ea:	eb <span class="number">4</span>d                	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">000012</span>ec &lt;.L18&gt;:</span><br><span class="line">    <span class="number">12</span>ec:	c6 <span class="number">45</span> e3 <span class="number">38</span>          	movb   $<span class="number">0x38</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// N &gt;&gt; 8</span></span><br><span class="line">    <span class="number">12f</span>0:	eb <span class="number">47</span>                	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">000012f</span>2 &lt;.L19&gt;:</span><br><span class="line">    <span class="number">12f</span>2:	c6 <span class="number">45</span> e3 <span class="number">30</span>          	movb   $<span class="number">0x30</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// O &gt;&gt; 0</span></span><br><span class="line">    <span class="number">12f</span>6:	eb <span class="number">41</span>                	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">000012f</span>8 &lt;.L20&gt;:</span><br><span class="line">    <span class="number">12f</span>8:	c6 <span class="number">45</span> e3 <span class="number">32</span>          	movb   $<span class="number">0x32</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// P &gt;&gt; 2</span></span><br><span class="line">    <span class="number">12f</span>c:	eb <span class="number">3b</span>                	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">000012f</span>e &lt;.L21&gt;:</span><br><span class="line">    <span class="number">12f</span>e:	c6 <span class="number">45</span> e3 <span class="number">76</span>          	movb   $<span class="number">0x76</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// Q &gt;&gt; v</span></span><br><span class="line">    <span class="number">1302</span>:	eb <span class="number">35</span>                	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">00001304</span> &lt;.L22&gt;:</span><br><span class="line">    <span class="number">1304</span>:	c6 <span class="number">45</span> e3 <span class="number">35</span>          	movb   $<span class="number">0x35</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// R &gt;&gt; 5</span></span><br><span class="line">    <span class="number">1308</span>:	eb <span class="number">2f</span>                	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">0000130</span>a &lt;.L23&gt;:</span><br><span class="line">    <span class="number">130</span>a:	c6 <span class="number">45</span> e3 <span class="number">3</span>c          	movb   $<span class="number">0x3c</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// S &gt;&gt; &lt;</span></span><br><span class="line">    <span class="number">130</span>e:	eb <span class="number">29</span>                	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">00001310</span> &lt;.L24&gt;:</span><br><span class="line">    <span class="number">1310</span>:	c6 <span class="number">45</span> e3 <span class="number">39</span>          	movb   $<span class="number">0x39</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// J &gt;&gt; 9</span></span><br><span class="line">    <span class="number">1314</span>:	eb <span class="number">23</span>                	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">00001316</span> &lt;.L25&gt;:</span><br><span class="line">    <span class="number">1316</span>:	c6 <span class="number">45</span> e3 <span class="number">62</span>          	movb   $<span class="number">0x62</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// U &gt;&gt; b</span></span><br><span class="line">    <span class="number">131</span>a:	eb <span class="number">1</span>d                	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">0000131</span>c &lt;.L26&gt;:</span><br><span class="line">    <span class="number">131</span>c:	c6 <span class="number">45</span> e3 <span class="number">57</span>          	movb   $<span class="number">0x57</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// V &gt;&gt; W</span></span><br><span class="line">    <span class="number">1320</span>:	eb <span class="number">17</span>                	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">00001322</span> &lt;.L27&gt;:</span><br><span class="line">    <span class="number">1322</span>:	c6 <span class="number">45</span> e3 <span class="number">60</span>          	movb   $<span class="number">0x60</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// W &gt;&gt; ~</span></span><br><span class="line">    <span class="number">1326</span>:	eb <span class="number">11</span>                	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">00001328</span> &lt;.L28&gt;:</span><br><span class="line">    <span class="number">1328</span>:	c6 <span class="number">45</span> e3 <span class="number">4</span>d          	movb   $<span class="number">0x4d</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// X &gt;&gt; M</span></span><br><span class="line">    <span class="number">132</span>c:	eb <span class="number">0b</span>                	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">0000132</span>e &lt;.L29&gt;:</span><br><span class="line">    <span class="number">132</span>e:	c6 <span class="number">45</span> e3 <span class="number">31</span>          	movb   $<span class="number">0x31</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// Y &gt;&gt; 1</span></span><br><span class="line">    <span class="number">1332</span>:	eb <span class="number">05</span>                	jmp    <span class="number">1339</span> &lt;.L30+<span class="number">0x5</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">00001334</span> &lt;.L30&gt;:</span><br><span class="line">    <span class="number">1334</span>:	c6 <span class="number">45</span> e3 <span class="number">37</span>          	movb   $<span class="number">0x37</span>,<span class="number">-0x1d</span>(%ebp) <span class="comment">// Z &gt;&gt; 7</span></span><br><span class="line">    <span class="number">1338</span>:	<span class="number">90</span>                   	nop</span><br><span class="line">    <span class="number">1339</span>:	<span class="number">0f</span> be <span class="number">45</span> e3          	movsbl <span class="number">-0x1d</span>(%ebp),%eax</span><br><span class="line">    <span class="number">133</span>d:	<span class="number">83</span> ec <span class="number">0</span>c             	sub    $<span class="number">0xc</span>,%esp</span><br><span class="line">    <span class="number">1340</span>:	<span class="number">50</span>                   	push   %eax</span><br><span class="line">    <span class="number">1341</span>:	e8 <span class="number">2</span>a fd ff ff       	call   <span class="number">1070</span> &lt;<span class="built_in">putchar</span>@plt&gt;</span><br><span class="line">    <span class="number">1346</span>:	<span class="number">83</span> c4 <span class="number">10</span>             	add    $<span class="number">0x10</span>,%esp</span><br><span class="line">    <span class="number">1349</span>:	<span class="number">83</span> <span class="number">45</span> e4 <span class="number">01</span>          	addl   $<span class="number">0x1</span>,<span class="number">-0x1c</span>(%ebp)</span><br><span class="line">    <span class="number">134</span>d:	<span class="number">8b</span> <span class="number">45</span> e4             	mov    <span class="number">-0x1c</span>(%ebp),%eax</span><br><span class="line">    <span class="number">1350</span>:	<span class="number">83</span> f8 <span class="number">09</span>             	cmp    $<span class="number">0x9</span>,%eax</span><br><span class="line">    <span class="number">1353</span>:	<span class="number">0f</span> <span class="number">86</span> <span class="number">0</span>d ff ff ff    	jbe    <span class="number">1266</span> &lt;do_phase+<span class="number">0x41</span>&gt;</span><br><span class="line">    <span class="number">1359</span>:	<span class="number">83</span> ec <span class="number">0</span>c             	sub    $<span class="number">0xc</span>,%esp</span><br><span class="line">    <span class="number">135</span>c:	<span class="number">6</span>a <span class="number">0</span>a                	push   $<span class="number">0xa</span></span><br><span class="line">    <span class="number">135</span>e:	e8 <span class="number">0</span>d fd ff ff       	call   <span class="number">1070</span> &lt;<span class="built_in">putchar</span>@plt&gt;</span><br><span class="line">    <span class="number">1363</span>:	<span class="number">83</span> c4 <span class="number">10</span>             	add    $<span class="number">0x10</span>,%esp</span><br><span class="line">    <span class="number">1366</span>:	<span class="number">90</span>                   	nop</span><br><span class="line">    <span class="number">1367</span>:	<span class="number">8b</span> <span class="number">45</span> f4             	mov    <span class="number">-0xc</span>(%ebp),%eax</span><br><span class="line">    <span class="number">136</span>a:	<span class="number">65</span> <span class="number">33</span> <span class="number">05</span> <span class="number">14</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 	<span class="keyword">xor</span>    %gs:<span class="number">0x14</span>,%eax</span><br><span class="line">    <span class="number">1371</span>:	<span class="number">74</span> <span class="number">05</span>                	je     <span class="number">1378</span> &lt;.L30+<span class="number">0x44</span>&gt;</span><br><span class="line">    <span class="number">1373</span>:	e8 <span class="number">88</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       	call   <span class="number">1400</span> &lt;__stack_chk_fail_local&gt;</span><br><span class="line">    <span class="number">1378</span>:	<span class="number">8b</span> <span class="number">5</span>d fc             	mov    <span class="number">-0x4</span>(%ebp),%ebx</span><br><span class="line">    <span class="number">137b</span>:	c9                   	leave  </span><br><span class="line">    <span class="number">137</span>c:	c3                   	ret    </span><br><span class="line">    <span class="number">137</span>d:	<span class="number">66</span> <span class="number">90</span>                	xchg   %ax,%ax</span><br><span class="line">    <span class="number">137f</span>:	<span class="number">90</span>                   	nop</span><br></pre></td></tr></table></figure>
<p>这些奇怪的 L4 L6 L7 就是字符了（主要是因为它们有26个）</p>
<p>“jmp    1339 &lt;.L30+0x5&gt;”应该就是“break”，可以通过 movb 来获取对应的打印数据（已标记）</p>
<p>实验四想要我们修改“phase4.o”，但不让我们修改 .text 节的内容（可执行指令的集合），所以我们只能改 .rodata 节中的“跳转表”</p>
<p>​        // 可采用以下代码证明：L4 L6 L7 就是 A，B，C，D …… </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l4] readelf -s phase4.o</span><br><span class="line">➜  [/home/ywhkkx/ex1.linklab/l4] readelf -S phase4.o</span><br></pre></td></tr></table></figure>
<p>用 readelf 打印重定位节：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">重定位节 <span class="string">&#x27;.rel.rodata&#x27;</span> at offset <span class="number">0x648</span> contains <span class="number">26</span> entries:</span><br><span class="line"> 偏移量     信息    类型              符号值      符号名称</span><br><span class="line"><span class="number">00000000</span>  <span class="number">00000</span>a09 R_386_GOTOFF      <span class="number">0000006</span>d   .L4</span><br><span class="line"><span class="number">00000004</span>  <span class="number">00000b</span>09 R_386_GOTOFF      <span class="number">00000076</span>   .L6</span><br><span class="line"><span class="number">00000008</span>  <span class="number">00000</span>c09 R_386_GOTOFF      <span class="number">0000007f</span>   .L7</span><br><span class="line"><span class="number">0000000</span>c  <span class="number">00000</span>d09 R_386_GOTOFF      <span class="number">00000088</span>   .L8</span><br><span class="line"><span class="number">00000010</span>  <span class="number">00000e09</span> R_386_GOTOFF      <span class="number">00000091</span>   .L9</span><br><span class="line"><span class="number">00000014</span>  <span class="number">00000f</span>09 R_386_GOTOFF      <span class="number">00000097</span>   .L10</span><br><span class="line"><span class="number">00000018</span>  <span class="number">00001009</span> R_386_GOTOFF      <span class="number">0000009</span>d   .L11</span><br><span class="line"><span class="number">0000001</span>c  <span class="number">00001109</span> R_386_GOTOFF      <span class="number">000000</span>a3   .L12</span><br><span class="line"><span class="number">00000020</span>  <span class="number">00001209</span> R_386_GOTOFF      <span class="number">000000</span>a9   .L13</span><br><span class="line"><span class="number">00000024</span>  <span class="number">00001309</span> R_386_GOTOFF      <span class="number">000000</span>af   .L14</span><br><span class="line"><span class="number">00000028</span>  <span class="number">00001409</span> R_386_GOTOFF      <span class="number">000000b</span>5   .L15</span><br><span class="line"><span class="number">0000002</span>c  <span class="number">00001509</span> R_386_GOTOFF      <span class="number">000000b</span>b   .L16</span><br><span class="line"><span class="number">00000030</span>  <span class="number">00001609</span> R_386_GOTOFF      <span class="number">000000</span>c1   .L17</span><br><span class="line"><span class="number">00000034</span>  <span class="number">00001709</span> R_386_GOTOFF      <span class="number">000000</span>c7   .L18</span><br><span class="line"><span class="number">00000038</span>  <span class="number">00001809</span> R_386_GOTOFF      <span class="number">000000</span>cd   .L19</span><br><span class="line"><span class="number">0000003</span>c  <span class="number">00001909</span> R_386_GOTOFF      <span class="number">000000</span>d3   .L20</span><br><span class="line"><span class="number">00000040</span>  <span class="number">00001</span>a09 R_386_GOTOFF      <span class="number">000000</span>d9   .L21</span><br><span class="line"><span class="number">00000044</span>  <span class="number">00001b</span>09 R_386_GOTOFF      <span class="number">000000</span>df   .L22</span><br><span class="line"><span class="number">00000048</span>  <span class="number">00001</span>c09 R_386_GOTOFF      <span class="number">000000e5</span>   .L23</span><br><span class="line"><span class="number">0000004</span>c  <span class="number">00001</span>d09 R_386_GOTOFF      <span class="number">000000</span>eb   .L24</span><br><span class="line"><span class="number">00000050</span>  <span class="number">00001e09</span> R_386_GOTOFF      <span class="number">000000f</span>1   .L25</span><br><span class="line"><span class="number">00000054</span>  <span class="number">00001f</span>09 R_386_GOTOFF      <span class="number">000000f</span>7   .L26</span><br><span class="line"><span class="number">00000058</span>  <span class="number">00002009</span> R_386_GOTOFF      <span class="number">000000f</span>d   .L27</span><br><span class="line"><span class="number">0000005</span>c  <span class="number">00002109</span> R_386_GOTOFF      <span class="number">00000103</span>   .L28</span><br><span class="line"><span class="number">00000060</span>  <span class="number">00002209</span> R_386_GOTOFF      <span class="number">00000109</span>   .L29</span><br><span class="line"><span class="number">00000064</span>  <span class="number">00002309</span> R_386_GOTOFF      <span class="number">0000010f</span>   .L30</span><br></pre></td></tr></table></figure>
<p>获取各个元素的节内偏移</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l4] readelf -S phase4.o</span><br><span class="line">There are <span class="number">18</span> section headers, starting at offset <span class="number">0x7cc</span>:</span><br><span class="line"></span><br><span class="line">节头：</span><br><span class="line">  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al</span><br><span class="line">  [ <span class="number">0</span>]                   <span class="literal">NULL</span>            <span class="number">00000000</span> <span class="number">000000</span> <span class="number">000000</span> <span class="number">00</span>      <span class="number">0</span>   <span class="number">0</span>  <span class="number">0</span></span><br><span class="line">  [ <span class="number">1</span>] .group            GROUP           <span class="number">00000000</span> <span class="number">000034</span> <span class="number">000008</span> <span class="number">04</span>     <span class="number">15</span>  <span class="number">39</span>  <span class="number">4</span></span><br><span class="line">  [ <span class="number">2</span>] .text             PROGBITS        <span class="number">00000000</span> <span class="number">00003</span>c <span class="number">000158</span> <span class="number">00</span>  AX  <span class="number">0</span>   <span class="number">0</span>  <span class="number">1</span></span><br><span class="line">  [ <span class="number">3</span>] .rel.text         REL             <span class="number">00000000</span> <span class="number">000618</span> <span class="number">000030</span> <span class="number">08</span>   I <span class="number">15</span>   <span class="number">2</span>  <span class="number">4</span></span><br><span class="line">  [ <span class="number">4</span>] .data             PROGBITS        <span class="number">00000000</span> <span class="number">000194</span> <span class="number">000000</span> <span class="number">00</span>  WA  <span class="number">0</span>   <span class="number">0</span>  <span class="number">1</span></span><br><span class="line">  [ <span class="number">5</span>] .bss              NOBITS          <span class="number">00000000</span> <span class="number">000194</span> <span class="number">000000</span> <span class="number">00</span>  WA  <span class="number">0</span>   <span class="number">0</span>  <span class="number">1</span></span><br><span class="line">  [ <span class="number">6</span>] .rodata           PROGBITS        <span class="number">00000000</span> <span class="number">000194</span> <span class="number">000068</span> <span class="number">00</span>   A  <span class="number">0</span>   <span class="number">0</span>  <span class="number">4</span></span><br><span class="line">  [ <span class="number">7</span>] .rel.rodata       REL             <span class="number">00000000</span> <span class="number">000648</span> <span class="number">0000</span>d0 <span class="number">08</span>   I <span class="number">15</span>   <span class="number">6</span>  <span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>“.rel.rodata ”的偏移为“000648”，</p>
<p>现在可以用 hexedit 进行修改了，主要关注偏移为“000648”的地方，目的是交换’.rel.rodata’的信息，以改变重定位值，进而改变输出值：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00000640</span>   <span class="number">4F</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">02</span> <span class="number">2</span>A <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">09</span> <span class="number">0</span>A <span class="number">00</span> <span class="number">00</span>  O....*..........</span><br><span class="line"><span class="number">00000650</span>   <span class="number">04</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">09</span> <span class="number">0B</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">08</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">09</span> <span class="number">0</span>C <span class="number">00</span> <span class="number">00</span>  ................</span><br><span class="line"><span class="number">00000660</span>   <span class="number">0</span>C <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">09</span> <span class="number">0</span>D <span class="number">00</span> <span class="number">00</span>  <span class="number">10</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">09</span> <span class="number">0</span>E <span class="number">00</span> <span class="number">00</span>  ................</span><br><span class="line"><span class="number">00000670</span>   <span class="number">14</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">09</span> <span class="number">0F</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">18</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">09</span> <span class="number">10</span> <span class="number">00</span> <span class="number">00</span>  ................</span><br><span class="line"><span class="number">00000680</span>   <span class="number">1</span>C <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">09</span> <span class="number">11</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">20</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">09</span> <span class="number">12</span> <span class="number">00</span> <span class="number">00</span>  ........ .......</span><br></pre></td></tr></table></figure>
<ul>
<li>cookie：BGOMEIUFQJ</li>
<li>对应符号名称：L6 L11 L19 L17 L9 L13 L25 L10 L21 L14 </li>
<li>原本的输出：wl0_TZb3vJ</li>
</ul>
<p>假设我们想输出：0123456789</p>
<ul>
<li>对应符号名称：L19 L29 L20 L10 L12 L22 L8 L30 L18 L24</li>
</ul>
<p>然后用 hexedit 做出调换：L6-&gt;L19，L11-&gt;L29，L19-&gt;L20 ……….</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00000640</span>   <span class="number">4F</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">02</span> <span class="number">2</span>A <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">09</span> <span class="number">0</span>A <span class="number">00</span> <span class="number">00</span>  O....*..........</span><br><span class="line"><span class="number">00000650</span>   <span class="number">04</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">09</span> <span class="number">18</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">08</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">09</span> <span class="number">0</span>C <span class="number">00</span> <span class="number">00</span>  ................</span><br><span class="line"><span class="number">00000660</span>   <span class="number">0</span>C <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">09</span> <span class="number">0</span>D <span class="number">00</span> <span class="number">00</span>  <span class="number">10</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">09</span> <span class="number">11</span> <span class="number">00</span> <span class="number">00</span>  ................</span><br><span class="line"><span class="number">00000670</span>   <span class="number">14</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">09</span> <span class="number">23</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">18</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">09</span> <span class="number">22</span> <span class="number">00</span> <span class="number">00</span>  .....#.......<span class="string">&quot;..</span></span><br><span class="line"><span class="string">00000680   1C 00 00 00  09 11 00 00  20 00 00 00  09 1B 00 00  ........ .......</span></span><br><span class="line"><span class="string">00000690   24 00 00 00  09 1D 00 00  28 00 00 00  09 14 00 00  $.......(.......</span></span><br><span class="line"><span class="string">000006A0   2C 00 00 00  09 15 00 00  30 00 00 00  09 23 00 00  ,.......0....#..</span></span><br><span class="line"><span class="string">000006B0   34 00 00 00  09 17 00 00  38 00 00 00  09 19 00 00  4.......8.......</span></span><br><span class="line"><span class="string">000006C0   3C 00 00 00  09 19 00 00  40 00 00 00  09 17 00 00  &lt;.......@.......</span></span><br><span class="line"><span class="string">000006D0   44 00 00 00  09 1B 00 00  48 00 00 00  09 1C 00 00  D.......H.......</span></span><br><span class="line"><span class="string">000006E0   4C 00 00 00  09 1D 00 00  50 00 00 00  09 0D 00 00  L.......P.......</span></span><br><span class="line"><span class="string">000006F0   54 00 00 00  09 1F 00 00  58 00 00 00  09 20 00 00  T.......X.... ..</span></span><br><span class="line"><span class="string">00000700   5C 00 00 00  09 21 00 00  60 00 00 00  09 22 00 00  \....!..`....&quot;</span>..</span><br><span class="line"><span class="number">00000710</span>   <span class="number">64</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">09</span> <span class="number">23</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">01</span> <span class="number">26</span> <span class="number">00</span> <span class="number">00</span>  d....#.......&amp;..</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l4] gcc -m32 -o linkbomb4 main.o phase4.o</span><br><span class="line">➜  [/home/ywhkkx/ex1.linklab/l4] ./linkbomb4                          </span><br><span class="line"><span class="number">0127456789</span></span><br></pre></td></tr></table></figure>
<h2 id="实验五"><a href="#实验五" class="headerlink" title="实验五"></a>实验五</h2><p>修改二进制可重定位目标文件“phase5.o”的重定位节中的数据内容（不允许修改.text节的内容），补充完成其中被清零的一些重定位记录（分别对应于本模块中需要重定位的符号引用），使其与 main.o 链接后能够正确输出（且仅输出）自己学号</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> TRAN_ARRAY[] = &#123;… …&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> FDICT[] = FDICTDAT;</span><br><span class="line"><span class="keyword">char</span> BUF[] = MYID; </span><br><span class="line"><span class="keyword">char</span> CODE = PHASE5_COOKIE;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">transform_code</span><span class="params">( <span class="keyword">int</span> code, <span class="keyword">int</span> mode )</span>  </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>( TRAN_ARRAY [mode] &amp; <span class="number">0x00000007</span> )  &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            code = code &amp; (~ TRAN_ARRAY[mode]);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            code = code ^ TRAN_ARRAY[mode];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        … …</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> code;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">generate_code</span><span class="params">( <span class="keyword">int</span> cookie )</span>  </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    CODE = cookie;</span><br><span class="line">    <span class="keyword">for</span>( i=<span class="number">0</span>; i&lt;<span class="keyword">sizeof</span>(TRAN_ARRAY)/<span class="keyword">sizeof</span>(<span class="keyword">int</span>); i++ )</span><br><span class="line">          CODE = transform_code( CODE, i );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">encode</span><span class="params">( <span class="keyword">char</span>* str )</span>  </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, n = <span class="built_in">strlen</span>(str);</span><br><span class="line">    <span class="keyword">for</span>( i=<span class="number">0</span>; i&lt;n; i++ ) &#123;</span><br><span class="line">        str[i] = (FDICT[str[i]] ^ CODE) &amp; <span class="number">0x7F</span>;</span><br><span class="line">        <span class="keyword">if</span>( str[i]&lt;<span class="number">0x20</span> || str[i]&gt;<span class="number">0x7E</span> ) str[i] = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_phase</span><span class="params">()</span>  </span>&#123;</span><br><span class="line">    generate_code(PHASE5_COOKIE);</span><br><span class="line">    encode(BUF);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, BUF);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>对照 phase5.o 的反汇编程序及已有重定位记录，定位每一空重定位记录可能对应的符号引用</li>
<li>对每一待处理的符号引用，按照下列重定位记录结构，构造其二进制表示（8字节块）</li>
<li>使用 hexedit 或编程将生成的重定位记录写入到相应被清空的记录位置中</li>
</ul>
<p>直接运行程序：（报错了）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l5] gcc -m32 -o linkbomb5 main.o phase5.o </span><br><span class="line">➜  [/home/ywhkkx/ex1.linklab/l5] ./linkbomb5 </span><br><span class="line">[<span class="number">1</span>]    <span class="number">4179</span> <span class="function">illegal hardware <span class="title">instruction</span> <span class="params">(core dumped)</span>  ./linkbomb5 </span></span><br></pre></td></tr></table></figure>
<p>可能 实验五 就是为了让我们修复程序，一般段错误有以下原因：</p>
<ul>
<li>未对相关引用进行必要的重定位（实验PTT给出了这个）</li>
</ul>
<p>用GDB单步排查：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invalid instructions at <span class="number">0x56556399</span></span><br></pre></td></tr></table></figure>
<p>“do_phase”出问题了，但不知道是什么问题（其实大概率是重定位的问题，实验给了提示）</p>
<p>看一下重定位表：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l5] readelf -r phase5.o</span><br><span class="line"></span><br><span class="line">重定位节 <span class="string">&#x27;.rel.text&#x27;</span> at offset <span class="number">0x6e8</span> contains <span class="number">27</span> entries:</span><br><span class="line"> 偏移量     信息    类型              符号值      符号名称</span><br><span class="line"><span class="number">00000000</span>  <span class="number">00000000</span> R_386_NONE       </span><br><span class="line"><span class="number">00000009</span>  <span class="number">00001b</span>0a R_386_GOTPC       <span class="number">00000000</span>   _GLOBAL_OFFSET_TABLE_</span><br><span class="line"><span class="number">00000013</span>  <span class="number">00001509</span> R_386_GOTOFF      <span class="number">00000000</span>   CmhNnM</span><br><span class="line"><span class="number">00000000</span>  <span class="number">00000000</span> R_386_NONE       </span><br><span class="line"><span class="number">00000000</span>  <span class="number">00000000</span> R_386_NONE       </span><br><span class="line"><span class="number">0000004</span>c  <span class="number">00001509</span> R_386_GOTOFF      <span class="number">00000000</span>   CmhNnM</span><br><span class="line"><span class="number">0000005</span>d  <span class="number">00001509</span> R_386_GOTOFF      <span class="number">00000000</span>   CmhNnM</span><br><span class="line"><span class="number">00000000</span>  <span class="number">00000000</span> R_386_NONE       </span><br><span class="line"><span class="number">0000007</span>e  <span class="number">00001509</span> R_386_GOTOFF      <span class="number">00000000</span>   CmhNnM</span><br><span class="line"><span class="number">00000000</span>  <span class="number">00000000</span> R_386_NONE       </span><br><span class="line"><span class="number">0000009</span>e  <span class="number">00001b</span>0a R_386_GOTPC       <span class="number">00000000</span>   _GLOBAL_OFFSET_TABLE_</span><br><span class="line"><span class="number">000000</span>a7  <span class="number">00001809</span> R_386_GOTOFF      <span class="number">0000000b</span>   CODE</span><br><span class="line"><span class="number">00000000</span>  <span class="number">00000000</span> R_386_NONE       </span><br><span class="line"><span class="number">00000000</span>  <span class="number">00000000</span> R_386_NONE       </span><br><span class="line"><span class="number">000000</span>cc  <span class="number">00001809</span> R_386_GOTOFF      <span class="number">0000000b</span>   CODE</span><br><span class="line"><span class="number">000000</span>ea  <span class="number">00001</span>d02 R_386_PC32        <span class="number">00000000</span>   __x86.get_pc_thunk.bx</span><br><span class="line"><span class="number">00000000</span>  <span class="number">00000000</span> R_386_NONE       </span><br><span class="line"><span class="number">000000f</span>b  <span class="number">00001f</span>04 R_386_PLT32       <span class="number">00000000</span>   <span class="built_in">strlen</span></span><br><span class="line"><span class="number">00000120</span>  <span class="number">00001609</span> R_386_GOTOFF      <span class="number">00000040</span>   cRvFVR</span><br><span class="line"><span class="number">00000127</span>  <span class="number">00001809</span> R_386_GOTOFF      <span class="number">0000000b</span>   CODE</span><br><span class="line"><span class="number">00000000</span>  <span class="number">00000000</span> R_386_NONE       </span><br><span class="line"><span class="number">00000189</span>  <span class="number">00001b</span>0a R_386_GOTPC       <span class="number">00000000</span>   _GLOBAL_OFFSET_TABLE_</span><br><span class="line"><span class="number">00000193</span>  <span class="number">00001</span>c02 R_386_PC32        <span class="number">00000090</span>   generate_code</span><br><span class="line"><span class="number">0000019f</span>  <span class="number">00001709</span> R_386_GOTOFF      <span class="number">00000000</span>   BUF</span><br><span class="line"><span class="number">000001</span>a5  <span class="number">00001e02</span> R_386_PC32        <span class="number">000000e2</span>   encode</span><br><span class="line"><span class="number">000001b</span>1  <span class="number">00001709</span> R_386_GOTOFF      <span class="number">00000000</span>   BUF</span><br><span class="line"><span class="number">000001b</span>7  <span class="number">00002104</span> R_386_PLT32       <span class="number">00000000</span>   <span class="built_in">puts</span></span><br><span class="line"></span><br><span class="line">重定位节 <span class="string">&#x27;.rel.rodata&#x27;</span> at offset <span class="number">0x7c0</span> contains <span class="number">8</span> entries:</span><br><span class="line"> 偏移量     信息    类型              符号值      符号名称</span><br><span class="line"><span class="number">000000</span>c0  <span class="number">00000</span>c09 R_386_GOTOFF      <span class="number">0000002</span>d   .L3</span><br><span class="line"><span class="number">000000</span>c4  <span class="number">00000</span>d09 R_386_GOTOFF      <span class="number">00000032</span>   .L5</span><br><span class="line"><span class="number">000000</span>c8  <span class="number">00000</span>a09 R_386_GOTOFF      <span class="number">00000087</span>   .L2</span><br><span class="line"><span class="number">000000</span>cc  <span class="number">00000e09</span> R_386_GOTOFF      <span class="number">00000046</span>   .L6</span><br><span class="line"><span class="number">000000</span>d0  <span class="number">00000f</span>09 R_386_GOTOFF      <span class="number">00000057</span>   .L7</span><br><span class="line"><span class="number">000000</span>d4  <span class="number">00001009</span> R_386_GOTOFF      <span class="number">00000069</span>   .L8</span><br><span class="line"><span class="number">000000</span>d8  <span class="number">00000</span>a09 R_386_GOTOFF      <span class="number">00000087</span>   .L2</span><br><span class="line"><span class="number">000000</span>dc  <span class="number">00001109</span> R_386_GOTOFF      <span class="number">00000078</span>   .L9</span><br><span class="line"></span><br><span class="line">重定位节 <span class="string">&#x27;.rel.data.rel.local&#x27;</span> at offset <span class="number">0x800</span> contains <span class="number">1</span> entry:</span><br><span class="line"> 偏移量     信息    类型              符号值      符号名称</span><br><span class="line"><span class="number">00000000</span>  <span class="number">00002001</span> R_386_32          <span class="number">0000017b</span>   do_phase</span><br><span class="line"></span><br><span class="line">重定位节 <span class="string">&#x27;.rel.eh_frame&#x27;</span> at offset <span class="number">0x808</span> contains <span class="number">6</span> entries:</span><br><span class="line"> 偏移量     信息    类型              符号值      符号名称</span><br><span class="line"><span class="number">00000020</span>  <span class="number">00000202</span> R_386_PC32        <span class="number">00000000</span>   .text</span><br><span class="line"><span class="number">00000040</span>  <span class="number">00000202</span> R_386_PC32        <span class="number">00000000</span>   .text</span><br><span class="line"><span class="number">00000064</span>  <span class="number">00000202</span> R_386_PC32        <span class="number">00000000</span>   .text</span><br><span class="line"><span class="number">00000088</span>  <span class="number">00000202</span> R_386_PC32        <span class="number">00000000</span>   .text</span><br><span class="line"><span class="number">000000</span>ac  <span class="number">00000702</span> R_386_PC32        <span class="number">00000000</span>   .text.__x86.get_pc_thu</span><br><span class="line"><span class="number">000000</span>c0  <span class="number">00000802</span> R_386_PC32        <span class="number">00000000</span>   .text.__x86.get_pc_thu</span><br></pre></td></tr></table></figure>
<p>发现很多条目空着的，需要补全</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l5] readelf -S phase5.o</span><br><span class="line">There are <span class="number">20</span> section headers, starting at offset <span class="number">0x8f0</span>:</span><br><span class="line"></span><br><span class="line">节头：</span><br><span class="line">  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al</span><br><span class="line">  [ <span class="number">0</span>]                   <span class="literal">NULL</span>            <span class="number">00000000</span> <span class="number">000000</span> <span class="number">000000</span> <span class="number">00</span>      <span class="number">0</span>   <span class="number">0</span>  <span class="number">0</span></span><br><span class="line">  [ <span class="number">1</span>] .group            GROUP           <span class="number">00000000</span> <span class="number">000034</span> <span class="number">000008</span> <span class="number">04</span>     <span class="number">17</span>  <span class="number">26</span>  <span class="number">4</span></span><br><span class="line">  [ <span class="number">2</span>] .group            GROUP           <span class="number">00000000</span> <span class="number">00003</span>c <span class="number">000008</span> <span class="number">04</span>     <span class="number">17</span>  <span class="number">29</span>  <span class="number">4</span></span><br><span class="line">  [ <span class="number">3</span>] .text             PROGBITS        <span class="number">00000000</span> <span class="number">000044</span> <span class="number">0001</span>c4 <span class="number">00</span>  AX  <span class="number">0</span>   <span class="number">0</span>  <span class="number">1</span></span><br><span class="line">  [ <span class="number">4</span>] .rel.text         REL             <span class="number">00000000</span> <span class="number">0006e8</span> <span class="number">0000</span>d8 <span class="number">08</span>   I <span class="number">17</span>   <span class="number">3</span>  <span class="number">4</span></span><br><span class="line">  [ <span class="number">5</span>] .data             PROGBITS        <span class="number">00000000</span> <span class="number">000208</span> <span class="number">00000</span>c <span class="number">00</span>  WA  <span class="number">0</span>   <span class="number">0</span>  <span class="number">4</span></span><br><span class="line">  [ <span class="number">6</span>] .bss              NOBITS          <span class="number">00000000</span> <span class="number">000214</span> <span class="number">000000</span> <span class="number">00</span>  WA  <span class="number">0</span>   <span class="number">0</span>  <span class="number">1</span></span><br><span class="line">  [ <span class="number">7</span>] .rodata           PROGBITS        <span class="number">00000000</span> <span class="number">000220</span> <span class="number">0000e0</span> <span class="number">00</span>   A  <span class="number">0</span>   <span class="number">0</span> <span class="number">32</span></span><br><span class="line">  [ <span class="number">8</span>] .rel.rodata       REL             <span class="number">00000000</span> <span class="number">0007</span>c0 <span class="number">000040</span> <span class="number">08</span>   I <span class="number">17</span>   <span class="number">7</span>  <span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>“.rel.rodata”偏移为“0x7c0”，“.rel.text”偏移为“0x6e8”</p>
<p>在 hexedit 中看看：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">000006</span>D0   <span class="number">64</span> <span class="number">65</span> <span class="number">00</span> <span class="number">73</span>  <span class="number">74</span> <span class="number">72</span> <span class="number">6</span>C <span class="number">65</span>  <span class="number">6</span>E <span class="number">00</span> <span class="number">64</span> <span class="number">6F</span>  <span class="number">5F</span> <span class="number">70</span> <span class="number">68</span> <span class="number">61</span>  de.<span class="built_in">strlen</span>.do_pha</span><br><span class="line"><span class="number">000006E0</span>   <span class="number">73</span> <span class="number">65</span> <span class="number">00</span> <span class="number">70</span>  <span class="number">75</span> <span class="number">74</span> <span class="number">73</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  se.<span class="built_in">puts</span>.........</span><br><span class="line"><span class="number">000006F</span>0   <span class="number">09</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">0</span>A <span class="number">1B</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">13</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">09</span> <span class="number">15</span> <span class="number">00</span> <span class="number">00</span>  ................</span><br><span class="line"><span class="number">00000700</span>   <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  ................</span><br><span class="line"><span class="number">00000710</span>   <span class="number">4</span>C <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">09</span> <span class="number">15</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">5</span>D <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">09</span> <span class="number">15</span> <span class="number">00</span> <span class="number">00</span>  L.......].......</span><br><span class="line"><span class="number">00000720</span>   <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">7</span>E <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">09</span> <span class="number">15</span> <span class="number">00</span> <span class="number">00</span>  ........~.......</span><br></pre></td></tr></table></figure>
<p>可以发现一个规律，对应 ‘.rel.text’ 表中：</p>
<ul>
<li>第一个4字节空间是偏移量</li>
<li>第二个4字节空间是信息（注意小端字节序）</li>
</ul>
<p>在“0x6e8”和“0x6e8+0x4”的位置是空的，’.rel.text’ 表中空着的地方都没有数据，通过前面几个实验的观察，’.rel.text’ 表是不应该存在空数据的，所以实验五的核心就是为了把 ‘.rel.text’ 表补全</p>
<p>那么填入什么数据呢，需要在汇编中查看：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l5] objdump -d phase5.o</span><br><span class="line"></span><br><span class="line">phase5.o：     文件格式 elf32-i386</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line"><span class="number">00000000</span> &lt;transform_code&gt;:</span><br><span class="line">   <span class="number">0</span>:	<span class="number">55</span>                   	push   %ebp</span><br><span class="line">   <span class="number">1</span>:	<span class="number">89</span> e5                	mov    %esp,%ebp</span><br><span class="line">   <span class="number">3</span>:	e8 fc ff ff ff       	call   <span class="number">4</span> &lt;transform_code+<span class="number">0x4</span>&gt; <span class="comment">// target 0x4</span></span><br><span class="line">   <span class="number">8</span>:	<span class="number">05</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       	add    $<span class="number">0x1</span>,%eax <span class="comment">// _GLOBAL_OFFSET_TABLE_</span></span><br><span class="line">   d:	<span class="number">8b</span> <span class="number">55</span> <span class="number">0</span>c             	mov    <span class="number">0xc</span>(%ebp),%edx</span><br><span class="line">  <span class="number">10</span>:	<span class="number">8b</span> <span class="number">94</span> <span class="number">90</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 	mov    <span class="number">0x0</span>(%eax,%edx,<span class="number">4</span>),%edx <span class="comment">// CmhNnM</span></span><br><span class="line">  <span class="number">17</span>:	<span class="number">83</span> e2 <span class="number">07</span>             	<span class="keyword">and</span>    $<span class="number">0x7</span>,%edx</span><br><span class="line">  <span class="number">1</span>a:	<span class="number">83</span> fa <span class="number">07</span>             	cmp    $<span class="number">0x7</span>,%edx</span><br><span class="line">  <span class="number">1</span>d:	<span class="number">77</span> <span class="number">68</span>                	ja     <span class="number">87</span> &lt;.L2&gt;</span><br><span class="line">  <span class="number">1f</span>:	c1 e2 <span class="number">02</span>             	shl    $<span class="number">0x2</span>,%edx</span><br><span class="line">  <span class="number">22</span>:	<span class="number">8b</span> <span class="number">94</span> <span class="number">02</span> c0 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 	mov    <span class="number">0xc0</span>(%edx,%eax,<span class="number">1</span>),%edx <span class="comment">// target 0x25</span></span><br><span class="line">  <span class="number">29</span>:	<span class="number">01</span> c2                	add    %eax,%edx</span><br><span class="line">  <span class="number">2b</span>:	ff e2                	jmp    *%edx</span><br><span class="line"></span><br><span class="line"><span class="number">0000002</span>d &lt;.L3&gt;:</span><br><span class="line">  <span class="number">2</span>d:	f7 <span class="number">55</span> <span class="number">08</span>             	notl   <span class="number">0x8</span>(%ebp)</span><br><span class="line">  <span class="number">30</span>:	eb <span class="number">59</span>                	jmp    <span class="number">8b</span> &lt;.L2+<span class="number">0x4</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">00000032</span> &lt;.L5&gt;:</span><br><span class="line">  <span class="number">32</span>:	<span class="number">8b</span> <span class="number">55</span> <span class="number">0</span>c             	mov    <span class="number">0xc</span>(%ebp),%edx</span><br><span class="line">  <span class="number">35</span>:	<span class="number">8b</span> <span class="number">84</span> <span class="number">90</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 	mov    <span class="number">0x0</span>(%eax,%edx,<span class="number">4</span>),%eax <span class="comment">// target 0x38</span></span><br><span class="line">  <span class="number">3</span>c:	<span class="number">83</span> e0 <span class="number">03</span>             	<span class="keyword">and</span>    $<span class="number">0x3</span>,%eax</span><br><span class="line">  <span class="number">3f</span>:	<span class="number">89</span> c1                	mov    %eax,%ecx</span><br><span class="line">  <span class="number">41</span>:	d3 <span class="number">7</span>d <span class="number">08</span>             	sarl   %cl,<span class="number">0x8</span>(%ebp)</span><br><span class="line">  <span class="number">44</span>:	eb <span class="number">45</span>                	jmp    <span class="number">8b</span> &lt;.L2+<span class="number">0x4</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">00000046</span> &lt;.L6&gt;:</span><br><span class="line">  <span class="number">46</span>:	<span class="number">8b</span> <span class="number">55</span> <span class="number">0</span>c             	mov    <span class="number">0xc</span>(%ebp),%edx</span><br><span class="line">  <span class="number">49</span>:	<span class="number">8b</span> <span class="number">84</span> <span class="number">90</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 	mov    <span class="number">0x0</span>(%eax,%edx,<span class="number">4</span>),%eax <span class="comment">// CmhNnM</span></span><br><span class="line">  <span class="number">50</span>:	f7 d0                	<span class="keyword">not</span>    %eax</span><br><span class="line">  <span class="number">52</span>:	<span class="number">21</span> <span class="number">45</span> <span class="number">08</span>             	<span class="keyword">and</span>    %eax,<span class="number">0x8</span>(%ebp)</span><br><span class="line">  <span class="number">55</span>:	eb <span class="number">34</span>                	jmp    <span class="number">8b</span> &lt;.L2+<span class="number">0x4</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">00000057</span> &lt;.L7&gt;:</span><br><span class="line">  <span class="number">57</span>:	<span class="number">8b</span> <span class="number">55</span> <span class="number">0</span>c             	mov    <span class="number">0xc</span>(%ebp),%edx</span><br><span class="line">  <span class="number">5</span>a:	<span class="number">8b</span> <span class="number">84</span> <span class="number">90</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 	mov    <span class="number">0x0</span>(%eax,%edx,<span class="number">4</span>),%eax <span class="comment">// CmhNnM</span></span><br><span class="line">  <span class="number">61</span>:	c1 e0 <span class="number">08</span>             	shl    $<span class="number">0x8</span>,%eax</span><br><span class="line">  <span class="number">64</span>:	<span class="number">09</span> <span class="number">45</span> <span class="number">08</span>             	<span class="keyword">or</span>     %eax,<span class="number">0x8</span>(%ebp)</span><br><span class="line">  <span class="number">67</span>:	eb <span class="number">22</span>                	jmp    <span class="number">8b</span> &lt;.L2+<span class="number">0x4</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">00000069</span> &lt;.L8&gt;:</span><br><span class="line">  <span class="number">69</span>:	<span class="number">8b</span> <span class="number">55</span> <span class="number">0</span>c             	mov    <span class="number">0xc</span>(%ebp),%edx</span><br><span class="line">  <span class="number">6</span>c:	<span class="number">8b</span> <span class="number">84</span> <span class="number">90</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 	mov    <span class="number">0x0</span>(%eax,%edx,<span class="number">4</span>),%eax <span class="comment">// target 0x6f</span></span><br><span class="line">  <span class="number">73</span>:	<span class="number">31</span> <span class="number">45</span> <span class="number">08</span>             	<span class="keyword">xor</span>    %eax,<span class="number">0x8</span>(%ebp)</span><br><span class="line">  <span class="number">76</span>:	eb <span class="number">13</span>                	jmp    <span class="number">8b</span> &lt;.L2+<span class="number">0x4</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">00000078</span> &lt;.L9&gt;:</span><br><span class="line">  <span class="number">78</span>:	<span class="number">8b</span> <span class="number">55</span> <span class="number">0</span>c             	mov    <span class="number">0xc</span>(%ebp),%edx</span><br><span class="line">  <span class="number">7b</span>:	<span class="number">8b</span> <span class="number">84</span> <span class="number">90</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 	mov    <span class="number">0x0</span>(%eax,%edx,<span class="number">4</span>),%eax <span class="comment">// CmhNnM</span></span><br><span class="line">  <span class="number">82</span>:	<span class="number">89</span> <span class="number">45</span> <span class="number">08</span>             	mov    %eax,<span class="number">0x8</span>(%ebp)</span><br><span class="line">  <span class="number">85</span>:	eb <span class="number">04</span>                	jmp    <span class="number">8b</span> &lt;.L2+<span class="number">0x4</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">00000087</span> &lt;.L2&gt;:</span><br><span class="line">  <span class="number">87</span>:	f7 <span class="number">5</span>d <span class="number">08</span>             	negl   <span class="number">0x8</span>(%ebp)</span><br><span class="line">  <span class="number">8</span>a:	<span class="number">90</span>                   	nop</span><br><span class="line">  <span class="number">8b</span>:	<span class="number">8b</span> <span class="number">45</span> <span class="number">08</span>             	mov    <span class="number">0x8</span>(%ebp),%eax</span><br><span class="line">  <span class="number">8</span>e:	<span class="number">5</span>d                   	pop    %ebp</span><br><span class="line">  <span class="number">8f</span>:	c3                   	ret    </span><br><span class="line"></span><br><span class="line"><span class="number">00000090</span> &lt;generate_code&gt;:</span><br><span class="line">  <span class="number">90</span>:	<span class="number">55</span>                   	push   %ebp</span><br><span class="line">  <span class="number">91</span>:	<span class="number">89</span> e5                	mov    %esp,%ebp</span><br><span class="line">  <span class="number">93</span>:	<span class="number">53</span>                   	push   %ebx</span><br><span class="line">  <span class="number">94</span>:	<span class="number">83</span> ec <span class="number">10</span>             	sub    $<span class="number">0x10</span>,%esp</span><br><span class="line">  <span class="number">97</span>:	e8 fc ff ff ff       	call   <span class="number">98</span> &lt;generate_code+<span class="number">0x8</span>&gt; <span class="comment">// target 0x98</span></span><br><span class="line">  <span class="number">9</span>c:	<span class="number">81</span> c3 <span class="number">02</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    	add    $<span class="number">0x2</span>,%ebx <span class="comment">// _GLOBAL_OFFSET_TABLE_</span></span><br><span class="line">  a2:	<span class="number">8b</span> <span class="number">45</span> <span class="number">08</span>             	mov    <span class="number">0x8</span>(%ebp),%eax</span><br><span class="line">  a5:	<span class="number">88</span> <span class="number">83</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    	mov    %al,<span class="number">0x0</span>(%ebx) <span class="comment">// CODE</span></span><br><span class="line">  ab:	c7 <span class="number">45</span> f8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 	movl   $<span class="number">0x0</span>,<span class="number">-0x8</span>(%ebp) <span class="comment">// target 0xae</span></span><br><span class="line">  b2:	eb <span class="number">20</span>                	jmp    d4 &lt;generate_code+<span class="number">0x44</span>&gt;</span><br><span class="line">  b4:	<span class="number">0f</span> b6 <span class="number">83</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 	movzbl <span class="number">0x0</span>(%ebx),%eax <span class="comment">// target 0xb7</span></span><br><span class="line">  bb:	<span class="number">0f</span> be c0             	movsbl %al,%eax</span><br><span class="line">  be:	ff <span class="number">75</span> f8             	pushl  <span class="number">-0x8</span>(%ebp)</span><br><span class="line">  c1:	<span class="number">50</span>                   	push   %eax</span><br><span class="line">  c2:	e8 fc ff ff ff       	call   c3 &lt;generate_code+<span class="number">0x33</span>&gt;</span><br><span class="line">  c7:	<span class="number">83</span> c4 <span class="number">08</span>             	add    $<span class="number">0x8</span>,%esp</span><br><span class="line">  ca:	<span class="number">88</span> <span class="number">83</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    	mov    %al,<span class="number">0x0</span>(%ebx) <span class="comment">// CODE</span></span><br><span class="line">  d0:	<span class="number">83</span> <span class="number">45</span> f8 <span class="number">01</span>          	addl   $<span class="number">0x1</span>,<span class="number">-0x8</span>(%ebp)</span><br><span class="line">  d4:	<span class="number">8b</span> <span class="number">45</span> f8             	mov    <span class="number">-0x8</span>(%ebp),%eax</span><br><span class="line">  d7:	<span class="number">83</span> f8 <span class="number">08</span>             	cmp    $<span class="number">0x8</span>,%eax</span><br><span class="line">  da:	<span class="number">76</span> d8                	jbe    b4 &lt;generate_code+<span class="number">0x24</span>&gt;</span><br><span class="line">  dc:	<span class="number">90</span>                   	nop</span><br><span class="line">  dd:	<span class="number">8b</span> <span class="number">5</span>d fc             	mov    <span class="number">-0x4</span>(%ebp),%ebx</span><br><span class="line">  e0:	c9                   	leave  </span><br><span class="line">  e1:	c3                   	ret    </span><br><span class="line"></span><br><span class="line"><span class="number">000000e2</span> &lt;encode&gt;:</span><br><span class="line">  e2:	<span class="number">55</span>                   	push   %ebp</span><br><span class="line">  e3:	<span class="number">89</span> e5                	mov    %esp,%ebp</span><br><span class="line">  e5:	<span class="number">53</span>                   	push   %ebx</span><br><span class="line">  e6:	<span class="number">83</span> ec <span class="number">14</span>             	sub    $<span class="number">0x14</span>,%esp</span><br><span class="line">  e9:	e8 fc ff ff ff       	call   ea &lt;encode+<span class="number">0x8</span>&gt; <span class="comment">// __x86.get_pc_thunk.bx</span></span><br><span class="line">  ee:	<span class="number">81</span> c3 <span class="number">02</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    	add    $<span class="number">0x2</span>,%ebx <span class="comment">// target 0xf0</span></span><br><span class="line">  f4:	<span class="number">83</span> ec <span class="number">0</span>c             	sub    $<span class="number">0xc</span>,%esp</span><br><span class="line">  f7:	ff <span class="number">75</span> <span class="number">08</span>             	pushl  <span class="number">0x8</span>(%ebp)</span><br><span class="line">  fa:	e8 fc ff ff ff       	call   fb &lt;encode+<span class="number">0x19</span>&gt; <span class="comment">// strlen</span></span><br><span class="line">  ff:	<span class="number">83</span> c4 <span class="number">10</span>             	add    $<span class="number">0x10</span>,%esp</span><br><span class="line"> <span class="number">102</span>:	<span class="number">89</span> <span class="number">45</span> f4             	mov    %eax,<span class="number">-0xc</span>(%ebp)</span><br><span class="line"> <span class="number">105</span>:	c7 <span class="number">45</span> f0 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 	movl   $<span class="number">0x0</span>,<span class="number">-0x10</span>(%ebp) </span><br><span class="line"> <span class="number">10</span>c:	eb <span class="number">5</span>d                	jmp    <span class="number">16b</span> &lt;encode+<span class="number">0x89</span>&gt;</span><br><span class="line"> <span class="number">10</span>e:	<span class="number">8b</span> <span class="number">55</span> f0             	mov    <span class="number">-0x10</span>(%ebp),%edx</span><br><span class="line"> <span class="number">111</span>:	<span class="number">8b</span> <span class="number">45</span> <span class="number">08</span>             	mov    <span class="number">0x8</span>(%ebp),%eax</span><br><span class="line"> <span class="number">114</span>:	<span class="number">01</span> d0                	add    %edx,%eax</span><br><span class="line"> <span class="number">116</span>:	<span class="number">0f</span> b6 <span class="number">00</span>             	movzbl (%eax),%eax</span><br><span class="line"> <span class="number">119</span>:	<span class="number">0f</span> be c0             	movsbl %al,%eax</span><br><span class="line"> <span class="number">11</span>c:	<span class="number">0f</span> b6 <span class="number">94</span> <span class="number">03</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 	movzbl <span class="number">0x0</span>(%ebx,%eax,<span class="number">1</span>),%edx <span class="comment">// cRvFVR</span></span><br><span class="line"> <span class="number">123</span>:	<span class="number">00</span> </span><br><span class="line"> <span class="number">124</span>:	<span class="number">0f</span> b6 <span class="number">83</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 	movzbl <span class="number">0x0</span>(%ebx),%eax <span class="comment">// CODE</span></span><br><span class="line"> <span class="number">12b</span>:	<span class="number">89</span> d1                	mov    %edx,%ecx</span><br><span class="line"> <span class="number">12</span>d:	<span class="number">31</span> c1                	<span class="keyword">xor</span>    %eax,%ecx</span><br><span class="line"> <span class="number">12f</span>:	<span class="number">8b</span> <span class="number">55</span> f0             	mov    <span class="number">-0x10</span>(%ebp),%edx</span><br><span class="line"> <span class="number">132</span>:	<span class="number">8b</span> <span class="number">45</span> <span class="number">08</span>             	mov    <span class="number">0x8</span>(%ebp),%eax</span><br><span class="line"> <span class="number">135</span>:	<span class="number">01</span> d0                	add    %edx,%eax</span><br><span class="line"> <span class="number">137</span>:	<span class="number">83</span> e1 <span class="number">7f</span>             	<span class="keyword">and</span>    $<span class="number">0x7f</span>,%ecx</span><br><span class="line"> <span class="number">13</span>a:	<span class="number">89</span> ca                	mov    %ecx,%edx</span><br><span class="line"> <span class="number">13</span>c:	<span class="number">88</span> <span class="number">10</span>                	mov    %dl,(%eax)</span><br><span class="line"> <span class="number">13</span>e:	<span class="number">8b</span> <span class="number">55</span> f0             	mov    <span class="number">-0x10</span>(%ebp),%edx</span><br><span class="line"> <span class="number">141</span>:	<span class="number">8b</span> <span class="number">45</span> <span class="number">08</span>             	mov    <span class="number">0x8</span>(%ebp),%eax</span><br><span class="line"> <span class="number">144</span>:	<span class="number">01</span> d0                	add    %edx,%eax</span><br><span class="line"> <span class="number">146</span>:	<span class="number">0f</span> b6 <span class="number">00</span>             	movzbl (%eax),%eax</span><br><span class="line"> <span class="number">149</span>:	<span class="number">3</span>c <span class="number">1f</span>                	cmp    $<span class="number">0x1f</span>,%al</span><br><span class="line"> <span class="number">14b</span>:	<span class="number">7</span>e <span class="number">0f</span>                	jle    <span class="number">15</span>c &lt;encode+<span class="number">0x7a</span>&gt;</span><br><span class="line"> <span class="number">14</span>d:	<span class="number">8b</span> <span class="number">55</span> f0             	mov    <span class="number">-0x10</span>(%ebp),%edx</span><br><span class="line"> <span class="number">150</span>:	<span class="number">8b</span> <span class="number">45</span> <span class="number">08</span>             	mov    <span class="number">0x8</span>(%ebp),%eax</span><br><span class="line"> <span class="number">153</span>:	<span class="number">01</span> d0                	add    %edx,%eax</span><br><span class="line"> <span class="number">155</span>:	<span class="number">0f</span> b6 <span class="number">00</span>             	movzbl (%eax),%eax</span><br><span class="line"> <span class="number">158</span>:	<span class="number">3</span>c <span class="number">7f</span>                	cmp    $<span class="number">0x7f</span>,%al</span><br><span class="line"> <span class="number">15</span>a:	<span class="number">75</span> <span class="number">0b</span>                	jne    <span class="number">167</span> &lt;encode+<span class="number">0x85</span>&gt;</span><br><span class="line"> <span class="number">15</span>c:	<span class="number">8b</span> <span class="number">55</span> f0             	mov    <span class="number">-0x10</span>(%ebp),%edx</span><br><span class="line"> <span class="number">15f</span>:	<span class="number">8b</span> <span class="number">45</span> <span class="number">08</span>             	mov    <span class="number">0x8</span>(%ebp),%eax</span><br><span class="line"> <span class="number">162</span>:	<span class="number">01</span> d0                	add    %edx,%eax</span><br><span class="line"> <span class="number">164</span>:	c6 <span class="number">00</span> <span class="number">20</span>             	movb   $<span class="number">0x20</span>,(%eax)</span><br><span class="line"> <span class="number">167</span>:	<span class="number">83</span> <span class="number">45</span> f0 <span class="number">01</span>          	addl   $<span class="number">0x1</span>,<span class="number">-0x10</span>(%ebp)</span><br><span class="line"> <span class="number">16b</span>:	<span class="number">8b</span> <span class="number">45</span> f0             	mov    <span class="number">-0x10</span>(%ebp),%eax</span><br><span class="line"> <span class="number">16</span>e:	<span class="number">3b</span> <span class="number">45</span> f4             	cmp    <span class="number">-0xc</span>(%ebp),%eax</span><br><span class="line"> <span class="number">171</span>:	<span class="number">7</span>c <span class="number">9b</span>                	jl     <span class="number">10</span>e &lt;encode+<span class="number">0x2c</span>&gt;</span><br><span class="line"> <span class="number">173</span>:	<span class="number">8b</span> <span class="number">45</span> f4             	mov    <span class="number">-0xc</span>(%ebp),%eax</span><br><span class="line"> <span class="number">176</span>:	<span class="number">8b</span> <span class="number">5</span>d fc             	mov    <span class="number">-0x4</span>(%ebp),%ebx</span><br><span class="line"> <span class="number">179</span>:	c9                   	leave  </span><br><span class="line"> <span class="number">17</span>a:	c3                   	ret    </span><br><span class="line"></span><br><span class="line"><span class="number">0000017b</span> &lt;do_phase&gt;:</span><br><span class="line"> <span class="number">17b</span>:	<span class="number">55</span>                   	push   %ebp</span><br><span class="line"> <span class="number">17</span>c:	<span class="number">89</span> e5                	mov    %esp,%ebp</span><br><span class="line"> <span class="number">17</span>e:	<span class="number">53</span>                   	push   %ebx</span><br><span class="line"> <span class="number">17f</span>:	<span class="number">83</span> ec <span class="number">04</span>             	sub    $<span class="number">0x4</span>,%esp</span><br><span class="line"> <span class="number">182</span>:	e8 fc ff ff ff       	call   <span class="number">183</span> &lt;do_phase+<span class="number">0x8</span>&gt; <span class="comment">// target 0x183</span></span><br><span class="line"> <span class="number">187</span>:	<span class="number">81</span> c3 <span class="number">02</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    	add    $<span class="number">0x2</span>,%ebx <span class="comment">// _GLOBAL_OFFSET_TABLE_</span></span><br><span class="line"> <span class="number">18</span>d:	<span class="number">68</span> <span class="number">87</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       	push   $<span class="number">0x87</span></span><br><span class="line"> <span class="number">192</span>:	e8 fc ff ff ff       	call   <span class="number">193</span> &lt;do_phase+<span class="number">0x18</span>&gt; <span class="comment">// generate_code</span></span><br><span class="line"> <span class="number">197</span>:	<span class="number">83</span> c4 <span class="number">04</span>             	add    $<span class="number">0x4</span>,%esp</span><br><span class="line"> <span class="number">19</span>a:	<span class="number">83</span> ec <span class="number">0</span>c             	sub    $<span class="number">0xc</span>,%esp</span><br><span class="line"> <span class="number">19</span>d:	<span class="number">8</span>d <span class="number">83</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    	lea    <span class="number">0x0</span>(%ebx),%eax <span class="comment">// BUF</span></span><br><span class="line"> <span class="number">1</span>a3:	<span class="number">50</span>                   	push   %eax</span><br><span class="line"> <span class="number">1</span>a4:	e8 fc ff ff ff       	call   <span class="number">1</span>a5 &lt;do_phase+<span class="number">0x2a</span>&gt; <span class="comment">// encode</span></span><br><span class="line"> <span class="number">1</span>a9:	<span class="number">83</span> c4 <span class="number">10</span>             	add    $<span class="number">0x10</span>,%esp</span><br><span class="line"> <span class="number">1</span>ac:	<span class="number">83</span> ec <span class="number">0</span>c             	sub    $<span class="number">0xc</span>,%esp</span><br><span class="line"> <span class="number">1</span>af:	<span class="number">8</span>d <span class="number">83</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    	lea    <span class="number">0x0</span>(%ebx),%eax <span class="comment">// BUF</span></span><br><span class="line"> <span class="number">1b</span>5:	<span class="number">50</span>                   	push   %eax</span><br><span class="line"> <span class="number">1b</span>6:	e8 fc ff ff ff       	call   <span class="number">1b</span>7 &lt;do_phase+<span class="number">0x3c</span>&gt; <span class="comment">// puts</span></span><br><span class="line"> <span class="number">1b</span>b:	<span class="number">83</span> c4 <span class="number">10</span>             	add    $<span class="number">0x10</span>,%esp</span><br><span class="line"> <span class="number">1b</span>e:	<span class="number">90</span>                   	nop</span><br><span class="line"> <span class="number">1b</span>f:	<span class="number">8b</span> <span class="number">5</span>d fc             	mov    <span class="number">-0x4</span>(%ebp),%ebx</span><br><span class="line"> <span class="number">1</span>c2:	c9                   	leave  </span><br><span class="line"> <span class="number">1</span>c3:	c3                   	ret    </span><br><span class="line"></span><br><span class="line">Disassembly of section .text.__x86.get_pc_thunk.ax:</span><br><span class="line"></span><br><span class="line"><span class="number">00000000</span> &lt;__x86.get_pc_thunk.ax&gt;:</span><br><span class="line">   <span class="number">0</span>:	<span class="number">8b</span> <span class="number">04</span> <span class="number">24</span>             	mov    (%esp),%eax</span><br><span class="line">   <span class="number">3</span>:	c3                   	ret    </span><br><span class="line"></span><br><span class="line">Disassembly of section .text.__x86.get_pc_thunk.bx:</span><br><span class="line"></span><br><span class="line"><span class="number">00000000</span> &lt;__x86.get_pc_thunk.bx&gt;:</span><br><span class="line">   <span class="number">0</span>:	<span class="number">8b</span> <span class="number">1</span>c <span class="number">24</span>             	mov    (%esp),%ebx</span><br><span class="line">   <span class="number">3</span>:	c3                   	ret    </span><br></pre></td></tr></table></figure>
<p>主要看 “00 00 00” 和 “ff ff ff” 有没有在 ‘.rel.text’ 表中出现，把出现的标记，没有的可能就是需要修补的，最后进行修改：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l5] readelf -r phase5.o             </span><br><span class="line"></span><br><span class="line">重定位节 <span class="string">&#x27;.rel.text&#x27;</span> at offset <span class="number">0x6e8</span> contains <span class="number">27</span> entries:</span><br><span class="line"> 偏移量     信息    类型              符号值      符号名称</span><br><span class="line"><span class="number">00000004</span>  <span class="number">00001</span>d02 R_386_PC32        <span class="number">00000000</span>   __x86.get_pc_thunk.bx</span><br><span class="line"><span class="number">00000009</span>  <span class="number">00001b</span>0a R_386_GOTPC       <span class="number">00000000</span>   _GLOBAL_OFFSET_TABLE_</span><br><span class="line"><span class="number">00000013</span>  <span class="number">00001</span>d02 R_386_PC32        <span class="number">00000000</span>   __x86.get_pc_thunk.bx</span><br><span class="line"><span class="number">00000025</span>  <span class="number">00001b</span>0a R_386_GOTPC       <span class="number">00000000</span>   _GLOBAL_OFFSET_TABLE_</span><br><span class="line"><span class="number">00000038</span>  <span class="number">00001509</span> R_386_GOTOFF      <span class="number">00000000</span>   CmhNnM</span><br><span class="line"><span class="number">0000004</span>c  <span class="number">00001509</span> R_386_GOTOFF      <span class="number">00000000</span>   CmhNnM</span><br><span class="line"><span class="number">0000005</span>d  <span class="number">00001509</span> R_386_GOTOFF      <span class="number">00000000</span>   CmhNnM</span><br><span class="line"><span class="number">0000006f</span>  <span class="number">00001509</span> R_386_GOTOFF      <span class="number">00000000</span>   CmhNnM</span><br><span class="line"><span class="number">0000007</span>e  <span class="number">00001509</span> R_386_GOTOFF      <span class="number">00000000</span>   CmhNnM</span><br><span class="line"><span class="number">00000098</span>  <span class="number">00001</span>d02 R_386_PC32        <span class="number">00000000</span>   __x86.get_pc_thunk.bx</span><br><span class="line"><span class="number">0000009</span>e  <span class="number">00001b</span>0a R_386_GOTPC       <span class="number">00000000</span>   _GLOBAL_OFFSET_TABLE_</span><br><span class="line"><span class="number">000000</span>a7  <span class="number">00001809</span> R_386_GOTOFF      <span class="number">0000000b</span>   CODE</span><br><span class="line"><span class="number">000000</span>ae  <span class="number">00001809</span> R_386_GOTOFF      <span class="number">0000000b</span>   CODE</span><br><span class="line"><span class="number">000000b</span>7  <span class="number">00001809</span> R_386_GOTOFF      <span class="number">0000000b</span>   CODE</span><br><span class="line"><span class="number">000000</span>cc  <span class="number">00001809</span> R_386_GOTOFF      <span class="number">0000000b</span>   CODE</span><br><span class="line"><span class="number">000000</span>ea  <span class="number">00001</span>d02 R_386_PC32        <span class="number">00000000</span>   __x86.get_pc_thunk.bx</span><br><span class="line"><span class="number">000000f</span>0  <span class="number">00001b</span>0a R_386_GOTPC       <span class="number">00000000</span>   _GLOBAL_OFFSET_TABLE_</span><br><span class="line"><span class="number">000000f</span>b  <span class="number">00001f</span>04 R_386_PLT32       <span class="number">00000000</span>   <span class="built_in">strlen</span></span><br><span class="line"><span class="number">00000120</span>  <span class="number">00001609</span> R_386_GOTOFF      <span class="number">00000040</span>   cRvFVR</span><br><span class="line"><span class="number">00000127</span>  <span class="number">00001809</span> R_386_GOTOFF      <span class="number">0000000b</span>   CODE</span><br><span class="line"><span class="number">00000183</span>  <span class="number">00001</span>d02 R_386_PC32        <span class="number">00000000</span>   __x86.get_pc_thunk.bx</span><br><span class="line"><span class="number">00000189</span>  <span class="number">00001b</span>0a R_386_GOTPC       <span class="number">00000000</span>   _GLOBAL_OFFSET_TABLE_</span><br><span class="line"><span class="number">00000193</span>  <span class="number">00001</span>c02 R_386_PC32        <span class="number">00000090</span>   generate_code</span><br><span class="line"><span class="number">0000019f</span>  <span class="number">00001709</span> R_386_GOTOFF      <span class="number">00000000</span>   BUF</span><br><span class="line"><span class="number">000001</span>a5  <span class="number">00001e02</span> R_386_PC32        <span class="number">000000e2</span>   encode</span><br><span class="line"><span class="number">000001b</span>1  <span class="number">00001709</span> R_386_GOTOFF      <span class="number">00000000</span>   BUF</span><br><span class="line"><span class="number">000001b</span>7  <span class="number">00002104</span> R_386_PLT32       <span class="number">00000000</span>   <span class="built_in">puts</span></span><br></pre></td></tr></table></figure>
<p>“偏移量”很好处理，就是“信息”不好选择，我是根据“汇编代码的相似性”进行选择的，最后总算可以输出了（想要完美完成这个实验，必须掌握汇编）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  [/home/ywhkkx/ex1.linklab/l5] ./linkbomb5 </span><br><span class="line">PP$;`;;``;</span><br></pre></td></tr></table></figure>
<p>没有段错误了，但是输出很奇怪（有些地方没有改好）</p>
<hr>
<p><strong>收获</strong></p>
<ul>
<li>以前就对 link 有困惑，做了这个实验感受了一下 link 的过程后，发现自己对 link 的理解更清晰了</li>
<li>学习到了 objdump，readelf，hexedit 等工具的用法</li>
<li>看到了各个节在二进制文件的分布，学会了用“节偏移”和“节内偏移”来寻找需要的数据</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/labs/" rel="tag"><i class="fa fa-tag"></i> labs</a>
              <a href="/tags/CSapp/" rel="tag"><i class="fa fa-tag"></i> CSapp</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/03/08/House%20Of%20Einherjar-%E5%8E%9F%E7%90%86/" rel="prev" title="House Of Einherjar-原理">
      <i class="fa fa-chevron-left"></i> House Of Einherjar-原理
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/03/10/House%20Of%20Lore-%E5%8E%9F%E7%90%86/" rel="next" title="House Of Lore-原理">
      House Of Lore-原理 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Link-Lab"><span class="nav-number">1.</span> <span class="nav-text">Link Lab</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E6%96%87%E4%BB%B6"><span class="nav-number">2.</span> <span class="nav-text">实验文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="nav-number">3.</span> <span class="nav-text">使用工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%A6%E5%8F%B7%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86"><span class="nav-number">4.</span> <span class="nav-text">符号相关知识</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8A%82%E7%AE%80%E6%9E%90"><span class="nav-number">5.</span> <span class="nav-text">节简析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E5%99%A8%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">6.</span> <span class="nav-text">编译器驱动程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%BA%E7%AC%A6%E5%8F%B7%E4%B8%8E%E5%BC%B1%E7%AC%A6%E5%8F%B7"><span class="nav-number">7.</span> <span class="nav-text">强符号与弱符号</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E4%B8%80"><span class="nav-number">8.</span> <span class="nav-text">实验一</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E4%BA%8C"><span class="nav-number">9.</span> <span class="nav-text">实验二</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E4%B8%89"><span class="nav-number">10.</span> <span class="nav-text">实验三</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E5%9B%9B"><span class="nav-number">11.</span> <span class="nav-text">实验四</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E4%BA%94"><span class="nav-number">12.</span> <span class="nav-text">实验五</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="yhellow"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">yhellow</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">331</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">170</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yhellow</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">4.9m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">74:46</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

</body>
</html>
